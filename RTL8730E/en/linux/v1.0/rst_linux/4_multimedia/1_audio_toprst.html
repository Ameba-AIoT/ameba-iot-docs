

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Introduction &mdash; Ameba IoT Docs  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
      <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=7d84cf84" />
      <link rel="stylesheet" type="text/css" href="../../_static/tabs.css?v=a5c4661c" />
      <link rel="stylesheet" type="text/css" href="../../_static/_static/custom.css" />

  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../../_static/toggleprompt.js?v=d7ede5d2"></script>
        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
        <script>let toggleHintShow = 'Click to show';</script>
        <script>let toggleHintHide = 'Click to hide';</script>
        <script>let toggleOpenOnPrint = 'true';</script>
        <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="USB OTG" href="../7_usb/0_usb_index.html" />
    <link rel="prev" title="Multimedia" href="0_multimedia_index.html" />
   
  
  <script type="text/javascript" src="../../_static/js/selector.js"></script>

  <style>
    .wy-nav-content {max-width: 1000px;} /* 设置最大宽度 */
  </style>

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            Ameba IoT Docs
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../rst_rtos/0_ameba_product/0_ameba_product_center_index.html">Products Center</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rst_rtos/0_ameba_sdk/0_ameba_sdks_index.html">Ameba SDK</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_release_packages/0_release_packages_index.html">0.0 Release Packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_gcc_build_environment/0_gcc_build_index.html">0.1 Build Environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_sdk_architecture/0_sdk_architecture_index.html">0.2 SDK Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rst_rtos/0_tools/0_tools_index.html">0.7 Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_question_help/0_question_help_index.html">0.A Questions and Help</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_debugging/0_debugging_index.html">0.B System Debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1_boot_process/0_boot_index.html">1.1 BOOT Process</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1_ota/0_ota_index.html">1.2 OTA</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1_otpc/0_otpc_index.html">1.3 OTPC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1_flash/0_flash_index.html">1.4 Flash</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1_gpio/0_gpio_index.html">1.7 GPIO</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1_power_save/0_ps_index.html">1.8 Power Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_nda_secure_boot/0_secure_boot_index_nda.html">3.6 Secure Boot</a></li>
<li class="toctree-l1"><a class="reference internal" href="../7_usb_boot/0_usb_boot_index.html">3.7 USB Boot</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_crypto_engine/0_crypto_engine_index.html">3.8 Crypto Engine</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="0_multimedia_index.html">4.3 Multimedia</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Introduction</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#architecture">Architecture</a></li>
<li class="toctree-l3"><a class="reference internal" href="#implementation">Implementation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#configuration">Configuration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#dts-configuration">DTS Configuration</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#amplifier-configuration">Amplifier Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#sport-muti-io-configuration">SPORT Muti-io Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#sport-mclk-output-multiplier-set">SPORT MCLK Output Multiplier Set</a></li>
<li class="toctree-l4"><a class="reference internal" href="#sport-mclk-maximum-value-set">SPORT MCLK Maximum Value Set</a></li>
<li class="toctree-l4"><a class="reference internal" href="#sport-mode-set">SPORT Mode Set</a></li>
<li class="toctree-l4"><a class="reference internal" href="#sport-pinmux-set">SPORT Pinmux Set</a></li>
<li class="toctree-l4"><a class="reference internal" href="#dmic-configuration">DMIC Configuration</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#build-configuration">Build Configuration</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#apis">APIs</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#api-for-user-space">API for User Space</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#alsa-core-apis">ALSA Core APIs</a></li>
<li class="toctree-l4"><a class="reference internal" href="#tinyalsa-apis">tinyalsa APIs</a></li>
<li class="toctree-l4"><a class="reference internal" href="#alsa-lib-apis">ALSA-lib APIs</a></li>
<li class="toctree-l4"><a class="reference internal" href="#audio-clock-apis">Audio-clock APIs</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#debug-tools">Debug Tools</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#tinyalsa">tinyalsa</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#tinymix">tinymix</a></li>
<li class="toctree-l4"><a class="reference internal" href="#tinyplay">tinyplay</a></li>
<li class="toctree-l4"><a class="reference internal" href="#tinycap">tinycap</a></li>
<li class="toctree-l4"><a class="reference internal" href="#tinyhostless">tinyhostless</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#tinyalsa-extension">tinyalsa-extension</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#tinydownchplay">tinydownchplay</a></li>
<li class="toctree-l4"><a class="reference internal" href="#tinylooptest">tinylooptest</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#alsa-util">ALSA-util</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#amixer">amixer</a></li>
<li class="toctree-l4"><a class="reference internal" href="#aplay">aplay</a></li>
<li class="toctree-l4"><a class="reference internal" href="#arecord">arecord</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../7_usb/0_usb_index.html">7.1 USB Host &amp; Device</a></li>
<li class="toctree-l1"><a class="reference internal" href="../7_sdio/0_sdioh_index.html">7.2 SDIO Host</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_dmac/0_dmac_index.html">8.1 DMA Controllor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_rtc/0_rtc_index.html">8.2 RTC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_thermal/0_thermal_index.html">8.3 Thermal Meter</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_adc/0_adc_index.html">8.4 ADC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_cap_touch/0_cap_touch_index.html">8.5 Cap-Touch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_ir/0_ir_index.html">8.6 IR</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_ledc/0_ledc_index.html">8.7 LEDC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_i2c/0_i2c_index.html">8.8 I2C</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_uart/0_uart_index.html">8.9 UART</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_lcdc/0_lcdc_index.html">8.A LCDC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_spi/0_spi_index.html">8.B SPI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_spic/0_spic_index.html">8.C SPI Flash Controller</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_timer/0_timer_index.html">8.D Timer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_wdg/0_wdg_index.html">8.E Watchdog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../9_bluetooth/0_bluetooth_index.html">9.1 Bluetooth</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Ameba IoT Docs</a>
      </nav>

      <div class="wy-nav-content">

        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="0_multimedia_index.html">Multimedia</a></li>
      <li class="breadcrumb-item active">Introduction</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="introduction">
<span id="audio"></span><h1>Introduction<a class="headerlink" href="#introduction" title="Link to this heading"></a></h1>
<section id="architecture">
<h2>Architecture<a class="headerlink" href="#architecture" title="Link to this heading"></a></h2>
<p>Realtek’s audio driver follows Linux’s ALSA System on Chip (ASoC) architecture. ASoC provides better ALSA support for embedded system on chip processors and portable audio codecs.</p>
<ul class="simple">
<li><p>ALSA - Advanced Linux Sound Architecture.</p></li>
<li><p>ASoC - ALSA System on Chip.</p></li>
</ul>
<p>ASoC basically splits an embedded audio system into three re-usable component drivers:</p>
<ul class="simple">
<li><p>Codec driver - The codec driver is platform-independent and contains audio controls, audio interface capabilities, codec DAPM definition and codec IO functions.</p></li>
<li><p>Platform driver - The platform driver contains audio DMA engine and audio interface drivers for that platform.</p></li>
<li><p>Machine driver - The machine driver handles any machine specific controls and audio events, e.g. turning on an AMP at the start of playback.</p></li>
</ul>
<p>Realtek’s audio driver implements all above components, the architecture is illustrated in the following figure.</p>
<figure class="align-center">
<a class="reference internal image-reference" href="../../_images/audio_driver_arch.svg"><img alt="../../_images/audio_driver_arch.svg" height="462" src="../../_images/audio_driver_arch.svg" width="682" /></a>
</figure>
</section>
<section id="implementation">
<span id="linux-audio-implementation"></span><h2>Implementation<a class="headerlink" href="#implementation" title="Link to this heading"></a></h2>
<p>The implementation of Realtek’s audio driver lies in the following directories.</p>
<table class="docutils align-default" style="width: 100%">
<thead>
<tr class="row-odd"><th class="head"><p>Driver location</p></th>
<th class="head"><p>Introduction</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>&lt;linux&gt;/sound/soc/realtek/machine.c</p></td>
<td><p>Machine driver.</p>
<p>Describes which codec, dma, cpu_dai, codec_dai driver we use.</p>
</td>
</tr>
<tr class="row-odd"><td><p>&lt;linux&gt;/sound/soc/realtek/dma.c</p></td>
<td><p>DMA driver.</p></td>
</tr>
<tr class="row-even"><td><p>&lt;linux&gt;/sound/soc/realtek/sport.c</p></td>
<td><p>cpu_dai driver, which is the SPORT driver of audio codec.</p></td>
</tr>
<tr class="row-odd"><td><p>&lt;linux&gt;/sound/soc/realtek/ameba_sport.c</p></td>
<td><p>SPORT control APIs implementations.</p></td>
</tr>
<tr class="row-even"><td><p>&lt;linux&gt;/sound/soc/realtek/ameba_audio_clock.c</p></td>
<td><p>PLL clock framework.</p></td>
</tr>
<tr class="row-odd"><td><p>&lt;linux&gt;/sound/soc/realtek/ameba_audio_clock_driver.c</p></td>
<td><p>PLL clock driver.</p></td>
</tr>
<tr class="row-even"><td><p>&lt;linux&gt;/sound/soc/codecs/ameba-codec.c</p></td>
<td><p>codec_dai driver and codec driver.</p></td>
</tr>
<tr class="row-odd"><td><p>&lt;linux&gt;/sound/soc/codecs/ameba_audio.c</p></td>
<td><p>Codec control APIs implementations.</p></td>
</tr>
</tbody>
</table>
<p>Where <em>&lt;linux&gt;</em> means the kernel linux directory in sdk, which is <code class="docutils literal notranslate"><span class="pre">&lt;sdk&gt;/kernel/linux-5.4</span></code> for kernel 5.4.x, and <code class="docutils literal notranslate"><span class="pre">&lt;sdk&gt;/kernel/linux-6.6</span></code> for kernel 6.6.x, <strong>the same applies below</strong>.</p>
<ul>
<li><p>Audio driver Kconfig: <code class="docutils literal notranslate"><span class="pre">&lt;linux&gt;/sound/soc/Kconfig</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">source</span> <span class="s2">&quot;sound/soc/realtek/Kconfig&quot;</span>
</pre></div>
</div>
</li>
<li><p>Audio driver Makefile: <code class="docutils literal notranslate"><span class="pre">&lt;linux&gt;/sound/soc/Makefile</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>obj-$(CONFIG_SND_SOC)   += realtek/
</pre></div>
</div>
</li>
<li><p>Audio driver devices</p>
<p>The audio driver exports standard ALSA device to user space via <code class="docutils literal notranslate"><span class="pre">/dev/snd</span></code> when it is built into system. Check the following device node list in <code class="docutils literal notranslate"><span class="pre">/dev/snd</span></code> at runtime to check if the audio driver is working correctly.</p>
</li>
</ul>
<table class="docutils align-default" style="width: 100%">
<thead>
<tr class="row-odd"><th class="head"><p>Device nodes</p></th>
<th class="head"><p>Introduction</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>controlC0</p></td>
<td><p>Control device node for audio.</p>
<p>It’s used to set volume, mute, output device switch and input microphone number choice.</p>
</td>
</tr>
<tr class="row-odd"><td><p>pcmC0D0p</p></td>
<td><p>Device node for SPORT0 and internal audio codec output.</p></td>
</tr>
<tr class="row-even"><td><p>pcmC0D1c</p></td>
<td><p>Device node for SPORT1 and internal audio codec input.</p></td>
</tr>
<tr class="row-odd"><td><p>pcmC0D2p</p></td>
<td><p>Device node for SPORT2 I2S output.</p></td>
</tr>
<tr class="row-even"><td><p>pcmC0D2c</p></td>
<td><p>Device node for SPORT2 I2S input.</p></td>
</tr>
<tr class="row-odd"><td><p>pcmC0D3p</p></td>
<td><p>Device node for SPORT3 I2S output.</p></td>
</tr>
<tr class="row-even"><td><p>pcmC0D3c</p></td>
<td><p>Device node for SPORT3 I2S input.</p></td>
</tr>
</tbody>
</table>
<p>The implementation supports the following audio types:</p>
<ul>
<li><p>Audio Playback: Currently supports the following audio types for playback using <em>pcmC0D0p</em>/<em>pcmC0D2p</em> &amp; <em>pcmC0D3p</em>.</p>
<table class="docutils align-default" style="width: 100%">
<thead>
<tr class="row-odd"><th class="head"><p>Device node</p></th>
<th class="head"><p>Audio types</p></th>
<th class="head"><p>Format support</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>pcmC0D0p</p></td>
<td><p>Audio Format</p></td>
<td><ul class="simple">
<li><p>SNDRV_PCM_FORMAT_S16_LE</p></li>
<li><p>SNDRV_PCM_FORMAT_S24_LE</p></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><p>pcmC0D0p</p></td>
<td><p>Channel</p></td>
<td><ul class="simple">
<li><p>Mono</p></li>
<li><p>Stereo</p></li>
</ul>
</td>
</tr>
<tr class="row-even"><td><p>pcmC0D0p</p></td>
<td><p>Sample Rate</p></td>
<td><ul class="simple">
<li><p>8000</p></li>
<li><p>11025</p></li>
<li><p>16000</p></li>
<li><p>22050</p></li>
<li><p>32000</p></li>
<li><p>44100</p></li>
<li><p>48000</p></li>
<li><p>88200</p></li>
<li><p>96000</p></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><p>pcmC0D2p &amp; pcmC0D3p</p></td>
<td><p>Audio Format</p></td>
<td><ul class="simple">
<li><p>SNDRV_PCM_FORMAT_S16_LE</p></li>
<li><p>SNDRV_PCM_FORMAT_S20_LE</p></li>
<li><p>SNDRV_PCM_FORMAT_S24_LE</p></li>
<li><p>SNDRV_PCM_FORMAT_S32_LE</p></li>
</ul>
</td>
</tr>
<tr class="row-even"><td><p>pcmC0D2p &amp; pcmC0D3p</p></td>
<td><p>Channel</p></td>
<td><ul class="simple">
<li><p>Mono</p></li>
<li><p>Stereo</p></li>
<li><p>Quad multi-io</p></li>
<li><p>Quad TDM</p></li>
<li><p>6 channel TDM</p></li>
<li><p>6 channel multi-io</p></li>
<li><p>8 channel TDM</p></li>
<li><p>8 channel multi-io</p></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><p>pcmC0D2p &amp; pcmC0D3p</p></td>
<td><p>Sample Rate</p></td>
<td><ul class="simple">
<li><p>8000</p></li>
<li><p>11025</p></li>
<li><p>16000</p></li>
<li><p>22050</p></li>
<li><p>32000</p></li>
<li><p>44100</p></li>
<li><p>48000</p></li>
<li><p>88200</p></li>
<li><p>96000</p></li>
</ul>
</td>
</tr>
</tbody>
</table>
</li>
<li><p>Audio Capture: Currently supports the following audio types for capture using <em>pcmC0D1c</em>/<em>pcmC0D2c</em> &amp; <em>pcmC0D3c</em>.</p>
<table class="docutils align-default" style="width: 100%">
<thead>
<tr class="row-odd"><th class="head"><p>Device node</p></th>
<th class="head"><p>Audio types</p></th>
<th class="head"><p>Format support</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>pcmC0D1c</p></td>
<td><p>Audio Format</p></td>
<td><ul class="simple">
<li><p>SNDRV_PCM_FORMAT_S16_LE</p></li>
<li><p>SNDRV_PCM_FORMAT_S24_LE</p></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><p>pcmC0D1c</p></td>
<td><p>Channel</p></td>
<td><ul class="simple">
<li><p>mono</p></li>
<li><p>Stereo</p></li>
<li><p>4 Channel (2 Channel Mic Data + 2 Channel Reference Data)</p></li>
</ul>
</td>
</tr>
<tr class="row-even"><td><p>pcmC0D1c</p></td>
<td><p>Sample Rate</p></td>
<td><ul class="simple">
<li><p>8000</p></li>
<li><p>11025</p></li>
<li><p>16000</p></li>
<li><p>22050</p></li>
<li><p>32000</p></li>
<li><p>44100</p></li>
<li><p>48000</p></li>
<li><p>88200</p></li>
<li><p>96000</p></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><p>pcmC0D2c &amp; pcmC0D3c</p></td>
<td><p>Audio Format</p></td>
<td><ul class="simple">
<li><p>SNDRV_PCM_FORMAT_S16_LE</p></li>
<li><p>SNDRV_PCM_FORMAT_S20_LE</p></li>
<li><p>SNDRV_PCM_FORMAT_S24_LE</p></li>
<li><p>SNDRV_PCM_FORMAT_S32_LE</p></li>
</ul>
</td>
</tr>
<tr class="row-even"><td><p>pcmC0D2c &amp; pcmC0D3c</p></td>
<td><p>Channel</p></td>
<td><ul class="simple">
<li><p>Mono</p></li>
<li><p>Stereo</p></li>
<li><p>Quad multi-io</p></li>
<li><p>Quad TDM</p></li>
<li><p>6 channel TDM</p></li>
<li><p>6 channel multi-io</p></li>
<li><p>8 channel TDM</p></li>
<li><p>8 channel multi-io</p></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><p>pcmC0D2c &amp; pcmC0D3c</p></td>
<td><p>Sample Rate</p></td>
<td><ul class="simple">
<li><p>8000</p></li>
<li><p>11025</p></li>
<li><p>16000</p></li>
<li><p>22050</p></li>
<li><p>32000</p></li>
<li><p>44100</p></li>
<li><p>48000</p></li>
<li><p>88200</p></li>
<li><p>96000</p></li>
</ul>
</td>
</tr>
</tbody>
</table>
</li>
<li><p>Audio Control: Currently supports the following audio control settings using <em>controlC0</em>.</p>
<table class="docutils align-default" style="width: 100%">
<thead>
<tr class="row-odd"><th class="head"><p>CTL No.</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Number</p></th>
<th class="head"><p>Name</p></th>
<th class="head"><p>Default Value</p></th>
<th class="head"><p>Introduction</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0</p></td>
<td><p>INT</p></td>
<td><p>2</p></td>
<td><p>DAC Volume</p></td>
<td><p>128, 128</p></td>
<td><p>Left Channel/Right Channel Volume[0~175]</p></td>
</tr>
<tr class="row-odd"><td><p>1</p></td>
<td><p>BOOL</p></td>
<td><p>2</p></td>
<td><p>DAC Mute</p></td>
<td><p>Off, Off</p></td>
<td><p>Left Channel/Right Channel mute</p>
<ul class="simple">
<li><p>Off: unmute</p></li>
<li><p>On: mute</p></li>
</ul>
</td>
</tr>
<tr class="row-even"><td><p>2</p></td>
<td><p>INT</p></td>
<td><p>1</p></td>
<td><p>AD0 Volume</p></td>
<td><p>47</p></td>
<td><p>ADC0 Volume[0~175]</p></td>
</tr>
<tr class="row-odd"><td><p>3</p></td>
<td><p>INT</p></td>
<td><p>1</p></td>
<td><p>AD1 Volume</p></td>
<td><p>47</p></td>
<td><p>ADC1 Volume[0~175]</p></td>
</tr>
<tr class="row-even"><td><p>4</p></td>
<td><p>INT</p></td>
<td><p>1</p></td>
<td><p>AD2 Volume</p></td>
<td><p>47</p></td>
<td><p>ADC2 Volume[0~175]</p></td>
</tr>
<tr class="row-odd"><td><p>5</p></td>
<td><p>INT</p></td>
<td><p>1</p></td>
<td><p>AD3 Volume</p></td>
<td><p>47</p></td>
<td><p>ADC3 Volume[0~175]</p></td>
</tr>
<tr class="row-even"><td><p>6</p></td>
<td><p>INT</p></td>
<td><p>1</p></td>
<td><p>AD4 Volume</p></td>
<td><p>47</p></td>
<td><p>ADC4 Volume[0~175]</p></td>
</tr>
<tr class="row-odd"><td><p>7</p></td>
<td><p>INT</p></td>
<td><p>1</p></td>
<td><p>AD5 Volume</p></td>
<td><p>47</p></td>
<td><p>ADC5 Volume[0~175]</p></td>
</tr>
<tr class="row-even"><td><p>8</p></td>
<td><p>INT</p></td>
<td><p>1</p></td>
<td><p>AD6 Volume</p></td>
<td><p>47</p></td>
<td><p>ADC6 Volume[0~175]</p></td>
</tr>
<tr class="row-odd"><td><p>9</p></td>
<td><p>INT</p></td>
<td><p>1</p></td>
<td><p>AD7 Volume</p></td>
<td><p>47</p></td>
<td><p>ADC7 Volume[0~175]</p></td>
</tr>
<tr class="row-even"><td><p>10</p></td>
<td><p>BYTE</p></td>
<td><p>5</p></td>
<td><p>MICBST AMIC1-5 GAIN</p></td>
<td><p>06, 06, 06, 06, 06</p></td>
<td><p>GAIN of 5 AMICS</p>
<p>GAIN can be (0, 1, 2, 3, 4, 5, 6, 7, 8)</p>
</td>
</tr>
<tr class="row-odd"><td><p>11</p></td>
<td><p>INT</p></td>
<td><p>2</p></td>
<td><p>Zero Dect Timeout</p></td>
<td><p>0, 0</p></td>
<td><p>Left Channel/Right Channel zero detect timeout</p>
<ul class="simple">
<li><p>0: 1024*16 samples</p></li>
<li><p>1: 1024*32 samples</p></li>
<li><p>2: 1024*64 samples</p></li>
<li><p>3: 64 samples</p></li>
</ul>
</td>
</tr>
<tr class="row-even"><td><p>12</p></td>
<td><p>INT</p></td>
<td><p>1</p></td>
<td><p>Choice Device</p></td>
<td><p>0</p></td>
<td><ul class="simple">
<li><p>0: Speaker output</p></li>
<li><p>1: Headphone output</p></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><p>13</p></td>
<td><p>INT</p></td>
<td><p>1</p></td>
<td><p>Choice MIC 0:AMIC 1:DMIC</p></td>
<td><p>0</p></td>
<td><ul class="simple">
<li><p>0: Record from AMIC</p></li>
<li><p>1: Record from DMIC</p></li>
</ul>
</td>
</tr>
<tr class="row-even"><td><p>14</p></td>
<td><p>BYTE</p></td>
<td><p>8</p></td>
<td><p>Choice AMIC tdm-8 slot</p></td>
<td><p>01, 02, 03, 03, 03, 03, 03, 03</p></td>
<td><p>Define the AMIC number used to capture data</p></td>
</tr>
<tr class="row-odd"><td><p>15</p></td>
<td><p>BYTE</p></td>
<td><p>8</p></td>
<td><p>Choice DMIC tdm-8 slot</p></td>
<td><p>01, 02, 03, 04, 04, 04, 04, 04</p></td>
<td><p>Define the DMIC number used to capture data</p></td>
</tr>
</tbody>
</table>
</li>
</ul>
</section>
</section>
<section id="configuration">
<h1>Configuration<a class="headerlink" href="#configuration" title="Link to this heading"></a></h1>
<section id="dts-configuration">
<span id="linux-audio-dts-configuration"></span><h2>DTS Configuration<a class="headerlink" href="#dts-configuration" title="Link to this heading"></a></h2>
<p>Audio DTS makes audio driver more flexible for different hardware. User can change DTS according to the specific hardware. Be aware that, after changing DTS, make sure it has no conflict with other modules.</p>
<p>In this section, <em>&lt;dts_dir&gt;</em> means the directory of dts files, which is <code class="docutils literal notranslate"><span class="pre">&lt;sdk&gt;/kernel/linux-5.4/arch/arm/boot/dts</span></code> for kernel 5.4.x, and <code class="docutils literal notranslate"><span class="pre">&lt;sdk&gt;/kernel/linux-6.6/arch/arm/boot/dts/realtek/ameba</span></code> for kernel 6.6.x.</p>
<section id="amplifier-configuration">
<h3>Amplifier Configuration<a class="headerlink" href="#amplifier-configuration" title="Link to this heading"></a></h3>
<p>Change the following DTS GPIO configuration of amplifier enable pins according to different boards.</p>
<ol class="arabic">
<li><p>Change <code class="docutils literal notranslate"><span class="pre">&lt;dts_dir&gt;/rtl8730e-pinctrl.dtsi</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>audio_ext_amp_pins:audio_ext_pin@0 {
pins {
   pinmux = &lt;REALTEK_PINMUX(&#39;B&#39;, 7, GPIO)&gt;;  //using PB7 for amplifier enable pin
      ……
   };
};
</pre></div>
</div>
</li>
<li><p>Change your product’s amplifier pinmux setting in DTS. For example, if you launch <em>generic_rtl8730elh_va8-eng</em>, please change <code class="docutils literal notranslate"><span class="pre">&lt;dts_dir&gt;/rtl8730elh-va8-generic.dts</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&amp;</span><span class="n">codec</span><span class="p">{</span>
   <span class="n">pinctrl</span><span class="o">-</span><span class="n">names</span> <span class="o">=</span> <span class="s2">&quot;default&quot;</span><span class="p">;</span>
   <span class="n">pinctrl</span><span class="o">-</span><span class="mi">0</span> <span class="o">=</span> <span class="o">&lt;&amp;</span><span class="n">audio_ext_amp_pins</span><span class="o">&gt;</span><span class="p">;</span>
   <span class="n">ext_amp_gpio</span> <span class="o">=</span> <span class="o">&lt;&amp;</span><span class="n">gpiob</span> <span class="mi">7</span> <span class="mi">0</span><span class="o">&gt;</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
</li>
</ol>
</section>
<section id="sport-muti-io-configuration">
<h3>SPORT Muti-io Configuration<a class="headerlink" href="#sport-muti-io-configuration" title="Link to this heading"></a></h3>
<p>The SPORT2/SPORT3 I2S is for data transmission with external audio codec. It can be TDM or multi-io. Configure it according to the hardware of your board.</p>
<p>Take the <em>rtl8730elh-va8</em> demo board, generic project’s dts config for example.</p>
<ul>
<li><p>Example: how to set SPORT2 as multi-io.</p>
<p>Change <code class="docutils literal notranslate"><span class="pre">&lt;dts_dir&gt;/rtl8730elh-va8-generic.dts</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&amp;</span><span class="n">sport2</span> <span class="p">{</span>
   <span class="n">rtk</span><span class="p">,</span><span class="n">sport</span><span class="o">-</span><span class="n">multi</span><span class="o">-</span><span class="n">io</span> <span class="o">=</span> <span class="o">&lt;</span><span class="mi">1</span><span class="o">&gt;</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
</li>
<li><p>Example: how to set SPORT3 as TDM.</p>
<p>Change <code class="docutils literal notranslate"><span class="pre">&lt;dts_dir&gt;/rtl8730elh-va8-generic.dts</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&amp;</span><span class="n">sport3</span> <span class="p">{</span>
   <span class="n">rtk</span><span class="p">,</span><span class="n">sport</span><span class="o">-</span><span class="n">multi</span><span class="o">-</span><span class="n">io</span> <span class="o">=</span> <span class="o">&lt;</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
</li>
</ul>
</section>
<section id="sport-mclk-output-multiplier-set">
<h3>SPORT MCLK Output Multiplier Set<a class="headerlink" href="#sport-mclk-output-multiplier-set" title="Link to this heading"></a></h3>
<p>The SPORT2/SPORT3 I2S is for data transmission with external audio codec. Some external audio codec needs SPORT to provide MCLK to them. They may have requirements like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">External</span> <span class="n">audio</span> <span class="n">codec</span> <span class="n">MCLK</span> <span class="o">=</span> <span class="n">multiplier</span> <span class="o">*</span> <span class="n">sport_MCLK</span>
</pre></div>
</div>
<p>At this case, add the multiplier in DTS to notify SPORT driver the information, so that SPORT driver will calculate the right PLL clock for specific data streaming sample rate.</p>
<p>Take the <em>rtl8730elh-va8</em> demo board, generic project’s dts config for example:</p>
<p>Change <code class="docutils literal notranslate"><span class="pre">&lt;dts_dir&gt;/rtl8730elh-va8-generic.dts</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&amp;</span><span class="n">sport2</span> <span class="p">{</span>
   <span class="n">rtk</span><span class="p">,</span><span class="n">sport</span><span class="o">-</span><span class="n">mclk</span><span class="o">-</span><span class="n">multiplier</span> <span class="o">=</span> <span class="o">&lt;</span><span class="mi">256</span><span class="o">&gt;</span>
<span class="p">};</span>
</pre></div>
</div>
</section>
<section id="sport-mclk-maximum-value-set">
<h3>SPORT MCLK Maximum Value Set<a class="headerlink" href="#sport-mclk-maximum-value-set" title="Link to this heading"></a></h3>
<p>The SPORT2/SPORT3 I2S is for data transmission with external audio codec. Some external audio codec needs SPORT to provide MCLK to them. They may have requirements like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">External</span> <span class="n">audio</span> <span class="n">codec</span> <span class="n">MCLK</span> <span class="o">&lt;=</span> <span class="n">fixed_sport_MCLK</span>
</pre></div>
</div>
<p>At this case, add the maximum value of MCLK in DTS to notify SPORT driver the information, so that SPORT driver will calculate the right PLL clock for specific data streaming sample rate.</p>
<p>Take the <em>rtl8730elh-va8</em> demo board, generic project’s dts config for example:</p>
<p>Change <code class="docutils literal notranslate"><span class="pre">&lt;dts_dir&gt;/rtl8730elh-va8-generic.dts</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&amp;</span><span class="n">sport2</span> <span class="p">{</span>
   <span class="n">rtk</span><span class="p">,</span><span class="n">sport</span><span class="o">-</span><span class="n">mclk</span><span class="o">-</span><span class="n">fixed</span><span class="o">-</span><span class="nb">max</span> <span class="o">=</span> <span class="o">&lt;</span><span class="mi">12288000</span><span class="o">&gt;</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
<p>To be noticed: <em>rtk,sport-mclk-multiplier</em> and <em>rtk,sport-mclk-fixed-max</em> should not be set at the same time, otherwise driver will be confused.</p>
</section>
<section id="sport-mode-set">
<h3>SPORT Mode Set<a class="headerlink" href="#sport-mode-set" title="Link to this heading"></a></h3>
<p>The SPORT supports both master mode and slave mode.</p>
<p>Set the correct mode you need in your project’s dts. For example, if you launch <em>generic_rtl8730elh_va8-eng</em>, please change <code class="docutils literal notranslate"><span class="pre">&lt;dts_dir&gt;/rtl8730elh-va8-generic.dts</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&amp;</span><span class="n">sport2</span> <span class="p">{</span>
   <span class="n">rtk</span><span class="p">,</span><span class="n">sport</span><span class="o">-</span><span class="n">mode</span> <span class="o">=</span> <span class="o">&lt;</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">;</span> <span class="o">//</span> <span class="mi">0</span><span class="p">,</span><span class="n">soc</span> <span class="ow">is</span> <span class="n">master</span><span class="o">.</span> <span class="mi">1</span><span class="p">,</span> <span class="n">soc</span> <span class="ow">is</span> <span class="n">slave</span><span class="o">.</span>
<span class="p">};</span>
</pre></div>
</div>
</section>
<section id="sport-pinmux-set">
<h3>SPORT Pinmux Set<a class="headerlink" href="#sport-pinmux-set" title="Link to this heading"></a></h3>
<p>The SPORT2/SPORT3 I2S needs to set the pinmux to interact with external codec.</p>
<ol class="arabic">
<li><p>The I2S pinmux is set in <code class="docutils literal notranslate"><span class="pre">&lt;dts_dir&gt;/rtl8730e-pinctrl.dtsi</span></code>. If your board’s pinmux is different, config it. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">i2s2_pins</span><span class="p">:</span> <span class="n">i2s2</span><span class="o">@</span><span class="mi">0</span> <span class="p">{</span>
   <span class="n">pins</span> <span class="p">{</span>
      <span class="n">pinmux</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">REALTEK_PINMUX</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="n">I2S2</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span><span class="o">//</span><span class="n">change</span> <span class="n">your</span> <span class="n">pinmux</span>
      <span class="o">&lt;</span><span class="n">REALTEK_PINMUX</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="n">I2S2</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span>  <span class="o">//</span><span class="n">change</span> <span class="n">your</span> <span class="n">pinmux</span>
      <span class="o">&lt;</span><span class="n">REALTEK_PINMUX</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">I2S2</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span>  <span class="o">//</span><span class="n">change</span> <span class="n">your</span> <span class="n">pinmux</span>
      <span class="o">&lt;</span><span class="n">REALTEK_PINMUX</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="n">I2S2</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span>  <span class="o">//</span><span class="n">change</span> <span class="n">your</span> <span class="n">pinmux</span>
      <span class="o">&lt;</span><span class="n">REALTEK_PINMUX</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="n">I2S2</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span>  <span class="o">//</span><span class="n">change</span> <span class="n">your</span> <span class="n">pinmux</span>
      <span class="o">&lt;</span><span class="n">REALTEK_PINMUX</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="n">I2S2</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span>  <span class="o">//</span><span class="n">change</span> <span class="n">your</span> <span class="n">pinmux</span>
      <span class="o">&lt;</span><span class="n">REALTEK_PINMUX</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="n">I2S2</span><span class="p">)</span><span class="o">&gt;</span><span class="p">;</span>  <span class="o">//</span><span class="n">change</span> <span class="n">your</span> <span class="n">pinmux</span>
      <span class="n">bias</span><span class="o">-</span><span class="n">disable</span><span class="p">;</span>  <span class="o">//</span><span class="n">bias</span><span class="o">-</span><span class="n">disable</span><span class="o">/</span><span class="n">bias</span><span class="o">-</span><span class="n">pull</span><span class="o">-</span><span class="n">up</span><span class="o">/</span><span class="n">bias</span><span class="o">-</span><span class="n">pull</span><span class="o">-</span><span class="n">down</span>
      <span class="n">slew</span><span class="o">-</span><span class="n">rate</span> <span class="o">=</span> <span class="o">&lt;</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">;</span>
      <span class="n">drive</span><span class="o">-</span><span class="n">strength</span> <span class="o">=</span> <span class="o">&lt;</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">;</span>
   <span class="p">};</span>
<span class="p">};</span>
<span class="n">i2s3_pins</span><span class="p">:</span> <span class="n">i2s3</span><span class="o">@</span><span class="mi">0</span> <span class="p">{</span>
   <span class="n">pins</span> <span class="p">{</span>
      <span class="n">pinmux</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">REALTEK_PINMUX</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="n">I2S3</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">//</span><span class="n">change</span> <span class="n">your</span> <span class="n">pinmux</span>
      <span class="o">&lt;</span><span class="n">REALTEK_PINMUX</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="n">I2S3</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span>   <span class="o">//</span><span class="n">change</span> <span class="n">your</span> <span class="n">pinmux</span>
      <span class="o">&lt;</span><span class="n">REALTEK_PINMUX</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="n">I2S3</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span>   <span class="o">//</span><span class="n">change</span> <span class="n">your</span> <span class="n">pinmux</span>
      <span class="o">&lt;</span><span class="n">REALTEK_PINMUX</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="mi">29</span><span class="p">,</span> <span class="n">I2S3</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span>  <span class="o">//</span><span class="n">change</span> <span class="n">your</span> <span class="n">pinmux</span>
      <span class="o">&lt;</span><span class="n">REALTEK_PINMUX</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="n">I2S3</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span>  <span class="o">//</span><span class="n">change</span> <span class="n">your</span> <span class="n">pinmux</span>
      <span class="o">&lt;</span><span class="n">REALTEK_PINMUX</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="n">I2S3</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span>  <span class="o">//</span><span class="n">change</span> <span class="n">your</span> <span class="n">pinmux</span>
      <span class="o">&lt;</span><span class="n">REALTEK_PINMUX</span><span class="p">(</span><span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">I2S3</span><span class="p">)</span><span class="o">&gt;</span><span class="p">;</span>   <span class="o">//</span><span class="n">change</span> <span class="n">your</span> <span class="n">pinmux</span>
      <span class="n">bias</span><span class="o">-</span><span class="n">disable</span><span class="p">;</span>  <span class="o">//</span><span class="n">bias</span><span class="o">-</span><span class="n">disable</span><span class="o">/</span><span class="n">bias</span><span class="o">-</span><span class="n">pull</span><span class="o">-</span><span class="n">up</span><span class="o">/</span><span class="n">bias</span><span class="o">-</span><span class="n">pull</span><span class="o">-</span><span class="n">down</span>
      <span class="n">slew</span><span class="o">-</span><span class="n">rate</span> <span class="o">=</span> <span class="o">&lt;</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">;</span>
      <span class="n">drive</span><span class="o">-</span><span class="n">strength</span> <span class="o">=</span> <span class="o">&lt;</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">;</span>
   <span class="p">};</span>
<span class="p">};</span>
</pre></div>
</div>
</li>
</ol>
<p>Make sure to use the i2s pinmux in your project’s dts. For example, if you launch <em>generic_rtl8730elh_va8-eng</em> and need to use i2s2_pins in SPORT2, add i2s in the SPORT2 part in <code class="docutils literal notranslate"><span class="pre">&lt;dts_dir&gt;/rtl8730elh-va8-generic.dts</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&amp;</span><span class="n">sport2</span> <span class="p">{</span>
   <span class="n">pinctrl</span><span class="o">-</span><span class="n">names</span> <span class="o">=</span> <span class="s2">&quot;default&quot;</span><span class="p">;</span>
   <span class="n">spinctrl</span><span class="o">-</span><span class="mi">0</span> <span class="o">=</span> <span class="o">&lt;&amp;</span><span class="n">i2s2_pins</span><span class="o">&gt;</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
</section>
<section id="dmic-configuration">
<h3>DMIC Configuration<a class="headerlink" href="#dmic-configuration" title="Link to this heading"></a></h3>
<p>DMIC is not enabled by default. If you want to test the DMIC, follow the steps below:</p>
<p>There are two groups of DMIC pinmux in <code class="docutils literal notranslate"><span class="pre">&lt;dts_dir&gt;/rtl8730e-pinctrl.dtsi</span></code>. Choose the one you use, and you can also change it according to your hardware.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dmic_pins_a</span><span class="p">:</span> <span class="n">dmic</span><span class="o">@</span><span class="mi">0</span> <span class="p">{</span> <span class="o">//</span> <span class="n">Fixed</span> <span class="k">for</span> <span class="n">EV730EL0_3V0</span> <span class="n">demo</span> <span class="n">board</span>
   <span class="n">pins</span> <span class="p">{</span>
      <span class="n">pinmux</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">REALTEK_PINMUX</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="n">DMIC</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span><span class="o">//</span><span class="n">change</span> <span class="n">your</span> <span class="n">pinmux</span>
      <span class="o">&lt;</span><span class="n">REALTEK_PINMUX</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="n">DMIC</span><span class="p">)</span><span class="o">&gt;</span><span class="p">;</span>  <span class="o">//</span><span class="n">change</span> <span class="n">your</span> <span class="n">pinmux</span>
      <span class="n">bias</span><span class="o">-</span><span class="n">disable</span><span class="p">;</span>  <span class="o">//</span><span class="n">bias</span><span class="o">-</span><span class="n">disable</span><span class="o">/</span><span class="n">bias</span><span class="o">-</span><span class="n">pull</span><span class="o">-</span><span class="n">up</span><span class="o">/</span><span class="n">bias</span><span class="o">-</span><span class="n">pull</span><span class="o">-</span><span class="n">down</span>
      <span class="n">slew</span><span class="o">-</span><span class="n">rate</span> <span class="o">=</span> <span class="o">&lt;</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">;</span>
      <span class="n">drive</span><span class="o">-</span><span class="n">strength</span> <span class="o">=</span> <span class="o">&lt;</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">;</span>
   <span class="p">};</span>
<span class="p">};</span>
<span class="n">dmic_pins_b</span><span class="p">:</span> <span class="n">dmic</span><span class="o">@</span><span class="mi">1</span> <span class="p">{</span>
   <span class="n">pins</span> <span class="p">{</span>
      <span class="n">pinmux</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">REALTEK_PINMUX</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">DMIC</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">//</span><span class="n">change</span> <span class="n">your</span> <span class="n">pinmux</span>
      <span class="o">&lt;</span><span class="n">REALTEK_PINMUX</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="n">DMIC</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span>  <span class="o">//</span><span class="n">change</span> <span class="n">your</span> <span class="n">pinmux</span>
      <span class="o">&lt;</span><span class="n">REALTEK_PINMUX</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="n">DMIC</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span>  <span class="o">//</span><span class="n">change</span> <span class="n">your</span> <span class="n">pinmux</span>
      <span class="o">&lt;</span><span class="n">REALTEK_PINMUX</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="n">DMIC</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span>  <span class="o">//</span><span class="n">change</span> <span class="n">your</span> <span class="n">pinmux</span>
      <span class="o">&lt;</span><span class="n">REALTEK_PINMUX</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="n">DMIC</span><span class="p">)</span><span class="o">&gt;</span><span class="p">;</span>  <span class="o">//</span><span class="n">change</span> <span class="n">your</span> <span class="n">pinmux</span>
      <span class="n">bias</span><span class="o">-</span><span class="n">disable</span><span class="p">;</span>  <span class="o">//</span><span class="n">bias</span><span class="o">-</span><span class="n">disable</span><span class="o">/</span><span class="n">bias</span><span class="o">-</span><span class="n">pull</span><span class="o">-</span><span class="n">up</span><span class="o">/</span><span class="n">bias</span><span class="o">-</span><span class="n">pull</span><span class="o">-</span><span class="n">down</span>
      <span class="n">slew</span><span class="o">-</span><span class="n">rate</span> <span class="o">=</span> <span class="o">&lt;</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">;</span>
      <span class="n">drive</span><span class="o">-</span><span class="n">strength</span> <span class="o">=</span> <span class="o">&lt;</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">;</span>
   <span class="p">};</span>
<span class="p">};</span>
</pre></div>
</div>
<p>Make sure to use the dmic pinmux in your project’s dts. For example, if you launch <em>generic_rtl8730elh_va8-eng</em> and need to use dmic_pins_a, change <code class="docutils literal notranslate"><span class="pre">&lt;dts_dir&gt;/rtl8730elh-va8-generic.dts</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&amp;</span><span class="n">codec</span><span class="p">{</span>
   <span class="n">pinctrl</span><span class="o">-</span><span class="n">names</span> <span class="o">=</span> <span class="s2">&quot;default&quot;</span><span class="p">,</span> <span class="s2">&quot;default&quot;</span><span class="p">;</span>
   <span class="n">pinctrl</span><span class="o">-</span><span class="mi">0</span> <span class="o">=</span> <span class="o">&lt;&amp;</span><span class="n">audio_ext_amp_pins</span><span class="o">&gt;</span><span class="p">;</span>
      <span class="n">pinctrl</span><span class="o">-</span><span class="mi">1</span> <span class="o">=</span> <span class="o">&lt;&amp;</span><span class="n">dmic_pins_a</span><span class="o">&gt;</span><span class="p">;</span>
      <span class="n">ext_amp_gpio</span> <span class="o">=</span> <span class="o">&lt;&amp;</span><span class="n">gpiob</span> <span class="mi">7</span> <span class="mi">0</span><span class="o">&gt;</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
</section>
</section>
<section id="build-configuration">
<h2>Build Configuration<a class="headerlink" href="#build-configuration" title="Link to this heading"></a></h2>
<p>The configuration of audio driver is already set <em>y</em> by default.</p>
<p>To change audio driver configuration, type command, then select the menu in order.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="n">kernel_menuconfig</span>
</pre></div>
</div>
<figure class="align-center">
<a class="reference internal image-reference" href="../../_images/audio_kernel_menuconfig.svg"><img alt="../../_images/audio_kernel_menuconfig.svg" height="721" src="../../_images/audio_kernel_menuconfig.svg" width="1023" /></a>
</figure>
</section>
</section>
<section id="apis">
<h1>APIs<a class="headerlink" href="#apis" title="Link to this heading"></a></h1>
<section id="api-for-user-space">
<h2>API for User Space<a class="headerlink" href="#api-for-user-space" title="Link to this heading"></a></h2>
<p>The audio driver exports two layers of interfaces to meet customer’s requirements.</p>
<table class="docutils align-default" style="width: 100%">
<thead>
<tr class="row-odd"><th class="head"><p>API layers</p></th>
<th class="head"><p>Introduction</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>tinyalsa or ALSA-lib API</p></td>
<td><p>Third-party user space API of Advanced Linux Sound Architecture</p></td>
</tr>
<tr class="row-odd"><td><p>ALSA open,close,ioctl API</p></td>
<td><p>Standard Linux driver API</p></td>
</tr>
</tbody>
</table>
<p>The two layers of interfaces relationship is shown as below.</p>
<figure class="align-center">
<a class="reference internal image-reference" href="../../_images/audio_driver_api_layers.png"><img alt="../../_images/audio_driver_api_layers.png" src="../../_images/audio_driver_api_layers.png" style="width: 767.1999999999999px; height: 158.89999999999998px;" /></a>
</figure>
<section id="alsa-core-apis">
<h3>ALSA Core APIs<a class="headerlink" href="#alsa-core-apis" title="Link to this heading"></a></h3>
<p>The audio driver exports standard ALSA interfaces to user space.</p>
<table class="docutils align-default" style="width: 100%">
<thead>
<tr class="row-odd"><th class="head"><p>Interfaces</p></th>
<th class="head"><p>Introduction</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>open</p></td>
<td><p>Open an ALSA device (pcmC0D0p, pcmC0D1c, pcmC0D2p, pcmC0D2c, pcmC0D3p, pcmC0D3c, controlC0)</p></td>
</tr>
<tr class="row-odd"><td><p>close</p></td>
<td><p>Close an ALSA device</p></td>
</tr>
<tr class="row-even"><td><p>ioctl</p></td>
<td><p>Interaction with ALSA driver to read, write stream, or set volume/mute</p></td>
</tr>
</tbody>
</table>
</section>
<section id="tinyalsa-apis">
<h3>tinyalsa APIs<a class="headerlink" href="#tinyalsa-apis" title="Link to this heading"></a></h3>
<p>tinyalsa is a small library to interface with ALSA in the Linux kernel. It is open-source.</p>
<p>The aims are:</p>
<ul class="simple">
<li><p>Provide a basic PCM and mixer API.</p></li>
<li><p>Avoid supporting complex and unnecessary operations, which could be dealt with at a higher level.</p></li>
</ul>
<section id="control-apis">
<h4>Control APIs<a class="headerlink" href="#control-apis" title="Link to this heading"></a></h4>
<p>Here are some commonly used APIs to set control elements values.</p>
<table class="docutils align-default" style="width: 100%">
<thead>
<tr class="row-odd"><th class="head"><p>Interfaces</p></th>
<th class="head"><p>Introduction</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>mixer_open</p></td>
<td><p>Open a mixer</p></td>
</tr>
<tr class="row-odd"><td><p>mixer_close</p></td>
<td><p>Close a mixer</p></td>
</tr>
<tr class="row-even"><td><p>mixer_get_num_ctls</p></td>
<td><p>Get number of mixer controls</p></td>
</tr>
<tr class="row-odd"><td><p>mixer_get_ctl</p></td>
<td><p>Get mixer control of specific id</p></td>
</tr>
<tr class="row-even"><td><p>mixer_ctl_get_name</p></td>
<td><p>Get name of a mixer control</p></td>
</tr>
<tr class="row-odd"><td><p>mixer_get_ctl_by_name</p></td>
<td><p>Get mixer control by name</p></td>
</tr>
<tr class="row-even"><td><p>mixer_ctl_get_value</p></td>
<td><p>Get value of mixer control</p></td>
</tr>
<tr class="row-odd"><td><p>mixer_ctl_set_value</p></td>
<td><p>Set value of mixer control</p></td>
</tr>
<tr class="row-even"><td><p>mixer_ctl_set_array</p></td>
<td><p>Set array value of mixer control</p></td>
</tr>
</tbody>
</table>
<p>For more details of API, refer to <a class="reference external" href="https://github.com/tinyalsa/tinyalsa">github tinyalsa</a>.</p>
<p>Here is an example showing how to use control APIs to set audio volume.</p>
<ol class="arabic">
<li><p>Create string of volume control:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">char</span> <span class="n">mixer_ctl_name</span><span class="p">[</span><span class="mi">128</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;DAC Volume&quot;</span><span class="p">;</span>
</pre></div>
</div>
</li>
<li><p>Call mixer_open to open <code class="docutils literal notranslate"><span class="pre">/dev/snd/controlC0</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>struct mixer * mixer = mixer_open(0);
if (!mixer) {
   ALOGE(&quot;%s: Unable to open the mixer card&quot;);
}
</pre></div>
</div>
</li>
<li><p>Get control by name:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>struct mixer_ctl * ctl = mixer_get_ctl_by_name(mixer, mixer_ctl_name);
if (!ctl) {
   ALOGE(&quot;%s: Could not get ctl for %s&quot;, __func__, mixer_ctl_name);
   return -EINVAL;
}
</pre></div>
</div>
</li>
<li><p>Set volume value of control:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">int</span> <span class="n">volume</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<span class="n">volume</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">MAX_VOLUME</span><span class="p">;</span><span class="o">//</span><span class="mi">175</span>
<span class="n">volume</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">MAX_VOLUME</span><span class="p">;</span><span class="o">//</span><span class="mi">175</span>
<span class="n">mixer_ctl_set_array</span><span class="p">(</span><span class="n">ctl</span><span class="p">,</span> <span class="n">volume</span><span class="p">,</span> <span class="n">sizeof</span><span class="p">(</span><span class="n">volume</span><span class="p">)</span> <span class="o">/</span> <span class="n">sizeof</span><span class="p">(</span><span class="n">volume</span><span class="p">[</span><span class="mi">0</span><span class="p">]));</span>
</pre></div>
</div>
</li>
<li><p>If no need to use mixer, close it:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mixer_close</span><span class="p">(</span><span class="n">mixer</span><span class="p">);</span>
<span class="n">mixer</span> <span class="o">=</span> <span class="n">NULL</span><span class="p">;</span>
</pre></div>
</div>
</li>
</ol>
</section>
<section id="pcm-apis">
<h4>PCM APIs<a class="headerlink" href="#pcm-apis" title="Link to this heading"></a></h4>
<p>Here are some commonly used PCM-related APIs.</p>
<table class="docutils align-default" style="width: 100%">
<thead>
<tr class="row-odd"><th class="head"><p>Interfaces</p></th>
<th class="head"><p>Introduction</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>pcm_open</p></td>
<td><p>Open a PCM</p></td>
</tr>
<tr class="row-odd"><td><p>pcm_close</p></td>
<td><p>Close a PCM</p></td>
</tr>
<tr class="row-even"><td><p>pcm_write</p></td>
<td><p>Write PCM raw data to driver</p></td>
</tr>
<tr class="row-odd"><td><p>pcm_read</p></td>
<td><p>Get PCM raw data from driver</p></td>
</tr>
</tbody>
</table>
<p>For more details of APIs, refer to <a class="reference external" href="https://github.com/tinyalsa/tinyalsa">github tinyalsa</a>.</p>
<p>Here is an example showing how to use PCM APIs to render audio stream.</p>
<ol class="arabic" id="audio-pcm-apis-step-1">
<li><p>Create config of output stream:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">struct</span> <span class="n">pcm_config</span> <span class="n">pcm_output_config</span> <span class="o">=</span> <span class="p">{</span>
   <span class="o">.</span><span class="n">channels</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
   <span class="o">.</span><span class="n">rate</span> <span class="o">=</span> <span class="n">DEFAULT_OUT_SAMPLING_RATE</span><span class="p">,</span>
   <span class="o">.</span><span class="n">period_size</span> <span class="o">=</span> <span class="n">SHORT_PERIOD_SIZE</span><span class="p">,</span>
   <span class="o">.</span><span class="n">period_count</span> <span class="o">=</span> <span class="n">SHORT_PERIOD_COUNT</span><span class="p">,</span>
   <span class="o">.</span><span class="n">format</span> <span class="o">=</span> <span class="n">PCM_FORMAT_S16_LE</span><span class="p">,</span>
   <span class="o">.</span><span class="n">start_threshold</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
   <span class="o">.</span><span class="n">avail_min</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
<span class="p">};</span>
</pre></div>
</div>
</li>
<li><p>Open the device node of playback /dev/snd/pcmC0D0p, with the config created in step <a class="reference internal" href="#audio-pcm-apis-step-1"><span class="std std-ref">1</span></a>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">struct</span> <span class="n">pcm</span> <span class="o">*</span><span class="n">out_pcm</span> <span class="n">pcm_open</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">PCM_OUT</span> <span class="o">|</span> <span class="n">PCM_MONOTONIC</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">pcm_output_config</span><span class="p">);</span>
</pre></div>
</div>
</li>
<li><p>Write audio raw data to ALSA driver:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="n">out_pcm</span><span class="p">)</span> <span class="p">{</span>
   <span class="n">ret</span> <span class="o">=</span> <span class="n">pcm_write</span><span class="p">(</span><span class="n">out_pcm</span><span class="p">,</span> <span class="p">(</span><span class="n">void</span> <span class="o">*</span><span class="p">)</span><span class="n">buffer</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">);</span>
<span class="p">}</span><span class="k">else</span> <span class="p">{</span>
   <span class="n">ALOGE</span><span class="p">(</span><span class="s2">&quot;out pcm is NULL!!!&quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><p>When write done, close PCM device node:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">if</span><span class="p">(</span><span class="n">out_pcm</span><span class="p">)</span> <span class="p">{</span>
   <span class="n">pcm_close</span><span class="p">(</span><span class="n">out_pcm</span><span class="p">);</span>
   <span class="n">out_pcm</span> <span class="o">=</span> <span class="n">NULL</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
</ol>
</section>
</section>
<section id="alsa-lib-apis">
<h3>ALSA-lib APIs<a class="headerlink" href="#alsa-lib-apis" title="Link to this heading"></a></h3>
<p>ALSA-lib is a standard library to interface with ALSA in the Linux kernel. It is open-source.</p>
<p>The aims are:</p>
<ul class="simple">
<li><p>The library offers 100% of the functionality of the kernel API.</p></li>
<li><p>The library adds major improvements in usability, making the application code simpler and better looking.</p></li>
<li><p>Future fixes or compatibility code may be placed in the library code instead of the kernel driver.</p></li>
</ul>
<section id="id2">
<h4>Control APIs<a class="headerlink" href="#id2" title="Link to this heading"></a></h4>
<p>Here are some commonly used control APIs.</p>
<table class="docutils align-default" style="width: 100%">
<thead>
<tr class="row-odd"><th class="head"><p>Interfaces</p></th>
<th class="head"><p>Introduction</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>snd_ctl_open</p></td>
<td><p>Open sound control card</p></td>
</tr>
<tr class="row-odd"><td><p>snd_ctl_close</p></td>
<td><p>Close sound control card</p></td>
</tr>
<tr class="row-even"><td><p>snd_ctl_elem_info_get_id</p></td>
<td><p>Get CTL element identifier of a CTL element id/info</p></td>
</tr>
<tr class="row-odd"><td><p>snd_ctl_elem_info_set_id</p></td>
<td><p>Set CTL element identifier of a CTL element id/info</p></td>
</tr>
<tr class="row-even"><td><p>snd_ctl_elem_info</p></td>
<td><p>Get CTL element information</p></td>
</tr>
<tr class="row-odd"><td><p>snd_ctl_elem_read</p></td>
<td><p>Get CTL element value</p></td>
</tr>
<tr class="row-even"><td><p>snd_ctl_elem_write</p></td>
<td><p>Set CTL element value</p></td>
</tr>
</tbody>
</table>
<p>For more details of APIs, refer to <a class="reference external" href="https://www.alsa-project.org/alsa-doc/alsa-lib/group___control.html">Alsa project control interface</a>.</p>
<p>The example of control implementation can refer to the codes in alsa-utils: <code class="docutils literal notranslate"><span class="pre">fwk/third_party/alsa-lib/alsa-utils-1.2.5.1/alsactl</span></code></p>
</section>
<section id="id3">
<h4>PCM APIs<a class="headerlink" href="#id3" title="Link to this heading"></a></h4>
<p>Here are some commonly used PCM APIs.</p>
<table class="docutils align-default" style="width: 100%">
<thead>
<tr class="row-odd"><th class="head"><p>Interfaces</p></th>
<th class="head"><p>Introduction</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>snd_pcm_open</p></td>
<td><p>Opens a PCM</p></td>
</tr>
<tr class="row-odd"><td><p>snd_pcm_close</p></td>
<td><p>Close a PCM</p></td>
</tr>
<tr class="row-even"><td><p>snd_pcm_info</p></td>
<td><p>Obtain general (static) information for PCM handle</p></td>
</tr>
<tr class="row-odd"><td><p>snd_pcm_hw_params</p></td>
<td><p>Install one PCM hardware configuration</p></td>
</tr>
<tr class="row-even"><td><p>snd_pcm_prepare</p></td>
<td><p>Prepare PCM for use</p></td>
</tr>
<tr class="row-odd"><td><p>snd_pcm_readi</p></td>
<td><p>Read interleaved frames from a PCM</p></td>
</tr>
<tr class="row-even"><td><p>snd_pcm_writei</p></td>
<td><p>Write interleaved frames to a PCM</p></td>
</tr>
</tbody>
</table>
<p>For more details of APIs, refer to <a class="reference external" href="https://www.alsa-project.org/alsa-doc/alsa-lib/group___p_c_m.html">Alsa project pcm interface</a>.</p>
<p>The example of PCM implementation can refer to the codes in alsa-utils: <code class="docutils literal notranslate"><span class="pre">fwk/third_party/alsa-lib/alsa-utils-1.2.5.1/aplay</span></code></p>
</section>
</section>
<section id="audio-clock-apis">
<h3>Audio-clock APIs<a class="headerlink" href="#audio-clock-apis" title="Link to this heading"></a></h3>
<p>For internal audio codec, <em>SPORT0</em> is for playback, <em>SPORT1</em> is for capture. The audio input clock is XTAL 40M.</p>
<p>For external audio codec, <em>SPORT2</em> / <em>SPORT3</em> is for playback and capture. The audio input clock can be either XTAL 40M or audio PLL. If you set <em>Sport MCLK output multiplier set</em> as <a class="reference internal" href="#linux-audio-dts-configuration"><span class="std std-ref">DTS Configuration</span></a>, and the value is not <em>0</em>, audio driver will automatically choose suitable audio PLL clock.</p>
<p>The aims of audio-clock APIs are:</p>
<ul class="simple">
<li><p>Offer APIs for user to get the current clock for <em>SPORT0</em> to <em>SPORT3</em>.</p></li>
<li><p>Offer APIs for user to achieve fine-tuning of audio PLL.</p></li>
</ul>
<p>To use the audio-clock APIs, copy the header to your include path: <code class="docutils literal notranslate"><span class="pre">&lt;linux&gt;/include/uapi/sound/rtk_audio_pll.h</span></code></p>
<p>Audio-clock APIs are calling through standard device node interfaces.</p>
<table class="docutils align-default" style="width: 100%">
<thead>
<tr class="row-odd"><th class="head"><p>Interfaces</p></th>
<th class="head"><p>Introduction</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>open</p></td>
<td><p>Open an audio PLL clock device: /dev/audio_pll_clk.</p></td>
</tr>
<tr class="row-odd"><td><p>close</p></td>
<td><p>Close an audio PLL clock device.</p></td>
</tr>
<tr class="row-even"><td><p>ioctl</p></td>
<td><p>Interaction with audio clock driver to get clock information or achieve fine-tuning.</p></td>
</tr>
</tbody>
</table>
<p><code class="docutils literal notranslate"><span class="pre">rtk_audio_pll.h</span></code> describes two important structures:
- <code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">micro_adjust_params</span></code> is used to achieve fine-tuning.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">audio_clock_info</span></code> is used to get current clock for <code class="docutils literal notranslate"><span class="pre">SPORT0</span></code> to <code class="docutils literal notranslate"><span class="pre">SPORT3</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">struct</span> <span class="n">micro_adjust_params</span> <span class="p">{</span>
   <span class="o">/*</span><span class="n">can</span> <span class="n">be</span> <span class="n">PLL_24P576M</span><span class="p">,</span> <span class="n">PLL_45P158M</span><span class="p">,</span> <span class="ow">or</span> <span class="n">PLL_98P304M</span><span class="o">*/</span>
   <span class="n">unsigned</span> <span class="nb">int</span> <span class="n">clock</span><span class="p">;</span>
   <span class="o">/*</span><span class="n">can</span> <span class="n">be</span> <span class="c1">#define PLL_AUTO, PLL_FASTER, or PLL_SLOWER*/</span>
   <span class="n">unsigned</span> <span class="nb">int</span> <span class="n">action</span><span class="p">;</span>
   <span class="o">/*</span><span class="n">can</span> <span class="n">be</span> <span class="nb">any</span> <span class="n">value</span> <span class="n">between</span> <span class="mi">0</span><span class="o">-</span><span class="mi">1000</span><span class="o">*/</span>
   <span class="n">unsigned</span> <span class="nb">int</span> <span class="n">ppm</span><span class="p">;</span>
<span class="p">};</span>
<span class="n">struct</span> <span class="n">audio_clock_info</span> <span class="p">{</span>
   <span class="o">/*</span><span class="n">user</span> <span class="n">sets</span> <span class="n">sport_index</span><span class="p">,</span> <span class="n">to</span> <span class="n">tell</span> <span class="n">kernel</span> <span class="n">which</span> <span class="n">sport</span><span class="s1">&#39;s clock info it needs*/</span>
   <span class="n">unsigned</span> <span class="nb">int</span> <span class="n">sport_index</span><span class="p">;</span>
   <span class="o">/*</span><span class="n">user</span> <span class="n">gets</span> <span class="n">clock</span> <span class="n">info</span> <span class="kn">from</span> <span class="nn">kernel</span> <span class="k">for</span> <span class="n">the</span> <span class="n">sport_index</span> <span class="n">he</span> <span class="n">sets</span><span class="o">*/</span>
   <span class="n">unsigned</span> <span class="nb">int</span> <span class="n">clock</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
</li>
</ul>
<p>Here’s an example to get the clock info for <em>SPORT2</em>.</p>
<ol class="arabic">
<li><p>Open the audio PLL device node, and get the fd.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#define AUDIO_PLL_DEV &quot;/dev/audio_pll_clk&quot;</span>
<span class="nb">int</span> <span class="n">fd</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">AUDIO_PLL_DEV</span><span class="p">,</span> <span class="n">O_RDWR</span><span class="p">);</span>
</pre></div>
</div>
</li>
<li><p>Do ioctl with cmd <em>AUDIO_PLL_GET_CLOCK_FOR_SPORT</em> to get the clock info.</p>
<p>Note that the info.sport_index should be set by application, so that driver will know which SPORT’s clock to get. However, the sport_index is a concept of hardware, you may wonder which SPORT is using. Check the PCM device node, for example, if audio is playing through audio device node pcmC0D2p, then it’s using SPORT2, so set <code class="docutils literal notranslate"><span class="pre">info.sport_index</span> <span class="pre">=</span> <span class="pre">2</span></code>.</p>
<p>The relationship may be got from <a class="reference internal" href="#linux-audio-implementation"><span class="std std-ref">Implementarion</span></a> <em>Audio driver devices</em>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">struct</span> <span class="n">audio_clock_info</span> <span class="n">info</span><span class="p">;</span>
<span class="n">info</span><span class="o">.</span><span class="n">sport_index</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="n">ioctl</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="n">AUDIO_PLL_GET_CLOCK_FOR_SPORT</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">info</span><span class="p">);</span>
</pre></div>
</div>
</li>
<li><p>If the device node is no longer used, close it.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">close</span><span class="p">(</span><span class="n">fd</span><span class="p">);</span>
</pre></div>
</div>
</li>
</ol>
<p>Here’s an example to achieve fine-tuning of 98.304M PLL clock.</p>
<ol class="arabic">
<li><p>Open the audio PLL device node, and get the fd.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fd</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">AUDIO_PLL_DEV</span><span class="p">,</span> <span class="n">O_RDWR</span><span class="p">);</span>
   <span class="k">if</span><span class="p">(</span><span class="n">fd</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">printf</span><span class="p">(</span><span class="s2">&quot;open </span><span class="si">%s</span><span class="s2"> fail </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">AUDIO_PLL_DEV</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><p>Do ioctl with cmd AUDIO_PLL_MICRO_ADJUST to do fine-tuning.</p>
<p>In this case, you should put the clock to adjust in <code class="docutils literal notranslate"><span class="pre">params.clock</span></code>, put the action(<em>PLL_FASTER</em>, <em>PLL_AUTO</em>, <em>PLL_SLOWER</em>) in <code class="docutils literal notranslate"><span class="pre">params.action</span></code>, and put the ppm in <code class="docutils literal notranslate"><span class="pre">params.ppm</span></code>.</p>
<p>Take 98.304M for example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PLL_AUTO</span><span class="p">:</span> <span class="n">reset</span> <span class="n">to</span> <span class="n">auto</span> <span class="mf">98.304</span><span class="n">M</span>
<span class="n">PLL_FASTER</span><span class="p">:</span> <span class="n">PLL</span> <span class="n">clock</span> <span class="n">faster</span> <span class="n">than</span> <span class="mf">98.304</span><span class="n">M</span>
<span class="n">PLL_SLOWER</span><span class="p">:</span> <span class="n">PLL</span> <span class="n">clock</span> <span class="n">slower</span> <span class="n">than</span> <span class="mf">98.304</span><span class="n">M</span>
</pre></div>
</div>
<p>The actions will not cause superposition. For example, set <em>PLL_FASTER</em> 800ppm once and set <em>PLL_FASTER</em> 800ppm twice, the result is the same. The <code class="docutils literal notranslate"><span class="pre">params.ppm</span></code> means the clock drift, the expected clock diff equals <span class="math notranslate nohighlight">\(98.304M * ppm/1000000\)</span>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">struct</span> <span class="n">micro_adjust_params</span> <span class="n">params</span><span class="p">;</span>
<span class="n">params</span><span class="o">.</span><span class="n">clock</span> <span class="o">=</span> <span class="n">PLL_98P304M</span><span class="p">;</span>
<span class="n">params</span><span class="o">.</span><span class="n">action</span> <span class="o">=</span> <span class="n">PLL_FASTER</span><span class="p">;</span>
<span class="n">params</span><span class="o">.</span><span class="n">ppm</span> <span class="o">=</span> <span class="mi">800</span><span class="p">;</span>
<span class="n">ioctl</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="n">AUDIO_PLL_MICRO_ADJUST</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">params</span><span class="p">);</span>
</pre></div>
</div>
</li>
<li><p>If the device node is no longer used, close it.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">close</span><span class="p">(</span><span class="n">fd</span><span class="p">);</span>
</pre></div>
</div>
</li>
</ol>
<p>The test demo lies in <code class="docutils literal notranslate"><span class="pre">tests/audio_pll</span></code>.</p>
</section>
</section>
</section>
<section id="debug-tools">
<h1>Debug Tools<a class="headerlink" href="#debug-tools" title="Link to this heading"></a></h1>
<section id="tinyalsa">
<h2>tinyalsa<a class="headerlink" href="#tinyalsa" title="Link to this heading"></a></h2>
<p>tinyalsa is an open-source tool for testing tinyalsa-lib.</p>
<section id="tinymix">
<h3>tinymix<a class="headerlink" href="#tinymix" title="Link to this heading"></a></h3>
<p>tinymix is a tool to set mixer controls.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tinymix</span> <span class="p">[</span><span class="n">options</span><span class="p">]</span> <span class="p">[</span><span class="n">control</span> <span class="n">name</span><span class="o">/</span><span class="c1">#] [value to set]</span>
</pre></div>
</div>
<p>The options are as follows:</p>
<table class="docutils align-default" style="width: 100%">
<thead>
<tr class="row-odd"><th class="head"><p>Options</p></th>
<th class="head"><p>Introduction</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>-D,–card</p></td>
<td><p>Use the given card # instead of 0.</p></td>
</tr>
<tr class="row-odd"><td><p>-a,–all-values</p></td>
<td><p>Show all possible values/ranges for control.</p></td>
</tr>
<tr class="row-even"><td><p>-t, –tabs-only</p></td>
<td><p>Separate all output columns/values with tabs.</p></td>
</tr>
<tr class="row-odd"><td><p>-v, –value-only</p></td>
<td><p>Show only the value for the selected control</p></td>
</tr>
</tbody>
</table>
<ul>
<li><p>If you want to choose output device, set as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tinymix</span> <span class="s2">&quot;Choice Device 0: Spk   1: HEAPHONE&quot;</span> <span class="mi">0</span>
</pre></div>
</div>
</li>
<li><p>If you want to set output volume, set as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tinymix</span> <span class="s2">&quot;DAC Volume&quot;</span> <span class="mi">100</span> <span class="mi">100</span>
</pre></div>
</div>
</li>
<li><p>If you want to set zero-dection timeout value, set as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tinymix</span> <span class="s2">&quot; Zero Dect TimeOut&quot;</span> <span class="mi">1</span> <span class="mi">1</span>
</pre></div>
</div>
</li>
<li><p>If you want to change MIC numbers for 2 channel-microphone data +2 channel-reference data, set as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tinymix</span> <span class="s2">&quot;Choice tdm-4 slot&quot;</span> <span class="mi">01</span> <span class="mi">02</span> <span class="mi">03</span> <span class="mi">03</span>
<span class="o">//</span><span class="n">chose</span> <span class="n">amic1</span><span class="p">(</span><span class="n">mic</span><span class="o">-</span><span class="n">left</span><span class="p">),</span><span class="n">amic2</span><span class="p">(</span><span class="n">mic</span><span class="o">-</span><span class="n">right</span><span class="p">),</span><span class="n">amic3</span><span class="p">(</span><span class="n">ref</span><span class="o">-</span><span class="n">left</span><span class="p">),</span><span class="n">amic3</span><span class="p">(</span><span class="n">ref</span><span class="o">-</span><span class="n">right</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>If you want to mute system, set as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tinymix</span> <span class="s2">&quot;DAC Mute&quot;</span> <span class="n">On</span>
</pre></div>
</div>
</li>
</ul>
</section>
<section id="tinyplay">
<h3>tinyplay<a class="headerlink" href="#tinyplay" title="Link to this heading"></a></h3>
<p>tinyplay is a tool to play PCM raw data.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tinyplay</span> <span class="n">file</span><span class="o">.</span><span class="n">wav</span> <span class="p">[</span><span class="n">options</span><span class="p">]</span>
</pre></div>
</div>
<p>The options are as follows:</p>
<table class="docutils align-default" style="width: 100%">
<thead>
<tr class="row-odd"><th class="head"><p>Options</p></th>
<th class="head"><p>Introduction</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>-D, –card</p></td>
<td><p>Use the given card # instead of 0.</p></td>
</tr>
<tr class="row-odd"><td><p>-d,–device</p></td>
<td><p>Use the given device # instead of 0.</p></td>
</tr>
<tr class="row-even"><td><p>-p, –period-size|-</p></td>
<td><p>Use the given period_size.</p></td>
</tr>
<tr class="row-odd"><td><p>-n, –period-count|</p></td>
<td><p>Use the given period_count.</p></td>
</tr>
</tbody>
</table>
<p>If you want to play a wave, set as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tinyplay</span> <span class="o">./</span><span class="n">file</span><span class="o">.</span><span class="n">wav</span> <span class="o">-</span><span class="n">D</span> <span class="mi">0</span> <span class="o">-</span><span class="n">d</span> <span class="mi">0</span> <span class="o">-</span><span class="n">p</span> <span class="mi">1024</span> <span class="o">-</span><span class="n">n</span> <span class="mi">4</span>
</pre></div>
</div>
</section>
<section id="tinycap">
<h3>tinycap<a class="headerlink" href="#tinycap" title="Link to this heading"></a></h3>
<p>tinycap is a tool to capture PCM raw data.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tinycap</span> <span class="n">file</span><span class="o">.</span><span class="n">wav</span> <span class="p">[</span><span class="n">options</span><span class="p">]</span>
</pre></div>
</div>
<p>The options are as follows:</p>
<table class="docutils align-default" style="width: 100%">
<thead>
<tr class="row-odd"><th class="head"><p>Options</p></th>
<th class="head"><p>Introduction</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>-D, –card</p></td>
<td><p>Use the given card # instead of 0.</p></td>
</tr>
<tr class="row-odd"><td><p>-d,–device</p></td>
<td><p>Use the given device # instead of 0.</p></td>
</tr>
<tr class="row-even"><td><p>-c, –channels</p></td>
<td><p>Use the given channel count.</p></td>
</tr>
<tr class="row-odd"><td><p>-r, –rate</p></td>
<td><p>Use the given sample rate.</p></td>
</tr>
<tr class="row-even"><td><p>-b, –bits</p></td>
<td><p>Use the given format bits.</p></td>
</tr>
<tr class="row-odd"><td><p>-p, –period-size</p></td>
<td><p>Use the given period_size.</p></td>
</tr>
<tr class="row-even"><td><p>-n, –period-count</p></td>
<td><p>Use the given period_count.</p></td>
</tr>
<tr class="row-odd"><td><p>-T, –capture-time</p></td>
<td><p>Time for capturing data.</p></td>
</tr>
</tbody>
</table>
<p>If you want to capture a wave, set as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tinycap</span> <span class="o">./</span><span class="n">file</span><span class="o">.</span><span class="n">wav</span> <span class="o">-</span><span class="n">D</span> <span class="mi">0</span> <span class="o">-</span><span class="n">d</span> <span class="mi">1</span> <span class="o">-</span><span class="n">r</span> <span class="mi">48000</span> <span class="o">-</span><span class="n">T</span> <span class="mi">10</span>
</pre></div>
</div>
</section>
<section id="tinyhostless">
<h3>tinyhostless<a class="headerlink" href="#tinyhostless" title="Link to this heading"></a></h3>
<p>tinyhostless is a tool to capture and send capture raw data to playback immediately.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tinyhostless</span> <span class="p">[</span><span class="n">options</span><span class="p">]</span>
</pre></div>
</div>
<p>The options are as follows:</p>
<table class="docutils align-default" style="width: 100%">
<thead>
<tr class="row-odd"><th class="head"><p>Options</p></th>
<th class="head"><p>Introduction</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>-D,–card</p></td>
<td><p>Use the given card.</p></td>
</tr>
<tr class="row-odd"><td><p>-P,–playback-device</p></td>
<td><p>Use the given device for playback.</p></td>
</tr>
<tr class="row-even"><td><p>-C,–capture-device</p></td>
<td><p>Use the given device for capture.</p></td>
</tr>
<tr class="row-odd"><td><p>-p,–period-size</p></td>
<td><p>Use the given period_size.</p></td>
</tr>
<tr class="row-even"><td><p>-n,–period-count</p></td>
<td><p>Use the given period_count.</p></td>
</tr>
<tr class="row-odd"><td><p>-c,–channel count</p></td>
<td><p>Use the given channel_count.</p></td>
</tr>
<tr class="row-even"><td><p>-r,–sample-rate</p></td>
<td><p>Use the given sample rate.</p></td>
</tr>
<tr class="row-odd"><td><p>-l,–should-loop</p></td>
<td><p>Should loop or not.</p></td>
</tr>
<tr class="row-even"><td><p>-T,–playback-capture-time</p></td>
<td><p>Playback-capture time.</p></td>
</tr>
</tbody>
</table>
<p>If you want to capture and send capture raw data to playback immediately, set as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tinyhostless</span> <span class="o">-</span><span class="n">D</span> <span class="mi">0</span> <span class="o">-</span><span class="n">P</span> <span class="mi">0</span> <span class="o">-</span><span class="n">C</span> <span class="mi">1</span> <span class="o">-</span><span class="n">p</span> <span class="mi">1024</span> <span class="o">-</span><span class="n">n</span> <span class="mi">4</span> <span class="o">-</span><span class="n">c</span> <span class="mi">2</span> <span class="o">-</span><span class="n">r</span> <span class="mi">16000</span> <span class="o">-</span><span class="n">l</span> <span class="o">-</span><span class="n">T</span> <span class="mi">10</span>
</pre></div>
</div>
</section>
</section>
<section id="tinyalsa-extension">
<h2>tinyalsa-extension<a class="headerlink" href="#tinyalsa-extension" title="Link to this heading"></a></h2>
<p>Realtek demo tool is used to test playback and capture, and mainly used in capturing 4 channel microphone data + reference data.</p>
<section id="tinydownchplay">
<h3>tinydownchplay<a class="headerlink" href="#tinydownchplay" title="Link to this heading"></a></h3>
<p>This test tool is only used in this case: User uses tinycap or record to capture a 4 channel raw data, which consists of 2 channel-microphone data, or 2 channel-reference data. Then user wants to separately play 2 channel-microphone data, or 2 channel-reference data.</p>
<p>The using of it is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tinydownchplay</span> <span class="n">file</span><span class="o">.</span><span class="n">wav</span> <span class="p">[</span><span class="n">options</span><span class="p">]</span>
</pre></div>
</div>
<p>The options are as follows:</p>
<table class="docutils align-default" style="width: 100%">
<thead>
<tr class="row-odd"><th class="head"><p>Options</p></th>
<th class="head"><p>Introduction</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>-D, –card</p></td>
<td><p>Use the given card # instead of 0.</p></td>
</tr>
<tr class="row-odd"><td><p>-d,–device</p></td>
<td><p>Use the given device # instead of 0.</p></td>
</tr>
<tr class="row-even"><td><p>-p, –period-size|-</p></td>
<td><p>Use the given period_size.</p></td>
</tr>
<tr class="row-odd"><td><p>-n, –period-count|</p></td>
<td><p>Use the given period_count.</p></td>
</tr>
<tr class="row-even"><td><p>-c, –target-play-channel-count</p></td>
<td><p>Target playing channel count.</p></td>
</tr>
<tr class="row-odd"><td><p>-s, –target-play-source</p></td>
<td><p>Choose 0 for the first 2 channel raw data in 4channel original data to play.</p>
<p>Choose 1 for the last 2 channel raw data in 4 channel original data to play.</p>
</td>
</tr>
</tbody>
</table>
<ul>
<li><p>If you want to play 2 channel microphone raw data, set as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tinydownchplay</span> <span class="o">./</span><span class="n">file</span><span class="o">.</span><span class="n">wav</span> <span class="o">-</span><span class="n">D</span> <span class="mi">0</span> <span class="o">-</span><span class="n">d</span> <span class="mi">0</span> <span class="o">-</span><span class="n">p</span> <span class="mi">1024</span> <span class="o">-</span><span class="n">n</span> <span class="mi">4</span> <span class="o">-</span><span class="n">c</span> <span class="mi">2</span> <span class="o">-</span><span class="n">s</span> <span class="mi">0</span>
</pre></div>
</div>
</li>
<li><p>If you want to play 2 channel reference raw data, set as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tinydownchplay</span> <span class="o">./</span><span class="n">file</span><span class="o">.</span><span class="n">wav</span> <span class="o">-</span><span class="n">D</span> <span class="mi">0</span> <span class="o">-</span><span class="n">d</span> <span class="mi">0</span> <span class="o">-</span><span class="n">p</span> <span class="mi">1024</span> <span class="o">-</span><span class="n">n</span> <span class="mi">4</span> <span class="o">-</span><span class="n">c</span> <span class="mi">2</span> <span class="o">-</span><span class="n">s</span> <span class="mi">1</span>
</pre></div>
</div>
</li>
</ul>
</section>
<section id="tinylooptest">
<h3>tinylooptest<a class="headerlink" href="#tinylooptest" title="Link to this heading"></a></h3>
<p>This test tool is only used in 88pin-test board in this case: User wants to quickly check that whether the 4 channel raw data capturing is fine.</p>
<p>The using of it is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tinylooptest</span> <span class="p">[</span><span class="n">options</span><span class="p">]</span>
</pre></div>
</div>
<p>If you hear the reference data from left speaker, and hear the AMIC data from the right speaker, it means the test is successful.</p>
<p>The options are as follows:</p>
<table class="docutils align-default" style="width: 100%">
<thead>
<tr class="row-odd"><th class="head"><p>Options</p></th>
<th class="head"><p>Introduction</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>-D,–card</p></td>
<td><p>Use the given card.</p></td>
</tr>
<tr class="row-odd"><td><p>-P,–playback-device</p></td>
<td><p>Use the given device for playback.</p></td>
</tr>
<tr class="row-even"><td><p>-C,–capture-device</p></td>
<td><p>Use the given device for capture.</p></td>
</tr>
<tr class="row-odd"><td><p>-p,–period-size</p></td>
<td><p>Use the given period_size.</p></td>
</tr>
<tr class="row-even"><td><p>-n,–period-count</p></td>
<td><p>Use the given period_count.</p></td>
</tr>
<tr class="row-odd"><td><p>-c,–channel count</p></td>
<td><p>Use the given channel_count.</p></td>
</tr>
<tr class="row-even"><td><p>-r,–sample-rate</p></td>
<td><p>Use the given sample rate.</p></td>
</tr>
<tr class="row-odd"><td><p>-l,–should-loop</p></td>
<td><p>Should loop or not.</p></td>
</tr>
<tr class="row-even"><td><p>-T,–playback-capture-time</p></td>
<td><p>Playback-capture time.</p></td>
</tr>
</tbody>
</table>
<p>If you want test 4 channel data capturing, set as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tinylooptest</span> <span class="o">-</span><span class="n">D</span> <span class="mi">0</span> <span class="o">-</span><span class="n">P</span> <span class="mi">0</span> <span class="o">-</span><span class="n">C</span> <span class="mi">1</span> <span class="o">-</span><span class="n">p</span> <span class="mi">1024</span> <span class="o">-</span><span class="n">n</span> <span class="mi">4</span> <span class="o">-</span><span class="n">c</span> <span class="mi">4</span> <span class="o">-</span><span class="n">r</span> <span class="mi">16000</span> <span class="o">-</span><span class="n">l</span> <span class="o">-</span><span class="n">T</span> <span class="mi">10</span>
</pre></div>
</div>
</section>
</section>
<section id="alsa-util">
<h2>ALSA-util<a class="headerlink" href="#alsa-util" title="Link to this heading"></a></h2>
<p>Standard ALSA tools are for debugging ALSA-lib.</p>
<section id="amixer">
<h3>amixer<a class="headerlink" href="#amixer" title="Link to this heading"></a></h3>
<p>amixer is a tool to set mixer controls.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">amixer</span> <span class="o">&lt;</span><span class="n">options</span><span class="o">&gt;</span> <span class="p">[</span><span class="n">command</span><span class="p">]</span>
</pre></div>
</div>
<p>The options are as follows:</p>
<table class="docutils align-default" style="width: 100%">
<thead>
<tr class="row-odd"><th class="head"><p>Options</p></th>
<th class="head"><p>Introduction</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>-c,–card</p></td>
<td><p>Select the car.</p></td>
</tr>
<tr class="row-odd"><td><p>-D,–device</p></td>
<td><p>Select the device.</p></td>
</tr>
<tr class="row-even"><td><p>cget cID</p></td>
<td><p>Get control contents for one control.</p></td>
</tr>
<tr class="row-odd"><td><p>cset cID P</p></td>
<td><p>Set control contents for one control.</p></td>
</tr>
<tr class="row-even"><td><p>controls</p></td>
<td><p>Show all controls for given card.</p></td>
</tr>
<tr class="row-odd"><td><p>contents</p></td>
<td><p>Show contents of all controls for given card.</p></td>
</tr>
</tbody>
</table>
<p>Here’s the example of setting volume:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">amixer</span> <span class="n">cset</span> <span class="n">numid</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">iface</span><span class="o">=</span><span class="n">MIXER</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;DAC Volume&#39;</span> <span class="mi">175</span> <span class="mi">175</span>
</pre></div>
</div>
<p>To test the ALSA plugins, take DAC Volume for example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">amixer</span> <span class="o">-</span><span class="n">D</span> <span class="n">your_ctl_name</span> <span class="n">cset</span> <span class="n">numid</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">iface</span><span class="o">=</span><span class="n">MIXER</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;DAC Volume&#39;</span> <span class="mi">175</span> <span class="mi">175</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Before this step, please add your file <code class="docutils literal notranslate"><span class="pre">asound.conf</span></code> into <code class="docutils literal notranslate"><span class="pre">/etc</span></code> directory on board.</p>
</div>
</section>
<section id="aplay">
<h3>aplay<a class="headerlink" href="#aplay" title="Link to this heading"></a></h3>
<p>aplay is a tool to play audio raw data.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">aplay</span> <span class="p">[</span><span class="n">OPTION</span><span class="p">]</span><span class="o">...</span> <span class="p">[</span><span class="n">FILE</span><span class="p">]</span><span class="o">...</span>
</pre></div>
</div>
<p>The options are as follows:</p>
<table class="docutils align-default" style="width: 100%">
<thead>
<tr class="row-odd"><th class="head"><p>Options</p></th>
<th class="head"><p>Introduction</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>-D, –device</p></td>
<td><p>Select PCM by name.</p></td>
</tr>
<tr class="row-odd"><td><p>-t, –file-type</p></td>
<td><p>Set the file type, for example: wav, raw….</p></td>
</tr>
<tr class="row-even"><td><p>-f, –format</p></td>
<td><p>Set the format of file.</p></td>
</tr>
<tr class="row-odd"><td><p>-c,–channel count</p></td>
<td><p>Get control contents for one control.</p></td>
</tr>
<tr class="row-even"><td><p>-r,–sample rate</p></td>
<td><p>Set the sample rate of file.</p></td>
</tr>
<tr class="row-odd"><td><p>–period-size</p></td>
<td><p>Get period size.</p></td>
</tr>
<tr class="row-even"><td><p>–buffer-size</p></td>
<td><p>Get ALSA buffer size.</p></td>
</tr>
</tbody>
</table>
<p>Here’s the example of playing audio wave through pcmC0D2p:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">aplay</span> <span class="o">-</span><span class="n">D</span> <span class="n">hw</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span> <span class="o">--</span><span class="n">period</span><span class="o">-</span><span class="n">size</span><span class="o">=</span><span class="mi">1024</span> <span class="o">--</span><span class="n">buffer</span><span class="o">-</span><span class="n">size</span><span class="o">=</span><span class="mi">4096</span> <span class="o">-</span><span class="n">t</span> <span class="n">wav</span> <span class="o">./</span><span class="n">file</span><span class="o">.</span><span class="n">wav</span>
</pre></div>
</div>
<p>To test the ALSA plugins:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">aplay</span> <span class="o">-</span><span class="n">Dplug</span><span class="p">:</span><span class="n">your_plug_name</span> <span class="o">--</span><span class="n">period</span><span class="o">-</span><span class="n">size</span><span class="o">=</span><span class="mi">1024</span> <span class="o">--</span><span class="n">buffer</span><span class="o">-</span><span class="n">size</span><span class="o">=</span><span class="mi">4096</span> <span class="o">-</span><span class="n">t</span> <span class="n">wav</span> <span class="o">./</span><span class="n">file</span><span class="o">.</span><span class="n">wav</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Before this step, please add your file <code class="docutils literal notranslate"><span class="pre">asound.conf</span></code> into <code class="docutils literal notranslate"><span class="pre">/etc</span></code> directory on board.</p>
</div>
</section>
<section id="arecord">
<h3>arecord<a class="headerlink" href="#arecord" title="Link to this heading"></a></h3>
<p>arecord is a tool to capture microphone data.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">arecord</span> <span class="p">[</span><span class="n">OPTION</span><span class="p">]</span><span class="o">...</span> <span class="p">[</span><span class="n">FILE</span><span class="p">]</span><span class="o">...</span>
</pre></div>
</div>
<p>The options are as follows:</p>
<table class="docutils align-default" style="width: 100%">
<thead>
<tr class="row-odd"><th class="head"><p>Options</p></th>
<th class="head"><p>Introduction</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>-D, –device</p></td>
<td><p>Select PCM by name.</p></td>
</tr>
<tr class="row-odd"><td><p>-t, –file-type</p></td>
<td><p>Set the file type, for example: wav, raw….</p></td>
</tr>
<tr class="row-even"><td><p>-f, –format</p></td>
<td><p>Set the format of file.</p></td>
</tr>
<tr class="row-odd"><td><p>-c,–channel count</p></td>
<td><p>Get control contents for one control.</p></td>
</tr>
<tr class="row-even"><td><p>-r,–sample rate</p></td>
<td><p>Set the sample rate of file.</p></td>
</tr>
<tr class="row-odd"><td><p>-d,–duration</p></td>
<td><p>Set the time of recording.</p></td>
</tr>
<tr class="row-even"><td><p>–period-size</p></td>
<td><p>Set period size.</p></td>
</tr>
<tr class="row-odd"><td><p>–buffer-size</p></td>
<td><p>Set ALSA buffer size.</p></td>
</tr>
</tbody>
</table>
<p>Here’s the example of capturing audio wave data through pcmC0D1c:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">arecord</span> <span class="o">-</span><span class="n">D</span> <span class="n">hw</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span> <span class="o">-</span><span class="n">d</span> <span class="mi">10</span> <span class="o">-</span><span class="n">r</span> <span class="mi">48000</span> <span class="o">-</span><span class="n">f</span> <span class="n">S16_LE</span> <span class="o">-</span><span class="n">c</span> <span class="mi">2</span> <span class="o">--</span><span class="n">period</span><span class="o">-</span><span class="n">size</span><span class="o">=</span><span class="mi">1024</span> <span class="o">--</span><span class="n">buffer</span><span class="o">-</span><span class="n">size</span><span class="o">=</span><span class="mi">4096</span> <span class="o">-</span><span class="n">t</span> <span class="n">wav</span> <span class="o">./</span><span class="n">test</span><span class="o">.</span><span class="n">wav</span>
</pre></div>
</div>
<p>To test the ALSA plugins:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">arecord</span> <span class="o">-</span><span class="n">Dplug</span><span class="p">:</span><span class="n">your_plug_name</span> <span class="o">-</span><span class="n">d</span> <span class="mi">5</span> <span class="o">-</span><span class="n">r</span> <span class="mi">48000</span> <span class="o">-</span><span class="n">f</span> <span class="n">S16_LE</span> <span class="o">-</span><span class="n">c</span> <span class="mi">2</span> <span class="o">--</span><span class="n">period</span><span class="o">-</span><span class="n">size</span><span class="o">=</span><span class="mi">1024</span> <span class="o">--</span><span class="n">b</span>
<span class="n">uffer</span><span class="o">-</span><span class="n">size</span><span class="o">=</span><span class="mi">4096</span> <span class="o">-</span><span class="n">t</span> <span class="n">wav</span> <span class="o">./</span><span class="n">test</span><span class="o">.</span><span class="n">wav</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Before this step, please add your file <code class="docutils literal notranslate"><span class="pre">asound.conf</span></code> into <code class="docutils literal notranslate"><span class="pre">/etc</span></code> directory on board.</p>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="0_multimedia_index.html" class="btn btn-neutral float-left" title="Multimedia" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../7_usb/0_usb_index.html" class="btn btn-neutral float-right" title="USB OTG" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Realsil.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>

      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 



</body>
</html>