<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Introduction &mdash; RTL8720EA Docs  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/togglebutton.css?v=13237357" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/tabs.css?v=a5c4661c" />

  
    <link rel="shortcut icon" href="../../../../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../../../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../../../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../../../../_static/toggleprompt.js?v=d7ede5d2"></script>
        <script src="../../../../_static/tabs.js?v=3030b3cb"></script>
        <script>let toggleHintShow = 'Click to show';</script>
        <script>let toggleHintHide = 'Click to hide';</script>
        <script>let toggleOpenOnPrint = 'true';</script>
        <script src="../../../../_static/togglebutton.js?v=4a39c7ea"></script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <link rel="next" title="Wi-Fi" href="../../wifi/index.html" />
    <link rel="prev" title="FullMAC" href="index.html" />  
     
  <link href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script type="text/javascript" src="../../../../_static/js/selector.js"></script>
<style>
      .wy-nav-content {
      max-width: 1000px; /* 设置最大宽度 */
      }
</style>



</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../index.html" class="icon icon-home">
            RTL8720EA Docs
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../../product_overview/src/index.html">Product Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../application_note/index.html">Application Note</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">FullMAC</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Introduction</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#transport-interface">Transport Interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="#architecture">Architecture</a></li>
<li class="toctree-l3"><a class="reference internal" href="#features">Features</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#file-tree">File Tree</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#wi-fi">Wi-Fi</a></li>
<li class="toctree-l3"><a class="reference internal" href="#bluetooth">Bluetooth</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#porting-guide">Porting Guide</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#freertos">FreeRTOS</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#hardware-configuration">Hardware Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#software-configuration">Software Configuration</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#linux">Linux</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id5">Hardware Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id6">Software Configuration</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#throughput">Throughput</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id11">FreeRTOS</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id12">Linux</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#memory-size-requirement">Memory Size Requirement</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#device">Device</a></li>
<li class="toctree-l3"><a class="reference internal" href="#host">Host</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id13">FreeRTOS</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id14">Linux</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../wifi/index.html">Wi-Fi Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../wifi_tunnel/src/index.html">Wi-Fi R-Mesh</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../wifi_bridge/src/index.html">Wi-Fi Bridge</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../wifi_csi/src/index.html">Wi-Fi CSI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dsp/index.html">DSP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usb/usb_otg/src/index.html">USB Host &amp; Device</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../audio/src/index.html">Audio</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../multimedia/src/index.html">Multimedia</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gui/src/index.html">GUI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ai/index.html">AI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ai_voice/src/index.html">AIVoice</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../low_power/src/index.html">Low Power Solution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../security_encryption/src/index.html">Security &amp; Encryption</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../at_command/src/index.html">AT Command</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../software_tools/index.html">Software Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mp_tools/src/index.html">MP Tools</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">RTL8720EA Docs</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">FullMAC</a></li>
      <li class="breadcrumb-item active">Introduction</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="introduction">
<span id="fullmac"></span><h1>Introduction<a class="headerlink" href="#introduction" title="Link to this heading"></a></h1>
<p>The FullMAC solution provides a standard wireless network interface for the host, allowing Wi-Fi and Bluetooth applications (such as wpa_supplicant, TCP/IP stack, etc.) to run smoothly on the operating system.</p>
<section id="transport-interface">
<h2>Transport Interface<a class="headerlink" href="#transport-interface" title="Link to this heading"></a></h2>
<p>The transport interfaces supported by FullMAC are listed below:</p>
<table class="docutils align-default" style="width: 100%">
<thead>
<tr class="row-odd"><th class="head" rowspan="2"><p>Ameba SoC</p></th>
<th class="head" rowspan="2"><p>Interface</p></th>
<th class="head" colspan="2"><p>Host (Operating system)</p></th>
<th class="head" rowspan="2"><p>Wi-Fi</p></th>
<th class="head" rowspan="2"><p>Bluetooth</p></th>
<th class="head" rowspan="2"><p>Transport description</p></th>
</tr>
<tr class="row-even"><th class="head"><p>Linux</p></th>
<th class="head"><p>FreeRTOS</p></th>
</tr>
</thead>
<tbody>
<tr class="row-odd"><td rowspan="7"><div class="line-block">
<div class="line">RTL8721Dx</div>
<div class="line">RTL8711Dx</div>
</div>
</td>
<td><p>SDIO</p></td>
<td><p>Y</p></td>
<td><p>Y</p></td>
<td><p>Y</p></td>
<td><p>Y</p></td>
<td><p>Wi-Fi and Bluetooth, traffic for both runs over SDIO</p></td>
</tr>
<tr class="row-even"><td><p>SPI</p></td>
<td><p>Y</p></td>
<td><p>Y</p></td>
<td><p>Y</p></td>
<td><p>Y</p></td>
<td><p>Wi-Fi and Bluetooth, traffic for both runs over SPI</p></td>
</tr>
<tr class="row-odd"><td><p>USB</p></td>
<td><p>Y</p></td>
<td><p>X</p></td>
<td><p>Y</p></td>
<td><p>X</p></td>
<td><p>Wi-Fi and Bluetooth, traffic for both runs over USB</p></td>
</tr>
<tr class="row-even"><td><p>UART</p></td>
<td><p>TBD</p></td>
<td><p>TBD</p></td>
<td></td>
<td></td>
<td><p>Bluetooth only runs over UART</p></td>
</tr>
<tr class="row-odd"><td><p>SDIO (Wi-Fi) + UART (BT)</p></td>
<td><p>Y</p></td>
<td><p>Y</p></td>
<td><p>Y</p></td>
<td><p>Y</p></td>
<td><p>Wi-Fi runs over SDIO, and Bluetooth runs over UART</p></td>
</tr>
<tr class="row-even"><td><p>SPI (Wi-Fi) + UART (BT)</p></td>
<td><p>Y</p></td>
<td><p>Y</p></td>
<td><p>Y</p></td>
<td><p>Y</p></td>
<td><p>Wi-Fi runs over SPI, and Bluetooth runs over UART</p></td>
</tr>
<tr class="row-odd"><td><p>USB (Wi-Fi) + UART (BT)</p></td>
<td><p>TBD</p></td>
<td><p>TBD</p></td>
<td></td>
<td></td>
<td><p>Wi-Fi runs over USB, and Bluetooth runs over UART</p></td>
</tr>
<tr class="row-even"><td rowspan="7"><div class="line-block">
<div class="line">RTL8726EA</div>
<div class="line">RTL8713EC</div>
<div class="line">RTL8720EA</div>
<div class="line">RTL8710EC</div>
</div>
</td>
<td><p>SDIO</p></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>SPI</p></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-even"><td><p>USB</p></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>UART</p></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-even"><td><p>SDIO (Wi-Fi) + UART (BT)</p></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>SPI (Wi-Fi) + UART (BT)</p></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-even"><td><p>USB (Wi-Fi) + UART (BT)</p></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-odd"><td rowspan="7"><p>RTL8730E</p></td>
<td><p>SDIO</p></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-even"><td><p>SPI</p></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>USB</p></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-even"><td><p>UART</p></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>SDIO (Wi-Fi) + UART (BT)</p></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-even"><td><p>SPI (Wi-Fi) + UART (BT)</p></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>USB (Wi-Fi) + UART (BT)</p></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</section>
<section id="architecture">
<h2>Architecture<a class="headerlink" href="#architecture" title="Link to this heading"></a></h2>
<p>The FullMAC driver implements the following modules:</p>
<ul class="simple">
<li><p>Provide a data transmission path between the host and the device based on a private transmission protocol via the SDIO/SPI interface</p></li>
<li><p>Adapt the cfg80211 layer and register the wireless network interface (wlan0/1) in the kernel to enable network data packet interaction between the Linux kernel and the RTL8720EA</p></li>
<li><p>Provide commonly-used and proprietary commands to configure the parameters of Wi-Fi interface</p></li>
</ul>
<p>To clarify, in the following sections, the term <code class="docutils literal notranslate"><span class="pre">host</span></code> refers to the Linux PC/Rtos IC acting as the host, and the term <code class="docutils literal notranslate"><span class="pre">device</span></code> refers to the RTL8720EA serving as the device.</p>
<figure class="align-center" id="id15">
<a class="reference internal image-reference" href="../../../../_images/wifi_fullmac_architecture.svg"><img alt="../../../../_images/wifi_fullmac_architecture.svg" height="466" src="../../../../_images/wifi_fullmac_architecture.svg" width="464" /></a>
<figcaption>
<p><span class="caption-text">FullMAC architecture</span><a class="headerlink" href="#id15" title="Link to this image"></a></p>
</figcaption>
</figure>
</section>
<section id="features">
<h2>Features<a class="headerlink" href="#features" title="Link to this heading"></a></h2>
<table class="docutils align-default" style="width: 100%">
<thead>
<tr class="row-odd"><th class="head"><p>Features</p></th>
<th class="head"><p>Linux host</p></th>
<th class="head"><p>FreeRTOS host</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Wi-Fi configuration mechanism</p></td>
<td><p>Standard Linux APIs</p></td>
<td><p>FreeRTOS Wi-Fi APIs</p></td>
</tr>
<tr class="row-odd"><td><p>Wi-Fi features</p></td>
<td colspan="2"><p>802.11 a/b/g/n/ax</p></td>
</tr>
<tr class="row-even"><td><p>Transport interface</p></td>
<td colspan="2"><ul class="simple">
<li><p>SDIO</p></li>
<li><p>SPI</p></li>
<li><p>USB</p></li>
<li><p>UART</p></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><p>Wi-Fi &amp; BT transport combinations</p></td>
<td colspan="2"><ul class="simple">
<li><p>SDIO only</p></li>
<li><p>SPI only</p></li>
<li><p>USB only</p></li>
<li><p>SDIO + UART</p></li>
<li><p>SPI + UART</p></li>
<li><p>USB + UART</p></li>
</ul>
</td>
</tr>
<tr class="row-even"><td><p>Wi-Fi mode</p></td>
<td><ul class="simple">
<li><p>Station</p></li>
<li><p>SoftAP</p></li>
<li><p>NAN</p></li>
<li><p>P2P GO</p></li>
</ul>
</td>
<td><ul class="simple">
<li><p>Station</p></li>
<li><p>SoftAP</p></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><p>Wi-Fi security</p></td>
<td colspan="2"><ul class="simple">
<li><p>Open</p></li>
<li><p>WPA</p></li>
<li><p>WPA2</p></li>
<li><p>WPA3</p></li>
</ul>
</td>
</tr>
<tr class="row-even"><td rowspan="2"><p>Power saving</p></td>
<td colspan="2"><p>Wowlan</p></td>
</tr>
<tr class="row-odd"><td><p>Proxy Offload:</p>
<ul class="simple">
<li><p>ARP Response</p></li>
<li><p>mDNS</p></li>
<li><p>ICMP Response (TODO)</p></li>
<li><p>SNMP (TODO)</p></li>
<li><p>LLMNR (TODO)</p></li>
<li><p>SSDP/SLP/WSD/LLTD (TODO)</p></li>
</ul>
</td>
<td><p>-</p></td>
</tr>
<tr class="row-even"><td><p>Bluetooth features</p></td>
<td colspan="2"><ul class="simple">
<li><p>BLE 5.0</p></li>
<li><p>BLE 5.2</p></li>
<li><p>Bluetooth 5.3</p></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><p>SoC supported</p></td>
<td colspan="2"><p>RTL8721Dx/RTL8711Dx</p></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="file-tree">
<h1>File Tree<a class="headerlink" href="#file-tree" title="Link to this heading"></a></h1>
<section id="wi-fi">
<h2>Wi-Fi<a class="headerlink" href="#wi-fi" title="Link to this heading"></a></h2>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-0-0-0" aria-selected="true" class="sphinx-tabs-tab" id="tab-0-0-0" name="0-0" role="tab" tabindex="0">FreeRTOS</button><button aria-controls="panel-0-0-1" aria-selected="false" class="sphinx-tabs-tab" id="tab-0-0-1" name="0-1" role="tab" tabindex="-1">Linux</button></div><div aria-labelledby="tab-0-0-0" class="sphinx-tabs-panel" id="panel-0-0-0" name="0-0" role="tabpanel" tabindex="0"><p>The FullMAC driver of FreeRTOS in the SDK is located at <code class="docutils literal notranslate"><span class="pre">{SDK}/component/wifi/inic</span></code>. Users need to porting files in none_ipc_rtos if use other FreeRtos IC as Host.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Low-level driver
└── sdio
    └── inic_sdio_dev.c
└── spi
    ├── inic_spi_dev.c
    ├── inic_spi_host.c
    └── inic_spi_host_trx.c
└── usb
    └── inic_usb_dev.c

FullMAC common driver
└── none_ipc_dev
    ├── inic_dev_api.c
    ├── inic_dev_bridge.c
    ├── inic_dev_msg_queue.c
    └── inic_dev_protocal_offload.c
└── none_ipc_host
    ├── inic_host_api.c
    ├── inic_host_api_basic.c
    ├── inic_host_api_bt.c
    └── inic_host_api_ext.c
└── none_ipc_rtos
</pre></div>
</div>
</div><div aria-labelledby="tab-0-0-1" class="sphinx-tabs-panel" hidden="true" id="panel-0-0-1" name="0-1" role="tabpanel" tabindex="0"><p>The FullMAC driver of Linux in the SDK is located at <code class="docutils literal notranslate"><span class="pre">{SDK}/component/wifi/cfg80211_fullmac</span></code>. The main focus should be on the files below.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Low-level hardware driver
└── common
    ├── rtw_ioctl.c
    ├── rtw_ioctl.h
    ├── rtw_llhw_event.h
    ├── rtw_llhw_event_rx.c
    ├── rtw_llhw_event_tx.c
    ├── rtw_llhw_hci.c
    ├── rtw_llhw_hci.h
    ├── rtw_llhw_hci_memory.c
    ├── rtw_llhw_ops.c
    ├── rtw_llhw_pkt_rx.c
    ├── rtw_llhw_pkt_tx.c
    ├── rtw_llhw_trx.h
    └── rtw_protocal_offload.c
└── sdio
    ├── Kbuild
    ├── rtw_sdio.h
    ├── rtw_sdio_drvio.c
    ├── rtw_sdio_drvio.h
    ├── rtw_sdio_fwdl.c
    ├── rtw_sdio_init.c
    ├── rtw_sdio_ops.c
    ├── rtw_sdio_ops.h
    ├── rtw_sdio_probe.c
    └── rtw_sdio_reg.h
└── spi
    ├── Kbuild
    ├── rtw_spi.h
    ├── rtw_spi_ops.c
    ├── rtw_spi_probe.c
    └── spidev-overlay.dts
└── usb
    ├── Kbuild
    ├── rtw_usb.h
    ├── rtw_usb_ops.c
    └── rtw_usb_probe.c

FullMAC driver
├── rtw_acs.c
├── rtw_acs.h
├── rtw_cfg80211_fullmac.h
├── rtw_cfg80211_ops.c
├── rtw_cfg80211_ops_ap.c
├── rtw_cfg80211_ops_key.c
├── rtw_cfg80211_ops_nan.c
├── rtw_cfg80211_ops_p2p.c
├── rtw_cfgvendor.c
├── rtw_cfgvendor.h
├── rtw_drv_probe.c
├── rtw_drv_probe.h
├── rtw_ethtool_ops.c
├── rtw_ethtool_ops.h
├── rtw_functions.h
├── rtw_netdev_ops.c
├── rtw_netdev_ops.h
├── rtw_netdev_ops_p2p.c
├── rtw_proc.c
├── rtw_proc.h
├── rtw_promisc.c
├── rtw_promisc.h
├── rtw_regd.c
├── rtw_regd.h
├── rtw_wiphy.c
└── rtw_wiphy.h
</pre></div>
</div>
</div></div>
</section>
<section id="bluetooth">
<h2>Bluetooth<a class="headerlink" href="#bluetooth" title="Link to this heading"></a></h2>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-1-1-0" aria-selected="true" class="sphinx-tabs-tab" id="tab-1-1-0" name="1-0" role="tab" tabindex="0">FreeRTOS</button><button aria-controls="panel-1-1-1" aria-selected="false" class="sphinx-tabs-tab" id="tab-1-1-1" name="1-1" role="tab" tabindex="-1">Linux</button></div><div aria-labelledby="tab-1-1-0" class="sphinx-tabs-panel" id="panel-1-1-0" name="1-0" role="tabpanel" tabindex="0"></div><div aria-labelledby="tab-1-1-1" class="sphinx-tabs-panel" hidden="true" id="panel-1-1-1" name="1-1" role="tabpanel" tabindex="0"></div></div>
</section>
</section>
<section id="porting-guide">
<h1>Porting Guide<a class="headerlink" href="#porting-guide" title="Link to this heading"></a></h1>
<section id="freertos">
<h2>FreeRTOS<a class="headerlink" href="#freertos" title="Link to this heading"></a></h2>
<section id="hardware-configuration">
<h3>Hardware Configuration<a class="headerlink" href="#hardware-configuration" title="Link to this heading"></a></h3>
<p>The FullMAC can be used on FreeRTOS with different interfaces, with different pins used for FullMAC function.</p>
<table class="docutils align-default" style="width: 100%">
<thead>
<tr class="row-odd"><th class="head"><p>Interface</p></th>
<th class="head"><p>RTL8721Dx/RTL8711Dx Pin</p></th>
<th class="head"><p>Function</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td rowspan="6"><p>SPI
Host/Device</p></td>
<td><p>PB24</p></td>
<td><p>SPI_MOSI</p></td>
<td rowspan="4"><p>SPI pins</p></td>
</tr>
<tr class="row-odd"><td><p>PB25</p></td>
<td><p>SPI_MISO</p></td>
</tr>
<tr class="row-even"><td><p>PB23</p></td>
<td><p>SPI_CLK</p></td>
</tr>
<tr class="row-odd"><td><p>PB26</p></td>
<td><p>SPI_CS</p></td>
</tr>
<tr class="row-even"><td><p>PB8</p></td>
<td><p>DEV_TX_REQ</p></td>
<td><p>A input pin for host, output pin for dev, indicating that there</p>
<p>is a packet in dev wating to send to Host with a rising edge.</p>
</td>
</tr>
<tr class="row-odd"><td><p>PB9</p></td>
<td><p>DEV_READY</p></td>
<td><p>A input pin for host, output pin for dev, used to show that</p>
<p>if dev is ready for a SPI transcation.</p>
<ul class="simple">
<li><p>1: Device is ready.</p></li>
<li><p>0: Device is busy.</p></li>
</ul>
</td>
</tr>
<tr class="row-even"><td rowspan="6"><p>SDIO
Device</p></td>
<td><p>PB6</p></td>
<td><p>SDIO_DAT2</p></td>
<td rowspan="6"><p>SDIO pins</p></td>
</tr>
<tr class="row-odd"><td><p>PB7</p></td>
<td><p>SDIO_DAT3</p></td>
</tr>
<tr class="row-even"><td><p>PB8</p></td>
<td><p>SDIO_CMD</p></td>
</tr>
<tr class="row-odd"><td><p>PB9</p></td>
<td><p>SDIO_CLK</p></td>
</tr>
<tr class="row-even"><td><p>PB13</p></td>
<td><p>SDIO_DAT0</p></td>
</tr>
<tr class="row-odd"><td><p>PB14</p></td>
<td><p>SDIO_DAT1</p></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The above pins of SDIO are the default pin configuration in the firmware code. If you need to change the pin configuration on the SDIO device side, modifications must be made in the SPDIO_Board_Init function to set the actual connected pins’ pinmux to SDIO. This function is located in the following file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">component</span><span class="o">/</span><span class="n">soc</span><span class="o">/</span><span class="n">amebadplus</span><span class="o">/</span><span class="n">hal</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">spdio_api</span><span class="o">.</span><span class="n">c</span>
</pre></div>
</div>
<p>Currently, the host driver for OOB mode has not yet been developed; hence, the pinmux configuration for SDIO_DATA1 must be set to SDIO mode rather than GPIO mode. Users can use polling mode if interrupt in host is not supported.</p>
</div>
</section>
<section id="software-configuration">
<h3>Software Configuration<a class="headerlink" href="#software-configuration" title="Link to this heading"></a></h3>
<section id="id1">
<h4>Wi-Fi<a class="headerlink" href="#id1" title="Link to this heading"></a></h4>
<p>The FullMAC can be used on FreeRTOS with different interfaces, and RTL8720EA can be used as SPI Host/Device, or SDIO Device.</p>
<section id="device-driver">
<h5>Device Driver<a class="headerlink" href="#device-driver" title="Link to this heading"></a></h5>
<ol class="arabic">
<li><p>Execute <code class="docutils literal notranslate"><span class="pre">./menuconfig.py</span></code> under the path <code class="docutils literal notranslate"><span class="pre">{SDK}/amebadplus_gcc_project</span></code></p>
<ol class="loweralpha">
<li><p>Click <span class="menuselection">CONFIG Link Option &gt; IMG2(Application) running on FLASH or PSRAM?</span>, and select <span class="menuselection">PSRAM</span></p>
<figure class="align-center">
<a class="reference internal image-reference" href="../../../../_images/sdio_config_flash_or_psram.png"><img alt="../../../../_images/sdio_config_flash_or_psram.png" src="../../../../_images/sdio_config_flash_or_psram.png" style="width: 920.8000000000001px; height: 264.0px;" /></a>
</figure>
</li>
<li><p>Click <span class="menuselection">CONFIG INIC ITNF &gt; INIC Mode &gt; FULLMAC</span>, select <span class="menuselection">SDIO_FULLMAC</span> for SDIO interface or <span class="menuselection">SPI_FULLMAC</span> for SPI interface.</p>
<figure class="align-center">
<a class="reference internal image-reference" href="../../../../_images/wifi_sdio_spi_selection.png"><img alt="../../../../_images/wifi_sdio_spi_selection.png" src="../../../../_images/wifi_sdio_spi_selection.png" style="width: 304.0px; height: 101.60000000000001px;" /></a>
</figure>
</li>
</ol>
</li>
<li><p>Execute the make command to generate <code class="file docutils literal notranslate"><span class="pre">km4_boot_all.bin</span></code> and <code class="file docutils literal notranslate"><span class="pre">km0_km4_app.bin</span></code> after the build is successfully complete.</p></li>
<li><p>Use the ImageTool to flash the bin files to RTL8720EA and resst the device.</p></li>
</ol>
</section>
<section id="host-driver">
<h5>Host Driver<a class="headerlink" href="#host-driver" title="Link to this heading"></a></h5>
<p>If use RTL8720EA as SPI Fullmac Host:</p>
<ol class="arabic">
<li><p>Execute <code class="docutils literal notranslate"><span class="pre">./menuconfig.py</span></code> under the path <code class="docutils literal notranslate"><span class="pre">{SDK}/amebadplus_gcc_project</span></code></p>
<ol class="loweralpha">
<li><p>Click <span class="menuselection">CONFIG INIC ITNF &gt; INIC Mode</span>, select <span class="menuselection">SPI_FULLMAC_HOST</span> for SPI interface.</p>
<figure class="align-center">
<a class="reference internal image-reference" href="../../../../_images/spi_config_fullmac_host.png"><img alt="../../../../_images/spi_config_fullmac_host.png" src="../../../../_images/spi_config_fullmac_host.png" style="width: 308.0px; height: 80.0px;" /></a>
</figure>
</li>
</ol>
</li>
<li><p>Execute the make command to generate <code class="file docutils literal notranslate"><span class="pre">km4_boot_all.bin</span></code> and <code class="file docutils literal notranslate"><span class="pre">km0_km4_app.bin</span></code> after the build is successfully complete.</p></li>
<li><p>Use the ImageTool to flash the bin files to RTL8720EA and resst the device.</p></li>
</ol>
<p>If use other rtos IC as SPI/SDIO Fullmac Host, files showed in file tree can be used.</p>
</section>
</section>
<section id="id2">
<h4>Bluetooth<a class="headerlink" href="#id2" title="Link to this heading"></a></h4>
<section id="id3">
<h5>Device Driver<a class="headerlink" href="#id3" title="Link to this heading"></a></h5>
</section>
<section id="id4">
<h5>Host Driver<a class="headerlink" href="#id4" title="Link to this heading"></a></h5>
</section>
</section>
</section>
</section>
<section id="linux">
<h2>Linux<a class="headerlink" href="#linux" title="Link to this heading"></a></h2>
<section id="id5">
<h3>Hardware Configuration<a class="headerlink" href="#id5" title="Link to this heading"></a></h3>
<p>The FullMAC can be used on Linux PC or Raspberry Pi with different interfaces, with different pins used for FullMAC function.</p>
<table class="docutils align-default" id="fullmac-pins" style="width: 100%">
<caption><span class="caption-text">FullMAC used pins of different interfaces</span><a class="headerlink" href="#fullmac-pins" title="Link to this table"></a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>Interface</p></th>
<th class="head"><p>RTL8721Dx/RTL8711Dx pin</p></th>
<th class="head"><p>Raspberry Pi pin</p></th>
<th class="head"><p>Function</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td rowspan="6"><p>SDIO</p></td>
<td><p>PB6</p></td>
<td><p>GPIO 26</p></td>
<td><p>SDIO_DAT2</p></td>
<td rowspan="6"><p>SDIO pins</p></td>
</tr>
<tr class="row-odd"><td><p>PB7</p></td>
<td><p>GPIO 27</p></td>
<td><p>SDIO_DAT3</p></td>
</tr>
<tr class="row-even"><td><p>PB8</p></td>
<td><p>GPIO 23</p></td>
<td><p>SDIO_CMD</p></td>
</tr>
<tr class="row-odd"><td><p>PB9</p></td>
<td><p>GPIO 22</p></td>
<td><p>SDIO_CLK</p></td>
</tr>
<tr class="row-even"><td><p>PB13</p></td>
<td><p>GPIO 24</p></td>
<td><p>SDIO_DAT0</p></td>
</tr>
<tr class="row-odd"><td><p>PB14</p></td>
<td><p>GPIO 25</p></td>
<td><p>SDIO_DAT1</p></td>
</tr>
<tr class="row-even"><td rowspan="6"><p>SPI</p></td>
<td><p>PB24</p></td>
<td><p>GPIO 10</p></td>
<td><p>SPI_MOSI</p></td>
<td rowspan="4"><p>SPI pins</p></td>
</tr>
<tr class="row-odd"><td><p>PB25</p></td>
<td><p>GPIO 9</p></td>
<td><p>SPI_MISO</p></td>
</tr>
<tr class="row-even"><td><p>PB23</p></td>
<td><p>GPIO 11</p></td>
<td><p>SPI_CLK</p></td>
</tr>
<tr class="row-odd"><td><p>PB26</p></td>
<td><p>GPIO 8</p></td>
<td><p>SPI_CS</p></td>
</tr>
<tr class="row-even"><td><p>PB8</p></td>
<td><p>GPIO 23</p></td>
<td><p>DEV_TX_REQ</p></td>
<td><p>An output pin for RTL8720EA, used to indicate to the host</p>
<p>that it has a data packet to send with a rising edge.</p>
</td>
</tr>
<tr class="row-odd"><td><p>PB9</p></td>
<td><p>GPIO 22</p></td>
<td><p>DEV_READY</p></td>
<td><p>An output pin for RTL8720EA, used to indicate its readiness</p>
<p>for SPI transcation to host.</p>
<ul class="simple">
<li><p>1: Device is ready.</p></li>
<li><p>0: Device is busy.</p></li>
</ul>
</td>
</tr>
<tr class="row-even"><td rowspan="6"><p>USB???</p></td>
<td><p>PB6</p></td>
<td><p>GPIO 26</p></td>
<td><p>SDIO_DAT2</p></td>
<td><p>SDIO_DAT2</p></td>
</tr>
<tr class="row-odd"><td><p>PB7</p></td>
<td><p>GPIO 27</p></td>
<td><p>SDIO_DAT3</p></td>
<td><p>SDIO_DAT3</p></td>
</tr>
<tr class="row-even"><td><p>PB8</p></td>
<td><p>GPIO 23</p></td>
<td><p>SDIO_CMD</p></td>
<td><p>SDIO_CMD</p></td>
</tr>
<tr class="row-odd"><td><p>PB9</p></td>
<td><p>GPIO 22</p></td>
<td><p>SDIO_CLK</p></td>
<td><p>SDIO_CLK</p></td>
</tr>
<tr class="row-even"><td><p>PB13</p></td>
<td><p>GPIO 24</p></td>
<td><p>SDIO_DAT0</p></td>
<td><p>SDIO_DAT0</p></td>
</tr>
<tr class="row-odd"><td><p>PB14</p></td>
<td><p>GPIO 25</p></td>
<td><p>SDIO_DAT1</p></td>
<td><p>SDIO_DAT1</p></td>
</tr>
<tr class="row-even"><td rowspan="2"><p>UART</p></td>
<td><p>PB14</p></td>
<td><p>GPIO 25</p></td>
<td><p>SDIO_DAT1</p></td>
<td><p>SDIO_DAT1</p></td>
</tr>
<tr class="row-odd"><td><p>PB14</p></td>
<td><p>GPIO 25</p></td>
<td><p>SDIO_DAT1</p></td>
<td><p>SDIO_DAT1</p></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The above pins of SDIO are the default pin configuration in the firmware code. If you need to change the pin configuration on the SDIO device side, modifications must be made in the SPDIO_Board_Init function to set the actual connected pins’ pinmux to SDIO. This function is located in the following file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">component</span><span class="o">/</span><span class="n">soc</span><span class="o">/</span><span class="n">amebadplus</span><span class="o">/</span><span class="n">hal</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">spdio_api</span><span class="o">.</span><span class="n">c</span>
</pre></div>
</div>
<p>Currently, the host driver for OOB mode has not yet been developed; hence, the pinmux configuration for SDIO_DATA1 must be set to SDIO mode rather than GPIO mode.</p>
</div>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-2-2-0" aria-selected="true" class="sphinx-tabs-tab" id="tab-2-2-0" name="2-0" role="tab" tabindex="0">Linux PC</button><button aria-controls="panel-2-2-1" aria-selected="false" class="sphinx-tabs-tab" id="tab-2-2-1" name="2-1" role="tab" tabindex="-1">Raspberry Pi</button></div><div aria-labelledby="tab-2-2-0" class="sphinx-tabs-panel" id="panel-2-2-0" name="2-0" role="tabpanel" tabindex="0"><p>For the Linux PC, an SDIO host peripheral is required. Please connect to the RTL8720EA with corresponding pins according to <a class="reference internal" href="#fullmac-pins"><span class="std std-ref">FullMAC used pins of different interfaces</span></a>.</p>
<p>The RTL8720EA can also use a gold finger adapter to convert the SDIO pins into a standard SD card, as the following figure shows, and supports the hardware platform only with an SD card slot.
Note that in this case, you need to contact us to modify the demo board circuit.</p>
<figure class="align-center" id="id16">
<a class="reference internal image-reference" href="../../../../_images/sdio_adapter_board.jpg"><img alt="../../../../_images/sdio_adapter_board.jpg" src="../../../../_images/sdio_adapter_board.jpg" style="width: 335.5px; height: 248.5px;" /></a>
<figcaption>
<p><span class="caption-text">RTL8720EA SDIO adapter board</span><a class="headerlink" href="#id16" title="Link to this image"></a></p>
</figcaption>
</figure>
</div><div aria-labelledby="tab-2-2-1" class="sphinx-tabs-panel" hidden="true" id="panel-2-2-1" name="2-1" role="tabpanel" tabindex="0"><p>The pin location of RTL8720EA demo board corresponds to the pin location of Raspberry Pi.
In order to run at high speed, it’s strongly recommended to plug the demo board directly into Raspberry Pi, as the following figure shows.</p>
<p>The pins used for SDIO FullMAC on Raspberry Pi are listed in <a class="reference internal" href="#fullmac-pins"><span class="std std-ref">FullMAC used pins of different interfaces</span></a>.</p>
<figure class="align-center" id="id17">
<a class="reference internal image-reference" href="../../../../_images/connection_with_raspberry_pi.jpg"><img alt="../../../../_images/connection_with_raspberry_pi.jpg" src="../../../../_images/connection_with_raspberry_pi.jpg" style="width: 254.5px; height: 227.0px;" /></a>
<figcaption>
<p><span class="caption-text">RTL8720EA connection with Raspberry Pi</span><a class="headerlink" href="#id17" title="Link to this image"></a></p>
</figcaption>
</figure>
</div></div>
</section>
<section id="id6">
<h3>Software Configuration<a class="headerlink" href="#id6" title="Link to this heading"></a></h3>
<section id="id7">
<h4>Wi-Fi<a class="headerlink" href="#id7" title="Link to this heading"></a></h4>
<section id="id8">
<h5>Host Driver<a class="headerlink" href="#id8" title="Link to this heading"></a></h5>
<p>The FullMAC driver has been tested and verified to work on Linux kernel versions 5.4 and 5.10.
If you encounter any compilation errors on other kernel versions, please contact us.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The SPI operates using DMA, and the data for the SPI device is stored in RAM. When the nCS pin is asserted low, DMA transfers the data from RAM to the bus. Under normal conditions, this data transfer occurs without issues. However, if the bus is busy, a delay can occur during the data transfer, leading to potential problems. Our developer identified and tested this issue, determining that a delay of 7 microseconds provides sufficient time to ensure safe data transfer to the bus, even when it is busy. In some older versions of the Linux kernel, the SPI driver does not support the struct spi_delay, which prevents setting the delay between nCS and the clock signal through the interface. As a result, it may be necessary to modify the driver code directly to achieve the desired delay configuration.</p>
</div>
<div class="admonition-prerequisites admonition">
<p class="admonition-title">Prerequisites</p>
<p>Install the following software packages on Linux system first.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>build-essential
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>dhcpcd
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>hostapd
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>dhcpd
</pre></div>
</div>
</div>
<ol class="arabic">
<li><p>Enable the SDIO, SPI, or USB function.</p>
<ul class="simple">
<li><p>For Linux PC, skip this step.</p></li>
<li><p>For Raspberry Pi:</p></li>
</ul>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-3-3-0" aria-selected="true" class="sphinx-tabs-tab" id="tab-3-3-0" name="3-0" role="tab" tabindex="0">SDIO</button><button aria-controls="panel-3-3-1" aria-selected="false" class="sphinx-tabs-tab" id="tab-3-3-1" name="3-1" role="tab" tabindex="-1">SPI</button><button aria-controls="panel-3-3-2" aria-selected="false" class="sphinx-tabs-tab" id="tab-3-3-2" name="3-2" role="tab" tabindex="-1">USB</button></div><div aria-labelledby="tab-3-3-0" class="sphinx-tabs-panel" id="panel-3-3-0" name="3-0" role="tabpanel" tabindex="0"><p>Use <code class="docutils literal notranslate"><span class="pre">dtoverlay</span></code> command to configure SDIO.</p>
<p>For Raspberry Pi 4, type the following command:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>dtoverlay<span class="w"> </span>sdio<span class="w"> </span><span class="nv">poll_once</span><span class="o">=</span>off
</pre></div>
</div>
</div><div aria-labelledby="tab-3-3-1" class="sphinx-tabs-panel" hidden="true" id="panel-3-3-1" name="3-1" role="tabpanel" tabindex="0"><ol class="lowerroman">
<li><p>Enable the SPI peripheral.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>raspi-config
</pre></div>
</div>
</li>
<li><p>Select <span class="menuselection">Interface Options &gt; SPI &gt; Yes</span></p></li>
</ol>
<blockquote>
<div><figure class="align-center">
<a class="reference internal image-reference" href="../../../../_images/raspberry_pi_spi_config.png"><img alt="../../../../_images/raspberry_pi_spi_config.png" src="../../../../_images/raspberry_pi_spi_config.png" style="width: 640.0px; height: 268.0px;" /></a>
</figure>
</div></blockquote>
<ol class="lowerroman simple" start="3">
<li><p>Generate and apply Device Tree Overlay</p></li>
</ol>
<blockquote>
<div><div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>su
<span class="nb">cd</span><span class="w"> </span><span class="o">{</span>driver_path<span class="o">}</span>/cfg80211_fullmac/rtl8730e/spi
dtc<span class="w"> </span>-@<span class="w"> </span>-Hepapr<span class="w"> </span>-I<span class="w"> </span>dts<span class="w"> </span>-O<span class="w"> </span>dtb<span class="w"> </span>-o<span class="w"> </span>inic_spidev.dtbo<span class="w"> </span>spidev-overlay.dts
cp<span class="w"> </span>inic_spidev.dtbo<span class="w"> </span>/boot/overlays/
dtoverlay<span class="w"> </span>inic_spidev
</pre></div>
</div>
</div></blockquote>
</div><div aria-labelledby="tab-3-3-2" class="sphinx-tabs-panel" hidden="true" id="panel-3-3-2" name="3-2" role="tabpanel" tabindex="0"></div></div>
</li>
<li><p>Build the module.</p>
<ol class="loweralpha simple">
<li><p>In the path <code class="docutils literal notranslate"><span class="pre">/component/wifi/cfg80211_fullmac</span></code>, execute the following script with an interface parameter to configure the host driver.</p></li>
</ol>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-4-4-0" aria-selected="true" class="sphinx-tabs-tab" id="tab-4-4-0" name="4-0" role="tab" tabindex="0">SDIO</button><button aria-controls="panel-4-4-1" aria-selected="false" class="sphinx-tabs-tab" id="tab-4-4-1" name="4-1" role="tab" tabindex="-1">SPI</button><button aria-controls="panel-4-4-2" aria-selected="false" class="sphinx-tabs-tab" id="tab-4-4-2" name="4-2" role="tab" tabindex="-1">USB</button></div><div aria-labelledby="tab-4-4-0" class="sphinx-tabs-panel" id="panel-4-4-0" name="4-0" role="tabpanel" tabindex="0"><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">fullmac_setup</span><span class="o">.</span><span class="n">sh</span> <span class="n">sdio</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-4-4-1" class="sphinx-tabs-panel" hidden="true" id="panel-4-4-1" name="4-1" role="tabpanel" tabindex="0"><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">fullmac_setup</span><span class="o">.</span><span class="n">sh</span> <span class="n">spi</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-4-4-2" class="sphinx-tabs-panel" hidden="true" id="panel-4-4-2" name="4-2" role="tabpanel" tabindex="0"><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">fullmac_setup</span><span class="o">.</span><span class="n">sh</span> <span class="n">usb</span>
</pre></div>
</div>
</div></div>
<ol class="loweralpha" start="2">
<li><p>Copy the folder of <code class="docutils literal notranslate"><span class="pre">cfg80211_fullmac</span></code> to the Linux system.</p></li>
<li><p>Open the terminal and execute the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="p">{</span><span class="n">driver_path</span><span class="p">}</span><span class="o">/</span><span class="n">cfg80211_fullmac</span><span class="p">;</span><span class="n">make</span>
</pre></div>
</div>
</li>
</ol>
</li>
</ol>
<ol class="arabic" id="load-the-module-step" start="3">
<li><p>Load the module.</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-5-5-0" aria-selected="true" class="sphinx-tabs-tab" id="tab-5-5-0" name="5-0" role="tab" tabindex="0">SDIO</button><button aria-controls="panel-5-5-1" aria-selected="false" class="sphinx-tabs-tab" id="tab-5-5-1" name="5-1" role="tab" tabindex="-1">SPI</button><button aria-controls="panel-5-5-2" aria-selected="false" class="sphinx-tabs-tab" id="tab-5-5-2" name="5-2" role="tab" tabindex="-1">USB</button></div><div aria-labelledby="tab-5-5-0" class="sphinx-tabs-panel" id="panel-5-5-0" name="5-0" role="tabpanel" tabindex="0"><p><code class="file docutils literal notranslate"><span class="pre">fullmac_sdio.ko</span></code> is generated in <code class="docutils literal notranslate"><span class="pre">/cfg80211_fullmac/sdio</span></code>.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>su
cp<span class="w"> </span>sdio/fullmac_sdio.ko<span class="w"> </span>/lib/modules/XXX/
depmod
modprobe<span class="w"> </span>fullmac_sdio
</pre></div>
</div>
</div><div aria-labelledby="tab-5-5-1" class="sphinx-tabs-panel" hidden="true" id="panel-5-5-1" name="5-1" role="tabpanel" tabindex="0"><p><code class="file docutils literal notranslate"><span class="pre">fullmac_spi.ko</span></code> is generated in <code class="docutils literal notranslate"><span class="pre">/cfg80211_fullmac/spi</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">su</span>
<span class="n">cp</span> <span class="n">spi</span><span class="o">/</span><span class="n">fullmac_spi</span><span class="o">.</span><span class="n">ko</span> <span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">modules</span><span class="o">/</span><span class="n">XXX</span><span class="o">/</span>
<span class="n">depmod</span>
<span class="n">modprobe</span> <span class="n">fullmac_spi</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-5-5-2" class="sphinx-tabs-panel" hidden="true" id="panel-5-5-2" name="5-2" role="tabpanel" tabindex="0"><p><code class="file docutils literal notranslate"><span class="pre">fullmac_spi.ko</span></code> is generated in <code class="docutils literal notranslate"><span class="pre">/cfg80211_fullmac/usb</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">su</span>
<span class="n">cp</span> <span class="n">usb</span><span class="o">/</span><span class="n">fullmac_spi</span><span class="o">.</span><span class="n">ko</span> <span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">modules</span><span class="o">/</span><span class="n">XXX</span><span class="o">/</span>
<span class="n">depmod</span>
<span class="n">modprobe</span> <span class="n">fullmac_usb</span>
</pre></div>
</div>
</div></div>
<p>When loading module is successful, use <code class="docutils literal notranslate"><span class="pre">ifconfig</span></code> command to get the information of net device.
The net device whose MAC address starts with <code class="docutils literal notranslate"><span class="pre">00:e0:4c</span></code> is STA, and the net device whose MAC address starts with <code class="docutils literal notranslate"><span class="pre">00:e1:4c</span> <span class="pre">is</span></code> softAP.</p>
<p>The following is an example, in which <strong>wlan1</strong> is STA and <strong>wlan2</strong> is softAP.</p>
<figure class="align-center">
<a class="reference internal image-reference" href="../../../../_images/ifconfig_sta_softap.png"><img alt="../../../../_images/ifconfig_sta_softap.png" src="../../../../_images/ifconfig_sta_softap.png" style="width: 569.0px; height: 524.0px;" /></a>
</figure>
</li>
<li><p>Connect to STA.</p>
<ol class="loweralpha">
<li><p>Create <code class="file docutils literal notranslate"><span class="pre">wpa_supplicant.conf</span></code> under the path <code class="docutils literal notranslate"><span class="pre">/etc/wpa_supplicant/</span></code> and add AP information.</p>
<p>There is an example configuration for WPA2.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ctrl_interface</span><span class="o">=/</span><span class="n">var</span><span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">wpa_supplicant</span>
<span class="n">network</span><span class="o">=</span><span class="p">{</span>
         <span class="n">ssid</span><span class="o">=</span><span class="s2">&quot;HUAWEI-JX2UX5_HiLink_5G&quot;</span>
         <span class="n">psk</span><span class="o">=</span><span class="s2">&quot;12345678&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><p>Connect with the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Wpa_supplicant</span> <span class="o">-</span><span class="n">D</span> <span class="n">nl80211</span> <span class="o">-</span><span class="n">i</span> <span class="n">wlanX</span> <span class="o">-</span><span class="n">c</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">wpa_supplicant</span><span class="o">/</span><span class="n">wpa_supplicant</span><span class="o">.</span><span class="n">conf</span> <span class="o">-</span><span class="n">dd</span> <span class="o">&gt;</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">wifi_log</span>
</pre></div>
</div>
</li>
<li><p>Obtain the IP address with the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dhcpcd</span> <span class="n">wlanX</span>
</pre></div>
</div>
</li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul>
<li><p>The <em>wlanX</em> in the above command refers to the name of STA obtained from <a class="reference internal" href="#load-the-module-step"><span class="std std-ref">Step 3</span></a>.</p></li>
<li><p>The configuration files of OPEN and WPA3 are different, please refer to the official supplicant documentation for details.</p></li>
<li><p>For Ubuntu system, if you want to manually connect using command <code class="docutils literal notranslate"><span class="pre">wpa_supplicant</span></code> and obtain an IP address, first stop NetworkManager and DHCP service to avoid the influence of NetworkManager on <em>wpa_supplicant</em>.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>su
systemctl<span class="w"> </span>stop<span class="w"> </span>NetworkManager
systemctl<span class="w"> </span>disable<span class="w"> </span>NetworkManager
systemctl<span class="w"> </span>stop<span class="w"> </span>dhcpcd.service
</pre></div>
</div>
</li>
</ul>
</div>
</li>
<li><p>Setup the softAP.</p>
<ol class="loweralpha">
<li><p>Create <code class="file docutils literal notranslate"><span class="pre">hostapd.conf</span></code> under the path <code class="docutils literal notranslate"><span class="pre">/etc/hostapd/</span></code> and add the configuration information.</p>
<p>Take WPA2 as an example, you can add the following information:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">driver</span><span class="o">=</span><span class="n">nl80211</span>

<span class="n">logger_syslog</span><span class="o">=-</span><span class="mi">1</span>
<span class="n">logger_syslog_level</span><span class="o">=</span><span class="mi">2</span>
<span class="n">logger_stdout</span><span class="o">=-</span><span class="mi">1</span>
<span class="n">logger_stdout_level</span><span class="o">=</span><span class="mi">2</span>

<span class="n">ctrl_interface</span><span class="o">=/</span><span class="n">var</span><span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">hostapd</span>

<span class="n">hw_mode</span><span class="o">=</span><span class="n">g</span>
<span class="n">channel</span><span class="o">=</span><span class="mi">6</span>
<span class="n">ssid</span><span class="o">=</span><span class="n">aaa_test</span>
<span class="n">beacon_int</span><span class="o">=</span><span class="mi">100</span>
<span class="n">dtim_period</span><span class="o">=</span><span class="mi">1</span>
<span class="n">max_num_sta</span><span class="o">=</span><span class="mi">8</span>
<span class="n">rts_threshold</span><span class="o">=</span><span class="mi">2347</span>
<span class="n">fragm_threshold</span><span class="o">=</span><span class="mi">2346</span>

<span class="n">ieee80211n</span><span class="o">=</span><span class="mi">1</span>

<span class="n">erp_send_reauth_start</span><span class="o">=</span><span class="mi">1</span>

<span class="n">wpa</span><span class="o">=</span><span class="mi">2</span>
<span class="n">wpa_key_mgmt</span><span class="o">=</span><span class="n">WPA</span><span class="o">-</span><span class="n">PSK</span>
<span class="n">wpa_pairwise</span><span class="o">=</span><span class="n">CCMP</span>
<span class="n">wpa_passphrase</span><span class="o">=</span><span class="mi">12345678</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This configuration file is applicable for WPA2 softAP.
If you want to use OPEN or WPA3, please refer to the official hostapd documentation to set the parameters.</p>
</div>
</li>
<li><p>Create <code class="file docutils literal notranslate"><span class="pre">udhcpd_wlanX.conf</span></code> under the path <code class="docutils literal notranslate"><span class="pre">/etc/</span></code> and add the following information:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># The start and end of the IP lease block</span>
<span class="n">start</span>          <span class="mf">192.168.43.20</span>
<span class="n">end</span>            <span class="mf">192.168.43.254</span>

<span class="c1"># The interface that udhcpd will use</span>
<span class="n">interface</span>      <span class="n">wlanX</span>

<span class="n">opt</span>    <span class="n">dns</span>     <span class="mf">192.168.43.1</span> <span class="mf">129.219.13.81</span>
<span class="n">option</span> <span class="n">subnet</span>  <span class="mf">255.255.255.0</span>
<span class="n">opt</span>    <span class="n">router</span>  <span class="mf">192.168.43.1</span>
<span class="n">option</span> <span class="n">domain</span>  <span class="n">local</span>
<span class="n">option</span> <span class="n">lease</span>   <span class="mi">864000</span>          <span class="c1"># default: 10 days</span>
<span class="n">option</span> <span class="n">msstaticroutes</span>  <span class="mf">10.0.0.0</span><span class="o">/</span><span class="mi">8</span> <span class="mf">10.127.0.1</span>           <span class="c1"># single static route</span>
<span class="n">option</span> <span class="n">staticroutes</span>    <span class="mf">10.0.0.0</span><span class="o">/</span><span class="mi">8</span> <span class="mf">10.127.0.1</span><span class="p">,</span> <span class="mf">10.11.12.0</span><span class="o">/</span><span class="mi">24</span> <span class="mf">10.11.12.1</span>
<span class="n">option</span> <span class="mh">0x08</span>    <span class="mi">01020304</span>        <span class="c1"># option 8: &quot;cookie server IP addr: 1.2.3.4&quot;</span>
</pre></div>
</div>
</li>
<li><p>Start the softAP.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">hostapd</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">hostapd</span><span class="o">/</span><span class="n">hostapd</span><span class="o">.</span><span class="n">conf</span> <span class="o">-</span><span class="n">i</span> <span class="n">wlanX</span>
</pre></div>
</div>
</li>
<li><p>Set the IP address.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ifconfig</span> <span class="n">wlanX</span> <span class="mf">192.168.43.1</span>
</pre></div>
</div>
</li>
<li><p>Start the DHCP server.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">udhcpd</span> <span class="o">-</span><span class="n">f</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">udhcpd_wlanX</span><span class="o">.</span><span class="n">conf</span>
</pre></div>
</div>
</li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <em>wlanX</em> in the above command refers to the name of softAP obtained from <a class="reference internal" href="#load-the-module-step"><span class="std std-ref">Step 3</span></a>.</p>
</div>
</li>
</ol>
</section>
</section>
<section id="id9">
<h4>Bluetooth<a class="headerlink" href="#id9" title="Link to this heading"></a></h4>
<section id="id10">
<h5>Host Driver<a class="headerlink" href="#id10" title="Link to this heading"></a></h5>
</section>
</section>
</section>
</section>
</section>
<section id="throughput">
<h1>Throughput<a class="headerlink" href="#throughput" title="Link to this heading"></a></h1>
<section id="id11">
<h2>FreeRTOS<a class="headerlink" href="#id11" title="Link to this heading"></a></h2>
<table class="docutils align-default" style="width: 100%">
<thead>
<tr class="row-odd"><th class="head"><p>Interface</p></th>
<th class="head"><p>Item</p></th>
<th class="head"><p>BW 20M (Mbps)</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td rowspan="4"><p>SPI</p></td>
<td><p>TCP RX</p></td>
<td><p>8.3</p></td>
</tr>
<tr class="row-odd"><td><p>TCP TX</p></td>
<td><p>9.9</p></td>
</tr>
<tr class="row-even"><td><p>UDP RX</p></td>
<td><p>15.8</p></td>
</tr>
<tr class="row-odd"><td><p>UDP TX</p></td>
<td><p>17.6</p></td>
</tr>
</tbody>
</table>
</section>
<section id="id12">
<h2>Linux<a class="headerlink" href="#id12" title="Link to this heading"></a></h2>
<table class="docutils align-default" style="width: 100%">
<thead>
<tr class="row-odd"><th class="head"><p>Interface</p></th>
<th class="head"><p>Wi-Fi driver location</p></th>
<th class="head"><p>Item</p></th>
<th class="head"><p>BW 20M (Mbps)</p></th>
<th class="head"><p>BW 40M (Mbps)</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td rowspan="8"><p>SDIO <sup>[1]</sup></p></td>
<td rowspan="4"><p>KM0</p></td>
<td><p>TCP RX</p></td>
<td><p>36</p></td>
<td><p>42</p></td>
</tr>
<tr class="row-odd"><td><p>TCP TX</p></td>
<td><p>46</p></td>
<td><p>54</p></td>
</tr>
<tr class="row-even"><td><p>UDP RX</p></td>
<td><p>50</p></td>
<td><p>60</p></td>
</tr>
<tr class="row-odd"><td><p>UDP TX</p></td>
<td><p>55</p></td>
<td><p>62</p></td>
</tr>
<tr class="row-even"><td rowspan="4"><p>KM4 (331MHz)</p></td>
<td><p>TCP RX</p></td>
<td><p>41</p></td>
<td><p>58</p></td>
</tr>
<tr class="row-odd"><td><p>TCP TX</p></td>
<td><p>46</p></td>
<td><p>80</p></td>
</tr>
<tr class="row-even"><td><p>UDP RX</p></td>
<td><p>53</p></td>
<td><p>74</p></td>
</tr>
<tr class="row-odd"><td><p>UDP TX</p></td>
<td><p>53</p></td>
<td><p>90</p></td>
</tr>
<tr class="row-even"><td rowspan="4"><p>SPI <sup>[2]</sup></p></td>
<td rowspan="4"><p>KM0</p></td>
<td><p>TCP RX</p></td>
<td><p>14.5</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>TCP TX</p></td>
<td><p>16</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>UDP RX</p></td>
<td><p>17.4</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>UDP TX</p></td>
<td><p>17.8</p></td>
<td></td>
</tr>
<tr class="row-even"><td rowspan="4"><p>USB <sup>[3]</sup></p></td>
<td rowspan="4"></td>
<td><p>TCP RX</p></td>
<td></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>TCP TX</p></td>
<td></td>
<td></td>
</tr>
<tr class="row-even"><td><p>UDP RX</p></td>
<td></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>UDP TX</p></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>[1] The data is the test result of device code running in PSRAM, host driver running on Dell Optiplex 3080 MT.</p></li>
<li><p>[2] The data is the test result of device code running in PSRAM, host driver running on Raspberry Pi 4.</p></li>
<li><p>[3] The data is the test result of device code running in</p></li>
</ul>
</div>
</section>
</section>
<section id="memory-size-requirement">
<h1>Memory Size Requirement<a class="headerlink" href="#memory-size-requirement" title="Link to this heading"></a></h1>
<section id="device">
<h2>Device<a class="headerlink" href="#device" title="Link to this heading"></a></h2>
<p>Take the Wi-Fi driver running on KM0 for an example:</p>
<table class="docutils align-default" style="width: 100%">
<thead>
<tr class="row-odd"><th class="head"><p>Item</p></th>
<th class="head"><p>KM0</p></th>
<th class="head"><p>KM4</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>txt</p></td>
<td><p>270KB</p></td>
<td><p>31KB</p></td>
</tr>
<tr class="row-odd"><td><p>rodata</p></td>
<td><p>51KB</p></td>
<td><p>9KB</p></td>
</tr>
<tr class="row-even"><td><p>data+bss</p></td>
<td><p>17KB</p></td>
<td><p>4KB</p></td>
</tr>
<tr class="row-odd"><td><p>heap</p></td>
<td><p>~68KB</p></td>
<td><p>~2.5KB</p></td>
</tr>
</tbody>
</table>
</section>
<section id="host">
<h2>Host<a class="headerlink" href="#host" title="Link to this heading"></a></h2>
<section id="id13">
<h3>FreeRTOS<a class="headerlink" href="#id13" title="Link to this heading"></a></h3>
<table class="docutils align-default" style="width: 100%">
<thead>
<tr class="row-odd"><th class="head"><p>Host</p></th>
<th class="head"><p>Item</p></th>
<th class="head"><p>inic</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td rowspan="3"><p>SPI</p></td>
<td><p>txt</p></td>
<td><p>4.8KB</p></td>
</tr>
<tr class="row-odd"><td><p>bss</p></td>
<td><p>~3.5KB</p></td>
</tr>
<tr class="row-even"><td><p>heap</p></td>
<td><p>~5KB</p></td>
</tr>
</tbody>
</table>
</section>
<section id="id14">
<h3>Linux<a class="headerlink" href="#id14" title="Link to this heading"></a></h3>
<table class="docutils align-default" style="width: 100%">
<thead>
<tr class="row-odd"><th class="head"><p>Host</p></th>
<th class="head"><p>Item</p></th>
<th class="head"><p>fullmac_xxx.ko</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td rowspan="3"><p>SDIO</p></td>
<td><p>txt</p></td>
<td><p>88KB</p></td>
</tr>
<tr class="row-odd"><td><p>data</p></td>
<td><p>65KB</p></td>
</tr>
<tr class="row-even"><td><p>bss</p></td>
<td><p>18KB</p></td>
</tr>
<tr class="row-odd"><td rowspan="3"><p>SPI</p></td>
<td><p>txt</p></td>
<td><p>73KB</p></td>
</tr>
<tr class="row-even"><td><p>data</p></td>
<td><p>54KB</p></td>
</tr>
<tr class="row-odd"><td><p>bss</p></td>
<td><p>18KB</p></td>
</tr>
<tr class="row-even"><td rowspan="3"><p>USB</p></td>
<td><p>txt</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>data</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>bss</p></td>
<td></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The characters before <strong>.ko</strong> are <strong>sdio</strong>, <strong>spi</strong> or <strong>usb</strong>, corresponding to different hosts.</p>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="FullMAC" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../../wifi/index.html" class="btn btn-neutral float-right" title="Wi-Fi" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Realsil.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>