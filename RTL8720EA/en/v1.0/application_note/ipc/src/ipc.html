<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Introduction &mdash; RTL8720EA Docs  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css?v=13237357" />
      <link rel="stylesheet" type="text/css" href="../../../_static/tabs.css?v=a5c4661c" />

  
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../../../_static/toggleprompt.js?v=d7ede5d2"></script>
        <script>let toggleHintShow = 'Click to show';</script>
        <script>let toggleHintHide = 'Click to hide';</script>
        <script>let toggleOpenOnPrint = 'true';</script>
        <script src="../../../_static/togglebutton.js?v=4a39c7ea"></script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Direct Memory Access Controller (DMAC)" href="../../dmac/src/index.html" />
    <link rel="prev" title="Inter-Processor Communication (IPC)" href="index.html" />  
     
  <link href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script type="text/javascript" src="../../../_static/js/selector.js"></script>
<style>
      .wy-nav-content {
      max-width: 1000px; /* 设置最大宽度 */
      }
</style>



</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            RTL8720EA Docs
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../product_overview/src/index.html">Product Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../index.html">Application Note</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../gcc_build_environment/src/index.html">Build Environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../sdk_architecture/src/index.html">SDK Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../gcc_makefile/src/index.html">GCC Makefile</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../sdk_example/src/index.html">SDK Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../flash_memory_layout/index.html">Flash and Memory Layout</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../mpu_cache/src/index.html">MPU and Cache</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../file_system/src/index.html">Virtual File System</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../mp_image/src/index.html">MP Image</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ota/src/index.html">OTA Firmware Update</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../chipen/src/index.html">CHIP Enable</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../boot_process/src/index.html">Boot Process</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_config/src/index.html">User Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../hardware_ecdsa/src/index.html">ECDSA Engine</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../hardware_crypto_engine/src/index.html">Hardware Crypto Engine</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../otpc/src/index.html">One-time Programmable Controller (OTPC)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../power_save/src/index.html">Power Saving</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html">Inter-Processor Communication (IPC)</a><ul>
<li><a class="reference internal" href="#id1">Introduction</a></li>
<li><a class="reference internal" href="#id2">General Principle</a></li>
<li class="toctree-l3"><a class="reference internal" href="#how-to-use-ipc">How to Use IPC</a></li>
<li class="toctree-l3"><a class="reference internal" href="#troubleshooting">Troubleshooting</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ipc-application">IPC Application</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id3">Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="#how-to-use-ipc-application">How to Use IPC Application</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../dmac/src/index.html">Direct Memory Access Controller (DMAC)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../psram/src/index.html">Pseudo-Static Random Access Memory (PSRAM)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../pad/src/index.html">Pad Control</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../pinmux/src/index.html">Pin Multiplexing Instructions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../gpio/gpio/src/index.html">General Purpose Input/Output (GPIO)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../gpio/pinctrl/src/pinctrl.html">Pin Controller (Pinctrl)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ledc/src/index.html">Light Emitting Diode Controller (LEDC)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../trng/src/index.html">True Random Number Generator (TRNG)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../adc/src/index.html">Analog-to-Digital Converter (ADC)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../cap_touch/src/index.html">Cap-Touch Controller (CTC)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../thermal/src/index.html">Thermal Senor</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../ameba/en/fullmac/src/index.html">FullMAC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ameba/en/wifi/index.html">Wi-Fi Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ameba/en/wifi_tunnel/src/index.html">Wi-Fi R-Mesh</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ameba/en/wifi_bridge/src/index.html">Wi-Fi Bridge</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ameba/en/wifi_csi/src/index.html">Wi-Fi CSI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ameba/en/dsp/index.html">DSP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ameba/en/usb/usb_otg/src/index.html">USB Host &amp; Device</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ameba/en/audio/src/index.html">Audio</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ameba/en/multimedia/src/index.html">Multimedia</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ameba/en/gui/src/index.html">GUI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ameba/en/ai/index.html">AI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ameba/en/ai_voice/src/index.html">AIVoice</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ameba/en/low_power/src/index.html">Low Power Solution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ameba/en/security_encryption/src/index.html">Security &amp; Encryption</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ameba/en/at_command/src/index.html">AT Command</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ameba/en/software_tools/index.html">Software Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ameba/en/mp_tools/src/index.html">MP Tools</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">RTL8720EA Docs</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Application Note</a></li>
          <li class="breadcrumb-item"><a href="index.html">Inter-Processor Communication (IPC)</a></li>
      <li class="breadcrumb-item active">Introduction</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="id1">
<h1>Introduction<a class="headerlink" href="#id1" title="Link to this heading"></a></h1>
<p>There are multi-CPUs named KR4 and KM4 integrated into RTL8720EA. The inter-processor communication (IPC) hardware is designed to make these CPUs communicate with each other. Also, a shared SRAM is used to transmit information to each other. The block diagram is shown in the following figure.</p>
<figure class="align-center" id="id5">
<a class="reference internal image-reference" href="../../../_images/ipc_block_diagram_8720EA.svg"><img alt="../../../_images/ipc_block_diagram_8720EA.svg" height="49" src="../../../_images/ipc_block_diagram_8720EA.svg" width="282" /></a>
<figcaption>
<p><span class="caption-text">IPC block diagram</span><a class="headerlink" href="#id5" title="Link to this image"></a></p>
</figcaption>
</figure>
</section>
<section id="id2">
<h1>General Principle<a class="headerlink" href="#id2" title="Link to this heading"></a></h1>
<p>There are two directions for KM4 and KR4 to communicate with each other, and 8 channels for each direction. All the channels are processed independently, which means that one core can send different information to the other core through different channels at any time, the channels will not affect each other.</p>
<p>Each channel has one transmit side and one receive side, the transmit side and the receive side of the same channel is a pair. For example, KR4 sends an IPC to KM4 through channel 4, the transmit side is KR4 channel 4, and the receive side is KM4 channel 4; and information is sent from KR4 channel 4 to KM4 channel 4.</p>
<figure class="align-center" id="id7">
<a class="reference internal image-reference" href="../../../_images/ipc_schematic_diagram_8720EA.svg"><img alt="../../../_images/ipc_schematic_diagram_8720EA.svg" height="96" src="../../../_images/ipc_schematic_diagram_8720EA.svg" width="404" /></a>
<figcaption>
<p><span class="caption-text">IPC schematic diagram</span><a class="headerlink" href="#id7" title="Link to this image"></a></p>
</figcaption>
</figure>
</section>
<section id="how-to-use-ipc">
<h1>How to Use IPC<a class="headerlink" href="#how-to-use-ipc" title="Link to this heading"></a></h1>
<p>For example, KR4 sends an IPC to KM4 through channel 4.</p>
<ol class="arabic">
<li><p>Select IPC channel.</p>
<p>Uncomment the corresponding channel in <code class="file docutils literal notranslate"><span class="pre">ameba_ipc.h</span></code>  and add some description as below. This macro is used in step <a class="reference internal" href="#ipc-usage-procedure-step-3"><span class="std std-ref">3</span></a>. In this case, uncomment the macro <code class="docutils literal notranslate"><span class="pre">IPC_R2M_Channel4</span></code> which means KR4 to KM4 channel 4.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cm">/** @defgroup IPC_KR4_Tx_Channel</span>
<span class="cm">* @{</span>
<span class="cm">*/</span>
<span class="cp">#define IPC_R2M_TICKLESS_INDICATION    0  </span><span class="cm">/*!&lt; KR4 --&gt; KM4 Tickless indicate */</span>
<span class="cp">#define IPC_R2M_WAKE_AP                1  </span><span class="cm">/*!&lt; KR4 --&gt; KM4 Wakeup*/</span>
<span class="cp">#define IPC_R2M_FLASHPG_REQ            2  </span><span class="cm">/*!&lt; KR4 --&gt; KM4 Flash Program REQUEST*/</span>
<span class="cp">#define IPC_R2M_WIFI_FW_INFO           2  </span><span class="cm">/*!&lt; KR4 --&gt; KM4 FW Info*/</span>
<span class="c1">//#define IPC_R2M_Channel3             3</span>
<span class="hll"><span class="cp">#define IPC_R2M_Channel4               4  </span><span class="cm">/*Add your Description Here*/</span>
</span><span class="c1">//#define IPC_R2M_Channel5             5</span>
<span class="cp">#define IPC_R2M_WIFI_TRX_TRAN          6  </span><span class="cm">/*!&lt; NP --&gt; AP WIFI Message Exchange */</span>
<span class="cp">#define IPC_R2M_WIFI_API_TRAN          7  </span><span class="cm">/*!&lt; NP --&gt; AP API WIFI Message Exchange */</span>
<span class="cm">/**</span>
<span class="cm">* @}</span>
<span class="cm">*/</span>
</pre></div>
</div>
</li>
<li><p>Register IRQ handler function of the selected channel.</p>
<p>Add struct <code class="docutils literal notranslate"><span class="pre">IPC_INIT_TABLE</span></code> into your code and put this struct in IPC table section by add <code class="docutils literal notranslate"><span class="pre">IPC_TABLE_DATA_SECTION</span></code>. This struct specifies the direction, channel, mode and IRQ function of IPC as below.</p>
<dl class="field-list">
<dt class="field-odd">&lt;USER_MSG_TYPE&gt;<span class="colon">:</span></dt>
<dd class="field-odd"><p>This parameter can be</p>
<div class="line-block">
<div class="line"><strong>IPC_USER_DATA</strong>: The contents of this IPC is data.</div>
<div class="line"><strong>IPC_USER_POINT</strong>: The contents of this IPC is pointer which points to address of actual data.</div>
</div>
</dd>
<dt class="field-even">&lt;RxFunc&gt;<span class="colon">:</span></dt>
<dd class="field-even"><p>The callback function that CPU executes after receiving IPC.</p>
</dd>
<dt class="field-odd">&lt;RxIrqData&gt;<span class="colon">:</span></dt>
<dd class="field-odd"><p>The parameters that are passed into the rx callback function.</p>
</dd>
<dt class="field-even">&lt;TxFunc&gt;<span class="colon">:</span></dt>
<dd class="field-even"><p>The callback function that CPU executes after sending IPC.</p>
</dd>
<dt class="field-odd">&lt;TxIrqData&gt;<span class="colon">:</span></dt>
<dd class="field-odd"><p>The parameters that are passed into the tx callback function</p>
</dd>
<dt class="field-even">&lt;IPC_Direction&gt;<span class="colon">:</span></dt>
<dd class="field-even"><p>This parameter can be</p>
<div class="line-block">
<div class="line"><strong>IPC_KR4_TO_KM4</strong>: IPC is sent from KR4 to KM4.</div>
<div class="line"><strong>IPC_KM4_TO_KR4</strong>: IPC is sent from KM4 to KR4.</div>
<div class="line"><strong>IPC_KR4_TO_DSP</strong>: IPC is sent from KR4 to DSP.</div>
<div class="line"><strong>IPC_KM4_TO_DSP</strong>: IPC is sent from KM4 to DSP.</div>
<div class="line"><strong>IPC_DSP_TO_KR4</strong>: IPC is sent from DSP to KR4.</div>
<div class="line"><strong>IPC_DSP_TO_KM4</strong>: IPC is sent from DSP to KM4.</div>
</div>
</dd>
<dt class="field-odd">&lt;IPC_R2M_Channel4&gt;<span class="colon">:</span></dt>
<dd class="field-odd"><p>IPC channel used, this macro is selected in the previous step.</p>
</dd>
</dl>
<p>The SDK will automatically enable the IPC interrupt and register the corresponding IRQ handler and data for the channel. In this example, KM4 will enter IRQ_function_int after KR4 sends IPC through channel 4.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">IRQ_function_int</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
<span class="cm">/* Add your code here*/</span>
<span class="p">}</span>

<span class="n">IPC_TABLE_DATA_SECTION</span>
<span class="k">const</span><span class="w"> </span><span class="n">IPC_INIT_TABLE</span><span class="w"> </span><span class="n">ipc_R2M_CH4_table</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="p">{</span><span class="n">IPC_USER_DATA</span><span class="p">,</span><span class="w"> </span><span class="n">IRQ_function_int</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">VOID</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">IPC_TXHandler</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">VOID</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">IPC_KR4_TO_KM4</span><span class="p">,</span><span class="w"> </span><span class="n">IPC_R2M_Channel4</span><span class="p">},</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
</ol>
<ol class="arabic" id="ipc-usage-procedure-step-3" start="3">
<li><p>Send IPC request.</p>
<p>When KR4 sends an IPC request to KM4 through channel 4, it should call <code class="xref py py-func docutils literal notranslate"><span class="pre">ipc_send_message()</span></code>  and specify the channel number and message. If no message is needed, just input <code class="docutils literal notranslate"><span class="pre">NULL</span></code> for the third parameter of <code class="xref py py-func docutils literal notranslate"><span class="pre">ipc_send_message()</span></code> .</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">IPC_MSG_STRUCT</span><span class="w"> </span><span class="n">ipc_msg</span><span class="p">;</span>
<span class="cm">/*init ipc_msg here*/</span>
<span class="n">ipc_msg</span><span class="p">.</span><span class="n">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">u32</span><span class="p">)</span><span class="o">&amp;</span><span class="n">tmp_np_log_</span><span class="w"> </span><span class="n">buf</span><span class="p">;</span>
<span class="cm">/*init ipc_msg end*/</span>
<span class="n">ipc_send_message</span><span class="p">(</span><span class="n">IPC_KR4_TO_KM4</span><span class="p">,</span><span class="w"> </span><span class="n">IPC_R2M_Channel4</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ipc_msg</span><span class="p">);</span>
</pre></div>
</div>
</li>
<li><p>Get IPC message if needed.</p>
<p>After receiving IPC from KR4 channel 4, KM4 will enter IPC interrupt handler and the corresponding receive IRQ handler will be executed, call <code class="xref py py-func docutils literal notranslate"><span class="pre">ipc_get_message()</span></code> to get the message if needed.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">PIPC_MSG_STRUCT</span><span class="w"> </span><span class="n">ipc_msg_temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">PIPC_MSG_STRUCT</span><span class="p">)</span><span class="n">ipc_get_message</span><span class="p">(</span><span class="n">IPC_KR4_TO_KM4</span><span class="p">,</span><span class="w"> </span><span class="n">IPC_R2M_Channel4</span><span class="p">);</span>
</pre></div>
</div>
</li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Several channels are already used by Realtek, you can use the remaining channels.</p>
</div>
</section>
<section id="troubleshooting">
<h1>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Link to this heading"></a></h1>
<p>If <code class="docutils literal notranslate"><span class="pre">Channel</span> <span class="pre">Conflict</span> <span class="pre">for</span> <span class="pre">Channel</span> <span class="pre">xx!</span></code> log shows up, it means two IRQ functions are registered in the same channel. For example, if IRQFunc1 and IRQFunc2 are both registered in KM4 for KR4 to KM4 channel 1, the log will show up as below.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="mi">14</span><span class="o">:</span><span class="mi">23</span><span class="o">:</span><span class="mf">03.905</span><span class="w"> </span><span class="p">[</span><span class="n">MODULE_IPC</span><span class="o">-</span><span class="n">LEVEL_ERROR</span><span class="p">]</span><span class="o">:</span><span class="w"> </span><span class="n">Channel</span><span class="w"> </span><span class="n">Conflict</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Channel</span><span class="w"> </span><span class="mi">25</span><span class="o">!</span>
</pre></div>
</div>
</section>
<section id="ipc-application">
<h1>IPC Application<a class="headerlink" href="#ipc-application" title="Link to this heading"></a></h1>
<section id="id3">
<h2>Introduction<a class="headerlink" href="#id3" title="Link to this heading"></a></h2>
<p>IPC queue is designed for cores communication. Define an IPC queue between every two cores, and the two cores can send and receive messages through this IPC queue.</p>
<p>IPC Message Queue:</p>
<ol class="arabic simple">
<li><p>Packets send data from Core A to Core B through IPC message queue.</p></li>
<li><p>Sender copy a complete packet into queue.</p></li>
<li><p>Receiver copy packet with custom size from queue.</p></li>
</ol>
<p>For receiver, IPC interrupt is necessary.</p>
<figure class="align-center" id="id8">
<a class="reference internal image-reference" href="../../../_images/ipc_message_queue_block_diagram.svg"><img alt="../../../_images/ipc_message_queue_block_diagram.svg" height="179" src="../../../_images/ipc_message_queue_block_diagram.svg" width="709" /></a>
<figcaption>
<p><span class="caption-text">IPC Message Queue block diagram</span><a class="headerlink" href="#id8" title="Link to this image"></a></p>
</figcaption>
</figure>
</section>
<section id="how-to-use-ipc-application">
<h2>How to Use IPC Application<a class="headerlink" href="#how-to-use-ipc-application" title="Link to this heading"></a></h2>
<p>Before use IPC application, users should enable this function and initial it in each core.</p>
<ul class="simple">
<li><p>For KM4: <span class="menuselection">make menuconfig &gt; MENUCONFIG FOR KM4 CONFIG &gt; CONFIG IPC Message Queue &gt; Enable IPC Message Queue</span></p></li>
<li><p>For KR4: <span class="menuselection">make menuconfig &gt; MENUCONFIG FOR KR4 CONFIG &gt; CONFIG IPC Message Queue &gt; Enable IPC Message Queue</span></p></li>
<li><p>For DSP: Open project_dsp with Xplorer, then click <span class="menuselection">project_dsp &gt; Build Properties &gt; Symbols</span>, and set <span class="guilabel">CONFIG_RPC_EN</span> to 1</p></li>
</ul>
<p>The procedure will call <code class="xref py py-func docutils literal notranslate"><span class="pre">ipc_app_init()</span></code> in <code class="xref py py-func docutils literal notranslate"><span class="pre">main()</span></code> to initial IPC application when IPC application is enabled. The initialization include IPC queue initialization.</p>
<section id="how-to-use-ipc-queue">
<h3>How to Use IPC Queue<a class="headerlink" href="#how-to-use-ipc-queue" title="Link to this heading"></a></h3>
<p>For example, communication between KM4 and KR4 through <code class="docutils literal notranslate"><span class="pre">IPC_ID_KR4_TO_KM4</span></code>.</p>
<ol class="arabic">
<li><p><code class="docutils literal notranslate"><span class="pre">IPC_ID_KR4_TO_KM4</span></code> definition in enumeration <code class="docutils literal notranslate"><span class="pre">IPC_ID</span></code> in <code class="file docutils literal notranslate"><span class="pre">ipc.h</span></code> is shown below. This definition is used in <a class="reference internal" href="#how-to-use-ipc-queue-step-2"><span class="std std-ref">Stap 2</span></a>.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">typedef</span><span class="w"> </span><span class="k">enum</span><span class="w"> </span><span class="p">{</span>
<span class="hll"><span class="w">   </span><span class="n">IPC_ID_KR4_TO_KM4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
</span><span class="w">   </span><span class="n">IPC_ID_KM4_TO_KR4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">   </span><span class="n">IPC_ID_KR4_TO_DSP</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span>
<span class="w">   </span><span class="n">IPC_ID_DSP_TO_KR4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span>
<span class="w">   </span><span class="n">IPC_ID_DSP_TO_KM4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span>
<span class="w">   </span><span class="n">IPC_ID_KM4_TO_DSP</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span>
<span class="w">   </span><span class="cm">/*14-19 used for RPC*/</span>
<span class="w">   </span><span class="n">IPC_ID_NUM</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="mi">20</span>
<span class="p">}</span><span class="w"> </span><span class="n">IPC_ID</span><span class="p">;</span>
</pre></div>
</div>
</li>
</ol>
<ol class="arabic" id="how-to-use-ipc-queue-step-2" start="2">
<li><p>When KR4 sends a message to KM4 through <code class="docutils literal notranslate"><span class="pre">IPC_ID_KR4_TO_KM4</span></code>, it should call <code class="xref py py-func docutils literal notranslate"><span class="pre">IPC_Message_Queue_Send()</span></code> and specify the queue ID and message.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int32_t</span><span class="w"> </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="n">IPC_Message_Queue_Send</span><span class="p">(</span><span class="n">IPC_ID_KR4_TO_KM4</span><span class="p">,</span><span class="w"> </span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="n">IMQ_BUF_SIZE</span><span class="p">,</span><span class="w"> </span><span class="n">WAIT_FOREVER</span><span class="p">);</span>
</pre></div>
</div>
</li>
<li><p>When KM4 receives a message from KR4 through IPC_ID_KR4_TO_KM4, it should call <code class="xref py py-func docutils literal notranslate"><span class="pre">IPC_Message_Queue_Recv()</span></code> and the queue ID and a buffer to receive message.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">IMQ_BUF_SIZE</span><span class="p">;</span>
<span class="kt">int32_t</span><span class="w"> </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="n">IPC_Message_Queue_Recv</span><span class="p">(</span><span class="n">IPC_ID_KR4_TO_KM4</span><span class="p">,</span><span class="w"> </span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">size</span><span class="p">);</span>
</pre></div>
</div>
</li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>The memory regions are only defined in AP core, the maximum data region is 40kB.</p></li>
<li><p>Users can use default test demo to verify IPC queue by command <code class="docutils literal notranslate"><span class="pre">test_ipc_message</span></code> in console both in KR4 and KM4.</p></li>
</ul>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="Inter-Processor Communication (IPC)" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../../dmac/src/index.html" class="btn btn-neutral float-right" title="Direct Memory Access Controller (DMAC)" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Realsil.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>