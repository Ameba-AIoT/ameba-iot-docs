<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Introduction &mdash; RTL8720EA Docs  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css?v=13237357" />
      <link rel="stylesheet" type="text/css" href="../../../_static/tabs.css?v=a5c4661c" />

  
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../../../_static/toggleprompt.js?v=d7ede5d2"></script>
        <script>let toggleHintShow = 'Click to show';</script>
        <script>let toggleHintHide = 'Click to hide';</script>
        <script>let toggleOpenOnPrint = 'true';</script>
        <script src="../../../_static/togglebutton.js?v=4a39c7ea"></script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="OTA Firmware Update" href="../../ota/src/index.html" />
    <link rel="prev" title="MP Image" href="index.html" />  
     
  <link href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script type="text/javascript" src="../../../_static/js/selector.js"></script>
<style>
      .wy-nav-content {
      max-width: 1000px; /* 设置最大宽度 */
      }
</style>



</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            RTL8720EA Docs
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../product_overview/src/index.html">Product Overview</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">Application Note</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../gcc_build_environment/src/index.html">Build Environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../sdk_architecture/src/index.html">SDK Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../gcc_makefile/src/index.html">GCC Makefile</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../sdk_example/src/index.html">SDK Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../flash_memory_layout/index.html">Flash and Memory Layout</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../mpu_cache/src/index.html">MPU and Cache</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../file_system/src/index.html">Virtual File System</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">MP Image</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="#how-to-build-mp-image">How to Build MP Image</a></li>
<li class="toctree-l3"><a class="reference internal" href="#how-to-combine-images">How to Combine Images</a></li>
<li class="toctree-l3"><a class="reference internal" href="#boot-flow">Boot Flow</a></li>
<li class="toctree-l3"><a class="reference internal" href="#how-to-switch-image">How to Switch Image</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../ota/src/index.html">OTA Firmware Update</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../chipen/src/index.html">CHIP Enable</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../boot_process/src/index.html">Boot Process</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_config/src/index.html">User Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../hardware_ecdsa/src/index.html">ECDSA Engine</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../hardware_crypto_engine/src/index.html">Hardware Crypto Engine</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../otpc/src/index.html">One-time Programmable Controller (OTPC)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../power_save/src/index.html">Power Saving</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ipc/src/index.html">Inter-Processor Communication (IPC)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../dmac/src/index.html">Direct Memory Access Controller (DMAC)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../psram/src/index.html">Pseudo-Static Random Access Memory (PSRAM)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../pad/src/index.html">Pad Control</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../pinmux/src/index.html">Pin Multiplexing Instructions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../gpio/gpio/src/index.html">General Purpose Input/Output (GPIO)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../gpio/pinctrl/src/pinctrl.html">Pin Controller (Pinctrl)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ledc/src/index.html">Light Emitting Diode Controller (LEDC)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../trng/src/index.html">True Random Number Generator (TRNG)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../adc/src/index.html">Analog-to-Digital Converter (ADC)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../cap_touch/src/index.html">Cap-Touch Controller (CTC)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../thermal/src/index.html">Thermal Senor</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../ameba/en/fullmac/src/index.html">FullMAC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ameba/en/wifi/index.html">Wi-Fi Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ameba/en/wifi_tunnel/src/index.html">Wi-Fi R-Mesh</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ameba/en/wifi_bridge/src/index.html">Wi-Fi Bridge</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ameba/en/wifi_csi/src/index.html">Wi-Fi CSI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ameba/en/dsp/index.html">DSP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ameba/en/usb/usb_otg/src/index.html">USB Host &amp; Device</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ameba/en/audio/src/index.html">Audio</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ameba/en/multimedia/src/index.html">Multimedia</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ameba/en/gui/src/index.html">GUI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ameba/en/ai/index.html">AI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ameba/en/ai_voice/src/index.html">AIVoice</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ameba/en/low_power/src/index.html">Low Power Solution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ameba/en/security_encryption/src/index.html">Security &amp; Encryption</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ameba/en/at_command/src/index.html">AT Command</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ameba/en/software_tools/index.html">Software Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ameba/en/mp_tools/src/index.html">MP Tools</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">RTL8720EA Docs</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Application Note</a></li>
          <li class="breadcrumb-item"><a href="index.html">MP Image</a></li>
      <li class="breadcrumb-item active">Introduction</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="introduction">
<span id="mp-image"></span><h1>Introduction<a class="headerlink" href="#introduction" title="Link to this heading"></a></h1>
<p>The MP image is used for Wi-Fi &amp; BT performance verification and Wi-Fi &amp; BT parameters calibration in massive production. This chapter mainly illustrates how to build and use the MP image.</p>
<p>Refer to <em>WS_RTL8720E_RTL8726E_MP_FLOW.pdf</em> for more details about MP flow.</p>
</section>
<section id="how-to-build-mp-image">
<span id="id1"></span><h1>How to Build MP Image<a class="headerlink" href="#how-to-build-mp-image" title="Link to this heading"></a></h1>
<p>The steps of building MP image are depicted below:</p>
<ol class="arabic">
<li><p>Switch to work directory <code class="docutils literal notranslate"><span class="pre">{SDK}\amebalite_gcc_project</span></code>.</p></li>
<li><p>Use command <code class="docutils literal notranslate"><span class="pre">$make</span> <span class="pre">menuconfig</span></code> to modify the configurations.</p>
<ol class="loweralpha">
<li><p>Enable MP</p>
<figure class="align-center">
<a class="reference internal image-reference" href="../../../_images/enable_mp.svg"><img alt="../../../_images/enable_mp.svg" height="75" src="../../../_images/enable_mp.svg" width="537" /></a>
</figure>
</li>
<li><p>Enable Wi-Fi, and configure KM4 as AP core and KR4 as NP core.</p>
<figure class="align-center">
<a class="reference internal image-reference" href="../../../_images/enable_wifi.svg"><img alt="../../../_images/enable_wifi.svg" height="42" src="../../../_images/enable_wifi.svg" width="580" /></a>
</figure>
</li>
<li><p>Enable BT, and configure KM4 as AP core and KR4 as NP core.</p>
<figure class="align-center">
<a class="reference internal image-reference" href="../../../_images/enable_bt.svg"><img alt="../../../_images/enable_bt.svg" height="67" src="../../../_images/enable_bt.svg" width="624" /></a>
</figure>
</li>
<li><p>Save and exit the menuconfig.</p></li>
</ol>
</li>
<li><p>Use command <code class="docutils literal notranslate"><span class="pre">$make</span> <span class="pre">all</span></code> to rebuild project of KR4 and KM4.</p></li>
</ol>
<p>The MP image <code class="file docutils literal notranslate"><span class="pre">kr4_km4_app_mp.bin</span></code> will be generated in <code class="docutils literal notranslate"><span class="pre">{SDK}\amebalite_gcc_project</span></code> and all the images related to the MP image can be found in the paths below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="n">SDK</span><span class="p">}</span>\<span class="n">amebalite_gcc_project</span>\<span class="n">project_km4</span>\<span class="n">asdk</span>\<span class="n">image_mp</span>
<span class="p">{</span><span class="n">SDK</span><span class="p">}</span>\<span class="n">amebalite_gcc_project</span>\<span class="n">project_kr4</span>\<span class="n">asdk</span>\<span class="n">image_mp</span>
</pre></div>
</div>
</section>
<section id="how-to-combine-images">
<span id="id2"></span><h1>How to Combine Images<a class="headerlink" href="#how-to-combine-images" title="Link to this heading"></a></h1>
<p>Before downloading images into the chip, the MP image needs to be combined with normal image. In massive production, the MP image is used to calibrate the parameters first. After calibration, you can use the command illustrated in <a class="reference internal" href="#how-to-switch-image"><span class="std std-ref">How to Switch Image</span></a> to switch to the normal image and boot from it. Since the chip boots from OTA1 by default when both OTA1 and OTA2 images are valid and with the same version number, the MP image should be located in the OTA1 field.</p>
<p>The steps of combining images are depicted below:</p>
<ol class="arabic simple">
<li><p>Check if both the normal image and MP image are valid.</p></li>
</ol>
<ol class="arabic" start="2">
<li><p>Use ImageTool to combine all the images, including <code class="file docutils literal notranslate"><span class="pre">km4_boot_all.bin</span></code>, <code class="file docutils literal notranslate"><span class="pre">kr4_km4_app_mp.bin</span></code> and <code class="file docutils literal notranslate"><span class="pre">kr4_km4_app.bin</span></code>, which are generated in <code class="docutils literal notranslate"><span class="pre">{SDK}\amebalite_gcc_project</span></code>.</p>
<ol class="loweralpha">
<li><p>Set the image offsets in Image Tool according to the Flash layout, which can be found in <code class="docutils literal notranslate"><span class="pre">{SDK}\component\soc\amebalite\</span> <span class="pre">usrcfg\ameba_flashcfg.c</span></code>.</p>
<ul class="simple">
<li><p>Set kr4_km4_app_mp.bin in <code class="docutils literal notranslate"><span class="pre">IMG_APP_OTA1</span></code> section.</p></li>
<li><p>Set kr4_km4_app.bin in <code class="docutils literal notranslate"><span class="pre">IMG_APP_OTA2</span></code> section.</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">FlashLayoutInfo_TypeDef</span> <span class="n">Flash_Layout</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
   <span class="o">/*</span><span class="n">Region_Type</span><span class="p">,</span>   <span class="p">[</span><span class="n">StartAddr</span><span class="p">,</span>     <span class="n">EndAddr</span><span class="p">]</span> <span class="o">*/</span>
<span class="hll">   <span class="p">{</span><span class="n">IMG_BOOT</span><span class="p">,</span>               <span class="mh">0x08000000</span><span class="p">,</span>     <span class="mh">0x08013FFF</span><span class="p">},</span>    <span class="o">//</span><span class="n">Boot</span> <span class="n">Manifest</span><span class="p">(</span><span class="mi">4</span><span class="n">K</span><span class="p">)</span> <span class="o">+</span> <span class="n">KM4</span> <span class="n">Bootloader</span><span class="p">(</span><span class="mi">76</span><span class="n">K</span><span class="p">)</span>
</span>   <span class="o">//</span><span class="n">Users</span> <span class="n">should</span> <span class="n">modify</span> <span class="n">below</span> <span class="n">according</span> <span class="n">to</span> <span class="n">their</span> <span class="n">own</span> <span class="n">memory</span>
<span class="hll">   <span class="p">{</span><span class="n">IMG_APP_OTA1</span><span class="p">,</span>   <span class="mh">0x08014000</span><span class="p">,</span>     <span class="mh">0x08093FFF</span><span class="p">},</span>    <span class="o">//</span><span class="n">Certificate</span><span class="p">(</span><span class="mi">4</span><span class="n">K</span><span class="p">)</span> <span class="o">+</span> <span class="n">Manifest</span><span class="p">(</span><span class="mi">4</span><span class="n">K</span><span class="p">)</span> <span class="o">+</span> <span class="n">KM4</span> <span class="n">Application</span> <span class="n">OTA1</span>
</span>   <span class="p">{</span><span class="n">IMG_KR4_OTA1</span><span class="p">,</span>   <span class="mh">0x8094000</span><span class="p">,</span>      <span class="mh">0x081F3FFF</span><span class="p">},</span>    <span class="o">//</span><span class="n">Manifest</span><span class="p">(</span><span class="mi">4</span><span class="n">K</span><span class="p">)</span> <span class="o">+</span> <span class="n">KR4</span> <span class="n">Application</span> <span class="n">OTA1</span>

   <span class="o">//</span><span class="p">{</span><span class="n">IMG_BOOT_OTA2</span><span class="p">,</span>        <span class="mh">0x08200000</span><span class="p">,</span>     <span class="mh">0x08213FFF</span><span class="p">},</span>    <span class="o">//</span><span class="n">Boot</span> <span class="n">Manifest</span><span class="p">(</span><span class="mi">4</span><span class="n">K</span><span class="p">)</span> <span class="o">+</span> <span class="n">KM4</span> <span class="n">Bootloader</span><span class="p">(</span><span class="mi">76</span><span class="n">K</span><span class="p">)</span> <span class="n">OTA2</span>
<span class="hll">   <span class="p">{</span><span class="n">IMG_APP_OTA2</span><span class="p">,</span>   <span class="mh">0x08214000</span><span class="p">,</span>     <span class="mh">0x08293FFF</span><span class="p">},</span>    <span class="o">//</span><span class="n">Certificate</span><span class="p">(</span><span class="mi">4</span><span class="n">K</span><span class="p">)</span> <span class="o">+</span> <span class="n">Manifest</span><span class="p">(</span><span class="mi">4</span><span class="n">K</span><span class="p">)</span> <span class="o">+</span> <span class="n">KM4</span> <span class="n">Application</span> <span class="n">OTA2</span>
</span>   <span class="p">{</span><span class="n">IMG_KR4_OTA2</span><span class="p">,</span>   <span class="mh">0x08294000</span><span class="p">,</span>     <span class="mh">0x083F3FFF</span><span class="p">},</span>    <span class="o">//</span><span class="n">Manifest</span><span class="p">(</span><span class="mi">4</span><span class="n">K</span><span class="p">)</span> <span class="o">+</span> <span class="n">KR4</span> <span class="n">Application</span> <span class="n">OTA1</span>

   <span class="p">{</span><span class="n">FTL</span><span class="p">,</span>                    <span class="mh">0x08700000</span><span class="p">,</span> <span class="mh">0x08702FFF</span><span class="p">},</span> <span class="o">//</span><span class="n">FTL</span> <span class="k">for</span> <span class="n">BT</span><span class="p">(</span><span class="o">&gt;=</span><span class="mi">12</span><span class="n">K</span><span class="p">),</span> <span class="n">The</span> <span class="n">start</span> <span class="n">offset</span> <span class="n">of</span> <span class="n">flash</span> <span class="n">pages</span> <span class="n">which</span> <span class="ow">is</span> <span class="n">allocated</span> <span class="n">to</span> <span class="n">FTL</span> <span class="n">physical</span> <span class="nb">map</span><span class="o">.</span>
   <span class="p">{</span><span class="n">VFS1</span><span class="p">,</span>                   <span class="mh">0x08703000</span><span class="p">,</span> <span class="mh">0x08722FFF</span><span class="p">},</span> <span class="o">//</span><span class="n">VFS</span> <span class="n">region</span> <span class="mi">1</span> <span class="p">(</span><span class="mi">128</span><span class="n">K</span><span class="p">)</span>
   <span class="p">{</span><span class="n">VFS2</span><span class="p">,</span>                   <span class="mh">0xFFFFFFFF</span><span class="p">,</span> <span class="mh">0xFFFFFFFF</span><span class="p">},</span> <span class="o">//</span><span class="n">VFS</span> <span class="n">region</span> <span class="mi">2</span>
   <span class="p">{</span><span class="n">USER</span><span class="p">,</span>                   <span class="mh">0xFFFFFFFF</span><span class="p">,</span> <span class="mh">0xFFFFFFFF</span><span class="p">},</span> <span class="o">//</span><span class="n">reserve</span> <span class="k">for</span> <span class="n">user</span>

   <span class="o">/*</span> <span class="n">End</span> <span class="o">*/</span>
   <span class="p">{</span><span class="mh">0xFF</span><span class="p">,</span>                   <span class="mh">0xFFFFFFFF</span><span class="p">,</span> <span class="mh">0xFFFFFFFF</span><span class="p">},</span>
<span class="p">};</span>
</pre></div>
</div>
</li>
<li><p>Click <span class="guilabel">Generate</span> button in Image Tool, and save the combined image named <code class="file docutils literal notranslate"><span class="pre">Image_All.bin</span></code>.</p>
<figure class="align-center">
<a class="reference internal image-reference" href="../../../_images/mp_generate_image_8720EA.svg"><img alt="../../../_images/mp_generate_image_8720EA.svg" height="517" src="../../../_images/mp_generate_image_8720EA.svg" width="893" /></a>
</figure>
</li>
</ol>
</li>
</ol>
<ol class="arabic simple" start="3">
<li><p>Download the <code class="file docutils literal notranslate"><span class="pre">Image_All.bin</span></code> into the device after the combination is finished.</p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The normal image <code class="file docutils literal notranslate"><span class="pre">kr4_km4_app.bin</span></code> is built with MP disabled. Check the normal image in <code class="docutils literal notranslate"><span class="pre">{SDK}\amebalite_gcc_project</span></code>. All the images related to normal image can be found in paths below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="n">SDK</span><span class="p">}</span>\<span class="n">amebalite_gcc_project</span>\<span class="n">project_km4</span>\<span class="n">asdk</span>\<span class="n">image</span><span class="o">.</span>
<span class="p">{</span><span class="n">SDK</span><span class="p">}</span>\<span class="n">amebalite_gcc_project</span>\<span class="n">project_kr4</span>\<span class="n">asdk</span>\<span class="n">image</span><span class="o">.</span>
</pre></div>
</div>
</div>
</section>
<section id="boot-flow">
<h1>Boot Flow<a class="headerlink" href="#boot-flow" title="Link to this heading"></a></h1>
<ol class="arabic">
<li><p>Reset the device after downloading image is finished.</p></li>
<li><p>Check if the device boots from MP image successfully.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">MODULE_BOOT</span><span class="o">-</span><span class="n">LEVEL_INFO</span><span class="p">]:</span> <span class="n">KR4</span> <span class="n">XIP</span> <span class="n">IMG</span><span class="p">[</span><span class="mi">0</span><span class="n">c000000</span><span class="p">:</span><span class="mi">120000</span><span class="p">]</span>
<span class="p">[</span><span class="n">MODULE_BOOT</span><span class="o">-</span><span class="n">LEVEL_INFO</span><span class="p">]:</span> <span class="n">KR4</span> <span class="n">PSRAM</span><span class="p">[</span><span class="mi">60060000</span><span class="p">:</span><span class="mf">2e74</span><span class="p">]</span>
<span class="p">[</span><span class="n">MODULE_BOOT</span><span class="o">-</span><span class="n">LEVEL_INFO</span><span class="p">]:</span> <span class="n">KR4</span> <span class="n">SRAM</span><span class="p">[</span><span class="mi">0</span><span class="n">c122e74</span><span class="p">:</span><span class="mi">20</span><span class="p">]</span>
<span class="p">[</span><span class="n">MODULE_BOOT</span><span class="o">-</span><span class="n">LEVEL_INFO</span><span class="p">]:</span> <span class="n">KR4</span> <span class="n">B00T</span><span class="p">[</span><span class="mi">20040000</span><span class="p">:</span><span class="mi">40</span><span class="p">]</span>
<span class="p">[</span><span class="n">MODULE_BOOT</span><span class="o">-</span><span class="n">LEVEL_INFO</span><span class="p">]:</span> <span class="n">KR4</span> <span class="n">PMC</span><span class="p">[</span><span class="mi">20004</span><span class="n">c20</span><span class="p">:</span><span class="mi">160</span><span class="p">]</span>
<span class="p">[</span><span class="n">MODULE_BOOT</span><span class="o">-</span><span class="n">LEVEL_INFO</span><span class="p">]:</span> <span class="n">KM4</span> <span class="n">XIP</span> <span class="n">IMG</span><span class="p">[</span><span class="mf">0e000000</span><span class="p">:</span><span class="mi">5</span><span class="n">d080</span><span class="p">]</span>
<span class="p">[</span><span class="n">MODULE_BOOT</span><span class="o">-</span><span class="n">LEVEL_INFO</span><span class="p">]:</span> <span class="n">KM4</span> <span class="n">PSRAM</span><span class="p">[</span><span class="mi">60060000</span><span class="p">:</span><span class="mi">27</span><span class="n">a0</span><span class="p">]</span>
<span class="p">[</span><span class="n">MODULE_BOOT</span><span class="o">-</span><span class="n">LEVEL_INFO</span><span class="p">]:</span> <span class="n">KM4</span> <span class="n">SRAM</span><span class="p">[</span><span class="mf">0e05</span><span class="n">f820</span><span class="p">:</span><span class="mi">20</span><span class="p">]</span>
<span class="p">[</span><span class="n">MODULE_BOOT</span><span class="o">-</span><span class="n">LEVEL_INFO</span><span class="p">]:</span> <span class="n">KM4</span> <span class="n">PMC</span><span class="p">[</span><span class="mf">20004e00</span><span class="p">:</span><span class="mi">1</span><span class="n">f0</span><span class="p">]</span>
<span class="p">[</span><span class="n">MODULE_BOOT</span><span class="o">-</span><span class="n">LEVEL_INFO</span><span class="p">]:</span> <span class="n">DSP</span> <span class="n">PhyAddr</span> <span class="mi">8199</span><span class="n">a30</span> <span class="n">ImgAddr</span> <span class="n">d000000</span>
<span class="p">[</span><span class="n">MODULE_BOOT</span><span class="o">-</span><span class="n">LEVEL_INFO</span><span class="p">]:</span> <span class="n">DSP</span> <span class="n">XIP</span> <span class="n">IMG</span> <span class="n">Invalid</span> <span class="n">ffffffff</span> <span class="n">ffffffff</span>
<span class="hll"><span class="p">[</span><span class="n">MODULE_BOOT</span><span class="o">-</span><span class="n">LEVEL_INFO</span><span class="p">]:</span> <span class="n">IMG2</span> <span class="n">BOOT</span> <span class="kn">from</span> <span class="nn">OTA1</span>
</span><span class="p">[</span><span class="n">MODULE_BOOT</span><span class="o">-</span><span class="n">LEVEL_INFO</span><span class="p">]:</span> <span class="n">PMC_CORE_ROLE</span><span class="p">:</span> <span class="mi">0</span> <span class="p">(</span><span class="mi">0</span> <span class="n">represents</span> <span class="n">AP2NP</span><span class="p">),</span> <span class="n">NP</span><span class="p">:</span> <span class="mi">0</span> <span class="p">(</span><span class="mi">1</span> <span class="n">represents</span> <span class="n">KR4</span> <span class="ow">is</span> <span class="n">NP</span><span class="p">)</span>
<span class="p">[</span><span class="n">MODULE_BOOT</span><span class="o">-</span><span class="n">LEVEL_INFO</span><span class="p">]:</span> <span class="n">KM4</span> <span class="n">APP</span> <span class="n">START</span>
<span class="p">[</span><span class="n">MODULE_BOOT</span><span class="o">-</span><span class="n">LEVEL_INFO</span><span class="p">]:</span> <span class="n">IMG2</span> <span class="n">SECURE</span> <span class="n">STATE</span><span class="p">:</span> <span class="n">O</span>
<span class="p">[</span><span class="n">MODULE_BOOT</span><span class="o">-</span><span class="n">LEVEL_INFO</span><span class="p">]:</span> <span class="n">KM4</span> <span class="n">BOOT</span> <span class="n">REASON</span><span class="p">:</span> <span class="n">O</span>
<span class="p">[</span><span class="n">MODULE_BOOT</span><span class="o">-</span><span class="n">LEVEL_INFO</span><span class="p">]:</span> <span class="n">KM4</span> <span class="n">CPU</span> <span class="n">CLK</span><span class="p">:</span> <span class="mi">240000000</span><span class="n">Hz</span>
<span class="p">[</span><span class="n">MODULE_BOOT</span><span class="o">-</span><span class="n">LEVEL_INFO</span><span class="p">]:</span> <span class="n">KR4</span> <span class="n">OS</span> <span class="n">START</span>
<span class="p">[</span><span class="n">CAL131K</span><span class="p">]:</span> <span class="n">delta</span><span class="p">:</span><span class="mi">26</span> <span class="n">target</span><span class="p">:</span><span class="mi">2441</span> <span class="n">PpM</span><span class="p">:</span> <span class="mi">10651</span> <span class="n">PPM_Limit</span><span class="p">:</span><span class="mi">30000</span>
<span class="p">[</span><span class="n">CAL4M</span><span class="p">]:</span> <span class="n">delta</span><span class="p">:</span><span class="mi">1</span> <span class="n">target</span><span class="p">:</span><span class="mi">320</span> <span class="n">PPM</span><span class="p">:</span> <span class="mi">3125</span> <span class="n">PPM_Limit</span><span class="p">:</span><span class="mi">30000</span>
<span class="p">[</span><span class="n">MODULE_BOOT</span><span class="o">-</span><span class="n">LEVEL_INFO</span><span class="p">]:</span> <span class="n">KM4</span> <span class="n">MAIN</span>
<span class="p">[</span><span class="n">MODULE_PMC</span><span class="o">-</span><span class="n">LEVEL_INFO</span><span class="p">]:</span> <span class="n">SYSPMC_OPT</span> <span class="mi">200000</span>
<span class="p">[</span><span class="n">MODULE_PMC</span><span class="o">-</span><span class="n">LEVEL_INFO</span><span class="p">]:</span> <span class="n">AP</span> <span class="n">wake</span> <span class="n">event</span> <span class="mi">200020</span> <span class="mi">0</span>
<span class="p">[</span><span class="n">MODULE_PMC</span><span class="o">-</span><span class="n">LEVEL_INFO</span><span class="p">]:</span> <span class="n">DSP</span> <span class="n">wake</span> <span class="n">event</span> <span class="mi">80</span> <span class="mi">0</span>
<span class="p">[</span><span class="n">MODULE_PMC</span><span class="o">-</span><span class="n">LEVEL_INFO</span><span class="p">]:</span> <span class="n">NP</span> <span class="n">wake</span> <span class="n">event</span> <span class="mi">4</span><span class="n">f</span> <span class="mi">0</span>
<span class="p">[</span><span class="n">MoDULE_PMC</span><span class="o">-</span><span class="n">LEVEL_TNFO</span><span class="p">]:</span> <span class="n">REG_AON_PMC_OPT</span> <span class="mh">0x32</span>
<span class="p">[</span><span class="n">MODULE_BOOT</span><span class="o">-</span><span class="n">LEVEL_INFO</span><span class="p">]:</span> <span class="n">KM4</span> <span class="n">START</span> <span class="n">SCHEDULER</span>
<span class="n">interface</span> <span class="mi">0</span> <span class="ow">is</span> <span class="n">initialized</span>
<span class="n">interface</span> <span class="mi">1</span> <span class="ow">is</span> <span class="n">initialized</span>
<span class="n">interface</span> <span class="mi">2</span> <span class="ow">is</span> <span class="n">initialized</span>

<span class="n">Initializing</span> <span class="n">WIFI</span> <span class="o">...</span>
<span class="hll"><span class="n">RTL8720E</span><span class="p">[</span><span class="n">Driver</span><span class="p">]:</span> <span class="n">The</span> <span class="n">driver</span> <span class="ow">is</span> <span class="k">for</span> <span class="n">MP</span> <span class="n">Firmware</span> <span class="n">Enable</span>
</span>
<span class="n">_init_thread</span><span class="p">(</span><span class="mi">39</span><span class="p">),</span> <span class="n">Available</span> <span class="n">heap</span> <span class="n">Ox2db60</span>
</pre></div>
</div>
</li>
<li><p>Start the massive production flow if the device boots from MP image successfully.</p></li>
</ol>
</section>
<section id="how-to-switch-image">
<span id="id3"></span><h1>How to Switch Image<a class="headerlink" href="#how-to-switch-image" title="Link to this heading"></a></h1>
<p>When MP finished, you need to switch the image from MP image to the normal image to verify the application.</p>
<ol class="arabic">
<li><p>Use command <code class="docutils literal notranslate"><span class="pre">AT+OTACLEAR</span></code> from serial terminal to clear the signature of MP image in order to assign the MP image invalid.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="mi">16</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">35</span><span class="p">:</span><span class="mi">731</span><span class="p">]</span><span class="n">AT</span><span class="o">+</span><span class="n">OTACLEAR</span>
<span class="p">[</span><span class="mi">16</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">35</span><span class="p">:</span><span class="mi">731</span><span class="p">][</span><span class="n">SYS</span><span class="o">-</span><span class="n">A</span><span class="p">][</span><span class="n">sys_clear_ota_signature</span><span class="p">]</span> <span class="n">IMGID</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="n">current</span> <span class="n">OTA1</span> <span class="n">Address</span><span class="p">:</span> <span class="mh">0x00014000</span><span class="p">,</span> <span class="n">target</span> <span class="n">OTA2</span> <span class="n">Address</span><span class="p">:</span> <span class="mh">0x00214000</span>
<span class="p">[</span><span class="mi">16</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">35</span><span class="p">:</span><span class="mi">731</span><span class="p">]</span>
<span class="p">[</span><span class="mi">16</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">35</span><span class="p">:</span><span class="mi">731</span><span class="p">]</span><span class="o">+</span><span class="n">OTACLEAR</span><span class="p">:</span><span class="n">OK</span>
<span class="p">[</span><span class="mi">16</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">35</span><span class="p">:</span><span class="mi">731</span><span class="p">]</span>
<span class="p">[</span><span class="mi">16</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">35</span><span class="p">:</span><span class="mi">732</span><span class="p">][</span><span class="n">MEM</span><span class="p">]</span> <span class="n">After</span> <span class="n">do</span> <span class="n">cmd</span><span class="p">,</span> <span class="n">available</span> <span class="n">heap</span> <span class="mi">318976</span>
</pre></div>
</div>
</li>
<li><p>Reset the device, the device will boot from the normal image located in OTA2 field.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">BOOT</span><span class="o">-</span><span class="n">I</span><span class="p">]</span> <span class="n">KM4</span> <span class="n">XIP</span> <span class="n">IMG</span><span class="p">[</span><span class="mf">0e000000</span><span class="p">:</span><span class="mf">725e0</span><span class="p">]</span>
<span class="p">[</span><span class="n">BOOT</span><span class="o">-</span><span class="n">I</span><span class="p">]</span> <span class="n">KM4</span> <span class="n">PSRAM</span><span class="p">[</span><span class="mf">0e000000</span><span class="p">:</span><span class="mf">725e0</span><span class="p">]</span>
<span class="p">[</span><span class="n">BOOT</span><span class="o">-</span><span class="n">I</span><span class="p">]</span> <span class="n">KM4</span> <span class="n">SRAM</span><span class="p">[</span><span class="mi">2000</span><span class="n">b000</span><span class="p">:</span><span class="mi">11</span><span class="n">c0</span><span class="p">]</span>
<span class="p">[</span><span class="n">BOOT</span><span class="o">-</span><span class="n">I</span><span class="p">]</span> <span class="n">KM4</span> <span class="n">BOOT</span><span class="p">[</span><span class="mi">20005</span><span class="n">fc0</span><span class="p">:</span><span class="mi">40</span><span class="p">]</span>
<span class="p">[</span><span class="n">BOOT</span><span class="o">-</span><span class="n">I</span><span class="p">]</span> <span class="n">KM4</span> <span class="n">PMC</span><span class="p">[</span><span class="mi">20005900</span><span class="p">:</span><span class="mf">3e0</span><span class="p">]</span>
<span class="hll"><span class="p">[</span><span class="n">BOOT</span><span class="o">-</span><span class="n">I</span><span class="p">]</span> <span class="n">IMG2</span> <span class="n">BOOT</span> <span class="kn">from</span> <span class="nn">OTA</span> <span class="mi">2</span><span class="p">,</span> <span class="n">Version</span><span class="p">:</span> <span class="mf">1.1</span>
</span><span class="p">[</span><span class="n">BOOT</span><span class="o">-</span><span class="n">I</span><span class="p">]</span> <span class="n">Start</span> <span class="n">IMG2</span> <span class="o">@</span> <span class="mh">0xe00277d</span> <span class="o">...</span>
<span class="p">[</span><span class="n">APP</span><span class="o">-</span><span class="n">I</span><span class="p">]</span> <span class="n">kM4</span> <span class="n">APP</span> <span class="n">START</span>
<span class="p">[</span><span class="n">APP</span><span class="o">-</span><span class="n">I</span><span class="p">]</span> <span class="n">VTOR</span><span class="p">:</span> <span class="mi">30007000</span><span class="p">,</span> <span class="n">VTOR_NS</span><span class="p">:</span><span class="mi">30007000</span>
<span class="p">[</span><span class="n">APP</span><span class="o">-</span><span class="n">I</span><span class="p">]</span> <span class="n">IMG2</span> <span class="n">SECURE</span> <span class="n">STATE</span><span class="p">:</span> <span class="mi">1</span>
<span class="p">[</span><span class="n">MAIN</span><span class="o">-</span><span class="n">I</span><span class="p">]</span> <span class="n">KR4</span> <span class="n">OS</span> <span class="n">START</span>
<span class="p">[</span><span class="n">CLK</span><span class="o">-</span><span class="n">I</span><span class="p">]</span> <span class="p">[</span><span class="n">CAL131K</span><span class="p">]:</span> <span class="n">delta</span><span class="p">:</span><span class="mi">8</span> <span class="n">target</span><span class="p">:</span><span class="mi">2441</span> <span class="n">PPM</span><span class="p">:</span> <span class="mi">3277</span> <span class="n">PPM_Limit</span><span class="p">:</span><span class="mi">30000</span>
</pre></div>
</div>
</li>
</ol>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="MP Image" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../../ota/src/index.html" class="btn btn-neutral float-right" title="OTA Firmware Update" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Realsil.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>