

<!DOCTYPE html>
<html class="writer-html5" lang="zh-CN" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Architecture &mdash; Ameba IoT Docs  文档</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
      <link rel="stylesheet" type="text/css" href="../../_static/custom_cn.css?v=0d22fac7" />
      <link rel="stylesheet" type="text/css" href="../../_static/tabs.css?v=a5c4661c" />
      <link rel="stylesheet" type="text/css" href="../../_static/_static/custom_cn.css" />

  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=7d86a446"></script>
        <script src="../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../../_static/toggleprompt.js?v=d7ede5d2"></script>
        <script>let toggleHintShow = 'Click to show';</script>
        <script>let toggleHintHide = 'Click to hide';</script>
        <script>let toggleOpenOnPrint = 'true';</script>
        <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
        <script src="../../_static/translations.js?v=beaddf03"></script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="索引" href="../../genindex.html" />
    <link rel="search" title="搜索" href="../../search.html" />
    <link rel="next" title="温度测量" href="../8_thermal/0_thermal_index_cn.html" />
    <link rel="prev" title="Real Time Clock (RTC)" href="0_rtc_index_cn.html" />
   
  
  <script type="text/javascript" src="../../_static/js/selector.js"></script>

  <style>
    .wy-nav-content {max-width: 1000px;} /* 设置最大宽度 */
  </style>

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            Ameba IoT Docs
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="搜索文档" aria-label="搜索文档" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="导航菜单">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../rst_rtos/0_ameba_product/0_ameba_product_center_index_cn.html">产品中心</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rst_rtos/0_ameba_sdk/0_ameba_sdks_index_cn.html">Ameba SDK</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_release_packages/0_release_packages_index_cn.html">0.0 释放包</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_gcc_build_environment/0_gcc_build_index_cn.html">0.1 GCC 编译环境</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_sdk_architecture/0_sdk_architecture_index_cn.html">0.2 SDK 架构</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rst_rtos/0_tools/0_tools_index_cn.html">0.7 工具</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_question_help/0_question_help_index_cn.html">0.A 问题与帮助</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_debugging/0_debugging_index_cn.html">0.B 系统调试</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1_boot_process/0_boot_index_cn.html">1.1 启动流程</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1_ota/0_ota_index_cn.html">1.2 固件在线升级（OTA）</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1_otpc/0_otpc_index_cn.html">1.3 OTP 存储器</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1_flash/0_flash_index_cn.html">1.4 闪存</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1_gpio/0_gpio_index_cn.html">1.7 通用输入输出端口</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1_power_save/0_ps_index_cn.html">1.8 电源管理</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_nda_secure_boot/0_secure_boot_index_nda_cn.html">3.6 安全启动</a></li>
<li class="toctree-l1"><a class="reference internal" href="../7_usb_boot/0_usb_boot_index_cn.html">3.7 USB 启动</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_crypto_engine/0_crypto_engine_index_cn.html">3.8 加密引擎</a></li>
<li class="toctree-l1"><a class="reference internal" href="../4_multimedia/0_multimedia_index_cn.html">4.3 多媒体</a></li>
<li class="toctree-l1"><a class="reference internal" href="../7_usb/0_usb_index_cn.html">7.1 USB 主机与设备</a></li>
<li class="toctree-l1"><a class="reference internal" href="../7_sdio/0_sdioh_index_cn.html">7.2 SDIO 主机</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_dmac/0_dmac_index_cn.html">8.1 DMA 控制器</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="0_rtc_index_cn.html">8.2 实时时钟（RTC）</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="#implementation">Implementation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#configuration">Configuration</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#dts-configuration">DTS Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="#build-configuration">Build Configuration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#apis">APIs</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#apis-for-user-space">APIs for User Space</a></li>
<li class="toctree-l2"><a class="reference internal" href="#apis-for-kernel-space">APIs for Kernel Space</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../8_thermal/0_thermal_index_cn.html">8.3 热计量器（Thermel）</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_adc/0_adc_index_cn.html">8.4 模数转换器（ADC）</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_cap_touch/0_cap_touch_index_cn.html">8.5 电容触摸（Cap-touch）</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_ir/0_ir_index_cn.html">8.6 红外收发器（IR）</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_ledc/0_ledc_index_cn.html">8.7 LED 灯控制器</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_i2c/0_i2c_index_cn.html">8.8 集成电路间通信（I2C）</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_uart/0_uart_index_cn.html">8.9 通用异步收发传输器（UART）</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_lcdc/0_lcdc_index_cn.html">8.A 液晶显示控制器（LCDC）</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_spi/0_spi_index_cn.html">8.B 串行外设接口（SPI）</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_spic/0_spic_index_cn.html">8.C SPI 闪存控制器</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_timer/0_timer_index_cn.html">8.D 计时器</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_wdg/0_wdg_index_cn.html">8.E 看门狗</a></li>
<li class="toctree-l1"><a class="reference internal" href="../9_bluetooth/0_bluetooth_index_cn.html">9.1 蓝牙</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="移动版导航菜单" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Ameba IoT Docs</a>
      </nav>

      <div class="wy-nav-content">

        <div class="rst-content">
          <div role="navigation" aria-label="页面导航">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="0_rtc_index_cn.html">Real Time Clock (RTC)</a></li>
      <li class="breadcrumb-item active">Architecture</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="architecture">
<span id="rtc"></span><h1>Architecture<a class="headerlink" href="#architecture" title="Link to this heading"></a></h1>
<p>The RTC driver follows Linux RTC subsystem. The RTC subsystem architecture is illustrated in figure below.</p>
<figure class="align-center" id="id1">
<a class="reference internal image-reference" href="../../_images/rtc_subsystem_arch.svg"><img alt="../../_images/rtc_subsystem_arch.svg" height="412" src="../../_images/rtc_subsystem_arch.svg" width="456" /></a>
<figcaption>
<p><span class="caption-text">RTC subsystem architecture</span><a class="headerlink" href="#id1" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>The RTC is used to track wall time. It still works when system is in low power mode.</p>
<p>The RTC device is a standard character device. User space application can access RTC device through functions such as open, release, read, write and IOCTL. Also, RTC core provide APIs so kernel program can access it.</p>
<p>The RTC core provides 3 user space interfaces: <code class="docutils literal notranslate"><span class="pre">/dev/rtc0</span></code>, <code class="docutils literal notranslate"><span class="pre">/proc/rtc</span></code>, <code class="docutils literal notranslate"><span class="pre">/sys/class/rtc/rtc0</span></code>.</p>
</section>
<section id="implementation">
<h1>Implementation<a class="headerlink" href="#implementation" title="Link to this heading"></a></h1>
<p>The RTC driver is implemented as following files:</p>
<table class="docutils align-default" style="width: 100%">
<thead>
<tr class="row-odd"><th class="head"><p>Driver location</p></th>
<th class="head"><p>Introduction</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="file docutils literal notranslate"><span class="pre">&lt;linux&gt;/drivers/rtkdrivers/rtc/Kconfig</span></code></p></td>
<td><p>RTC driver Kconfig</p></td>
</tr>
<tr class="row-odd"><td><p><code class="file docutils literal notranslate"><span class="pre">&lt;linux&gt;/drivers/rtkdrivers/rtc/Makefile</span></code></p></td>
<td><p>RTC driver Makefile</p></td>
</tr>
<tr class="row-even"><td><p><code class="file docutils literal notranslate"><span class="pre">&lt;linux&gt;/drivers/rtkdrivers/rtc/rtk-rtc.c</span></code></p></td>
<td><p>RTC driver code</p></td>
</tr>
</tbody>
</table>
<section id="configuration">
<h2>Configuration<a class="headerlink" href="#configuration" title="Link to this heading"></a></h2>
</section>
</section>
<section id="dts-configuration">
<h1>DTS Configuration<a class="headerlink" href="#dts-configuration" title="Link to this heading"></a></h1>
<p>The DTS node is defined in <code class="file docutils literal notranslate"><span class="pre">&lt;dts&gt;/rtl8730e-ocp.dtsi</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rtc</span><span class="p">:</span> <span class="n">rtc</span><span class="o">@</span><span class="mf">4200E000</span> <span class="p">{</span>
   <span class="n">compatible</span> <span class="o">=</span> <span class="s2">&quot;realtek,ameba-rtc&quot;</span><span class="p">;</span>
   <span class="n">reg</span> <span class="o">=</span> <span class="o">&lt;</span><span class="mh">0x4200E000</span> <span class="mh">0x1000</span><span class="o">&gt;</span><span class="p">;</span>
   <span class="n">interrupts</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">GIC_SPI</span> <span class="mi">12</span> <span class="n">IRQ_TYPE_LEVEL_HIGH</span><span class="o">&gt;</span><span class="p">;</span>
   <span class="n">clocks</span> <span class="o">=</span> <span class="o">&lt;&amp;</span><span class="n">rcc</span> <span class="n">RTK_CKE_RTC</span><span class="o">&gt;</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
<p>The following table is property description.</p>
<table class="docutils align-default" style="width: 100%">
<thead>
<tr class="row-odd"><th class="head"><p>Property</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Configurable?</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>compatible</p></td>
<td><p>ID to match the driver and device</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-odd"><td><p>reg</p></td>
<td><p>Register resource.</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-even"><td><p>interrupts</p></td>
<td><p>SPI interrupt</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-odd"><td><p>clocks</p></td>
<td><p>RTC clock node</p></td>
<td><p>No</p></td>
</tr>
</tbody>
</table>
</section>
<section id="build-configuration">
<h1>Build Configuration<a class="headerlink" href="#build-configuration" title="Link to this heading"></a></h1>
<p>Select Device Drivers &gt; Drivers for Realtek &gt; RTC driver:</p>
<figure class="align-center">
<a class="reference internal image-reference" href="../../_images/rtc_build_configuration.png"><img alt="../../_images/rtc_build_configuration.png" src="../../_images/rtc_build_configuration.png" style="width: 857.7px; height: 646.2px;" /></a>
</figure>
<section id="apis">
<h2>APIs<a class="headerlink" href="#apis" title="Link to this heading"></a></h2>
</section>
</section>
<section id="apis-for-user-space">
<h1>APIs for User Space<a class="headerlink" href="#apis-for-user-space" title="Link to this heading"></a></h1>
<p>The RTC subsystem provides 3 userspace interfaces:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">/dev/rtc0</span></code>: RTC device.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/sys/class/rtc/rtc0</span></code>: Sysfs attributes support readonly access to some RTC attributes.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/proc/driver/rtc</span></code>: Procfs interface using for system clock RTC to expose itself.</p></li>
</ul>
<p>User can access attributes to control RTC device via sysfs node. Below are some examples.</p>
<ul>
<li><p>Command to get RTC date (year, month, day):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cat</span> <span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">class</span><span class="o">/</span><span class="n">rtc</span><span class="o">/</span><span class="n">rtc0</span><span class="o">/</span><span class="n">date</span>
</pre></div>
</div>
</li>
<li><p>Command to get RTC time (hour, minute, second):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cat</span> <span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">class</span><span class="o">/</span><span class="n">rtc</span><span class="o">/</span><span class="n">rtc0</span><span class="o">/</span><span class="n">time</span>
</pre></div>
</div>
</li>
</ul>
<p>Refer to <code class="file docutils literal notranslate"><span class="pre">&lt;sdk&gt;/sources/kernel/&lt;linux&gt;/drivers/rtc/sysfs.c</span></code> to get more information about sysfs interface.</p>
<p>Refer to <a class="reference external" href="https://www.kernel.org/doc/html/latest/admin-guide/rtc.html">RTC Drivers for Linux</a> to get more information.</p>
<p>The RTC device acts as a character device. User can use open, read, ioctl, etc. to access RTC device. Refer to <code class="docutils literal notranslate"><span class="pre">&lt;test&gt;/rtc</span></code> for test demo.</p>
</section>
<section id="apis-for-kernel-space">
<h1>APIs for Kernel Space<a class="headerlink" href="#apis-for-kernel-space" title="Link to this heading"></a></h1>
<table class="docutils align-default" style="width: 100%">
<thead>
<tr class="row-odd"><th class="head"><p>Interfaces</p></th>
<th class="head"><p>Introduction</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>rtc_class_open</p></td>
<td><p>Open RTC device</p></td>
</tr>
<tr class="row-odd"><td><p>rtc_class_close</p></td>
<td><p>Close RTC class</p></td>
</tr>
<tr class="row-even"><td><p>rtc_read_time</p></td>
<td><p>Get RTC time</p></td>
</tr>
<tr class="row-odd"><td><p>rtc_set_time</p></td>
<td><p>Set RTC time</p></td>
</tr>
<tr class="row-even"><td><p>rtc_set_ntp_time</p></td>
<td><p>Save NTP synchronized time to the RTC</p></td>
</tr>
<tr class="row-odd"><td><p>rtc_read_alarm</p></td>
<td><p>Get RTC alarm time</p></td>
</tr>
<tr class="row-even"><td><p>rtc_set_alarm</p></td>
<td><p>Set RTC alarm time</p></td>
</tr>
<tr class="row-odd"><td><p>rtc_irq_set_state</p></td>
<td><p>enable/disable 2^N Hz periodic IRQs</p></td>
</tr>
<tr class="row-even"><td><p>rtc_irq_set_freq</p></td>
<td><p>set 2^N Hz periodic IRQ frequency for IRQ</p></td>
</tr>
<tr class="row-odd"><td><p>rtc_update_irq_enable</p></td>
<td><p>enable/disable update IRQ</p></td>
</tr>
<tr class="row-even"><td><p>rtc_alarm_irq_enable</p></td>
<td><p>enable/disable alarm IRQ</p></td>
</tr>
</tbody>
</table>
<p>Examples:</p>
<ul>
<li><p>Read wall time:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rtc_read_time</span><span class="p">(</span><span class="n">rtc</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">tm</span><span class="p">);</span>
</pre></div>
</div>
</li>
<li><p>Set wall time:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rtc_set_time</span><span class="p">(</span><span class="n">rtc</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">tm</span><span class="p">);</span>
</pre></div>
</div>
</li>
<li><p>Set alarm time:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rtc_set_alarm</span><span class="p">(</span><span class="n">rtc</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">alrm</span><span class="p">);</span>
</pre></div>
</div>
</li>
</ul>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="页脚">
        <a href="0_rtc_index_cn.html" class="btn btn-neutral float-left" title="Real Time Clock (RTC)" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> 上一页</a>
        <a href="../8_thermal/0_thermal_index_cn.html" class="btn btn-neutral float-right" title="温度测量" accesskey="n" rel="next">下一页 <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; 版权所有 2025, Realsil。</p>
  </div>

  利用 <a href="https://www.sphinx-doc.org/">Sphinx</a> 构建，使用的 
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">主题</a>
    由 <a href="https://readthedocs.org">Read the Docs</a> 开发.
   

</footer>
        </div>

      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 



</body>
</html>