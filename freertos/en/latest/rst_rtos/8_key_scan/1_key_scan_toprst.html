

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Supported ICs &mdash; Ameba IoT Docs  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
      <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=b0e775ca" />
      <link rel="stylesheet" type="text/css" href="../../_static/tabs.css?v=a5c4661c" />
      <link rel="stylesheet" type="text/css" href="../../_static/_static/custom.css" />

  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../../_static/toggleprompt.js?v=d7ede5d2"></script>
        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
        <script src="../../_static/tabs.js?v=3030b3cb"></script>
        <script>let toggleHintShow = 'Click to show';</script>
        <script>let toggleHintHide = 'Click to hide';</script>
        <script>let toggleOpenOnPrint = 'true';</script>
        <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="RTC_IO" href="../8_rtc_io/0_rtc_io_index.html" />
    <link rel="prev" title="Key-Scan" href="0_key_scan_index.html" />
   
  
  <script type="text/javascript" src="../../_static/js/selector.js"></script>

  <style>
    .wy-nav-content {max-width: 1000px;} /* 设置最大宽度 */
  </style>

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            Ameba IoT Docs
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../0_ameba_product/0_ameba_product_center_index.html">Products Center</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_ameba_sdk/0_ameba_sdks_index.html">Ameba SDK</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_ameba_solutions/0_ameba_solutions_index.html">Ameba Solutions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_gcc_build_environment/0_gcc_build_index.html">0.1 GCC Build Environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_gdb_debug/0_gdb_debug_index.html">0.2 GDB Debug</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_gcc_build_library/0_gcc_build_library_index.html">0.3 GCC Build Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_sdk_example/0_sdk_example_index.html">0.4 SDK Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_memory_layout/0_layout_index.html">0.5 Flash &amp; RAM Layout</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_user_config/0_usrcfg_index.html">0.6 User Config</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_tools/0_tools_index.html">0.7 Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_at_command/0_at_command_index.html">0.8 AT Command</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_file_system/0_vfs_index.html">0.9 Virtual File System</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1_mpu_cache/0_mpu_cache_index.html">1.0 MPU and Cache</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1_boot_process/0_boot_index.html">1.1 BOOT Process</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1_ota/0_ota_index.html">1.2 OTA</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1_otpc/0_otpc_index.html">1.3 OTPC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1_chipen/0_chipen_index.html">1.4 CHIPEN</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1_ipc/0_ipc_index.html">1.5 Inter Processor Communication</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1_pinmux/0_pinmux_index.html">1.6 PINMUX</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1_gpio/0_gpio_index.html">1.7 GPIO</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1_power_save/0_ps_index.html">1.9 Power Save</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2_whc_wifi_bridge/0_wifi_bridge_index.html">2.1 WHC Bridge</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2_whc_fullmac/0_fullmac_index.html">2.2 WHC FullMAC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2_wifi_tunnel/0_wifi_tunnel_index.html">2.3 Wi-Fi R-Mesh</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2_wifi_csi/0_wifi_csi_index.html">2.5 Wi-Fi CSI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2_wifi_adaptivity_test/0_wifi_adaptivity_index.html">2.6 Wi-Fi Adaptivity Test</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_security/0_security_index.html">3.1 Security &amp; Encryption</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_trng/0_trng_index.html">3.2 True Random Number Generator</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_nda_huk_derivation/0_huk_derivation_index_nda.html">3.3 HUK Derivation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_nda_rdp/0_rdp_index_nda.html">3.4 RDP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_nda_rsip/0_rsip_index_nda.html">3.5 RSIP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_nda_secure_boot/0_secure_boot_index_nda.html">3.6 Secure Boot</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_nda_swd_protection/0_swd_protection_index_nda.html">3.7 SWD Protection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_nda_tfm/0_tfm_index_nda.html">3.8 Trusted Firmware-M (TF-M)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_crypto_engine/0_crypto_engine_index.html">3.9 Crypto Engine</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_ecdsa_engine/0_ecdsa_index.html">3.a ECDSA Engine</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_eddsa_engine/0_eddsa_index.html">3.b EDDSA Engine</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_rsa_engine/0_rsa_index.html">3.c RSA Engine</a></li>
<li class="toctree-l1"><a class="reference internal" href="../4_ai/0_ai_index.html">4.1 AI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../4_ai_voice/0_ai_voice_index.html">4.2 AIVoice</a></li>
<li class="toctree-l1"><a class="reference internal" href="../4_multimedia/0_multimedia_index.html">4.3 Multimedia</a></li>
<li class="toctree-l1"><a class="reference internal" href="../4_dsp/0_dsp_index.html">4.4 DSP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../6_mass_production/0_mp_index.html">6.1 Mass Production</a></li>
<li class="toctree-l1"><a class="reference internal" href="../6_mp_image/0_mp_image_index.html">6.2 MP Image</a></li>
<li class="toctree-l1"><a class="reference internal" href="../6_mptools/0_mptools_index.html">6.3 MP Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../7_usb/0_usb_index.html">7.1 USB Host &amp; Device</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_dmac/0_dmac_index.html">8.1 DMA Controllor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_psram/0_psram_index.html">8.2 PSRAM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_thermal/0_thermal_index.html">8.3 Thermal Meter</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_adc/0_adc_index.html">8.4 ADC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_ir/0_ir_index.html">8.5 IR</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_ledc/0_ledc_index.html">8.6 LEDC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_cap_touch/0_cap_touch_index.html">8.7 Cap-Touch</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="0_key_scan_index.html">8.8 Key-Scan</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Supported ICs</a></li>
<li class="toctree-l2"><a class="reference internal" href="#introduction">Introduction</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#block-diagram">Block Diagram</a></li>
<li class="toctree-l3"><a class="reference internal" href="#keypad">Keypad</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#work-mode">Work Mode</a></li>
<li class="toctree-l2"><a class="reference internal" href="#fifo-mechanism">FIFO Mechanism</a></li>
<li class="toctree-l2"><a class="reference internal" href="#low-power">Low Power</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#active-mode">Active Mode</a></li>
<li class="toctree-l3"><a class="reference internal" href="#sleep-mode">Sleep Mode</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#stuck-key">Stuck Key</a></li>
<li class="toctree-l2"><a class="reference internal" href="#usage">Usage</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#normal-operation">Normal Operation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#key-stuck-handling">Key Stuck Handling</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../8_rtc_io/0_rtc_io_index.html">8.9 RTC-IO</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_lcdc/0_lcdc_index.html">8.A LCDC</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Ameba IoT Docs</a>
      </nav>

      <div class="wy-nav-content">

        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="0_key_scan_index.html">Key-Scan</a></li>
      <li class="breadcrumb-item active">Supported ICs</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="supported-ics">
<span id="key-scan"></span><h1>Supported ICs<a class="headerlink" href="#supported-ics" title="Link to this heading"></a></h1>
<table class="docutils align-default" style="width: 100%">
<thead>
<tr class="row-odd"><th class="head"><p>IC</p></th>
<th class="head"><p>RTL8721Dx</p></th>
<th class="head"><p>RTL8726E</p></th>
<th class="head"><p>RTL8720E</p></th>
<th class="head"><p>RTL8730E</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Supported</p></td>
<td><p>Y</p></td>
<td><p>N</p></td>
<td><p>N</p></td>
<td><p>N</p></td>
</tr>
</tbody>
</table>
</section>
<section id="introduction">
<h1>Introduction<a class="headerlink" href="#introduction" title="Link to this heading"></a></h1>
<p>As a keypad scanning device, Key-Scan supports up to 8x8 keypad arrays with configurable rows and columns. It features multi-key detection and low-power operation modes.</p>
<section id="block-diagram">
<h2>Block Diagram<a class="headerlink" href="#block-diagram" title="Link to this heading"></a></h2>
<p>The block diagram of Key-Scan is illustrated in the following figure.</p>
<figure class="align-center">
<a class="reference internal image-reference" href="../../_images/key_scan_block_diagram.svg"><img alt="../../_images/key_scan_block_diagram.svg" height="252" src="../../_images/key_scan_block_diagram.svg" width="611" /></a>
</figure>
<p>Key-Scan contains 6 key Components:</p>
<ul class="simple">
<li><p><strong>Interrupt Control</strong>: control and manage interrupts</p></li>
<li><p><strong>Registers and FIFO</strong>: configure Key-Scan parameters and FIFO</p></li>
<li><p><strong>Clock</strong>: 131KHz clock for stuck row detection</p></li>
<li><p><strong>Keypad Control</strong>: scanning logic, wakeup control, and input/output control</p></li>
<li><p><strong>Keypad</strong>: 16 GPIOs for 8x8 array implementation</p></li>
</ul>
</section>
<section id="keypad">
<h2>Keypad<a class="headerlink" href="#keypad" title="Link to this heading"></a></h2>
<p>The columns and rows of Key-Scan are configurable, and the maximum columns or rows can be as 8.</p>
<figure class="align-center" id="id1">
<a class="reference internal image-reference" href="../../_images/keypad_array.svg"><img alt="../../_images/keypad_array.svg" height="705" src="../../_images/keypad_array.svg" width="830" /></a>
<figcaption>
<p><span class="caption-text">Keypad array</span><a class="headerlink" href="#id1" title="Link to this image"></a></p>
</figcaption>
</figure>
<ul class="simple">
<li><p>At the beginning, all columns output low, and all rows are set as input with internal pull up.</p></li>
<li><p>When there is a key or multiple keys pressed (short between the Column and the Row), it triggers an internal state machine to start a Key-Scan cycle to determine the column and row of the key that is pressed.</p></li>
<li><p>The state machine sets first column as an output low and all other columns are in Hi-Z state. The state machine then scans all rows to determine which keys are being pressed, and then second column is output low until the last column.</p></li>
</ul>
</section>
</section>
<section id="work-mode">
<h1>Work Mode<a class="headerlink" href="#work-mode" title="Link to this heading"></a></h1>
<p>Key-Scan contains two work modes: Event Trigger Mode and Regular Scan Mode.</p>
<table class="docutils align-default" style="width: 100%">
<thead>
<tr class="row-odd"><th class="head"><p>Work mode</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Event Trigger</p></td>
<td><p>key press/release event is stored in the FIFO only once during each key press/release operation</p></td>
</tr>
<tr class="row-odd"><td><p>Regular Scan</p></td>
<td><p>At each full scan, any key press event is stored in the FIFO until it is released</p></td>
</tr>
</tbody>
</table>
<p>The following figure shows the difference of FIFO items between Event Trigger Mode and Regular Scan Mode during a key press and release.</p>
<figure class="align-center">
<a class="reference internal image-reference" href="../../_images/difference_FIFO_items_between_two_work_modes.svg"><img alt="../../_images/difference_FIFO_items_between_two_work_modes.svg" height="341" src="../../_images/difference_FIFO_items_between_two_work_modes.svg" width="500" /></a>
</figure>
</section>
<section id="fifo-mechanism">
<h1>FIFO Mechanism<a class="headerlink" href="#fifo-mechanism" title="Link to this heading"></a></h1>
<p>The FIFO of Key-Scan has a depth of 16 and an entry width of 12 bits. The FIFO structure of Key-Scan is illustrated below.</p>
<figure class="align-center">
<a class="reference internal image-reference" href="../../_images/FIFO_structure.svg"><img alt="../../_images/FIFO_structure.svg" height="63" src="../../_images/FIFO_structure.svg" width="627" /></a>
</figure>
<div class="line-block">
<div class="line"><br /></div>
</div>
<table class="docutils align-default" style="width: 100%">
<thead>
<tr class="row-odd"><th class="head"><p>Bit</p></th>
<th class="head"><p>Indication</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>[8]</p></td>
<td><p>Event</p></td>
<td><ul class="simple">
<li><p>1: key press event</p></li>
<li><p>0: key release event</p></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><p>[7:4]</p></td>
<td><p>Row index</p></td>
<td><ul class="simple">
<li><p>1: row 0</p></li>
<li><p>2: row 1</p></li>
<li><p>3: row 2</p></li>
<li><p>…</p></li>
<li><p>8: row 7</p></li>
</ul>
</td>
</tr>
<tr class="row-even"><td><p>[3:0]</p></td>
<td><p>Column index</p></td>
<td><ul class="simple">
<li><p>1: column 0</p></li>
<li><p>2: column 1</p></li>
<li><p>3: column 2</p></li>
<li><p>…</p></li>
<li><p>8: column 7</p></li>
</ul>
</td>
</tr>
</tbody>
</table>
</section>
<section id="low-power">
<h1>Low Power<a class="headerlink" href="#low-power" title="Link to this heading"></a></h1>
<section id="active-mode">
<h2>Active Mode<a class="headerlink" href="#active-mode" title="Link to this heading"></a></h2>
<p>In active mode, Key-Scan circuit keeps power on all the time.</p>
<p>When Key-Scan scans column <em>x</em> (<em>x</em> is any column), it sets column <em>x</em> as an output low and all other columns are in Hi-Z state. Then, it scans all rows to determine which keys are being pressed or released, completing one column scan.</p>
<p>Key-Scan scans column sequentially , and will ba periodic scan column by column.</p>
</section>
<section id="sleep-mode">
<h2>Sleep Mode<a class="headerlink" href="#sleep-mode" title="Link to this heading"></a></h2>
<p>In practical application scenarios, keeping Key-Scan active consumes a significant amount of power. To save power and optimize applications, Key-Scan usually operates in the sleep mode.</p>
<p>In the sleep mode, the CPU enters a low-power state. However, when a key is pressed, it wakes up the CPU, and then Key-Scan starts scanning to determine which keys are pressed. Key-Scan continues to scan while the keys are pressed. After the keys are released and no other events occur, the CPU enters the sleep state again.</p>
</section>
</section>
<section id="stuck-key">
<h1>Stuck Key<a class="headerlink" href="#stuck-key" title="Link to this heading"></a></h1>
<p>Key stuck may occur in some applications. Without a solution for stuck keys, CPU will keep active to perform continuous keypad scans, preventing it from entering the low-power mode and resulting in high power consumption.</p>
<p>To solve this problem, the Key-Scan supports automatic  check key stuck function. When enabling this function, if a key stuck time is over than stuck time threshold, this key will be regarded as a stuck key. Read key stuck status registers to get the stuck key, and set the default status of the stuck key row to let CPU enter low power mode.</p>
<p>To reduce the power consumption, stuck row detection function may be enabled to set the detection time interval for row pins with <code class="docutils literal notranslate"><span class="pre">no</span> <span class="pre">pull</span></code>.</p>
</section>
<section id="usage">
<h1>Usage<a class="headerlink" href="#usage" title="Link to this heading"></a></h1>
<section id="normal-operation">
<h2>Normal Operation<a class="headerlink" href="#normal-operation" title="Link to this heading"></a></h2>
<p>To use Key-Scan in either Event Trigger Mode or Regular Scan Mode, perform the following steps:</p>
<ol class="arabic">
<li><p>Configure the pin multiplexing for Key-Scan keypads.</p>
<ol class="loweralpha">
<li><p>Set the column pins to no pull and configure the column pin multiplexing function.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">PAD_PullCtrl</span><span class="p">(</span><span class="n">pad_colx</span><span class="p">,</span><span class="w"> </span><span class="n">GPIO_PuPd_NOPULL</span><span class="p">);</span>
<span class="n">Pinmux_Config</span><span class="p">(</span><span class="n">pad_colx</span><span class="p">,</span><span class="w"> </span><span class="n">PINMUX_FUNCTION_KEY_COLx</span><span class="p">);</span>
</pre></div>
</div>
</li>
<li><p>Set the row pins to pull-up and configure the row pin multiplexing function.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">PAD_PullCtrl</span><span class="p">(</span><span class="n">pad_rowx</span><span class="p">,</span><span class="w"> </span><span class="n">GPIO_PuPd_UP</span><span class="p">);</span>
<span class="n">Pinmux_Config</span><span class="p">(</span><span class="n">pad_rowx</span><span class="p">,</span><span class="w"> </span><span class="n">PINMUX_FUNCTION_KEY_ROWx</span><span class="p">);</span>
</pre></div>
</div>
</li>
</ol>
</li>
<li><p>Initialize Key-Scan parameters.</p>
<p>Select the number of key rows and columns (one bit corresponds to one row or column) according to keypads, and set work mode to Event Trigger Mode or Regular Scan Mode, etc.</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-0-0-0" aria-selected="true" class="sphinx-tabs-tab" id="tab-0-0-0" name="0-0" role="tab" tabindex="0">Event Trigger Mode</button><button aria-controls="panel-0-0-1" aria-selected="false" class="sphinx-tabs-tab" id="tab-0-0-1" name="0-1" role="tab" tabindex="-1">Regular Scan Mode</button></div><div aria-labelledby="tab-0-0-0" class="sphinx-tabs-panel" id="panel-0-0-0" name="0-0" role="tabpanel" tabindex="0"><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">KeyScan_StructInit</span><span class="p">(</span><span class="o">&amp;</span><span class="n">KeyScan_InitStruct</span><span class="p">);</span>
<span class="n">KeyScan_InitStruct</span><span class="p">.</span><span class="n">KS_ColSel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0xFF</span><span class="p">;</span><span class="w">  </span><span class="c1">//8 columns</span>
<span class="n">KeyScan_InitStruct</span><span class="p">.</span><span class="n">KS_RowSel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0xFF</span><span class="p">;</span><span class="w">  </span><span class="c1">//8 rows</span>
<span class="n">KeyScan_InitStruct</span><span class="p">.</span><span class="n">KS_WorkMode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">KS_EVENT_TRIGGER_MODE</span><span class="p">;</span>
<span class="n">KeyScan_Init</span><span class="p">(</span><span class="n">KeyScan</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">KeyScan_InitStruct</span><span class="p">);</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-0-0-1" class="sphinx-tabs-panel" hidden="true" id="panel-0-0-1" name="0-1" role="tabpanel" tabindex="0"><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">KeyScan_StructInit</span><span class="p">(</span><span class="o">&amp;</span><span class="n">KeyScan_InitStruct</span><span class="p">);</span>
<span class="n">KeyScan_InitStruct</span><span class="p">.</span><span class="n">KS_ColSel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0xFF</span><span class="p">;</span><span class="w">  </span><span class="c1">//8 columns</span>
<span class="n">KeyScan_InitStruct</span><span class="p">.</span><span class="n">KS_RowSel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0xFF</span><span class="p">;</span><span class="w">  </span><span class="c1">//8 rows</span>
<span class="n">KeyScan_InitStruct</span><span class="p">.</span><span class="n">KS_WorkMode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">KS_REGULAR_SCAN_MODE</span><span class="p">;</span>
<span class="n">KeyScan_Init</span><span class="p">(</span><span class="n">KeyScan</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">KeyScan_InitStruct</span><span class="p">);</span>
</pre></div>
</div>
</div></div>
</li>
<li><p>Enable Key-Scan interrupt and register Key-Scan interrupt handler.</p></li>
<li><p>Enable Key-Scan.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">KeyScan_Cmd</span><span class="p">(</span><span class="n">KeyScan</span><span class="p">,</span><span class="w"> </span><span class="n">ENABLE</span><span class="p">);</span>
</pre></div>
</div>
</li>
<li><p>Wait for the Key-Scan interrupt and handle items.</p></li>
</ol>
</section>
<section id="key-stuck-handling">
<h2>Key Stuck Handling<a class="headerlink" href="#key-stuck-handling" title="Link to this heading"></a></h2>
<p>When a stuck key occurs, perform the following steps:</p>
<ol class="arabic">
<li><p>Configure the pin multiplexing for Key-Scan keypads.</p>
<ol class="loweralpha">
<li><p>Set the column pins to no pull and configure the column pin multiplexing function.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">PAD_PullCtrl</span><span class="p">(</span><span class="n">pad_colx</span><span class="p">,</span><span class="w"> </span><span class="n">GPIO_PuPd_NOPULL</span><span class="p">);</span>
<span class="n">Pinmux_Config</span><span class="p">(</span><span class="n">pad_colx</span><span class="p">,</span><span class="w"> </span><span class="n">PINMUX_FUNCTION_KEY_COLx</span><span class="p">);</span>
</pre></div>
</div>
</li>
<li><p>Set the row pins to pull-up and configure the row pin multiplexing function.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">PAD_PullCtrl</span><span class="p">(</span><span class="n">pad_rowx</span><span class="p">,</span><span class="w"> </span><span class="n">GPIO_PuPd_UP</span><span class="p">);</span>
<span class="n">Pinmux_Config</span><span class="p">(</span><span class="n">pad_rowx</span><span class="p">,</span><span class="w"> </span><span class="n">PINMUX_FUNCTION_KEY_ROWx</span><span class="p">);</span>
</pre></div>
</div>
</li>
</ol>
</li>
<li><p>Initialize Key-Scan parameters.</p>
<p>Select the number of key rows and columns (one bit corresponds to one row or column) according to keypads, and set work mode to Regular Scan Mode, etc.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">KeyScan_StructInit</span><span class="p">(</span><span class="o">&amp;</span><span class="n">KeyScan_InitStruct</span><span class="p">);</span>
<span class="n">KeyScan_InitStruct</span><span class="p">.</span><span class="n">KS_ColSel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0xFF</span><span class="p">;</span><span class="w">  </span><span class="c1">//8 columns</span>
<span class="n">KeyScan_InitStruct</span><span class="p">.</span><span class="n">KS_RowSel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0xFF</span><span class="p">;</span><span class="w">  </span><span class="c1">//8 rows</span>
<span class="n">KeyScan_Init</span><span class="p">(</span><span class="n">KeyScan</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">KeyScan_InitStruct</span><span class="p">);</span>
</pre></div>
</div>
</li>
<li><p>Enable the Key-Scan stuck key auto-detection function.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">KeyScan_StuckAutoCmd</span><span class="p">(</span><span class="n">KeyScan</span><span class="p">,</span><span class="w"> </span><span class="n">ENABLE</span><span class="p">);</span>
</pre></div>
</div>
</li>
<li><p>Set the stuck time threshold and configure the stuck row detection time and interval.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">KeyScan_SetStuckThreshold</span><span class="p">(</span><span class="n">KeyScan</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">);</span><span class="w">  </span><span class="c1">//stuck time threshold: 10ms</span>
<span class="n">KeyScan_StuckPeriodicalPull</span><span class="p">(</span><span class="n">KeyScan</span><span class="p">,</span><span class="mi">2000</span><span class="p">,</span><span class="mi">4000</span><span class="p">);</span><span class="c1">//pull time:2000us, no pull time:4000us</span>
</pre></div>
</div>
</li>
</ol>
<p>5. Enable the Key-Scan stuck key and all default interrupts, and register the Key-Scan interrupt handler.
7. Enable Key-Scan.</p>
<blockquote>
<div><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">KeyScan_Cmd</span><span class="p">(</span><span class="n">KeyScan</span><span class="p">,</span><span class="w"> </span><span class="n">ENABLE</span><span class="p">);</span>
</pre></div>
</div>
</div></blockquote>
<ol class="arabic" start="8">
<li><p>Wait for the Key-Scan interrupt and handle it.</p>
<ul>
<li><p>In stuck key event interrupt, get the row status, set the default row status to indicate stuck row, and mask all the keys of the stuck row.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">row_status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">KeyScan_GetStuckRow</span><span class="p">(</span><span class="n">KeyScan</span><span class="p">);</span>
<span class="n">KeyScan_SetStuckRow</span><span class="p">(</span><span class="n">KeyScan</span><span class="p">,</span><span class="w"> </span><span class="n">row_status</span><span class="p">);</span>
</pre></div>
</div>
</li>
<li><p>In all default interrupts, reset row default status to initial value, disable stuck key event interrupt and all default interrupts, enable scan event interrupt and all release the interrupt, then other keys except the stuck key can work normally.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">KeyScan_INTConfig</span><span class="p">(</span><span class="n">KeyScan</span><span class="p">,</span><span class="w"> </span><span class="n">KS_BIT_ALL_DEFAULT_INT_MASK</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">KS_BIT_STUCK_EVENT_INT_MASK</span><span class="p">,</span><span class="w"> </span><span class="n">DISABLE</span><span class="p">);</span>
<span class="n">KeyScan_SetStuckRow</span><span class="p">(</span><span class="n">KeyScan</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="n">KeyScan_INTConfig</span><span class="p">(</span><span class="n">KeyScan</span><span class="p">,</span><span class="w"> </span><span class="n">KS_BIT_ALL_RELEASE_INT_MASK</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">KS_BIT_SCAN_EVENT_INT_MASK</span><span class="p">,</span><span class="w"> </span><span class="n">ENABLE</span><span class="p">);</span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><p>Key or keys except the stuck key press or release will generate the corresponding interrupts normally.</p></li>
</ol>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="0_key_scan_index.html" class="btn btn-neutral float-left" title="Key-Scan" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../8_rtc_io/0_rtc_io_index.html" class="btn btn-neutral float-right" title="RTC_IO" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Realsil.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>

      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 



</body>
</html>