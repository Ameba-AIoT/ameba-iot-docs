

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Overview &mdash; Ameba IoT Docs  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
      <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=dcc6a489" />
      <link rel="stylesheet" type="text/css" href="../../_static/tabs.css?v=a5c4661c" />
      <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=dcc6a489" />

  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="canonical" href="http://172.29.57.206:5000/docs/rst_rtos/0_build_system/1_build_system_toprst.html" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../../_static/toggleprompt.js?v=d7ede5d2"></script>
        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
        <script>let toggleHintShow = 'Click to show';</script>
        <script>let toggleHintHide = 'Click to hide';</script>
        <script>let toggleOpenOnPrint = 'true';</script>
        <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
        <script src="../../_static/tabs.js?v=3030b3cb"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Kconfig System" href="how_to_use_kconfig.html" />
    <link rel="prev" title="Build System" href="0_build_system_index.html" />
     

    

    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

    <!-- 样式模板 -->
    <style>
        .wy-nav-content {
            max-width: 1100px;
             
        }

        .wy-nav-content {
            transition: margin 0.3s ease; /* 添加过渡效果 */
            margin-left: 0px !important; /* 侧边栏展开时的偏移 */
            max-width: calc(100% - 0px) !important; /* 调整最大宽度，使其与侧边栏宽度相关 */
        }

        .wy-nav-content.expanded {
            margin-left: 0 !important; /* 侧边栏收缩时内容区域回归左边 */
            max-width: 100% !important; /* 内容区域最大宽度调整 */
        }
    </style>

    <!-- 注入 TOC 映射和当前页面信息 -->
    

<!-- TOC 映射和当前文档信息 -->
<script>
// 将 Python 字典转换为 JS 对象
const TOC_TITLE_MAP = {"rst_rtos/0_ameba_product": "Products Center", "rst_rtos/0_ameba_product/0_ameba_product_center_index": "Products Center", "rst_rtos/0_ameba_sdk": "Ameba SDK", "rst_rtos/0_ameba_sdk/0_ameba_sdks_index": "Ameba SDK", "rst_rtos/0_ameba_solutions": "Ameba Solutions", "rst_rtos/0_ameba_solutions/0_ameba_solutions_index": "Ameba Solutions", "rst_rtos/0_at_command": "0.8 AT Commands", "rst_rtos/0_at_command/0_at_command_index": "0.8 AT Commands", "rst_rtos/0_build_system": "0.3 Build System", "rst_rtos/0_build_system/0_build_system_index": "0.3 Build System", "rst_rtos/0_file_system": "0.9 Virtual File System", "rst_rtos/0_file_system/0_vfs_index": "0.9 Virtual File System", "rst_rtos/0_ftl": "0.a Flash Translation Layer", "rst_rtos/0_ftl/0_ftl_index": "0.a Flash Translation Layer", "rst_rtos/0_gcc_build_environment": "0.1 GCC Build Environment", "rst_rtos/0_gcc_build_environment/0_gcc_build_index": "0.1 GCC Build Environment", "rst_rtos/0_gdb_debug": "0.2 GDB Debug", "rst_rtos/0_gdb_debug/0_gdb_debug_index": "0.2 GDB Debug", "rst_rtos/0_memory_layout": "0.5 Flash \u0026 RAM Layout", "rst_rtos/0_memory_layout/0_layout_index": "0.5 Flash \u0026 RAM Layout", "rst_rtos/0_sdk_example": "0.4 SDK Example", "rst_rtos/0_sdk_example/0_sdk_example_index": "0.4 SDK Example", "rst_rtos/0_tools": "0.7 Tools", "rst_rtos/0_tools/0_tools_index": "0.7 Tools", "rst_rtos/0_user_config": "0.6 User Config", "rst_rtos/0_user_config/0_usrcfg_index": "0.6 User Config", "rst_rtos/10_api_docs": "2.6 Wi-Fi API Reference", "rst_rtos/10_api_docs/0_api_index": "2.6 Wi-Fi API Reference", "rst_rtos/1_boot_process": "1.1 Boot Process", "rst_rtos/1_boot_process/0_boot_index": "1.1 Boot Process", "rst_rtos/1_chipen": "1.4 Chip Enable", "rst_rtos/1_chipen/0_chipen_index": "1.4 Chip Enable", "rst_rtos/1_gpio": "1.7 GPIO \u0026 Pin Control", "rst_rtos/1_gpio/0_gpio_index": "1.7 GPIO \u0026 Pin Control", "rst_rtos/1_ipc": "1.5 Inter Processor Communication", "rst_rtos/1_ipc/0_ipc_index": "1.5 Inter Processor Communication", "rst_rtos/1_mpu_cache": "1.0 Memory Management \u0026 Cache", "rst_rtos/1_mpu_cache/0_mpu_cache_index": "1.0 Memory Management \u0026 Cache", "rst_rtos/1_ota": "1.2 OTA", "rst_rtos/1_ota/0_ota_index": "1.2 OTA", "rst_rtos/1_otpc": "1.3 OTPC", "rst_rtos/1_otpc/0_otpc_index": "1.3 OTPC", "rst_rtos/1_pinmux": "1.6 Pin Multiplexing", "rst_rtos/1_pinmux/0_pinmux_index": "1.6 Pin Multiplexing", "rst_rtos/1_power_save": "1.9 Power Saving", "rst_rtos/1_power_save/0_ps_index": "1.9 Power Saving", "rst_rtos/2_whc_fullmac": "2.2 WHC FullMAC", "rst_rtos/2_whc_fullmac/0_fullmac_index": "2.2 WHC FullMAC", "rst_rtos/2_whc_wifi_bridge": "2.1 WHC Bridge", "rst_rtos/2_whc_wifi_bridge/0_wifi_bridge_index": "2.1 WHC Bridge", "rst_rtos/2_wifi_adaptivity_test": "2.5 Wi-Fi Adaptivity Test", "rst_rtos/2_wifi_adaptivity_test/0_wifi_adaptivity_index": "2.5 Wi-Fi Adaptivity Test", "rst_rtos/2_wifi_basic": "2.0 Wi-Fi Basic Mode", "rst_rtos/2_wifi_basic/0_wifi_basic_index": "2.0 Wi-Fi Basic Mode", "rst_rtos/2_wifi_csi": "2.4 Wi-Fi CSI", "rst_rtos/2_wifi_csi/0_wifi_csi_index": "2.4 Wi-Fi CSI", "rst_rtos/2_wifi_tunnel": "2.3 Wi-Fi R-Mesh", "rst_rtos/2_wifi_tunnel/0_wifi_tunnel_index": "2.3 Wi-Fi R-Mesh", "rst_rtos/3_ap_trustzone": "3.d AP Secure Service", "rst_rtos/3_ap_trustzone/0_ap_tz_index": "3.d AP Secure Service", "rst_rtos/3_crypto_engine": "3.9 Crypto Engine", "rst_rtos/3_crypto_engine/0_crypto_engine_index": "3.9 Crypto Engine", "rst_rtos/3_ecdsa_engine": "3.a ECDSA Engine", "rst_rtos/3_ecdsa_engine/0_ecdsa_index": "3.a ECDSA Engine", "rst_rtos/3_eddsa_engine": "3.b EDDSA Engine", "rst_rtos/3_eddsa_engine/0_eddsa_index": "3.b EDDSA Engine", "rst_rtos/3_rsa_engine": "3.c RSA Engine", "rst_rtos/3_rsa_engine/0_rsa_index": "3.c RSA Engine", "rst_rtos/3_security": "3.1 Security \u0026 Encryption", "rst_rtos/3_security/0_security_index": "3.1 Security \u0026 Encryption", "rst_rtos/3_trng": "3.2 True Random Number Generator", "rst_rtos/3_trng/0_trng_index": "3.2 True Random Number Generator", "rst_rtos/4_ai": "4.1 AI", "rst_rtos/4_ai/0_ai_index": "4.1 AI", "rst_rtos/4_ai_voice": "4.2 AIVoice", "rst_rtos/4_ai_voice/0_ai_voice_index": "4.2 AIVoice", "rst_rtos/4_dsp": "4.4 DSP", "rst_rtos/4_dsp/0_dsp_index": "4.4 DSP", "rst_rtos/4_multimedia": "4.3 Multimedia", "rst_rtos/4_multimedia/0_multimedia_index": "4.3 Multimedia", "rst_rtos/6_mass_production": "6.1 Mass Production", "rst_rtos/6_mass_production/0_mp_index": "6.1 Mass Production", "rst_rtos/6_mptools": "6.2 MP Tools", "rst_rtos/6_mptools/0_mptools_index": "6.2 MP Tools", "rst_rtos/7_usb": "7.1 USB Host \u0026 Device", "rst_rtos/7_usb/0_usb_index": "7.1 USB Host \u0026 Device", "rst_rtos/8_adc": "8.4 ADC", "rst_rtos/8_adc/0_adc_index": "8.4 ADC", "rst_rtos/8_cap_touch": "8.7 Cap-Touch", "rst_rtos/8_cap_touch/0_cap_touch_index": "8.7 Cap-Touch", "rst_rtos/8_dmac": "8.1 DMA Controller", "rst_rtos/8_dmac/0_dmac_index": "8.1 DMA Controller", "rst_rtos/8_ir": "8.5 IR", "rst_rtos/8_ir/0_ir_index": "8.5 IR", "rst_rtos/8_key_scan": "8.8 Key-Scan", "rst_rtos/8_key_scan/0_key_scan_index": "8.8 Key-Scan", "rst_rtos/8_lcdc": "8.a LCD Controller", "rst_rtos/8_lcdc/0_lcdc_index": "8.a LCD Controller", "rst_rtos/8_ledc": "8.6 LED Controller", "rst_rtos/8_ledc/0_ledc_index": "8.6 LED Controller", "rst_rtos/8_psram": "8.2 PSRAM", "rst_rtos/8_psram/0_psram_index": "8.2 PSRAM", "rst_rtos/8_rtc_io": "8.9 RTC-IO", "rst_rtos/8_rtc_io/0_rtc_io_index": "8.9 RTC-IO", "rst_rtos/8_thermal": "8.3 Thermal Meter", "rst_rtos/8_thermal/0_thermal_index": "8.3 Thermal Meter"};
console.log("TOC_TITLE_MAP:", TOC_TITLE_MAP);

// 获取当前页面的文档名 (例如 'rst_rtos/3_nda_secure_boot/0_secure_boot_index_nda')
const CURRENT_DOCNAME = 'rst_rtos/0_build_system/1_build_system_toprst';

// 动态查找顶级分类函数（定义为全局函数）
window.findTopLevelChapter = function(docname) {
    console.log("Attempting to find top-level chapter for:", docname);
    let bestMatch = "";
    let bestTitle = "Unknown Chapter";

    // 按路径长度降序排序以确保最长匹配
    const sortedPaths = Object.keys(TOC_TITLE_MAP).sort((a, b) => b.length - a.length);

    for (const path of sortedPaths) {
        console.log("Checking path:", path);
        if (docname === path || docname.startsWith(path + '/')) { // 子页面
            bestMatch = path;
            bestTitle = TOC_TITLE_MAP[path];
            console.log("Matched path:", path, "with title:", bestTitle);
            break;
        }
    }

    // 如果没有找到任何匹配项，则尝试更短的路径
    if (bestMatch === "") {
        const pathSegments = docname.split('/');
        while (pathSegments.length > 1) { // 至少保留根路径
            const candidate = pathSegments.join('/');
            console.log("Checking shorter path:", candidate);
            if (TOC_TITLE_MAP[candidate]) {
                bestTitle = TOC_TITLE_MAP[candidate];
                console.log("Matched shorter path:", candidate, "with title:", bestTitle);
                break;
            }
            pathSegments.pop();
        }
    }

    console.log("Final top-level chapter:", bestTitle);
    return bestTitle;
}

// 初始化时调用
document.addEventListener('DOMContentLoaded', function() {
    const topLevelChapter = findTopLevelChapter(CURRENT_DOCNAME);
    console.log("Top Level Chapter:", topLevelChapter);

    // 将顶级分类插入到DOM中（根据需要）
    const chapterElement = document.createElement('div');
    chapterElement.className = 'top-level-chapter';
    chapterElement.innerHTML = `<strong>Top Level Chapter: </strong>${topLevelChapter}`;
    document.body.appendChild(chapterElement);
});
</script>

    

    <!-- 左上角标题距离控制：Ameba IoT Docs -->
    <style>
        /* 新增的标题间距调整样式（添加在此处） */
        div[role="navigation"] > div[role="search"] {
            margin-bottom: 4px !important;
        }

        a.icon.icon-home {
            display: inline-block;
            margin-bottom: 2px !important;
        }
    </style>

    <!-- 引入功能模块 -->
    
    
<script>
    /* ====================== 嵌入式配置开始 ====================== */
    const embeddedConfig = {
        "freertos": {
            "name": "FreeRTOS",
            "languages": {
                "en": ["latest"],
                "cn": ["latest"]
            }
        },
        "linux": {
            "name": "Linux",
            "languages": {
                "en": ["latest"],
                "cn": ["latest"]
            }
        }
    };
    /* ====================== 嵌入式配置结束 ====================== */
</script>

<script>
    // 获取OS显示名称列表
    function getOSNames(data) {
        return Object.keys(data).map(key => data[key].name);
    }

    // 获取指定OS的语言列表
    function getLanguages(data, osKey) {
        return Object.keys(data[osKey]?.languages || {});
    }

    // 获取指定OS和语言的版本列表
    function getVersions(data, osKey, language) {
        return data[osKey]?.languages?.[language] || ['latest'];
    }

    // 根据显示名称查找OS键
    function findOSKey(data, displayName) {
        return Object.keys(data).find(key => data[key].name === displayName);
    }

    // 获取基础URL路径
    function getBaseURL() {
        const url = new URL(window.location.href);
        console.log('[DEBUG] getBaseURL:');

        if (url.protocol === 'file:') {
            // 本地路径处理
            const pathParts = url.pathname.split('/').filter(part => part !== '');
            const index = pathParts.indexOf('build');
            console.log('[DEBUG] getBaseURL0:', pathParts.slice(0, index + 1).join('/'));
            return `file://${pathParts.slice(0, index + 1).join('/')}/`;
        } else {
            // 网络路径处理
            const basePath = url.pathname.split('/')[1]; // 直接取第一个有效路径段
            console.log('[DEBUG] getBaseURL:', url.origin, basePath);
            return `${url.origin}/${basePath}/`;
        }
    }

    // 获取当前URL路径分段
    function getCurrentSegments() {
        const url = new URL(window.location.href);
        let segments = url.pathname.split('/').filter(segment => segment);


        console.log('[DEBUG] getCurrentSegments:');

        if (url.protocol === 'file:') {
            // 本地路径处理
            const index = segments.indexOf('build');
            segments = segments.slice(index + 1); // 去掉 build 及之前的路径
            console.log('[DEBUG] getCurrentSegments0:', segments);
        } else {
            // 网络路径处理
            segments = segments.slice(1); // 去掉 ameba-iot-docs/
            console.log('[DEBUG] getCurrentSegments:', segments);
        }

        return {
            osKey: segments[0] || 'freertos', // 默认为 freertos
            language: segments[1] || 'en',   // 默认为 en
            version: segments[2] || 'latest' // 默认为 latest
        };
    }

    // 绑定事件监听
    function bindEvents(baseURL, segments) {
        document.getElementById('os-selector').addEventListener('change', () => {
            const newOSKey = document.getElementById('os-selector').value;
            const availableLangs = getLanguages(embeddedConfig, newOSKey);
            const defaultLang = availableLangs[0] || 'en';
            const defaultVersion = getVersions(embeddedConfig, newOSKey, defaultLang)[0] || 'latest';
            console.log('OS Changed:', {newOSKey, defaultLang, defaultVersion});
            redirectTo(`${baseURL}${newOSKey}/${defaultLang}/${defaultVersion}/`);
        });

        document.getElementById('language-selector').addEventListener('change', () => {
            const newLang = document.getElementById('language-selector').value;
            const defaultVersion = getVersions(embeddedConfig, segments.osKey, newLang)[0] || 'latest';
            console.log('Language Changed:', {newLang, defaultVersion});
            redirectTo(`${baseURL}${segments.osKey}/${newLang}/${defaultVersion}/`);
        });

        document.getElementById('version-selector').addEventListener('change', () => {
            const newVer = document.getElementById('version-selector').value;
            console.log('Version Changed:', {newVer});
            redirectTo(`${baseURL}${segments.osKey}/${segments.language}/${newVer}/`);
        });
    }

    // 跳转函数
    function redirectTo(path) {
        const url = new URL(path, window.location.href);
        if (url.protocol === 'file:') {
            url.pathname += 'index.html';
        }
        console.log('Redirecting to:', url.href);
        window.location.href = url.href;
    }
</script>

<script>
    // 验证并修正路径参数
    function validateSegments(segments) {
        const currentOSName = embeddedConfig[segments.osKey]?.name;

        // 如果 OS 无效，默认设置为 FreeRTOS
        if (!currentOSName) {
            console.warn("Invalid OS key, defaulting to FreeRTOS");
            segments.osKey = 'freertos';
        }

        // 如果语言无效，默认设置为 en
        if (!getLanguages(embeddedConfig, segments.osKey).includes(segments.language)) {
            console.warn("Invalid language, defaulting to en");
            segments.language = 'en';
        }

        return segments;
    }

    // 设置初始选中值
    function setInitialValues(segments) {
        document.getElementById('os-selector').value = segments.osKey;
        document.getElementById('language-selector').value = segments.language;

        const versionSelector = document.getElementById('version-selector');
        const availableVersions = getVersions(embeddedConfig, segments.osKey, segments.language);
        versionSelector.value = availableVersions.includes(segments.version) ? segments.version : availableVersions[0] || 'latest';
    }
</script>

<style>
    .selectors-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr); /* 三列等宽 */
        gap: 4px;
        padding: 1px 1px;

        margin-top: var(--root-margin-top, 4px);
        margin-bottom: var(--root-margin-bottom, 0px);
    }

    .dual-selector-group {
        display: grid;
        grid-template-columns: 1fr 1fr; /* 两列等宽 */
        gap: 4px; /* 列间距 */
    }

    .selector-group {
        position: relative;
        width: 100%; /* 确保填满网格列 */
    }

    .selector-label {
        display: block;
        color: #a0b3c6;
        font-size: 0.85em;
        margin-bottom: 4px;
        padding-left: 4px;
    }

    .selector-dropdown {
        width: 100%;
        margin-top: var(--root-margin-top, 4px);
        margin-bottom: var(--root-margin-bottom, 0px);
        padding: 2px 2px;
        border: 2px white !important;
        border-radius: 6px !important;
        background: #627078 !important;
        color: white;
        font-size: 0.95em;
        transition: all 0.3s ease;
        appearance: none;
        background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23a0b3c6'%3e%3cpath d='M7 10l5 5 5-5z'/%3e%3c/svg%3e");
        background-repeat: no-repeat;
        background-position: right 10px center;
        background-size: 16px;
        display: flex;
        height: 30px;

        box-shadow: none !important; /* 不要边框阴影 */
        outline: none !important; /* 不要边框阴影 */
    }

    .selector-dropdown:hover {
        border-color: #4a6a8b;
        background-color: rgba(44, 62, 80, 1);
        box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }

    .selector-dropdown:focus {
        outline: none;
        border-color: #3498db;
        box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
    }

    /* 移动端优化 */
    @media (max-width: 768px) {
        .selectors-grid {
            grid-template-columns: 1fr; /* 小屏幕下堆叠显示 */
            gap: 10px;
        }

        .selector-dropdown {
            padding: 10px 12px;
        }

        .dual-selector-group {
            grid-template-columns: 1fr; /* 小屏幕下堆叠显示 */
        }
    }
</style>

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
    

          
          
          <a href="../../index.html" class="icon icon-home">
            Ameba IoT Docs
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

    <!-- templates/sidebar_toggle.html -->


<div id="topleft-panel" style="display: block !important; padding: 0; background: none; border: none;"></div>


<div class="bottomleft-panel"></div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        try {
            const segments = validateSegments(getCurrentSegments());
            const baseURL = getBaseURL();

            // 渲染HTML
            document.getElementById('topleft-panel').innerHTML = `
<!-- templates/sidebar_user_panel_div.html -->


<!-- templates/sidebar_user_panel_div_docselect.html -->

<div class="selectors-grid">
    <!-- 系统选择器 -->
    <div class="selector-group">
        <select id="os-selector" class="selector-dropdown">
            ${Object.keys(embeddedConfig).map(key => `
                <option value="${key}">${embeddedConfig[key].name}</option>
            `).join('')}
        </select>
    </div>

    <!-- 语言选择器 -->
    <div class="selector-group">
        <select id="language-selector" class="selector-dropdown">
            ${getLanguages(embeddedConfig, segments.osKey).map(lang => `
                <option value="${lang}">${lang === 'en' ? 'en' : 'cn'}</option>
            `).join('')}
        </select>
    </div>

    <!-- 版本选择器 -->
    <div class="selector-group">
        <select id="version-selector" class="selector-dropdown">
            ${getVersions(embeddedConfig, segments.osKey, segments.language).map(ver => `
                <option value="${ver}">${ver}</option>
            `).join('')}
        </select>
    </div>
</div>

<div class="user-panel-container">
    <div class="user-panel">
        

    </div>
</div>`;

            // 设置初始值
            setInitialValues(segments);

            // 绑定事件
            bindEvents(baseURL, segments);

            // 将 user-panel 移动到 bottomleft-panel 内
            const userPanel = document.querySelector('.user-panel');
            const bottomleftPanel = document.querySelector('.bottomleft-panel');
            if (userPanel && bottomleftPanel) {
                bottomleftPanel.appendChild(userPanel); // 直接添加为子元素
            }
        } catch (error) {
            console.error("Error initializing selectors:", error);
        }
    });
</script>

<style>
    #topleft-panel {
        background: rgba(40, 58, 73, 0.9);
        border-radius: 4px;
        padding: 4px;
        margin: 4px 0;
        box-shadow: 0 4px 4px rgba(0,0,0,0.15);
        backdrop-filter: blur(4px);
    }

    /* 移动端优化 */
    @media (max-width: 768px) {
        #topleft-panel {
            margin: 8px 0;
            padding: 10px;
        }
    }
</style>

        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../0_ameba_product/0_ameba_product_center_index.html">Products Center</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_ameba_sdk/0_ameba_sdks_index.html">Ameba SDK</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_ameba_solutions/0_ameba_solutions_index.html">Ameba Solutions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_gcc_build_environment/0_gcc_build_index.html">0.1 GCC Build Environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_gdb_debug/0_gdb_debug_index.html">0.2 GDB Debug</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="0_build_system_index.html">0.3 Build System</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Overview</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#concepts">Concepts</a></li>
<li class="toctree-l3"><a class="reference internal" href="#sdk-cmake-structure">SDK CMake Structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="#global-compilation-configuration">Global Compilation Configuration</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#compilation-configuration-contents">Compilation Configuration Contents</a></li>
<li class="toctree-l4"><a class="reference internal" href="#global-compilation-configuration-sources">Global Compilation Configuration Sources</a></li>
<li class="toctree-l4"><a class="reference internal" href="#scope-of-global-compilation-configuration">Scope of Global Compilation Configuration</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#component-compilation-cmakelists-txt">Component Compilation CMakeLists.txt</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#component-public-part">Component Public Part</a></li>
<li class="toctree-l4"><a class="reference internal" href="#component-private-part">Component Private Part</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#best-practices">Best Practices</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#modifying-existing-component-build-config">Modifying Existing Component Build Config</a></li>
<li class="toctree-l3"><a class="reference internal" href="#quickly-compile-link-source-files-for-testing">Quickly Compile &amp; Link Source Files for Testing</a></li>
<li class="toctree-l3"><a class="reference internal" href="#integrating-code-with-standalone-build-system">Integrating Code with Standalone Build System</a></li>
<li class="toctree-l3"><a class="reference internal" href="#adjusting-submodule-organization-relationships-in-components">Adjusting Submodule Organization Relationships in Components</a></li>
<li class="toctree-l3"><a class="reference internal" href="#adding-new-components-in-component-directory">Adding New Components in Component Directory</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#commonly-used-cmake-interfaces-and-preset-constants">Commonly Used CMake Interfaces and Preset Constants</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#list-operations">List Operations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#ameba-list-append">ameba_list_append</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ameba-list-append-if">ameba_list_append_if</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ameba-list-append-ifnot">ameba_list_append_ifnot</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ameba-list-append-ifdef">ameba_list_append_ifdef</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#add-library">Add Library</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#ameba-add-internal-library">ameba_add_internal_library</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ameba-port-standalone-internal-library">ameba_port_standalone_internal_library</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ameba-add-external-app-library">ameba_add_external_app_library</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#add-subdirectory">Add Subdirectory</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#ameba-add-subdirectory">ameba_add_subdirectory</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ameba-add-subdirectory-if">ameba_add_subdirectory_if</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ameba-add-subdirectory-ifnot">ameba_add_subdirectory_ifnot</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ameba-add-subdirectory-if-exist">ameba_add_subdirectory_if_exist</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#constants-definition">Constants Definition</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#general-constants">General Constants</a></li>
<li class="toctree-l4"><a class="reference internal" href="#soc-project-related-constants">SOC Project-related Constants</a></li>
<li class="toctree-l4"><a class="reference internal" href="#mcu-project-related-constants">MCU Project-related Constants</a></li>
<li class="toctree-l4"><a class="reference internal" href="#component-related-constants">Component-related Constants</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#frequently-asked-questions-suggestions">Frequently Asked Questions &amp; Suggestions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#view-detailed-compilation-parameters-of-a-source-file">View Detailed Compilation Parameters of a Source File</a></li>
<li class="toctree-l3"><a class="reference internal" href="#undefined-reference-error">Undefined Reference Error</a></li>
<li class="toctree-l3"><a class="reference internal" href="#useful-types-for-complex-logic-processing">Useful Types for Complex Logic Processing</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#soc-type">SOC Type</a></li>
<li class="toctree-l4"><a class="reference internal" href="#mcu-type">MCU Type</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#common-cmake-debugging-methods">Common CMake Debugging Methods</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#logging">Logging</a></li>
<li class="toctree-l4"><a class="reference internal" href="#troubleshooting-common-cmake-errors">Troubleshooting Common CMake Errors</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#copied-and-replaced-a-source-file-but-did-not-trigger-recompilation">Copied and replaced a source file but did not trigger recompilation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#advanced-learning-readings">Advanced Learning Readings</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#special-compilation-configurations">Special Compilation Configurations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#set-compilation-configuration-per-source-file">Set Compilation Configuration Per Source File</a></li>
<li class="toctree-l4"><a class="reference internal" href="#set-compile-options-per-source-file-type">Set Compile Options Per Source File Type</a></li>
<li class="toctree-l4"><a class="reference internal" href="#suppress-compilation-warnings-as-errors">Suppress Compilation Warnings as Errors</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="how_to_use_kconfig.html">Kconfig System</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../0_sdk_example/0_sdk_example_index.html">0.4 SDK Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_memory_layout/0_layout_index.html">0.5 Flash &amp; RAM Layout</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_user_config/0_usrcfg_index.html">0.6 User Config</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_tools/0_tools_index.html">0.7 Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_at_command/0_at_command_index.html">0.8 AT Commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_file_system/0_vfs_index.html">0.9 Virtual File System</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_ftl/0_ftl_index.html">0.a Flash Translation Layer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1_mpu_cache/0_mpu_cache_index.html">1.0 Memory Management &amp; Cache</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1_boot_process/0_boot_index.html">1.1 Boot Process</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1_ota/0_ota_index.html">1.2 OTA</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1_otpc/0_otpc_index.html">1.3 OTPC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1_chipen/0_chipen_index.html">1.4 Chip Enable</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1_ipc/0_ipc_index.html">1.5 Inter Processor Communication</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1_pinmux/0_pinmux_index.html">1.6 Pin Multiplexing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1_gpio/0_gpio_index.html">1.7 GPIO &amp; Pin Control</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1_power_save/0_ps_index.html">1.9 Power Saving</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2_wifi_basic/0_wifi_basic_index.html">2.0 Wi-Fi Basic Mode</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2_whc_wifi_bridge/0_wifi_bridge_index.html">2.1 WHC Bridge</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2_whc_fullmac/0_fullmac_index.html">2.2 WHC FullMAC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2_wifi_tunnel/0_wifi_tunnel_index.html">2.3 Wi-Fi R-Mesh</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2_wifi_csi/0_wifi_csi_index.html">2.4 Wi-Fi CSI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2_wifi_adaptivity_test/0_wifi_adaptivity_index.html">2.5 Wi-Fi Adaptivity Test</a></li>
<li class="toctree-l1"><a class="reference internal" href="../10_api_docs/0_api_index.html">2.6 Wi-Fi API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_security/0_security_index.html">3.1 Security &amp; Encryption</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_trng/0_trng_index.html">3.2 True Random Number Generator</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_crypto_engine/0_crypto_engine_index.html">3.9 Crypto Engine</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_ecdsa_engine/0_ecdsa_index.html">3.a ECDSA Engine</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_eddsa_engine/0_eddsa_index.html">3.b EDDSA Engine</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_rsa_engine/0_rsa_index.html">3.c RSA Engine</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_ap_trustzone/0_ap_tz_index.html">3.d AP Secure Service</a></li>
<li class="toctree-l1"><a class="reference internal" href="../4_ai/0_ai_index.html">4.1 AI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../4_ai_voice/0_ai_voice_index.html">4.2 AIVoice</a></li>
<li class="toctree-l1"><a class="reference internal" href="../4_multimedia/0_multimedia_index.html">4.3 Multimedia</a></li>
<li class="toctree-l1"><a class="reference internal" href="../4_dsp/0_dsp_index.html">4.4 DSP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../6_mass_production/0_mp_index.html">6.1 Mass Production</a></li>
<li class="toctree-l1"><a class="reference internal" href="../6_mptools/0_mptools_index.html">6.2 MP Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../7_usb/0_usb_index.html">7.1 USB Host &amp; Device</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_dmac/0_dmac_index.html">8.1 DMA Controller</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_psram/0_psram_index.html">8.2 PSRAM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_thermal/0_thermal_index.html">8.3 Thermal Meter</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_adc/0_adc_index.html">8.4 ADC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_ir/0_ir_index.html">8.5 IR</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_ledc/0_ledc_index.html">8.6 LED Controller</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_cap_touch/0_cap_touch_index.html">8.7 Cap-Touch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_key_scan/0_key_scan_index.html">8.8 Key-Scan</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_rtc_io/0_rtc_io_index.html">8.9 RTC-IO</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_lcdc/0_lcdc_index.html">8.a LCD Controller</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Ameba IoT Docs</a>
      </nav>

      <div class="wy-nav-content">
    
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="0_build_system_index.html">Build System</a></li>
      <li class="breadcrumb-item active">Overview</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <span class="target" id="build-system"></span><!-- 下拉菜单 -->
<div style="margin: 20px 0; text-align: left;">
    <div style="display: flex; align-items: center; gap: 10px;">
        <span style="font-size: 14px;">IC: </span>
        <select class="tab-selector" style="height: 22px; padding: 2px 8px; font-size: 13px;">
            <option value="RTL8721Dx">RTL8721Dx</option>
            <option value="RTL8720E">RTL8720E</option>
            <option value="RTL8726E">RTL8726E</option>
            <option value="RTL8730E">RTL8730E</option>
        </select>
    </div>
</div>

<!-- 修复后的 JavaScript -->
<script>
document.addEventListener("DOMContentLoaded", function() {
    const selector = document.querySelector('.tab-selector');

    selector.addEventListener('change', function() {
        const targetTab = this.value;
        const tabs = document.querySelectorAll('.sphinx-tabs-tab');
        let found = false;

        tabs.forEach(tab => {
            const tabText = tab.textContent.trim();
            if (tabText === targetTab) {
                tab.click();
                window.dispatchEvent(new Event('resize')); // 触发插件更新
                found = true;
            }
        });

        if (!found) {
            console.error("未找到选项卡:", targetTab);
        }
    });
});
</script><section id="overview">
<h1>Overview<a class="headerlink" href="#overview" title="Link to this heading"></a></h1>
<section id="concepts">
<span id="build-concept-definitions"></span><h2>Concepts<a class="headerlink" href="#concepts" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p><strong>SOC Project</strong>: Each SOC project root directory contains a <code class="file docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> as the build entry point. All MCU projects under it are added here.</p></li>
<li><p><strong>MCU Project</strong>: Each MCU project uses unified toolchain and configuration parameters (some configurations may vary due to firmware or ROM). Different MCU projects may use different toolchains. An MCU project includes builds of one or more firmwares.</p></li>
<li><p><strong>Firmware</strong>: Mainly includes <code class="file docutils literal notranslate"><span class="pre">image1</span></code>, <code class="file docutils literal notranslate"><span class="pre">image2</span></code>, <code class="file docutils literal notranslate"><span class="pre">image3</span></code>, with differences as follows:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">image1</span></code>: Defines the common infrastructure for bootloader and system flash layout in MCU systems, providing a secure bootloader with convenient software upgrade support.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">image2</span></code>: The main application firmware of the SOC, typically containing a real-time OS (FreeRTOS) and application tasks.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">image3</span></code>: Highly configurable, allowing users to include only required security services. Protected by Read Protection (RDP), decrypted in the secure bootloader, and loaded into TrustZone-protected SRAM.</p></li>
</ul>
</li>
<li><p><strong>Component</strong>: Components are organized under the <code class="file docutils literal notranslate"><span class="pre">component</span></code> directory at the same level as SOC projects. Each subdirectory represents a functional module with its own <code class="file docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> defining compilation and linking configurations.</p></li>
<li><p><strong>Firmware Build</strong>: In each MCU project’s <code class="file docutils literal notranslate"><span class="pre">[asdk|vsdk]/make/[image1|image2|image3]/CMakeLists.txt</span></code>, add required components and define generation rules.</p></li>
</ul>
</section>
<section id="sdk-cmake-structure">
<span id="build-sdk-cmake-structure"></span><h2>SDK CMake Structure<a class="headerlink" href="#sdk-cmake-structure" title="Link to this heading"></a></h2>
<p>The project’s <code class="file docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> directory structure and invocation relationships are shown below:</p>
<figure class="align-center" id="build-cmake-project-structure">
<a class="reference internal image-reference" href="../../_images/build_cmake_project_structure.svg"><img alt="../../_images/build_cmake_project_structure.svg" height="856" src="../../_images/build_cmake_project_structure.svg" width="1216" /></a>
</figure>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>In the diagram above, the <code class="file docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> in <code class="file docutils literal notranslate"><span class="pre">image1</span></code>, <code class="file docutils literal notranslate"><span class="pre">image2</span></code>, and <code class="file docutils literal notranslate"><span class="pre">image3</span></code> directories can <strong>independently add components for their respective firmwares</strong>.</p>
</div>
<p>Directory structure of <code class="file docutils literal notranslate"><span class="pre">cmake</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>cmake
├── flags                              # Global compile and link options
│   ├── ca32
│   │   ├── compile_options.cmake
│   │   └── link_options.cmake
│   ├── common
│   │   ├── compile_options.cmake
│   │   └── link_options.cmake
│   ├── km0
│   │   ├── compile_options.cmake
│   │   └── link_options.cmake
│   ├── km4
│   │   ├── compile_options.cmake
│   │   └── link_options.cmake
│   └── kr4
│       ├── compile_options.cmake
│       └── link_options.cmake
├── CMakeLists-template.cmake        # CMakeLists.txt template for component
├── common.cmake                     # Project related APIs
├── global_define.cmake              # Global defined parameters
├── utility_base.cmake               # Utility APIs (lower level)
├── utility.cmake                    # Utility APIs (upper level)
└── toolchain                        # Toolchain defines
    ├── ameba-toolchain-asdk-10.3.1.cmake
    ├── ameba-toolchain-asdk-12.3.1.cmake
    ├── ameba-toolchain-check.cmake
    ├── ameba-toolchain-common.cmake
    └── ameba-toolchain-vsdk-10.3.1.cmake
</pre></div>
</div>
</section>
<section id="global-compilation-configuration">
<span id="build-global-compile-config"></span><h2>Global Compilation Configuration<a class="headerlink" href="#global-compilation-configuration" title="Link to this heading"></a></h2>
<p>Refers to compilation settings that are ​**shared by all components** within a specified scope.</p>
<section id="compilation-configuration-contents">
<h3>Compilation Configuration Contents<a class="headerlink" href="#compilation-configuration-contents" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p><strong>Sources</strong></p></li>
<li><p><strong>Include directories</strong></p></li>
<li><p><strong>Compile options</strong></p></li>
<li><p><strong>Definitions</strong></p></li>
<li><p><strong>Link options</strong></p></li>
<li><p><strong>Link libraries</strong></p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p><strong>Sources, include directories, compile options, and definitions</strong> are used for component compilation.</p></li>
<li><p><strong>Link options</strong> and <strong>link libraries</strong> are used for firmware linking.</p></li>
</ul>
</div>
</section>
<section id="global-compilation-configuration-sources">
<h3>Global Compilation Configuration Sources<a class="headerlink" href="#global-compilation-configuration-sources" title="Link to this heading"></a></h3>
<p>Primarily consists of two sources:</p>
<ul class="simple">
<li><p>Settings in <code class="file docutils literal notranslate"><span class="pre">cmake/flags</span></code>, refer to <a class="reference internal" href="#build-sdk-cmake-structure"><span class="std std-ref">SDK CMake Structure</span></a></p></li>
<li><p>Additional content appended by each component’s <a class="reference internal" href="#build-component-cmake-public-part"><span class="std std-ref">Component Public Part</span></a></p></li>
</ul>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<ul class="simple">
<li><p>The order of components’ appended configurations in the final global compilation settings (e.g., the order of header file paths) depends on the sequence in which components are added to the firmware</p></li>
<li><p>This ordering is unreliable. For order-sensitive configurations (like header file paths), it’s recommended to handle them through alternative approaches. For details see <a class="reference internal" href="#build-component-cmake-private-part"><span class="std std-ref">Component Private Part</span></a></p></li>
</ul>
</div>
</section>
<section id="scope-of-global-compilation-configuration">
<h3>Scope of Global Compilation Configuration<a class="headerlink" href="#scope-of-global-compilation-configuration" title="Link to this heading"></a></h3>
<p>The <strong>global compilation configuration</strong> applies to each MCU project. For example, <code class="docutils literal notranslate"><span class="pre">RTL8721Dx</span></code> has separate configurations for <code class="docutils literal notranslate"><span class="pre">km0</span></code> and <code class="docutils literal notranslate"><span class="pre">km4</span></code>, while <code class="docutils literal notranslate"><span class="pre">RTL8730E</span></code> has configurations for <code class="docutils literal notranslate"><span class="pre">km0</span></code>, <code class="docutils literal notranslate"><span class="pre">km4</span></code>, and <code class="docutils literal notranslate"><span class="pre">ca32</span></code>. These configurations are isolated. <strong>Components under the same MCU project use the same global compilation configuration</strong>. See the following diagram:</p>
<figure class="align-center" id="build-cmake-project-structure-with-config">
<a class="reference internal image-reference" href="../../_images/build_cmake_project_structure_with_config.svg"><img alt="../../_images/build_cmake_project_structure_with_config.svg" height="856" src="../../_images/build_cmake_project_structure_with_config.svg" width="1268" /></a>
</figure>
<p>Key points:</p>
<ul class="simple">
<li><p>Each MCU project contains an independent compilation scope.</p></li>
<li><p>Different firmwares (<code class="file docutils literal notranslate"><span class="pre">image1</span></code>, <code class="file docutils literal notranslate"><span class="pre">image2</span></code>, <code class="file docutils literal notranslate"><span class="pre">image3</span></code>) under the same MCU project share the same compilation config.</p></li>
<li><p>The same component is compiled with <strong>different global configurations</strong> across MCU projects (e.g., <code class="docutils literal notranslate"><span class="pre">at_cmd</span></code> in <code class="docutils literal notranslate"><span class="pre">project_mcu1</span></code> vs. <code class="docutils literal notranslate"><span class="pre">project_mcu2</span></code>).</p></li>
</ul>
</section>
</section>
<section id="component-compilation-cmakelists-txt">
<span id="build-component-cmake-structure"></span><h2>Component Compilation CMakeLists.txt<a class="headerlink" href="#component-compilation-cmakelists-txt" title="Link to this heading"></a></h2>
<p>Consists of <a class="reference internal" href="#build-component-cmake-public-part"><span class="std std-ref">Component Public Part</span></a> and <a class="reference internal" href="#build-component-cmake-private-part"><span class="std std-ref">Component Private Part</span></a>:</p>
<ul class="simple">
<li><p>The former appends configurations to the <a class="reference internal" href="#build-global-compile-config"><span class="std std-ref">Global Compilation Configuration</span></a>.</p></li>
<li><p>The latter defines the <strong>component’s library</strong> build configuration.</p></li>
</ul>
<section id="component-public-part">
<span id="build-component-cmake-public-part"></span><h3>Component Public Part<a class="headerlink" href="#component-public-part" title="Link to this heading"></a></h3>
<p>Appends the following to the <a class="reference internal" href="#build-global-compile-config"><span class="std std-ref">Global Compilation Configuration</span></a>:</p>
<ul class="simple">
<li><p><strong>Include directories</strong>: Added to global if other components need headers from this component.</p></li>
<li><p><strong>Definitions</strong>: Global preprocessor macros added to global when this component is added (rarely used).</p></li>
<li><p><strong>Link libraries</strong>: Required if the component is provided as a prebuilt library (not source). Use <a class="reference internal" href="#build-ameba-add-external-app-library"><span class="std std-ref">ameba_add_external_app_library</span></a> to build the library.</p></li>
</ul>
<p>Configuration variables: <code class="docutils literal notranslate"><span class="pre">public_includes</span></code>, <code class="docutils literal notranslate"><span class="pre">public_definitions</span></code>, <code class="docutils literal notranslate"><span class="pre">public_libraries</span></code>. Update these in the highlighted section of code block below. See examples in <code class="file docutils literal notranslate"><span class="pre">cmake/CMakeLists-template.cmake</span></code> and APIs in <a class="reference internal" href="#build-cmake-api-list"><span class="std std-ref">List Operations</span></a>.</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c">##########################################################################################</span>
<span class="linenos"> 2</span><span class="c">## * This part defines public part of the component</span>
<span class="linenos"> 3</span><span class="c">## * Public part will be used as global build configures for all component</span>
<span class="linenos"> 4</span>
<span class="linenos"> 5</span><span class="nb">set</span><span class="p">(</span><span class="s">public_includes</span><span class="p">)</span><span class="w">                </span><span class="c">#public include directories, NOTE: relative path is OK</span>
<span class="linenos"> 6</span><span class="nb">set</span><span class="p">(</span><span class="s">public_definitions</span><span class="p">)</span><span class="w">             </span><span class="c">#public definitions</span>
<span class="linenos"> 7</span><span class="nb">set</span><span class="p">(</span><span class="s">public_libraries</span><span class="p">)</span><span class="w">               </span><span class="c">#public libraries(files), NOTE: linked with whole-archive options</span>
<span class="linenos"> 8</span>
<span class="linenos"> 9</span><span class="c">#------------------------------------------------------------------#</span>
<span class="linenos">10</span><span class="c"># Component public part, user config begin(DO NOT remove this line)</span>
<span class="hll"><span class="linenos">11</span>
</span><span class="hll"><span class="linenos">12</span><span class="c"># set public_includes, public_definitions, public_libraries in this section</span>
</span><span class="hll"><span class="linenos">13</span>
</span><span class="linenos">14</span><span class="c"># Component public part, user config end(DO NOT remove this line)</span>
<span class="linenos">15</span><span class="c">#------------------------------------------------------------------#</span>
<span class="linenos">16</span>
<span class="linenos">17</span><span class="c">#WARNING: Fixed section, DO NOT change!</span>
<span class="linenos">18</span><span class="nb">ameba_global_include</span><span class="p">(</span><span class="o">${</span><span class="nv">public_includes</span><span class="o">}</span><span class="p">)</span>
<span class="linenos">19</span><span class="nb">ameba_global_define</span><span class="p">(</span><span class="o">${</span><span class="nv">public_defines</span><span class="o">}</span><span class="p">)</span>
<span class="linenos">20</span><span class="nb">ameba_global_library</span><span class="p">(</span><span class="o">${</span><span class="nv">public_libraries</span><span class="o">}</span><span class="p">)</span><span class="w"> </span><span class="c">#default: whole-achived</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If there’s no need to update the three types of configurations mentioned above for the current component, the highlighted code section can be left blank.</p>
</div>
</section>
<section id="component-private-part">
<span id="build-component-cmake-private-part"></span><h3>Component Private Part<a class="headerlink" href="#component-private-part" title="Link to this heading"></a></h3>
<p>Defines the component library build:</p>
<ul class="simple">
<li><p><strong>Source files</strong>: Source files for current component</p></li>
<li><p><strong>Private includes</strong>: Only for current component</p></li>
<li><p><strong>Private definitions</strong>: Only for current component</p></li>
<li><p><strong>Private compile options</strong>: Only for current component</p></li>
</ul>
<p>Configuration variables: <code class="docutils literal notranslate"><span class="pre">private_sources</span></code>, <code class="docutils literal notranslate"><span class="pre">private_includes</span></code>, <code class="docutils literal notranslate"><span class="pre">private_definitions</span></code>, <code class="docutils literal notranslate"><span class="pre">private_compile_options</span></code>. Update these in the highlighted section of code block below. See examples in <code class="file docutils literal notranslate"><span class="pre">cmake/CMakeLists-template.cmake</span></code> and APIs in <a class="reference internal" href="#build-cmake-api-list"><span class="std std-ref">List Operations</span></a>.</p>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>The final compilation configuration of a component (particularly <strong>include directories</strong>, <strong>definitions</strong> and <strong>compile options</strong>) is composed of both <a class="reference internal" href="#build-component-cmake-private-part"><span class="std std-ref">Component Private Part</span></a> and <a class="reference internal" href="#build-component-cmake-public-part"><span class="std std-ref">Component Public Part</span></a>, with <strong>the former taking higher priority for include directories and compile options</strong> . For example, the actual header search paths for a component include:</p>
<ul class="simple">
<li><p><strong>Private include directories</strong> added by the current component.</p></li>
<li><p><strong>Global include directories</strong> from <a class="reference internal" href="#build-global-compile-config"><span class="std std-ref">Global Compilation Configuration</span></a>, which includes paths appended by <strong>both the current component</strong> and <strong>other components</strong>.</p></li>
</ul>
<p>Therefore, configurations already added in <a class="reference internal" href="#build-component-cmake-public-part"><span class="std std-ref">Component Public Part</span></a> should <strong>not be duplicated</strong> in <a class="reference internal" href="#build-component-cmake-private-part"><span class="std std-ref">Component Private Part</span></a>.</p>
<p>General recommendations:</p>
<ul class="simple">
<li><p>Prefer placing include directories in the <a class="reference internal" href="#build-component-cmake-private-part"><span class="std std-ref">Component Private Part</span></a> to avoid header file pollution.</p></li>
<li><p>Exceptions: For generic or low-level components used by many others, placing includes in <a class="reference internal" href="#build-component-cmake-public-part"><span class="std std-ref">Component Public Part</span></a> is preferred to improve reusability.</p></li>
</ul>
</div>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c">##########################################################################################</span>
<span class="linenos"> 2</span><span class="c">## * This part defines private part of the component</span>
<span class="linenos"> 3</span><span class="c">## * Private part is used to build target of current component</span>
<span class="linenos"> 4</span><span class="c">## * NOTE: The build API guarantees the global build configures(mentioned above)</span>
<span class="linenos"> 5</span><span class="c">## *       applied to the target automatically. So if any configure was already added</span>
<span class="linenos"> 6</span><span class="c">## *       to public above, it&#39;s unnecessary to add again below.</span>
<span class="linenos"> 7</span>
<span class="linenos"> 8</span><span class="c">#NOTE: User defined section, add your private build configures here</span>
<span class="linenos"> 9</span><span class="c"># You may use if-else condition to set these predefined variable</span>
<span class="linenos">10</span><span class="c"># They are only for ameba_add_internal_library/ameba_add_external_app_library/ameba_add_external_soc_library</span>
<span class="linenos">11</span><span class="nb">set</span><span class="p">(</span><span class="s">private_sources</span><span class="p">)</span><span class="w">                 </span><span class="c">#private source files, NOTE: relative path is OK</span>
<span class="linenos">12</span><span class="nb">set</span><span class="p">(</span><span class="s">private_includes</span><span class="p">)</span><span class="w">                </span><span class="c">#private include directories, NOTE: relative path is OK</span>
<span class="linenos">13</span><span class="nb">set</span><span class="p">(</span><span class="s">private_definitions</span><span class="p">)</span><span class="w">             </span><span class="c">#private definitions</span>
<span class="linenos">14</span><span class="nb">set</span><span class="p">(</span><span class="s">private_compile_options</span><span class="p">)</span><span class="w">         </span><span class="c">#private compile_options</span>
<span class="linenos">15</span>
<span class="linenos">16</span><span class="c">#------------------------------#</span>
<span class="linenos">17</span><span class="c"># Component private part, user config begin</span>
<span class="hll"><span class="linenos">18</span>
</span><span class="hll"><span class="linenos">19</span><span class="w"> </span><span class="c"># set private_sources, private_includes, private_definitions, private_compile_options in this section</span>
</span><span class="hll"><span class="linenos">20</span>
</span><span class="linenos">21</span><span class="c"># Component private part, user config end</span>
<span class="linenos">22</span><span class="c">#------------------------------#</span>
<span class="linenos">23</span>
<span class="linenos">24</span><span class="c">#WARNING: Select right API based on your component&#39;s release/not-release/standalone</span>
<span class="linenos">25</span>
<span class="linenos">26</span><span class="c">###NOTE: For open-source component, always build from source</span>
<span class="hll"><span class="linenos">27</span><span class="nb">ameba_add_internal_library</span><span class="p">(</span><span class="s">foo</span>
</span><span class="linenos">28</span><span class="w">    </span><span class="s">p_SOURCES</span>
<span class="linenos">29</span><span class="w">        </span><span class="o">${</span><span class="nv">private_sources</span><span class="o">}</span>
<span class="linenos">30</span><span class="w">    </span><span class="s">p_INCLUDES</span>
<span class="linenos">31</span><span class="w">        </span><span class="o">${</span><span class="nv">private_includes</span><span class="o">}</span>
<span class="linenos">32</span><span class="w">    </span><span class="s">p_DEFINITIONS</span>
<span class="linenos">33</span><span class="w">        </span><span class="o">${</span><span class="nv">private_definitions</span><span class="o">}</span>
<span class="linenos">34</span><span class="w">    </span><span class="s">p_COMPILE_OPTIONS</span>
<span class="linenos">35</span><span class="w">        </span><span class="o">${</span><span class="nv">private_compile_options</span><span class="o">}</span>
<span class="linenos">36</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>The code block above uses <a class="reference internal" href="#build-ameba-add-internal-library"><span class="std std-ref">ameba_add_internal_library</span></a> to generate library files. Other APIs can also be selected as needed. For details, see <a class="reference internal" href="#build-cmake-api-add-library"><span class="std std-ref">Add Library</span></a>. For modifications to the highlighted code section, refer to <a class="reference internal" href="#build-modify-existing-component-build-config"><span class="std std-ref">Modifying Existing Component Build Config</span></a>.</p></li>
<li><p>If the component already has a directory with standalone build scripts, see <a class="reference internal" href="#build-porting-standalone-code"><span class="std std-ref">Integrating Code with Standalone Build System</span></a>.</p></li>
</ul>
</div>
</section>
</section>
</section>
<section id="best-practices">
<h1>Best Practices<a class="headerlink" href="#best-practices" title="Link to this heading"></a></h1>
<section id="modifying-existing-component-build-config">
<span id="build-modify-existing-component-build-config"></span><h2>Modifying Existing Component Build Config<a class="headerlink" href="#modifying-existing-component-build-config" title="Link to this heading"></a></h2>
<p>Refer to the instructions in <a class="reference internal" href="#build-component-cmake-structure"><span class="std std-ref">Component Compilation CMakeLists.txt</span></a>, utilize <a class="reference internal" href="#build-some-types-for-logic-process"><span class="std std-ref">Useful Types for Complex Logic Processing</span></a>, and note that APIs from <a class="reference internal" href="#build-cmake-api-list"><span class="std std-ref">List Operations</span></a> can be called multiple times. Below are some examples:</p>
<ul>
<li><p>Add public header file paths. It is recommended to use relative paths:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">ameba_list_append</span><span class="p">(</span><span class="s">public_includes</span>
<span class="w">    </span><span class="o">${</span><span class="nv">CMAKE_CURRENT_SOURCE_DIR</span><span class="o">}</span><span class="w">        </span><span class="c"># Access current dir by CMAKE_CURRENT_SOURCE_DIR, same as .</span>
<span class="w">    </span><span class="o">${</span><span class="nv">CMAKE_CURRENT_SOURCE_DIR</span><span class="o">}</span><span class="s">/foo</span><span class="w">    </span><span class="c"># Access sub dir by CMAKE_CURRENT_SOURCE_DIR, same as ./foo</span>
<span class="w">    </span><span class="s">foo</span><span class="w">                                </span><span class="c"># Access sub dir directly</span>
<span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>Add the link library paths. For the variables used here, you can refer to <a class="reference internal" href="#build-cmake-api-some-const-variable-mcu-proj"><span class="std std-ref">MCU Project-related Constants</span></a>:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">ameba_list_append</span><span class="p">(</span><span class="s">public_libraries</span>
<span class="w">    </span><span class="o">${</span><span class="nv">c_SDK_LIB_APP_DIR</span><span class="o">}</span><span class="s">/lib_foo.a</span>
<span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>Add private sources. It is recommended to use relative paths:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">ameba_list_append</span><span class="p">(</span><span class="s">private_sources</span>
<span class="w">    </span><span class="s">foo/foo.c</span>
<span class="w">    </span><span class="s">bar/bar.c</span>
<span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>Add private header file paths. It is recommended to use relative paths:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">ameba_list_append</span><span class="p">(</span><span class="s">public_includes</span>
<span class="w">    </span><span class="s">../common</span><span class="w">  </span><span class="c"># Access parent dir</span>
<span class="w">    </span><span class="s">foo</span>
<span class="w">    </span><span class="s">bar</span>
<span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>Add definitions:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">ameba_list_append</span><span class="p">(</span><span class="s">private_definitions</span>
<span class="w">    </span><span class="s">__RTOS__</span>
<span class="w">    </span><span class="s">MBEDTLS_CONFIG_FILE=</span><span class="s2">&quot;mbedtls/config.h&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>Add compile options:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">ameba_list_append</span><span class="p">(</span><span class="s">private_compile_options</span>
<span class="w">    </span><span class="s">-Wno-unused-parameter</span>
<span class="p">)</span>
</pre></div>
</div>
</li>
</ul>
</section>
<section id="quickly-compile-link-source-files-for-testing">
<span id="build-compile-some-source-and-link-to-image"></span><h2>Quickly Compile &amp; Link Source Files for Testing<a class="headerlink" href="#quickly-compile-link-source-files-for-testing" title="Link to this heading"></a></h2>
<p>Steps:</p>
<ol class="arabic">
<li><p>Copy <code class="file docutils literal notranslate"><span class="pre">cmake/CMakeLists-template.cmake</span></code> to your source directory as <code class="file docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code>.</p></li>
<li><p>Refer to <a class="reference internal" href="#build-modify-existing-component-build-config"><span class="std std-ref">Modifying Existing Component Build Config</span></a> configure <a class="reference internal" href="#build-component-cmake-public-part"><span class="std std-ref">Component Public Part</span></a> and <a class="reference internal" href="#build-component-cmake-private-part"><span class="std std-ref">Component Private Part</span></a>.</p></li>
<li><p>Select <a class="reference internal" href="#build-ameba-add-internal-library"><span class="std std-ref">ameba_add_internal_library</span></a> in <a class="reference internal" href="#build-component-cmake-private-part"><span class="std std-ref">Component Private Part</span></a>.</p></li>
<li><p>Refer to <a class="reference internal" href="#build-cmake-project-structure"><span class="std std-ref">CMakeLists.txt invocation relationships</span></a> add the component directory in the firmware’s <code class="file docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code>:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">ameba_add_subdirectory</span><span class="p">(</span><span class="s">path/to/your/cmakelists</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>Compile and test</p></li>
</ol>
</section>
<section id="integrating-code-with-standalone-build-system">
<span id="build-porting-standalone-code"></span><h2>Integrating Code with Standalone Build System<a class="headerlink" href="#integrating-code-with-standalone-build-system" title="Link to this heading"></a></h2>
<p>For third-party code with independent build systems (e.g., CMake/Makefile-based components), non-intrusive integration solutions can be implemented to link them into the firmware. Specific adaptation strategies should be selected based on their build system types:</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-0-0-0" aria-selected="true" class="sphinx-tabs-tab" id="tab-0-0-0" name="0-0" role="tab" tabindex="0">CMake</button><button aria-controls="panel-0-0-1" aria-selected="false" class="sphinx-tabs-tab" id="tab-0-0-1" name="0-1" role="tab" tabindex="-1">Makefile</button></div><div aria-labelledby="tab-0-0-0" class="sphinx-tabs-panel" id="panel-0-0-0" name="0-0" role="tabpanel" tabindex="0"><ol class="arabic">
<li><p>Create a wrapper <code class="file docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> in some directory using the template <code class="file docutils literal notranslate"><span class="pre">cmake/CMakeLists-template.cmake</span></code>.</p></li>
<li><p>Refer to <a class="reference internal" href="#build-modify-existing-component-build-config"><span class="std std-ref">Modifying Existing Component Build Config</span></a> to config <a class="reference internal" href="#build-component-cmake-public-part"><span class="std std-ref">Component Public Part</span></a></p></li>
<li><p>In <a class="reference internal" href="#build-component-cmake-private-part"><span class="std std-ref">Component Private Part</span></a>, add the original CMake project via <code class="xref py py-func docutils literal notranslate"><span class="pre">ameba_add_subdirectory()</span></code> and use <a class="reference internal" href="#build-ameba-port-standalone-internal-library"><span class="std std-ref">ameba_port_standalone_internal_library</span></a> to link the target:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">ameba_add_subdirectory</span><span class="p">(</span><span class="s">path/to/your/cmakelists</span><span class="p">)</span><span class="w"> </span><span class="c"># Add the real CMakeLists.txt dir of the wrapped component</span>
<span class="nb">ameba_port_standalone_internal_library</span><span class="p">(</span><span class="s">foo</span><span class="p">)</span><span class="w">     </span><span class="c"># Add the real target of the wrapped component to link</span>
</pre></div>
</div>
</li>
<li><p>Refer to <a class="reference internal" href="#build-cmake-project-structure"><span class="std std-ref">CMakeLists.txt invocation relationships</span></a> add the component directory in the firmware’s <code class="file docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code>:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">ameba_add_subdirectory</span><span class="p">(</span><span class="s">path/to/your/wrap/cmakelists</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>Compile and test</p></li>
</ol>
</div><div aria-labelledby="tab-0-0-1" class="sphinx-tabs-panel" hidden="true" id="panel-0-0-1" name="0-1" role="tabpanel" tabindex="0"><ol class="arabic">
<li><p>Create a wrapper <code class="file docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> in some directory using the template <code class="file docutils literal notranslate"><span class="pre">cmake/CMakeLists-template.cmake</span></code>.</p></li>
<li><p>Refer to <a class="reference internal" href="#build-modify-existing-component-build-config"><span class="std std-ref">Modifying Existing Component Build Config</span></a> to configure the <a class="reference internal" href="#build-component-cmake-public-part"><span class="std std-ref">Component Public Part</span></a>, specifically setting the <code class="docutils literal notranslate"><span class="pre">public_libraries</span></code> variable to the path of the final library file.</p></li>
<li><p>In <a class="reference internal" href="#build-component-cmake-private-part"><span class="std std-ref">Component Private Part</span></a>, Use <code class="docutils literal notranslate"><span class="pre">add_custom_target</span></code> to invoke makefile as below:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">add_custom_target</span><span class="p">(</span><span class="s">foo</span><span class="w"> </span><span class="s">ALL</span><span class="w">                                     </span><span class="c"># Replace foo with new name as you wish</span>
<span class="w">    </span><span class="s">COMMAND</span><span class="w"> </span><span class="o">${</span><span class="nv">CMAKE_COMMAND</span><span class="o">}</span><span class="w"> </span><span class="s">-E</span><span class="w"> </span><span class="s">echo</span><span class="w"> </span><span class="s2">&quot;Building foo project&quot;</span><span class="w">   </span><span class="c"># Some prompt message while building</span>
<span class="w">    </span><span class="s">COMMAND</span><span class="w"> </span><span class="s">make</span><span class="w"> </span><span class="s">-j</span><span class="w"> </span><span class="s">-C</span><span class="w"> </span><span class="s">/path/to/your/makefile</span><span class="w"> </span><span class="s">all</span><span class="w">             </span><span class="c"># Set your makefile path</span>
<span class="w">    </span><span class="s">COMMENT</span><span class="w"> </span><span class="s2">&quot;Building foo project using make&quot;</span>
<span class="p">)</span>

<span class="nb">ameba_target_depend</span><span class="p">(</span><span class="o">${</span><span class="nv">c_CURRENT_IMAGE</span><span class="o">}</span><span class="w"> </span><span class="s">foo</span><span class="p">)</span><span class="w">                   </span><span class="c"># Add dependency, foo MUST be same as in add_custom_target above</span>
</pre></div>
</div>
</li>
<li><p>Refer to <a class="reference internal" href="#build-cmake-project-structure"><span class="std std-ref">CMakeLists.txt invocation relationships</span></a> add the component directory in the firmware’s <code class="file docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code>:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">ameba_add_subdirectory</span><span class="p">(</span><span class="s">path/to/your/wrap/cmakelists</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>Compile and test</p></li>
</ol>
</div></div>
</section>
<section id="adjusting-submodule-organization-relationships-in-components">
<h2>Adjusting Submodule Organization Relationships in Components<a class="headerlink" href="#adjusting-submodule-organization-relationships-in-components" title="Link to this heading"></a></h2>
<p>When a component is complex and contains multiple subcomponents, the <code class="file docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> in the component root directory should manage their organizational relationships. Pay attention to:</p>
<ul>
<li><p><strong>Configuration Checks</strong>: Since <strong>MCU projects generally don’t check switches and directly add components</strong>, configuration checks must be performed here. Example from <code class="file docutils literal notranslate"><span class="pre">component/bluetooth/CMakeLists.txt</span></code>:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">if</span><span class="p">(</span><span class="s">NOT</span><span class="w"> </span><span class="s">CONFIG_BT</span><span class="p">)</span>
<span class="w">    </span><span class="nb">ameba_info</span><span class="p">(</span><span class="s2">&quot;CONFIG_BT is off, bluetooth will not be built&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nb">return</span><span class="p">()</span>
<span class="nb">endif</span><span class="p">()</span>
</pre></div>
</div>
</li>
<li><p><strong>Subcomponent Addition Logic</strong>: When splitting subcomponents, handle the addition logic using <a class="reference internal" href="#build-some-types-for-logic-process"><span class="std std-ref">Useful Types for Complex Logic Processing</span></a> Example from <code class="file docutils literal notranslate"><span class="pre">component/bluetooth/CMakeLists.txt</span></code>:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">ameba_add_subdirectory_ifnot</span><span class="p">(</span><span class="s">CONFIG_BT_INIC</span><span class="w"> </span><span class="s">api</span><span class="p">)</span>
<span class="nb">ameba_add_subdirectory_if</span><span class="p">(</span><span class="s">CONFIG_BT_AUDIO_CODEC_SUPPORT</span><span class="w"> </span><span class="s">bt_audio</span><span class="p">)</span>
<span class="nb">ameba_add_subdirectory</span><span class="p">(</span><span class="s">bt_mp</span><span class="p">)</span>
<span class="nb">ameba_add_subdirectory</span><span class="p">(</span><span class="s">driver</span><span class="p">)</span>
<span class="nb">ameba_add_subdirectory_ifnot</span><span class="p">(</span><span class="s">CONFIG_BT_INIC</span><span class="w"> </span><span class="s">example</span><span class="p">)</span>
<span class="nb">ameba_add_subdirectory</span><span class="p">(</span><span class="s">osif</span><span class="p">)</span>
<span class="nb">ameba_add_subdirectory</span><span class="p">(</span><span class="s">rtk_coex</span><span class="p">)</span>
<span class="nb">if</span><span class="p">(</span><span class="s">CONFIG_BT_ZEPHYR</span><span class="p">)</span>
<span class="w">    </span><span class="nb">ameba_add_subdirectory</span><span class="p">(</span><span class="s">zephyr</span><span class="p">)</span>
<span class="nb">elseif</span><span class="p">(</span><span class="s">NOT</span><span class="w"> </span><span class="s">CONFIG_BT_INIC</span><span class="p">)</span>
<span class="w">    </span><span class="nb">ameba_add_subdirectory</span><span class="p">(</span><span class="s">rtk_stack</span><span class="p">)</span><span class="w">  </span><span class="c"># refer to ble_mesh_stack</span>
<span class="nb">endif</span><span class="p">()</span>
</pre></div>
</div>
</li>
</ul>
</section>
<section id="adding-new-components-in-component-directory">
<h2>Adding New Components in Component Directory<a class="headerlink" href="#adding-new-components-in-component-directory" title="Link to this heading"></a></h2>
<p>To add a new independent component:</p>
<ol class="arabic">
<li><p>Add component path variables in <code class="file docutils literal notranslate"><span class="pre">cmake/global_define.cmake</span></code> as below:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">ameba_set</span><span class="p">(</span><span class="s">c_CMPT_WIFI_DIR</span><span class="w">         </span><span class="o">${</span><span class="nv">c_COMPONENT_DIR</span><span class="o">}</span><span class="s">/wifi</span><span class="p">)</span>
<span class="nb">ameba_set</span><span class="p">(</span><span class="s">c_CMPT_WPAN_DIR</span><span class="w">         </span><span class="o">${</span><span class="nv">c_COMPONENT_DIR</span><span class="o">}</span><span class="s">/wpan</span><span class="p">)</span>

<span class="nb">ameba_set</span><span class="p">(</span><span class="s">c_CMPT_CRASHDUMP_DIR</span><span class="w">    </span><span class="o">${</span><span class="nv">c_COMPONENT_DIR</span><span class="o">}</span><span class="s">/soc/common/crashdump</span><span class="p">)</span>
<span class="nb">ameba_set</span><span class="p">(</span><span class="s">c_CMPT_LZMA_DIR</span><span class="w">         </span><span class="o">${</span><span class="nv">c_COMPONENT_DIR</span><span class="o">}</span><span class="s">/soc/common/lzma</span><span class="p">)</span>

<span class="hll"><span class="nb">ameba_set</span><span class="p">(</span><span class="s">c_CMPT_FOO_DIR</span><span class="w">         </span><span class="o">${</span><span class="nv">c_COMPONENT_DIR</span><span class="o">}</span><span class="s">/foo</span><span class="p">)</span><span class="w">  </span><span class="c"># new component</span>
</span></pre></div>
</div>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>For SOC/MCU-related components, add them in the <code class="xref py py-func docutils literal notranslate"><span class="pre">ameba_reset_global_define()</span></code> macro:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">macro</span><span class="p">(</span><span class="s">ameba_reset_global_define</span><span class="p">)</span>
<span class="w">    </span><span class="nb">ameba_set</span><span class="p">(</span><span class="s">c_CMPT_USRCFG_DIR</span><span class="w"> </span><span class="o">${</span><span class="nv">c_COMPONENT_DIR</span><span class="o">}</span><span class="s">/soc/usrcfg/</span><span class="o">${</span><span class="nv">c_SOC_TYPE</span><span class="o">}</span><span class="p">)</span>
<span class="w">    </span><span class="nb">ameba_set</span><span class="p">(</span><span class="s">c_CMPT_BOOTLOADER_DIR</span><span class="w"> </span><span class="o">${</span><span class="nv">c_CMPT_SOC_DIR</span><span class="o">}</span><span class="s">/bootloader</span><span class="p">)</span>

<span class="hll"><span class="w">    </span><span class="nb">ameba_set</span><span class="p">(</span><span class="s">c_CMPT_FOO_DIR</span><span class="w"> </span><span class="o">${</span><span class="nv">c_CMPT_SOC_DIR</span><span class="o">}</span><span class="s">/foo</span><span class="p">)</span><span class="w">  </span><span class="c"># new component</span>
</span><span class="nb">endmacro</span><span class="p">()</span>
</pre></div>
</div>
</div>
</li>
<li><p>Create component directory under <code class="file docutils literal notranslate"><span class="pre">component</span></code> and add <code class="file docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> following <a class="reference internal" href="#build-component-cmake-structure"><span class="std std-ref">Component Compilation CMakeLists.txt</span></a>.</p></li>
<li><p>Add in firmware’s <code class="file docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code>:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">ameba_add_subdirectory</span><span class="p">(</span><span class="o">${</span><span class="nv">c_CMPT_FOO_DIR</span><span class="o">}</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ol>
</section>
</section>
<section id="commonly-used-cmake-interfaces-and-preset-constants">
<h1>Commonly Used CMake Interfaces and Preset Constants<a class="headerlink" href="#commonly-used-cmake-interfaces-and-preset-constants" title="Link to this heading"></a></h1>
<section id="list-operations">
<span id="build-cmake-api-list"></span><h2>List Operations<a class="headerlink" href="#list-operations" title="Link to this heading"></a></h2>
<section id="ameba-list-append">
<h3>ameba_list_append<a class="headerlink" href="#ameba-list-append" title="Link to this heading"></a></h3>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">ameba_list_append</span><span class="p">(</span><span class="s">&lt;list_name&gt;</span><span class="w"> </span><span class="s">[&lt;value&gt;</span><span class="w"> </span><span class="s">...]</span><span class="p">)</span>
</pre></div>
</div>
<p>Appends elements to a list, supports appending multiple elements. Parameter description:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">list_name</span></code>: List variable name</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">value</span></code>: Value(s) to append</p></li>
</ul>
</section>
<section id="ameba-list-append-if">
<h3>ameba_list_append_if<a class="headerlink" href="#ameba-list-append-if" title="Link to this heading"></a></h3>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">ameba_list_append_if</span><span class="p">(</span><span class="s">&lt;condition&gt;</span><span class="w"> </span><span class="s">&lt;list_name&gt;</span><span class="w"> </span><span class="s">[&lt;value&gt;</span><span class="w"> </span><span class="s">...]</span><span class="w"> </span><span class="s">[p_ELSE</span><span class="w"> </span><span class="s">&lt;else</span><span class="w"> </span><span class="s">value&gt;</span><span class="w"> </span><span class="s">...]</span><span class="p">)</span>
</pre></div>
</div>
<p>Appends elements to a list conditionally, supports appending multiple elements. Parameter description:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">condition</span></code>: Variable name representing the condition</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">list_name</span></code>: List variable name</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">value</span></code>: Value(s) to append when <code class="docutils literal notranslate"><span class="pre">condition</span></code> is true</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">p_ELSE</span></code>: Optional keyword parameter, followed by value(s) to append when <code class="docutils literal notranslate"><span class="pre">condition</span></code> is false</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">else</span> <span class="pre">value</span></code>: Value(s) to append when <code class="docutils literal notranslate"><span class="pre">condition</span></code> is false</p></li>
</ul>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>If the variable represented by <code class="docutils literal notranslate"><span class="pre">condition</span></code> is undefined or defined with a bool value of <code class="docutils literal notranslate"><span class="pre">FALSE</span></code>, it will be considered as false.</p>
</div>
</section>
<section id="ameba-list-append-ifnot">
<h3>ameba_list_append_ifnot<a class="headerlink" href="#ameba-list-append-ifnot" title="Link to this heading"></a></h3>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">ameba_list_append_ifnot</span><span class="p">(</span><span class="s">&lt;condition&gt;</span><span class="w"> </span><span class="s">&lt;list_name&gt;</span><span class="w"> </span><span class="s">[&lt;value&gt;</span><span class="w"> </span><span class="s">...]</span><span class="w"> </span><span class="s">[p_ELSE</span><span class="w"> </span><span class="s">&lt;else</span><span class="w"> </span><span class="s">value&gt;</span><span class="w"> </span><span class="s">...]</span><span class="p">)</span>
</pre></div>
</div>
<p>Appends elements to a list conditionally (opposite functionality to <code class="xref py py-func docutils literal notranslate"><span class="pre">ameba_list_append_if()</span></code>). Parameter description:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">condition</span></code>: Variable name representing the condition</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">list_name</span></code>: List variable name</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">value</span></code>: Value(s) to append when <code class="docutils literal notranslate"><span class="pre">condition</span></code> is false</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">p_ELSE</span></code>: Optional keyword parameter, followed by value(s) to append when <code class="docutils literal notranslate"><span class="pre">condition</span></code> is true</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">else</span> <span class="pre">value</span></code>: Value(s) to append when <code class="docutils literal notranslate"><span class="pre">condition</span></code> is true</p></li>
</ul>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>If the variable represented by <code class="docutils literal notranslate"><span class="pre">condition</span></code> is undefined or defined with a bool value of <code class="docutils literal notranslate"><span class="pre">FALSE</span></code>, it will be considered as false.</p>
</div>
</section>
<section id="ameba-list-append-ifdef">
<h3>ameba_list_append_ifdef<a class="headerlink" href="#ameba-list-append-ifdef" title="Link to this heading"></a></h3>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">ameba_list_append_ifdef</span><span class="p">(</span><span class="s">&lt;condition&gt;</span><span class="w"> </span><span class="s">&lt;list_name&gt;</span><span class="w"> </span><span class="s">[&lt;value&gt;</span><span class="w"> </span><span class="s">...]</span><span class="w"> </span><span class="s">[p_ELSE</span><span class="w"> </span><span class="s">&lt;else</span><span class="w"> </span><span class="s">value&gt;</span><span class="w"> </span><span class="s">...]</span><span class="p">)</span>
</pre></div>
</div>
<p>Appends elements to a list based on variable definition status. Parameter description:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">condition</span></code>: Variable name representing the condition</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">list_name</span></code>: List variable name</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">value</span></code>: Value(s) to append when <code class="docutils literal notranslate"><span class="pre">condition</span></code> is defined (Note: <code class="docutils literal notranslate"><span class="pre">condition</span></code> can be <code class="docutils literal notranslate"><span class="pre">FALSE</span></code>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">p_ELSE</span></code>: Optional keyword parameter, followed by value(s) to append when <code class="docutils literal notranslate"><span class="pre">condition</span></code> is undefined</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">else</span> <span class="pre">value</span></code>: Value(s) to append when <code class="docutils literal notranslate"><span class="pre">condition</span></code> is undefined</p></li>
</ul>
</section>
</section>
<section id="add-library">
<span id="build-cmake-api-add-library"></span><h2>Add Library<a class="headerlink" href="#add-library" title="Link to this heading"></a></h2>
<p>The following APIs are used to compile code into static libraries or to perform further processing on existing targets.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>These APIs have the following characteristics:</p>
<ul class="simple">
<li><p>The firmware that links the static library <strong>depends on which firmware’s</strong> <code class="file docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> it is added in. For example, if added in <a class="reference internal" href="#build-cmake-project-structure"><span class="std std-ref">image2/CMakeLists.txt</span></a>, the static library will be linked to firmware <code class="docutils literal notranslate"><span class="pre">image2</span></code>.</p></li>
<li><p>The actual target name generated by the <code class="docutils literal notranslate"><span class="pre">name</span></code> parameter in these APIs is combined with other information such as <a class="reference internal" href="#build-cmake-api-some-const-variable"><span class="std std-ref">c_MCU_PROJECT_NAME</span></a> and <a class="reference internal" href="#build-cmake-api-some-const-variable"><span class="std std-ref">c_CURRENT_IMAGE</span></a>. Users can obtain the real target name using the variable <code class="docutils literal notranslate"><span class="pre">c_CURRENT_TARGET_NAME</span></code> after API calls.</p></li>
<li><p>These APIs internally apply <a class="reference internal" href="#build-global-compile-config"><span class="std std-ref">Global Compilation Configuration</span></a> to compile the current target.</p></li>
</ul>
</div>
<section id="ameba-add-internal-library">
<span id="build-ameba-add-internal-library"></span><h3>ameba_add_internal_library<a class="headerlink" href="#ameba-add-internal-library" title="Link to this heading"></a></h3>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">ameba_add_internal_library</span><span class="p">(</span><span class="s">&lt;name&gt;</span>
<span class="w">                           </span><span class="s">[p_SOURCES</span><span class="w"> </span><span class="s">&lt;sources&gt;</span><span class="w"> </span><span class="s">...]</span>
<span class="w">                           </span><span class="s">[p_INCLUDES</span><span class="w"> </span><span class="s">&lt;include</span><span class="w"> </span><span class="s">dirs&gt;</span><span class="w"> </span><span class="s">...]</span>
<span class="w">                           </span><span class="s">[p_COMPILE_OPTIONS</span><span class="w"> </span><span class="s">&lt;compile</span><span class="w"> </span><span class="s">options&gt;</span><span class="w"> </span><span class="s">...]</span>
<span class="w">                           </span><span class="s">[p_DEFINITIONS</span><span class="w"> </span><span class="s">&lt;definitions&gt;</span><span class="w"> </span><span class="s">...]</span>
<span class="w">                           </span><span class="s">[p_DEPENDENCIES</span><span class="w"> </span><span class="s">&lt;dependencies&gt;</span><span class="w"> </span><span class="s">...]</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Adds a static library, compiles it, and <strong>automatically links the target to the current firmware</strong>. The library file is generated under the <code class="file docutils literal notranslate"><span class="pre">build</span></code> directory. Parameter descriptions:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">name</span></code>: Target name. The actual library file is <code class="docutils literal notranslate"><span class="pre">lib_${name}.a</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">p_SOURCES</span></code>: Source files for the target.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">p_INCLUDES</span></code>: Include directories for the target.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">p_COMPILE_OPTIONS</span></code>: Compile options for the target.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">p_DEFINITIONS</span></code>: Preprocessor definitions for the target.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">p_DEPENDENCIES</span></code>: Dependencies for the target.</p></li>
</ul>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>The library file generated by this API resides in the build directory. It does not check <code class="docutils literal notranslate"><span class="pre">CONFIG_AMEBA_RLS</span></code> internally and is always active.</p>
</div>
</section>
<section id="ameba-port-standalone-internal-library">
<span id="build-ameba-port-standalone-internal-library"></span><h3>ameba_port_standalone_internal_library<a class="headerlink" href="#ameba-port-standalone-internal-library" title="Link to this heading"></a></h3>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">ameba_port_standalone_internal_library</span><span class="p">(</span><span class="s">&lt;name&gt;</span><span class="p">)</span>
</pre></div>
</div>
<p>Links an <strong>existing</strong> static library target <strong>to the current firmware</strong>:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">name</span></code>: Target name.</p></li>
</ul>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Particularly useful for non-intrusive adaptation of third-party library <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> refer to <a class="reference internal" href="#build-porting-standalone-code"><span class="std std-ref">Integrating Code with Standalone Build System</span></a>.</p>
</div>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>This API does not check <code class="docutils literal notranslate"><span class="pre">CONFIG_AMEBA_RLS</span></code> internally and is always active.</p>
</div>
</section>
<section id="ameba-add-external-app-library">
<span id="build-ameba-add-external-app-library"></span><h3>ameba_add_external_app_library<a class="headerlink" href="#ameba-add-external-app-library" title="Link to this heading"></a></h3>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">ameba_add_external_app_library</span><span class="p">(</span><span class="s">&lt;name&gt;</span>
<span class="w">                               </span><span class="s">[p_SOURCES</span><span class="w"> </span><span class="s">&lt;sources&gt;</span><span class="w"> </span><span class="s">...]</span>
<span class="w">                               </span><span class="s">[p_INCLUDES</span><span class="w"> </span><span class="s">&lt;include</span><span class="w"> </span><span class="s">dirs&gt;</span><span class="w"> </span><span class="s">...]</span>
<span class="w">                               </span><span class="s">[p_COMPILE_OPTIONS</span><span class="w"> </span><span class="s">&lt;compile</span><span class="w"> </span><span class="s">options&gt;</span><span class="w"> </span><span class="s">...]</span>
<span class="w">                               </span><span class="s">[p_DEFINITIONS</span><span class="w"> </span><span class="s">&lt;definitions&gt;</span><span class="w"> </span><span class="s">...]</span>
<span class="w">                               </span><span class="s">[p_DEPENDENCIES</span><span class="w"> </span><span class="s">&lt;dependencies&gt;</span><span class="w"> </span><span class="s">...]</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Adds a static library, compiles it, but <strong>does not automatically link the target to the current firmware</strong>. It must be specified in <a class="reference internal" href="#build-component-cmake-public-part"><span class="std std-ref">Component Public Part</span></a>. The library file is output to the <code class="docutils literal notranslate"><span class="pre">${c_SDK_LIB_APP_DIR}</span></code> directory (see <a class="reference internal" href="#build-cmake-api-some-const-variable-mcu-proj"><span class="std std-ref">MCU Project-related Constants</span></a>) and undergoes <code class="docutils literal notranslate"><span class="pre">objcopy</span> <span class="pre">-g</span> <span class="pre">-D</span></code> processing. Parameter descriptions:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">name</span></code>: Target name. The actual library file is <code class="docutils literal notranslate"><span class="pre">lib_${name}.a</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">p_SOURCES</span></code>: Source files for the target.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">p_INCLUDES</span></code>: Include directories for the target.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">p_COMPILE_OPTIONS</span></code>: Compile options for the target.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">p_DEFINITIONS</span></code>: Preprocessor definitions for the target.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">p_DEPENDENCIES</span></code>: Dependencies for the target.</p></li>
</ul>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>This API does nothing and returns immediately if <code class="docutils literal notranslate"><span class="pre">CONFIG_AMEBA_RLS</span></code> is <code class="docutils literal notranslate"><span class="pre">TRUE</span></code>.</p>
</div>
</section>
</section>
<section id="add-subdirectory">
<h2>Add Subdirectory<a class="headerlink" href="#add-subdirectory" title="Link to this heading"></a></h2>
<section id="ameba-add-subdirectory">
<span id="build-ameba-add-subdirectory"></span><h3>ameba_add_subdirectory<a class="headerlink" href="#ameba-add-subdirectory" title="Link to this heading"></a></h3>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">ameba_add_subdirectory</span><span class="p">(</span><span class="s">&lt;dir&gt;</span><span class="p">)</span>
</pre></div>
</div>
<p>Add a directory for compilation. Refer to <a class="reference external" href="https://cmake.org/cmake/help/latest/command/add_subdirectory.html">add_subdirectory</a>. When <code class="docutils literal notranslate"><span class="pre">dir</span></code> is an external path, the last-level directory name will be used as <code class="docutils literal notranslate"><span class="pre">binary_dir</span></code>. Parameter description:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">dir</span></code>: Directory to be added for compilation</p></li>
</ul>
</section>
<section id="ameba-add-subdirectory-if">
<h3>ameba_add_subdirectory_if<a class="headerlink" href="#ameba-add-subdirectory-if" title="Link to this heading"></a></h3>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">ameba_add_subdirectory_if</span><span class="p">(</span><span class="s">&lt;condition&gt;</span><span class="w"> </span><span class="s">&lt;dir&gt;</span><span class="p">)</span>
</pre></div>
</div>
<p>Add a directory for compilation based on specified condition. Other behaviors are same as <a class="reference internal" href="#build-ameba-add-subdirectory"><span class="std std-ref">ameba_add_subdirectory</span></a>. Parameter description:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">condition</span></code>: Variable name representing the condition</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dir</span></code>: Directory to add for compilation when condition is met</p></li>
</ul>
</section>
<section id="ameba-add-subdirectory-ifnot">
<h3>ameba_add_subdirectory_ifnot<a class="headerlink" href="#ameba-add-subdirectory-ifnot" title="Link to this heading"></a></h3>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">ameba_add_subdirectory_ifnot</span><span class="p">(</span><span class="s">&lt;condition&gt;</span><span class="w"> </span><span class="s">&lt;dir&gt;</span><span class="p">)</span>
</pre></div>
</div>
<p>Add a directory for compilation based on specified condition. Other behaviors are same as <a class="reference internal" href="#build-ameba-add-subdirectory"><span class="std std-ref">ameba_add_subdirectory</span></a>. Parameter description:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">condition</span></code>: Variable name representing the condition</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dir</span></code>: Directory to add for compilation when condition is NOT met</p></li>
</ul>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>Variables represented by <code class="docutils literal notranslate"><span class="pre">condition</span></code> that are undefined or defined with a bool value of <code class="docutils literal notranslate"><span class="pre">FALSE</span></code> will be considered unmet</p>
</div>
</section>
<section id="ameba-add-subdirectory-if-exist">
<h3>ameba_add_subdirectory_if_exist<a class="headerlink" href="#ameba-add-subdirectory-if-exist" title="Link to this heading"></a></h3>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">ameba_add_subdirectory_if_exist</span><span class="p">(</span><span class="s">&lt;dir&gt;</span><span class="p">)</span>
</pre></div>
</div>
<p>When path doesn’t exist: silently return if <code class="docutils literal notranslate"><span class="pre">CONFIG_AMEBA_RLS</span></code> is <code class="docutils literal notranslate"><span class="pre">TRUE</span></code>, otherwise throw error. When path exists, behaves same as <a class="reference internal" href="#build-ameba-add-subdirectory"><span class="std std-ref">ameba_add_subdirectory</span></a>. Parameter description:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">dir</span></code>: Directory to add for compilation when path exists</p></li>
</ul>
</section>
</section>
<section id="constants-definition">
<span id="build-cmake-api-some-const-variable"></span><h2>Constants Definition<a class="headerlink" href="#constants-definition" title="Link to this heading"></a></h2>
<p>The CMake script <code class="file docutils literal notranslate"><span class="pre">cmake/global_define.cmake</span></code> defines several constants that can be directly used in script writing. Some examples are listed below:</p>
<section id="general-constants">
<h3>General Constants<a class="headerlink" href="#general-constants" title="Link to this heading"></a></h3>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 30.0%" />
<col style="width: 70.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Variable Name</p></th>
<th class="head"><p>Value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">c_BASEDIR</span></code></p></td>
<td><p>Root dir of the repo</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">c_CMAKE_FILES_DIR</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">${c_BASEDIR}/cmake</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">c_COMPONENT_DIR</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">${c_BASEDIR}/component</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">c_EMPTY_C_FILE</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">${c_CMAKE_FILES_DIR}/empty_file.c</span></code></p></td>
</tr>
</tbody>
</table>
</section>
<section id="soc-project-related-constants">
<h3>SOC Project-related Constants<a class="headerlink" href="#soc-project-related-constants" title="Link to this heading"></a></h3>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 30.0%" />
<col style="width: 70.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Variable Name</p></th>
<th class="head"><p>Value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">c_SOC_TYPE</span></code></p></td>
<td><p>One of [“amebadplus”, “amebalite”, “amebasmart”]</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">c_SOC_TYPE_UPPER</span></code></p></td>
<td><p>One of [“AMEBADPLUS”, “AMEBALITE”, “AMEBASMART”]</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">c_SOC_TYPE_CAMEL</span></code></p></td>
<td><p>One of [“AebaDplus”, “AmebaLite”, “AmebaSmart”]</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">c_SOC_PROJECT_DIR</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">${c_BASEDIR}/${c_SOC_TYPE}_gcc_project</span></code></p></td>
</tr>
</tbody>
</table>
</section>
<section id="mcu-project-related-constants">
<span id="build-cmake-api-some-const-variable-mcu-proj"></span><h3>MCU Project-related Constants<a class="headerlink" href="#mcu-project-related-constants" title="Link to this heading"></a></h3>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 30.0%" />
<col style="width: 70.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Variable Name</p></th>
<th class="head"><p>Value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">c_MCU_TYPE</span></code></p></td>
<td><p>One of [“km0”, “km4”, “kr4”, “ca32”, …]</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">c_MCU_PROJECT_NAME</span></code></p></td>
<td><p>If MCU project folder name is project_xxx, value is xxx</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">c_CURRENT_IMAGE</span></code></p></td>
<td><p>Current image target name, value like: target_img2_km4</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">c_MCU_KCONFIG_FILE</span></code></p></td>
<td><p>Kconfig file path for current MCU project</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">c_MCU_PROJECT_DIR</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">${c_SOC_PROJECT_DIR}/project_${c_MCU_TYPE}</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">c_SDK_LIB_APP_DIR</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">${c_MCU_PROJECT_DIR}/[asdk|vsdk]/lib/application</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">c_SDK_LIB_SOC_DIR</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">${c_MCU_PROJECT_DIR}/[asdk|vsdk]/lib/soc</span></code></p></td>
</tr>
</tbody>
</table>
</section>
<section id="component-related-constants">
<h3>Component-related Constants<a class="headerlink" href="#component-related-constants" title="Link to this heading"></a></h3>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 30.0%" />
<col style="width: 70.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Variable Name</p></th>
<th class="head"><p>Value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">c_CMPT_APP_DIR</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">${c_COMPONENT_DIR}/application</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">c_CMPT_AT_CMD_DIR</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">${c_COMPONENT_DIR}/at_cmd</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">c_CMPT_AUDIO_DIR</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">${c_COMPONENT_DIR}/audio</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">c_CMPT_BLUETOOTH_DIR</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">${c_COMPONENT_DIR}/bluetooth</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">c_CMPT_DYN_APP_DIR</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">${c_COMPONENT_DIR}/dynamic_app</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">c_CMPT_ETHERNET_DIR</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">${c_COMPONENT_DIR}/ethernet</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">c_CMPT_EXAMPLE_DIR</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">${c_COMPONENT_DIR}/example</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">c_CMPT_FILE_SYSTEM_DIR</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">${c_COMPONENT_DIR}/file_system</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">c_CMPT_LWIP_DIR</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">${c_COMPONENT_DIR}/lwip</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">c_CMPT_NETWORK_DIR</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">${c_COMPONENT_DIR}/network</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">c_CMPT_OS_DIR</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">${c_COMPONENT_DIR}/os</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">c_CMPT_RTK_COEX_DIR</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">${c_COMPONENT_DIR}/rtk_coex</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">c_CMPT_SDIO_DIR</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">${c_COMPONENT_DIR}/sdio</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">c_CMPT_SSL_DIR</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">${c_COMPONENT_DIR}/ssl</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">c_CMPT_UI_DIR</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">${c_COMPONENT_DIR}/ui</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">c_CMPT_USB_DIR</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">${c_COMPONENT_DIR}/usb</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">c_CMPT_UTILS_DIR</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">${c_COMPONENT_DIR}/utils</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">c_CMPT_TFLITE_DIR</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">${c_COMPONENT_DIR}/tflite_micro</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">c_CMPT_WIFI_DIR</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">${c_COMPONENT_DIR}/wifi</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">c_CMPT_WPAN_DIR</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">${c_COMPONENT_DIR}/wpan</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">c_CMPT_CRASHDUMP_DIR</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">${c_COMPONENT_DIR}/soc/common/crashdump</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">c_CMPT_LZMA_DIR</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">${c_COMPONENT_DIR}/soc/common/lzma</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">c_CMPT_SOC_DIR</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">${c_COMPONENT_DIR}/soc/${c_SOC_TYPE}</span></code></p></td>
</tr>
</tbody>
</table>
</section>
</section>
</section>
<section id="frequently-asked-questions-suggestions">
<h1>Frequently Asked Questions &amp; Suggestions<a class="headerlink" href="#frequently-asked-questions-suggestions" title="Link to this heading"></a></h1>
<section id="view-detailed-compilation-parameters-of-a-source-file">
<span id="build-check-source-compile-detail"></span><h2>View Detailed Compilation Parameters of a Source File<a class="headerlink" href="#view-detailed-compilation-parameters-of-a-source-file" title="Link to this heading"></a></h2>
<p>Add the following code at the beginning of the target source file or introduce syntax errors, then compile. The compiler will report errors at the corresponding source file location and print detailed compilation parameters.</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="c">#error debug</span>
</pre></div>
</div>
</section>
<section id="undefined-reference-error">
<span id="build-debug-link-error-undefined-reference"></span><h2>Undefined Reference Error<a class="headerlink" href="#undefined-reference-error" title="Link to this heading"></a></h2>
<p>This error typically occurs during the linking stage when generating axf files. Common causes include:</p>
<ul class="simple">
<li><p><strong>Cause 1</strong>: The library containing the symbol is not linked</p></li>
<li><p><strong>Cause 2</strong>: The source file containing the symbol is not compiled</p></li>
<li><p><strong>Cause 3</strong>: The code block containing the symbol is not compiled</p></li>
</ul>
<p>The following uses <code class="docutils literal notranslate"><span class="pre">RTL8721Dx</span></code> as an example to demonstrate troubleshooting steps for the above causes. Below is a sample link error output (partial information retained for demonstration):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="linenos"> 1</span>[5/42] Linking C executable project_km4/asdk/make/image2/target_img2_km4.axf
</span><span class="hll"><span class="linenos"> 2</span>FAILED: project_km4/asdk/make/image2/target_img2_km4.axf
</span><span class="linenos"> 3</span>ccache /opt/rtk-toolchain/asdk-10.3.1-4354/linux/newlib/bin/arm-none-eabi-gcc
<span class="linenos"> 4</span>-O2
<span class="linenos"> 5</span>-o project_km4/asdk/make/image2/target_img2_km4.axf
<span class="linenos"> 6</span>
<span class="linenos"> 7</span>-Wl,--whole-archive
<span class="linenos"> 8</span>project_km4/asdk/make/image2/at_cmd/lib_at_cmd.a
<span class="hll"><span class="linenos"> 9</span>project_km4/asdk/make/image2/swlib/lib_swlib.a
</span><span class="linenos">10</span>project_km4/asdk/make/image2/file_system/fatfs/lib_fatfs.a
<span class="linenos">11</span>project_km4/asdk/make/image2/file_system/littlefs/lib_littlefs.a
<span class="linenos">12</span>project_km4/asdk/make/image2/file_system/kv/lib_kv.a
<span class="linenos">13</span>project_km4/asdk/make/image2/file_system/vfs/lib_vfs.a
<span class="linenos">14</span>project_km4/asdk/make/image2/fwlib/lib_fwlib.a
<span class="linenos">15</span>project_km4/asdk/make/image2/hal/lib_hal.a
<span class="linenos">16</span>project_km4/asdk/make/image2/misc/lib_misc.a
<span class="linenos">17</span>project_km4/asdk/make/image2/lwip/lib_lwip.a
<span class="linenos">18</span>
<span class="linenos">19</span>-Wl,--no-whole-archive
<span class="linenos">20</span>
<span class="linenos">21</span>-lm
<span class="linenos">22</span>-O2
<span class="linenos">23</span>-o project_km4/asdk/make/image2/target_img2_km4.axf
<span class="linenos">24</span>
<span class="linenos">25</span>-Wl,--whole-archive
<span class="linenos">26</span>project_km4/asdk/make/image2/at_cmd/lib_at_cmd.a
<span class="linenos">27</span>project_km4/asdk/make/image2/cmsis-dsp/lib_cmsis_dsp.a
<span class="linenos">28</span>
<span class="linenos">29</span>-Wl,--no-whole-archive
<span class="linenos">30</span>
<span class="linenos">31</span>-lm
<span class="linenos">32</span>-lstdc++
<span class="hll"><span class="linenos">33</span>ld: amebadplus_gcc_project/project_km4/asdk/lib/soc/lib_chipinfo.a(ameba_rom_patch.o): in function `io_assert_failed&#39;:
</span><span class="hll"><span class="linenos">34</span>(.text.io_assert_failed+0x12): undefined reference to `rtk_log_write_nano&#39;
</span></pre></div>
</div>
<p>Key information from highlighted lines 1, 2, 33, 34:</p>
<ul class="simple">
<li><p><strong>MCU Project</strong>: <code class="docutils literal notranslate"><span class="pre">km4</span></code></p></li>
<li><p><strong>Firmware</strong>: image2, <strong>File</strong>: <code class="file docutils literal notranslate"><span class="pre">target_img2_km4.axf</span></code></p></li>
<li><p><strong>Undefined symbol</strong>: <code class="docutils literal notranslate"><span class="pre">rtk_log_write_nano</span></code>, called in function <code class="xref py py-func docutils literal notranslate"><span class="pre">io_assert_failed()</span></code></p></li>
<li><p><strong>Source file</strong>: <code class="file docutils literal notranslate"><span class="pre">log.c</span></code></p></li>
<li><p><strong>Component</strong>: <code class="docutils literal notranslate"><span class="pre">swlib</span></code></p></li>
<li><p><strong>Library</strong>: <code class="file docutils literal notranslate"><span class="pre">lib_swlib.a</span></code></p></li>
</ul>
<p>Troubleshooting steps:</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-1-1-0" aria-selected="true" class="sphinx-tabs-tab" id="tab-1-1-0" name="1-0" role="tab" tabindex="0">Cause 1</button><button aria-controls="panel-1-1-1" aria-selected="false" class="sphinx-tabs-tab" id="tab-1-1-1" name="1-1" role="tab" tabindex="-1">Cause 2</button><button aria-controls="panel-1-1-2" aria-selected="false" class="sphinx-tabs-tab" id="tab-1-1-2" name="1-2" role="tab" tabindex="-1">Cause 3</button></div><div aria-labelledby="tab-1-1-0" class="sphinx-tabs-panel" id="panel-1-1-0" name="1-0" role="tabpanel" tabindex="0"><p><strong>The library containing the symbol is not linked</strong></p>
<ol class="arabic simple">
<li><p>Verify if link parameters contain <code class="file docutils literal notranslate"><span class="pre">lib_swlib.a</span></code></p></li>
<li><p>Line 9 shows <code class="file docutils literal notranslate"><span class="pre">project_km4/asdk/make/image2/swlib/lib_swlib.a</span></code> is linked. If missing, check:</p>
<ul class="simple">
<li><p>Whether <code class="docutils literal notranslate"><span class="pre">swlib</span></code> component is added in image2’s <code class="file docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code></p></li>
<li><p>Check the component’s <code class="file docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code>. If APIs such as <a class="reference internal" href="#build-ameba-add-external-app-library"><span class="std std-ref">ameba_add_external_app_library</span></a> are used, ensure that the <code class="docutils literal notranslate"><span class="pre">public_libraries</span></code> in their <a class="reference internal" href="#build-component-cmake-public-part"><span class="std std-ref">Component Public Part</span></a> are correctly added.</p></li>
</ul>
</li>
</ol>
</div><div aria-labelledby="tab-1-1-1" class="sphinx-tabs-panel" hidden="true" id="panel-1-1-1" name="1-1" role="tabpanel" tabindex="0"><p><strong>The source file containing the symbol is not compiled</strong></p>
<ol class="arabic simple">
<li><p>Search for <code class="file docutils literal notranslate"><span class="pre">log.o</span></code> in CMake’s <code class="file docutils literal notranslate"><span class="pre">build</span></code> directory:</p></li>
</ol>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-2-2-0" aria-selected="true" class="sphinx-tabs-tab" id="tab-2-2-0" name="2-0" role="tab" tabindex="0">Linux</button><button aria-controls="panel-2-2-1" aria-selected="false" class="sphinx-tabs-tab" id="tab-2-2-1" name="2-1" role="tab" tabindex="-1">Windows</button></div><div aria-labelledby="tab-2-2-0" class="sphinx-tabs-panel" id="panel-2-2-0" name="2-0" role="tabpanel" tabindex="0"><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>find<span class="w"> </span>build/project_km4<span class="w"> </span>-name<span class="w"> </span>log.o
</pre></div>
</div>
<p>Sample output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">build</span><span class="o">/</span><span class="n">project_km4</span><span class="o">/</span><span class="n">asdk</span><span class="o">/</span><span class="n">make</span><span class="o">/</span><span class="n">image1</span><span class="o">/</span><span class="n">swlib</span><span class="o">/</span><span class="n">CMakeFiles</span><span class="o">/</span><span class="n">swlib_target_loader_km4</span><span class="o">.</span><span class="n">dir</span><span class="o">/</span><span class="n">log</span><span class="o">.</span><span class="n">o</span>
<span class="hll"><span class="n">build</span><span class="o">/</span><span class="n">project_km4</span><span class="o">/</span><span class="n">asdk</span><span class="o">/</span><span class="n">make</span><span class="o">/</span><span class="n">image2</span><span class="o">/</span><span class="n">swlib</span><span class="o">/</span><span class="n">CMakeFiles</span><span class="o">/</span><span class="n">swlib_target_img2_km4</span><span class="o">.</span><span class="n">dir</span><span class="o">/</span><span class="n">log</span><span class="o">.</span><span class="n">o</span>
</span></pre></div>
</div>
</div><div aria-labelledby="tab-2-2-1" class="sphinx-tabs-panel" hidden="true" id="panel-2-2-1" name="2-1" role="tabpanel" tabindex="0"><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>dir<span class="w"> </span>/s<span class="w"> </span>build<span class="se">\p</span>roject_km4<span class="se">\l</span>og.o
</pre></div>
</div>
<p>Sample output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">C</span><span class="p">:</span>\<span class="n">Users</span>\<span class="n">sdk</span>\<span class="n">amebadplus_gcc_project</span>\<span class="n">build</span>\<span class="n">project_km4</span>\<span class="n">asdk</span>\<span class="n">make</span>\<span class="n">image1</span>\<span class="n">swlib</span>\<span class="n">CMakeFiles</span>\<span class="n">swlib_target_loader_km4</span><span class="o">.</span><span class="n">dir</span>
<span class="mi">2025</span><span class="o">/</span><span class="mi">03</span><span class="o">/</span><span class="mi">12</span>  <span class="mi">14</span><span class="p">:</span><span class="mi">56</span>            <span class="mi">21</span><span class="p">,</span><span class="mi">096</span> <span class="n">log</span><span class="o">.</span><span class="n">o</span>

<span class="hll"><span class="n">C</span><span class="p">:</span>\<span class="n">Users</span>\<span class="n">sdk</span>\<span class="n">amebadplus_gcc_project</span>\<span class="n">build</span>\<span class="n">project_km4</span>\<span class="n">asdk</span>\<span class="n">make</span>\<span class="n">image2</span>\<span class="n">swlib</span>\<span class="n">CMakeFiles</span>\<span class="n">swlib_image2_km4</span><span class="o">.</span><span class="n">dir</span>
</span><span class="hll"><span class="mi">2025</span><span class="o">/</span><span class="mi">03</span><span class="o">/</span><span class="mi">12</span>  <span class="mi">14</span><span class="p">:</span><span class="mi">56</span>            <span class="mi">21</span><span class="p">,</span><span class="mi">096</span> <span class="n">log</span><span class="o">.</span><span class="n">o</span>
</span></pre></div>
</div>
</div></div>
<ol class="arabic simple" start="2">
<li><p>If highlighted entries are missing, check <code class="docutils literal notranslate"><span class="pre">swlib</span></code>’s <code class="file docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> for source file omissions or logic errors</p></li>
</ol>
</div><div aria-labelledby="tab-1-1-2" class="sphinx-tabs-panel" hidden="true" id="panel-1-1-2" name="1-2" role="tabpanel" tabindex="0"><p><strong>The code block containing the symbol is not compiled</strong></p>
<ol class="arabic">
<li><p>Locate <code class="file docutils literal notranslate"><span class="pre">log.o</span></code> using steps from <strong>Cause 2</strong></p></li>
<li><p>Check if <code class="file docutils literal notranslate"><span class="pre">log.o</span></code> contains the symbol using toolchain commands(refer to <a class="reference internal" href="../0_gcc_build_environment/1_gcc_build_environment_toprst.html#install-toolchain"><span class="std std-ref">Installing Toolchain</span></a> get the directory of toolchain):</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-3-3-0" aria-selected="true" class="sphinx-tabs-tab" id="tab-3-3-0" name="3-0" role="tab" tabindex="0">Linux</button><button aria-controls="panel-3-3-1" aria-selected="false" class="sphinx-tabs-tab" id="tab-3-3-1" name="3-1" role="tab" tabindex="-1">Windows</button></div><div aria-labelledby="tab-3-3-0" class="sphinx-tabs-panel" id="panel-3-3-0" name="3-0" role="tabpanel" tabindex="0"><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>/opt/rtk-toolchain/asdk-10.3.1/linux/newlib/bin/arm-none-eabi-nm<span class="w"> </span>build/project_km4/asdk/make/image2/swlib/CMakeFiles/swlib_target_img2_km4.dir/log.o<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-w<span class="w"> </span>rtk_log_write_nano
</pre></div>
</div>
</div><div aria-labelledby="tab-3-3-1" class="sphinx-tabs-panel" hidden="true" id="panel-3-3-1" name="3-1" role="tabpanel" tabindex="0"><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>C:<span class="se">\r</span>tk-toolchain<span class="se">\a</span>sdk-10.3.1-4354<span class="se">\m</span>ingw32<span class="se">\n</span>ewlib<span class="se">\b</span>in<span class="se">\a</span>rm-none-eabi-nm.exe<span class="w"> </span>build<span class="se">\p</span>roject_km4<span class="se">\a</span>sdk<span class="se">\m</span>ake<span class="se">\i</span>mage2<span class="se">\s</span>wlib<span class="se">\C</span>MakeFiles<span class="se">\s</span>wlib_image2_km4.dir<span class="se">\l</span>og.o<span class="w"> </span><span class="p">|</span><span class="w"> </span>findstr<span class="w"> </span>/R<span class="w"> </span><span class="s2">&quot;\&lt;rtk_log_write_nano\&gt;&quot;</span>
</pre></div>
</div>
</div></div>
</li>
<li><p>Valid output should contain (note <code class="docutils literal notranslate"><span class="pre">T</span></code> type):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">00000000</span> <span class="n">T</span> <span class="n">rtk_log_write_nano</span>
</pre></div>
</div>
<p>If missing, check conditional compilation in <code class="file docutils literal notranslate"><span class="pre">log.c</span></code></p>
</li>
</ol>
</div></div>
</section>
<section id="useful-types-for-complex-logic-processing">
<span id="build-some-types-for-logic-process"></span><h2>Useful Types for Complex Logic Processing<a class="headerlink" href="#useful-types-for-complex-logic-processing" title="Link to this heading"></a></h2>
<section id="soc-type">
<span id="build-soc-type"></span><h3>SOC Type<a class="headerlink" href="#soc-type" title="Link to this heading"></a></h3>
<p>Identify SOC types (e.g., <code class="docutils literal notranslate"><span class="pre">amebadplus</span></code>, <code class="docutils literal notranslate"><span class="pre">amebalite</span></code>, <code class="docutils literal notranslate"><span class="pre">amebasmart</span></code>) using variables: <code class="docutils literal notranslate"><span class="pre">CONFIG_AMEBADPLUS</span></code>, <code class="docutils literal notranslate"><span class="pre">CONFIG_AMEBALITE</span></code>, <code class="docutils literal notranslate"><span class="pre">CONFIG_AMEBASMART</span></code></p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">if</span><span class="p">(</span><span class="s">CONFIG_AMEBADPLUS</span><span class="p">)</span>
<span class="w">    </span><span class="c"># Add code for amebadplus here</span>
<span class="nb">elseif</span><span class="p">(</span><span class="s">CONFIG_AMEBALITE</span><span class="p">)</span>
<span class="w">    </span><span class="c"># Add code for amebalite here</span>
<span class="nb">elseif</span><span class="p">(</span><span class="s">CONFIG_AMEBASMART</span><span class="p">)</span>
<span class="w">    </span><span class="c"># Add code for amebasmart here</span>
<span class="nb">endif</span><span class="p">()</span>
</pre></div>
</div>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<ol class="arabic">
<li><p>SOC type distinctions should be minimized. Prefer feature-based configuration switches instead.</p></li>
<li><p>If such usage is mandatory, adhere to the principle of <strong>upward compatibility</strong> to ensure future SOC type additions <strong>require no modification of this logic</strong> (e.g., avoid adding new <code class="docutils literal notranslate"><span class="pre">elseif</span></code> clauses). Example implementation in <code class="file docutils literal notranslate"><span class="pre">component/rtk_coex/CMakeLists.txt</span></code>:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="nb">if</span><span class="p">(</span><span class="s">NOT</span><span class="w"> </span><span class="s">CONFIG_AMEBAD</span><span class="p">)</span>
</span><span class="w">    </span><span class="nb">if</span><span class="w"> </span><span class="p">(</span><span class="s">CONFIG_COEXIST_HOST</span><span class="p">)</span>
<span class="w">        </span><span class="nb">include</span><span class="p">(</span><span class="s">rtk_coex_api.cmake</span><span class="p">)</span>
<span class="w">    </span><span class="nb">endif</span><span class="p">()</span>
<span class="nb">endif</span><span class="p">()</span>
</pre></div>
</div>
</li>
</ol>
</div>
</section>
<section id="mcu-type">
<span id="build-mcu-type"></span><h3>MCU Type<a class="headerlink" href="#mcu-type" title="Link to this heading"></a></h3>
<p>Identify MCU types (e.g., <code class="docutils literal notranslate"><span class="pre">km0</span></code>, <code class="docutils literal notranslate"><span class="pre">km4</span></code>, <code class="docutils literal notranslate"><span class="pre">kr4</span></code>, <code class="docutils literal notranslate"><span class="pre">ca32</span></code>) using string variable <code class="docutils literal notranslate"><span class="pre">c_MCU_TYPE</span></code>:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">if</span><span class="p">(</span><span class="o">${</span><span class="nv">c_MCU_TYPE</span><span class="o">}</span><span class="w"> </span><span class="s">STREQUAL</span><span class="w"> </span><span class="s2">&quot;km0&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="c"># Add code for km0 here</span>
<span class="nb">elseif</span><span class="p">(</span><span class="o">${</span><span class="nv">c_MCU_TYPE</span><span class="o">}</span><span class="w"> </span><span class="s">STREQUAL</span><span class="w"> </span><span class="s2">&quot;km4&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="c"># Add code for km4 here</span>
<span class="nb">elseif</span><span class="p">(</span><span class="o">${</span><span class="nv">c_SOC_TYPE</span><span class="o">}</span><span class="w"> </span><span class="s">STREUQAL</span><span class="w"> </span><span class="s2">&quot;ca32&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="c"># Add code for ca32 here</span>
<span class="nb">endif</span><span class="p">()</span>
</pre></div>
</div>
</section>
</section>
<section id="common-cmake-debugging-methods">
<h2>Common CMake Debugging Methods<a class="headerlink" href="#common-cmake-debugging-methods" title="Link to this heading"></a></h2>
<section id="logging">
<h3>Logging<a class="headerlink" href="#logging" title="Link to this heading"></a></h3>
<p>Use CMake’s built-in <code class="xref py py-func docutils literal notranslate"><span class="pre">message()</span></code> or more readable alternatives: <code class="xref py py-func docutils literal notranslate"><span class="pre">ameba_debug()</span></code>, <code class="xref py py-func docutils literal notranslate"><span class="pre">ameba_info()</span></code>, <code class="xref py py-func docutils literal notranslate"><span class="pre">ameba_warning()</span></code>, <code class="xref py py-func docutils literal notranslate"><span class="pre">ameba_fatal()</span></code>.</p>
<p>Example usage to halt execution for analysis:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">message</span><span class="p">(</span><span class="s">FATAL_ERROR</span><span class="w"> </span><span class="s2">&quot;stop here&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="troubleshooting-common-cmake-errors">
<h3>Troubleshooting Common CMake Errors<a class="headerlink" href="#troubleshooting-common-cmake-errors" title="Link to this heading"></a></h3>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Always check the <strong>first</strong> error in terminal output when troubleshooting CMake issues</p>
</div>
<section id="external-command-parameter-error">
<h4>External Command Parameter Error<a class="headerlink" href="#external-command-parameter-error" title="Link to this heading"></a></h4>
<p>Typically caused by incorrect parameters in <code class="docutils literal notranslate"><span class="pre">COMMAND</span></code> sections of <code class="xref py py-func docutils literal notranslate"><span class="pre">add_custom_target()</span></code> or <code class="xref py py-func docutils literal notranslate"><span class="pre">add_custom_command()</span></code>, often due to empty CMake variables. Sample error output showing CMake’s <code class="docutils literal notranslate"><span class="pre">-E</span></code> usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="n">FAILED</span><span class="p">:</span> <span class="n">build</span><span class="o">/</span><span class="n">lib_atcmd</span><span class="o">.</span><span class="n">a</span>
<span class="hll"><span class="linenos">2</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">cmake</span> <span class="o">-</span><span class="n">E</span> <span class="n">copy</span> <span class="n">build</span><span class="o">/</span><span class="n">lib_atcmd</span><span class="o">.</span><span class="n">a</span>
</span><span class="hll"><span class="linenos">3</span><span class="n">CMake</span> <span class="n">Error</span><span class="p">:</span> <span class="n">cmake</span> <span class="n">version</span> <span class="mf">3.30.2</span>
</span><span class="hll"><span class="linenos">4</span><span class="n">Usage</span><span class="p">:</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">cmake</span> <span class="o">-</span><span class="n">E</span> <span class="o">&lt;</span><span class="n">command</span><span class="o">&gt;</span> <span class="p">[</span><span class="n">arguments</span><span class="o">...</span><span class="p">]</span>
</span><span class="hll"><span class="linenos">5</span><span class="n">Available</span> <span class="n">commands</span><span class="p">:</span>
</span><span class="linenos">6</span><span class="n">capabilities</span>              <span class="o">-</span> <span class="n">Report</span> <span class="n">capabilities</span> <span class="n">built</span> <span class="n">into</span> <span class="n">cmake</span> <span class="ow">in</span> <span class="n">JSON</span> <span class="nb">format</span>
<span class="linenos">7</span><span class="n">cat</span> <span class="p">[</span><span class="o">--</span><span class="p">]</span> <span class="o">&lt;</span><span class="n">files</span><span class="o">&gt;...</span>       <span class="o">-</span> <span class="n">concat</span> <span class="n">the</span> <span class="n">files</span> <span class="ow">and</span> <span class="nb">print</span> <span class="n">them</span> <span class="n">to</span> <span class="n">the</span> <span class="n">standard</span> <span class="n">output</span>
<span class="linenos">8</span><span class="n">chdir</span> <span class="nb">dir</span> <span class="n">cmd</span> <span class="p">[</span><span class="n">args</span><span class="o">...</span><span class="p">]</span>   <span class="o">-</span> <span class="n">run</span> <span class="n">command</span> <span class="ow">in</span> <span class="n">a</span> <span class="n">given</span> <span class="n">directory</span>
<span class="linenos">9</span><span class="o">...</span>
</pre></div>
</div>
<p>Corresponding CMake code example:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="nb">add_custom_command</span><span class="p">(</span>
<span class="linenos">2</span><span class="w">    </span><span class="s">OUTPUT</span><span class="w"> </span><span class="s">lib/lib_atcmd.a</span>
<span class="hll"><span class="linenos">3</span><span class="w">    </span><span class="s">COMMAND</span><span class="w"> </span><span class="o">${</span><span class="nv">CMAKE_COMMAND</span><span class="o">}</span><span class="w"> </span><span class="s">-E</span><span class="w"> </span><span class="s">copy</span><span class="w"> </span><span class="s">build/lib_atcmd.a</span><span class="w"> </span><span class="o">${</span><span class="nv">output_path</span><span class="o">}</span>
</span><span class="linenos">4</span><span class="w">    </span><span class="s">DEPENDS</span><span class="w"> </span><span class="s">build/lib_atcmd.a</span>
<span class="linenos">5</span><span class="p">)</span>
</pre></div>
</div>
<p>This error occurs when <code class="docutils literal notranslate"><span class="pre">${output_path}</span></code> is empty, resulting in incomplete copy command as shown in line 2.</p>
</section>
</section>
</section>
<section id="copied-and-replaced-a-source-file-but-did-not-trigger-recompilation">
<h2>Copied and replaced a source file but did not trigger recompilation<a class="headerlink" href="#copied-and-replaced-a-source-file-but-did-not-trigger-recompilation" title="Link to this heading"></a></h2>
<p>The CMake build system uses incremental compilation by default, meaning it only recompiles when source code or header files change. Its mechanism for detecting changes is ​**based on whether the file’s modification timestamp is newer than the previous build**.</p>
<p>When replacing a file with an older version (via copy-paste) while keeping its original modification timestamp (default behavior in Windows Explorer), the incremental compilation ​**will not be triggered** because the timestamp remains unchanged.</p>
<p>Recommended solutions for Windows environments:
1. ​**Create a new file** and copy the content into it (generates a new timestamp)
2. Use the <code class="docutils literal notranslate"><span class="pre">build.py</span> <span class="pre">-c</span></code> command to clean the build directory</p>
</section>
</section>
<section id="advanced-learning-readings">
<h1>Advanced Learning Readings<a class="headerlink" href="#advanced-learning-readings" title="Link to this heading"></a></h1>
<section id="special-compilation-configurations">
<h2>Special Compilation Configurations<a class="headerlink" href="#special-compilation-configurations" title="Link to this heading"></a></h2>
<section id="set-compilation-configuration-per-source-file">
<h3>Set Compilation Configuration Per Source File<a class="headerlink" href="#set-compilation-configuration-per-source-file" title="Link to this heading"></a></h3>
<p>To set compilation configurations, such as predefined macros, for specific source files. For example, adding a predefined macro <code class="docutils literal notranslate"><span class="pre">__FILE_Z_STR__</span></code> to each source file that expands to the filename string of the corresponding source file. Implementation is as follows:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">ameba_list_append</span><span class="p">(</span><span class="s">private_sources</span>
<span class="w">    </span><span class="s">foo.c</span>
<span class="w">    </span><span class="s">bar.c</span>
<span class="p">)</span>

<span class="nb">foreach</span><span class="p">(</span><span class="s">src</span><span class="w"> </span><span class="o">${</span><span class="nv">private_sources</span><span class="o">}</span><span class="p">)</span>
<span class="w">    </span><span class="nb">cmake_path</span><span class="p">(</span><span class="s">GET</span><span class="w"> </span><span class="s">src</span><span class="w"> </span><span class="s">FILENAME</span><span class="w"> </span><span class="s">filename</span><span class="p">)</span>
<span class="w">    </span><span class="nb">set_source_files_properties</span><span class="p">(</span><span class="o">${</span><span class="nv">src</span><span class="o">}</span><span class="w"> </span><span class="s">PROPERTIES</span><span class="w"> </span><span class="s">COMPILE_DEFINITIONS</span><span class="w"> </span><span class="s2">&quot;__FILE_Z_STR__=\&quot;</span><span class="o">${</span><span class="nv">filename</span><span class="o">}</span><span class="s">\&quot;&quot;)</span>
<span class="s">endforeach(</span><span class="p">)</span>
</pre></div>
</div>
<p>Use the CMake built-in interface <a class="reference external" href="https://cmake.org/cmake/help/latest/command/set_source_files_properties.html">set_source_files_properties</a> to precisely set compilation configurations for each source file.</p>
</section>
<section id="set-compile-options-per-source-file-type">
<h3>Set Compile Options Per Source File Type<a class="headerlink" href="#set-compile-options-per-source-file-type" title="Link to this heading"></a></h3>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">ameba_list_append</span><span class="p">(</span><span class="s">private_compile_options</span>
<span class="w">    </span><span class="s">-Wno-multichar</span><span class="w">                              </span><span class="c"># for both asm/c/cpp language</span>
<span class="w">    </span><span class="o">$&lt;</span><span class="nv">$&lt;COMPILE_LANGUAGE:C</span><span class="o">&gt;</span><span class="s">:-Wno-pointer-sign&gt;</span><span class="w">  </span><span class="c"># for c language only</span>
<span class="w">    </span><span class="o">$&lt;</span><span class="nv">$&lt;COMPILE_LANGUAGE:CXX</span><span class="o">&gt;</span><span class="s">:-Wno-narrowing&gt;</span><span class="w">   </span><span class="c"># for cpp language only</span>
<span class="w">    </span><span class="o">$&lt;</span><span class="nv">$&lt;COMPILE_LANGUAGE:CXX</span><span class="o">&gt;</span><span class="s">:-std=c++17&gt;</span><span class="w">       </span><span class="c"># for cpp language only</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="suppress-compilation-warnings-as-errors">
<h3>Suppress Compilation Warnings as Errors<a class="headerlink" href="#suppress-compilation-warnings-as-errors" title="Link to this heading"></a></h3>
<p>The global compilation configuration in <code class="file docutils literal notranslate"><span class="pre">cmake/flags/common/compile_options.cmake</span></code> enables <code class="docutils literal notranslate"><span class="pre">-Werror</span></code> by default, which ​treats all compilation warnings as errors. To disable this behavior, use one of the following methods:</p>
<ul>
<li><p>​Method 1: Component-Specific Disable. Add compilation options in the target component’s <code class="file docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code>:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">ameba_list_append</span><span class="p">(</span><span class="s">private_compile_options</span>
<span class="hll"><span class="w">    </span><span class="s">-Wno-error</span><span class="w">  </span><span class="c"># Disable warning-as-error for this component</span>
</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>​Method 2: Global Disable. Modify the global configuration file <code class="file docutils literal notranslate"><span class="pre">cmake/flags/common/compile_options.cmake</span></code> and ​comment out the <code class="docutils literal notranslate"><span class="pre">-Werror</span></code> line</p></li>
</ul>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="0_build_system_index.html" class="btn btn-neutral float-left" title="Build System" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="how_to_use_kconfig.html" class="btn btn-neutral float-right" title="Kconfig System" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Realsil.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>

    <!-- 问题反馈按钮和对话框 -->
    

      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
     

    <!-- templates/sidebar_toggle.html -->

<button id="sidebar-toggle-button" aria-label="Toggle sidebar"></button>

<script>
    function sidebarToggleButton() {
        const sidebar = document.querySelector('.wy-nav-side');
        const contentArea = document.querySelector('.wy-nav-content');
        const contentAreaWrap = document.querySelector('.wy-nav-content-wrap');
        const sidebarToggleButton = document.getElementById('sidebar-toggle-button');

        console.log('Sidebar:', sidebar);
        console.log('Content Area:', contentArea);
        console.log('Toggle Button:', sidebarToggleButton);

        if (!sidebar || !contentArea || !sidebarToggleButton) {
            console.error('One or more elements not found');
            return;
        }

        let isSidebarCollapsed = false;

        sidebarToggleButton.addEventListener('click', function() {
            document.documentElement.classList.add('sidebar-transitioning');// 添加过渡类

            if (isSidebarCollapsed) {
                document.documentElement.classList.remove('sidebar-collapsed'); // 改为使用CSS类控制

                sidebar.style.marginLeft = '0px';
                contentAreaWrap.style.marginLeft = '300px';
                contentArea.classList.remove('expanded');

                sidebarToggleButton.style.left = '300px';
            } else {
                document.documentElement.classList.add('sidebar-collapsed');

                sidebar.style.marginLeft = '-300px';
                contentAreaWrap.style.marginLeft = '0px';
                contentArea.classList.add('expanded');

                sidebarToggleButton.style.left = '0px';
            }

            // 同步状态
            isSidebarCollapsed = !isSidebarCollapsed;

            // 过渡结束后移除标记
            setTimeout(() => {
                document.documentElement.classList.remove('sidebar-transitioning');
            }, 300); // 必须与过渡时间匹配
        });
    }
</script>

<style>
    #sidebar-toggle-button {
        position: fixed;
        left: 300px;
        top: 0;
        z-index: 1002;

        width: 4px;  /* 竖线宽度 */
        /* 增加热区 */
        padding: 0 15px; /* 左右各扩展12px点击区域 */
        margin: 0 -15px; /* 抵消padding带来的位置偏移 */
        clip-path: inset(0 -15px); /* 保持视觉宽度4px */

        height: 100vh; /* 竖线高度 */
        background: #2d2d2d;
        border: none;
        border-radius: 2px;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        transform: none;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);

        /* 隐藏原始文字 */
        color: transparent;
        font-size: 0;

        /* 修正交互区域 */
        padding: 0;
        margin: 0;

        /* 新增：防止内容溢出 */
        overflow: visible;

        /* 调整箭头定位 */
        &::before {
            top: 50vh; /* 改为视口中点定位 */
            transform: translateY(-50%);
        }

        &::after {
            top: 50vh;
            transform: translateY(-50%) rotate(45deg);
        }
    }

    /* 动态箭头指示器 */
    #sidebar-toggle-button::before {
        content: '‹';
        position: absolute;
        left: 6px;
        top: 50%;
        width: 24px;
        height: 24px;
        background: #3498db;
        color: white;
        font-size: 18px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        transform: translateY(-50%);
        opacity: 0;
        transition: all 0.3s ease;
        pointer-events: none;
    }

    #sidebar-toggle-button::after {
        content: '';
        position: absolute;

        left: -15px;  /* 向左扩展12px */
        right: -15px; /* 向右扩展12px */

        top: 50%;
        width: 8px;
        height: 8px;
        border: 2px solid white;
        border-width: 2px 2px 0 0;
        transform: translateY(-50%) rotate(45deg);
        opacity: 0;
        transition: all 0.3s ease;
    }

    /* 悬停效果 */
    #sidebar-toggle-button:hover {
        width: 10px;
        background: #2980b9;
    }

    /* 点击动画 */
    #sidebar-toggle-button:active {
        transform: translateY(-50%) scale(0.9);
    }
</style>

<!-- 统一移动速度 -->
<style>
    /* 统一过渡参数 */
    :root {
        --sidebar-transition: 300ms cubic-bezier(0.4, 0, 0.2, 1);
    }

    .wy-nav-side,
    .wy-nav-content-wrap,
    #sidebar-toggle-button {
        transition: all var(--sidebar-transition) !important;
    }

    /* 按钮样式调整 */
    #sidebar-toggle-button {
        left: 300px;
        transition: left var(--sidebar-transition),
                    width 150ms ease, /* 悬停效果保持独立 */
                    background 150ms ease;
    }

    /* 折叠状态 */
    .sidebar-collapsed {
        .wy-nav-side {
            margin-left: -300px !important;
        }

        .wy-nav-content-wrap {
            margin-left: 0 !important;
        }

        #sidebar-toggle-button {
            left: 0 !important;
        }
    }

    /* 禁用点击时的过渡 */
    .sidebar-transitioning {
        .wy-nav-side,
        .wy-nav-content-wrap,
        #sidebar-toggle-button {
            transition: none !important;
        }
    }
</style>

    

    <script>
        // 初始化
        document.addEventListener('DOMContentLoaded', () => {
            

            sidebarToggleButton();
        });


    </script>



</body>
</html>