

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Overview &mdash; Ameba IoT Docs  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
      <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=b947ea82" />
      <link rel="stylesheet" type="text/css" href="../../_static/tabs.css?v=a5c4661c" />
      <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=b947ea82" />

  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="canonical" href="http://172.29.57.206:5000/docs/rst_rtos/0_build_system/1_build_system_toprst.html" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../../_static/toggleprompt.js?v=d7ede5d2"></script>
        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
        <script src="../../_static/tabs.js?v=3030b3cb"></script>
        <script>let toggleHintShow = 'Click to show';</script>
        <script>let toggleHintHide = 'Click to hide';</script>
        <script>let toggleOpenOnPrint = 'true';</script>
        <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="SDK Examples" href="../0_sdk_example/0_sdk_example_index.html" />
    <link rel="prev" title="Build System" href="0_build_system_index.html" />
     

    
        
        <script>
        // 配置豁免路径（需要与后端路由完全匹配）
        const EXEMPT_PATHS = [
            '/_',                     // Sphinx生成路径
            '/_static',               // 静态资源路径
            '/_images',               // 图片资源
            '/auth',                  // 认证端点
            '/login',                 // 登录页面
            '/logout',                // 登出端点
            '/check_session',         // 会话检查
            '/nda_restricted'         // 无权限提示页
        ];

        // 增强型路径检查
        function isExemptPath(targetPath = window.location.pathname) {
            const path = targetPath.toLowerCase();
            const fullExemptPaths = EXEMPT_PATHS.concat(
                EXEMPT_PATHS.map(p => `/en${p}`),  // 英文路径
                EXEMPT_PATHS.map(p => `/zh_CN${p}`) // 中文路径
            );

            return fullExemptPaths.some(exempt => {
                // 精确匹配或前缀匹配
                return path === exempt.toLowerCase() || 
                    path.startsWith(exempt.toLowerCase() + '/');
            });
        }
        </script>
    

    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" rel="stylesheet" />

    <!-- NDA文档输入密码的框 -->
    
<script>
// ▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼ 多语言配置 ▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼
const lang = 'en';  // 使用 Python 字符串切片
const i18n = {
    zh: {
        title: '访问授权',
        username: '用户名',
        password: '密码',
        confirm: '确认',
        cancel: '取消',
        usernameError: '用户名错误',
        userNotExist: '该用户不存在',
        passwordError: '密码错误',
        wrongPassword: '请输入正确的密码',
        accessDenied: '无访问权限',
        noPermission: '您无权查看此内容',
        expiredTitle: '访问已过期',
        expiredMsg: '您的权限已失效<br>有效期：%s 至 %s',
        deniedTitle: '⚠️ 无访问权限',
        contact: '请联系 claire_wang@realsil.com.cn 获取权限'
    },
    en: {
        title: 'Access Required',
        username: 'Username',
        password: 'Password',
        confirm: 'Confirm',
        cancel: 'Cancel',
        usernameError: 'Invalid Username',
        userNotExist: 'User does not exist',
        passwordError: 'Wrong Password',
        wrongPassword: 'Please enter correct password',
        accessDenied: 'Access Denied',
        noPermission: 'You have no permission to view this content',
        expiredTitle: 'Authorization Expired',
        expiredMsg: 'Your access has expired<br>Valid period: %s to %s',
        deniedTitle: '⚠️ Access Denied',
        contact: 'Please contact claire_wang@realsil.com.cn for access'
    }
};
// ▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲ 多语言配置结束 ▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲
</script>

    <!-- 样式模板 -->
    

<style>
    .wy-nav-content {
        max-width: 1100px;
         
    }
    
    .auth-denied {
        padding: 20px;
        background: #f8f9fa;
        border-radius: 4px;
        border: 1px solid #dee2e6;
        text-align: center;
        color: #721c24;
        margin-top: 20px;
    }
    .auth-denied h3 {
        margin-bottom: 10px;
        color: #dc3545;
    }
    
    #report-button {
        position: fixed;
        top: 10px;
        left: 1270px;
        padding: 1px 15px; /* 调整内边距：1px 为上下，5px 为左右 */
        height: 30px; /* 设置固定高度 */
        background-color: #2ecc71;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        z-index: 1000;
    }
    #report-button:hover {
        background-color: #2ecc71;
    }
    
    .feedback-dialog {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        z-index: 1001;
        width: 600px;
    }
    .feedback-dialog textarea {
        width: 100%;
        height: 150px;
        margin-top: 10px;
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 4px;
        resize: vertical;
    }
    .feedback-dialog button {
        margin-top: 10px;
        padding: 8px 16px;
        background-color: #007bff;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
    }
    .feedback-dialog button:hover {
        background-color: #0056b3;
    }

    
    
</style>



    <!-- 注入 TOC 映射和当前页面信息 -->
    

<!-- TOC 映射和当前文档信息 -->
<script>
// 将 Python 字典转换为 JS 对象
const TOC_TITLE_MAP = {"rst_rtos/0_ameba_product": "Products Center", "rst_rtos/0_ameba_product/0_ameba_product_center_index": "Products Center", "rst_rtos/0_ameba_sdk": "Ameba SDK", "rst_rtos/0_ameba_sdk/0_ameba_sdks_index": "Ameba SDK", "rst_rtos/0_ameba_solutions": "Ameba Solutions", "rst_rtos/0_ameba_solutions/0_ameba_solutions_index": "Ameba Solutions", "rst_rtos/0_at_command": "0.8 AT Commands", "rst_rtos/0_at_command/0_at_command_index": "0.8 AT Commands", "rst_rtos/0_build_system": "0.3 Build System", "rst_rtos/0_build_system/0_build_system_index": "0.3 Build System", "rst_rtos/0_file_system": "0.9 Virtual File System", "rst_rtos/0_file_system/0_vfs_index": "0.9 Virtual File System", "rst_rtos/0_ftl": "0.a Flash Translation Layer", "rst_rtos/0_ftl/0_ftl_index": "0.a Flash Translation Layer", "rst_rtos/0_gcc_build_environment": "0.1 GCC Build Environment", "rst_rtos/0_gcc_build_environment/0_gcc_build_index": "0.1 GCC Build Environment", "rst_rtos/0_gdb_debug": "0.2 GDB Debug", "rst_rtos/0_gdb_debug/0_gdb_debug_index": "0.2 GDB Debug", "rst_rtos/0_memory_layout": "0.5 Flash \u0026 RAM Layout", "rst_rtos/0_memory_layout/0_layout_index": "0.5 Flash \u0026 RAM Layout", "rst_rtos/0_sdk_example": "0.4 SDK Example", "rst_rtos/0_sdk_example/0_sdk_example_index": "0.4 SDK Example", "rst_rtos/0_tools": "0.7 Tools", "rst_rtos/0_tools/0_tools_index": "0.7 Tools", "rst_rtos/0_user_config": "0.6 User Config", "rst_rtos/0_user_config/0_usrcfg_index": "0.6 User Config", "rst_rtos/10_api_docs": "10.0 API Reference", "rst_rtos/10_api_docs/0_api_index": "10.0 API Reference", "rst_rtos/1_boot_process": "1.1 Boot Process", "rst_rtos/1_boot_process/0_boot_index": "1.1 Boot Process", "rst_rtos/1_chipen": "1.4 Chip Enable", "rst_rtos/1_chipen/0_chipen_index": "1.4 Chip Enable", "rst_rtos/1_gpio": "1.7 GPIO \u0026 Pin Control", "rst_rtos/1_gpio/0_gpio_index": "1.7 GPIO \u0026 Pin Control", "rst_rtos/1_ipc": "1.5 Inter Processor Communication", "rst_rtos/1_ipc/0_ipc_index": "1.5 Inter Processor Communication", "rst_rtos/1_mpu_cache": "1.0 MPU and Cache", "rst_rtos/1_mpu_cache/0_mpu_cache_index": "1.0 MPU and Cache", "rst_rtos/1_ota": "1.2 OTA", "rst_rtos/1_ota/0_ota_index": "1.2 OTA", "rst_rtos/1_otpc": "1.3 OTPC", "rst_rtos/1_otpc/0_otpc_index": "1.3 OTPC", "rst_rtos/1_pinmux": "1.6 Pin Multiplexing", "rst_rtos/1_pinmux/0_pinmux_index": "1.6 Pin Multiplexing", "rst_rtos/1_power_save": "1.9 Power Save", "rst_rtos/1_power_save/0_ps_index": "1.9 Power Save", "rst_rtos/2_whc_fullmac": "2.1 WHC FullMAC", "rst_rtos/2_whc_fullmac/0_fullmac_index": "2.1 WHC FullMAC", "rst_rtos/2_whc_wifi_bridge": "2.0 WHC Bridge", "rst_rtos/2_whc_wifi_bridge/0_wifi_bridge_index": "2.0 WHC Bridge", "rst_rtos/2_wifi_adaptivity_test": "2.4 Wi-Fi Adaptivity Test", "rst_rtos/2_wifi_adaptivity_test/0_wifi_adaptivity_index": "2.4 Wi-Fi Adaptivity Test", "rst_rtos/2_wifi_csi": "2.3 Wi-Fi CSI", "rst_rtos/2_wifi_csi/0_wifi_csi_index": "2.3 Wi-Fi CSI", "rst_rtos/2_wifi_tunnel": "2.2 Wi-Fi R-Mesh", "rst_rtos/2_wifi_tunnel/0_wifi_tunnel_index": "2.2 Wi-Fi R-Mesh", "rst_rtos/3_ap_trustzone": "3.d AP Secure Service", "rst_rtos/3_ap_trustzone/0_ap_tz_index": "3.d AP Secure Service", "rst_rtos/3_crypto_engine": "3.9 Crypto Engine", "rst_rtos/3_crypto_engine/0_crypto_engine_index": "3.9 Crypto Engine", "rst_rtos/3_ecdsa_engine": "3.a ECDSA Engine", "rst_rtos/3_ecdsa_engine/0_ecdsa_index": "3.a ECDSA Engine", "rst_rtos/3_eddsa_engine": "3.b EDDSA Engine", "rst_rtos/3_eddsa_engine/0_eddsa_index": "3.b EDDSA Engine", "rst_rtos/3_rsa_engine": "3.c RSA Engine", "rst_rtos/3_rsa_engine/0_rsa_index": "3.c RSA Engine", "rst_rtos/3_security": "3.1 Security \u0026 Encryption", "rst_rtos/3_security/0_security_index": "3.1 Security \u0026 Encryption", "rst_rtos/3_trng": "3.2 True Random Number Generator", "rst_rtos/3_trng/0_trng_index": "3.2 True Random Number Generator", "rst_rtos/4_ai": "4.1 AI", "rst_rtos/4_ai/0_ai_index": "4.1 AI", "rst_rtos/4_ai_voice": "4.2 AIVoice", "rst_rtos/4_ai_voice/0_ai_voice_index": "4.2 AIVoice", "rst_rtos/4_dsp": "4.4 DSP", "rst_rtos/4_dsp/0_dsp_index": "4.4 DSP", "rst_rtos/4_multimedia": "4.3 Multimedia", "rst_rtos/4_multimedia/0_multimedia_index": "4.3 Multimedia", "rst_rtos/6_mass_production": "6.1 Mass Production", "rst_rtos/6_mass_production/0_mp_index": "6.1 Mass Production", "rst_rtos/6_mptools": "6.2 MP Tools", "rst_rtos/6_mptools/0_mptools_index": "6.2 MP Tools", "rst_rtos/7_usb": "7.1 USB Host \u0026 Device", "rst_rtos/7_usb/0_usb_index": "7.1 USB Host \u0026 Device", "rst_rtos/8_adc": "8.4 ADC", "rst_rtos/8_adc/0_adc_index": "8.4 ADC", "rst_rtos/8_cap_touch": "8.7 Cap-Touch", "rst_rtos/8_cap_touch/0_cap_touch_index": "8.7 Cap-Touch", "rst_rtos/8_dmac": "8.1 DMA Controller", "rst_rtos/8_dmac/0_dmac_index": "8.1 DMA Controller", "rst_rtos/8_ir": "8.5 IR", "rst_rtos/8_ir/0_ir_index": "8.5 IR", "rst_rtos/8_key_scan": "8.8 Key-Scan", "rst_rtos/8_key_scan/0_key_scan_index": "8.8 Key-Scan", "rst_rtos/8_lcdc": "8.a LCD Controller", "rst_rtos/8_lcdc/0_lcdc_index": "8.a LCD Controller", "rst_rtos/8_ledc": "8.6 LED Controller", "rst_rtos/8_ledc/0_ledc_index": "8.6 LED Controller", "rst_rtos/8_psram": "8.2 PSRAM", "rst_rtos/8_psram/0_psram_index": "8.2 PSRAM", "rst_rtos/8_rtc_io": "8.9 RTC-IO", "rst_rtos/8_rtc_io/0_rtc_io_index": "8.9 RTC-IO", "rst_rtos/8_thermal": "8.3 Thermal Meter", "rst_rtos/8_thermal/0_thermal_index": "8.3 Thermal Meter"};
console.log("TOC_TITLE_MAP:", TOC_TITLE_MAP);

// 获取当前页面的文档名 (例如 'rst_rtos/3_nda_secure_boot/0_secure_boot_index_nda')
const CURRENT_DOCNAME = 'rst_rtos/0_build_system/1_build_system_toprst';

// 动态查找顶级分类函数（定义为全局函数）
window.findTopLevelChapter = function(docname) {
    console.log("Attempting to find top-level chapter for:", docname);
    let bestMatch = "";
    let bestTitle = "Unknown Chapter";

    // 按路径长度降序排序以确保最长匹配
    const sortedPaths = Object.keys(TOC_TITLE_MAP).sort((a, b) => b.length - a.length);

    for (const path of sortedPaths) {
        console.log("Checking path:", path);
        if (docname === path || docname.startsWith(path + '/')) { // 子页面
            bestMatch = path;
            bestTitle = TOC_TITLE_MAP[path];
            console.log("Matched path:", path, "with title:", bestTitle);
            break;
        }
    }

    // 如果没有找到任何匹配项，则尝试更短的路径
    if (bestMatch === "") {
        const pathSegments = docname.split('/');
        while (pathSegments.length > 1) { // 至少保留根路径
            const candidate = pathSegments.join('/');
            console.log("Checking shorter path:", candidate);
            if (TOC_TITLE_MAP[candidate]) {
                bestTitle = TOC_TITLE_MAP[candidate];
                console.log("Matched shorter path:", candidate, "with title:", bestTitle);
                break;
            }
            pathSegments.pop();
        }
    }

    console.log("Final top-level chapter:", bestTitle);
    return bestTitle;
}

// 初始化时调用
document.addEventListener('DOMContentLoaded', function() {
    const topLevelChapter = findTopLevelChapter(CURRENT_DOCNAME);
    console.log("Top Level Chapter:", topLevelChapter);

    // 将顶级分类插入到DOM中（根据需要）
    const chapterElement = document.createElement('div');
    chapterElement.className = 'top-level-chapter';
    chapterElement.innerHTML = `<strong>Top Level Chapter: </strong>${topLevelChapter}`;
    document.body.appendChild(chapterElement);
});
</script>

    <style>
        /* ====================== 紧凑型选择器 ====================== */
        #topleft-panel {
            background: rgba(40, 58, 73, 0.9);
            border-radius: 8px;
            padding: 4px;
            margin: 4px 0;
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
            backdrop-filter: blur(4px);
        }

        .selectors-grid {
            display: grid;
            gap: 4px;
        }

        .dual-selector-group {
            display: grid;
            grid-template-columns: 1fr 1fr; /* 两列等宽 */
            gap: 4px; /* 列间距 */
        }

        .selector-group {
            position: relative;
        }

        .selector-label {
            display: block;
            color: #a0b3c6;
            font-size: 0.85em;
            margin-bottom: 4px;
            padding-left: 4px;
        }

        .selector-dropdown {
            width: 100%;
            padding: 4px 4px;
            border: 1px solid rgba(64, 82, 97, 0.8);
            border-radius: 6px;
            background: rgba(44, 62, 80, 0.9);
            color: #ecf0f1;
            font-size: 0.95em;
            transition: all 0.2s ease;
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23a0b3c6'%3e%3cpath d='M7 10l5 5 5-5z'/%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 10px center;
            background-size: 16px;
        }

        .selector-dropdown:hover {
            border-color: #4a6a8b;
            background-color: rgba(44, 62, 80, 1);
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        }

        .selector-dropdown:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
        }

        /* 移动端优化 */
        @media (max-width: 768px) {
            #topleft-panel {
                margin: 8px 0;
                padding: 10px;
            }

            .selectors-grid {
                grid-template-columns: 1fr;
                gap: 10px;
            }

            .selector-dropdown {
                padding: 10px 12px;
            }

            .dual-selector-group {
                grid-template-columns: 1fr; /* 小屏幕下堆叠显示 */
            }
        }
    </style>

    
        

<style>
    /* ================= 用户面板 ================= */
    .user-panel {
        /* background: rgba(255,255,255,0.1); */
        background: rgba(255, 255, 255, 0.05); /* 更暗的背景 */
        border-radius: 4px;
        padding: 4px 4px; /* 上下间距减少 */
        margin: 4px 0px; /* 左右各10px边距 */
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);

        width: calc(100% - 4px); /* 宽度占满父容器减去20px（左右边距总和） */
        max-width: 280px; /* 设置最大宽度，防止过宽 */
        box-sizing: border-box; /* 确保padding和border不影响总宽度 */
    }

    #user-info {
        display: flex;
        gap: 4px;
        align-items: center;
        padding: 4px 0;
        width: 100%;
    }

    .username-btn, .logout-btn, .link-btn, .auth-btn {
        flex: 1; /* 均分剩余空间 */
        margin: 3px 0;           /* 减少外链按钮间距 */
        padding: 4px 6px;       /* 减少内边距 */
        background: rgba(255,255,255,0.05);
        border: 1px solid rgba(255,255,255,0.1);
        border-radius: 6px;
        color: white;
        display: flex;
        align-items: center;
        transition: all 0.3s ease;
    }

    .username-btn:hover {
        background: #92b5bb;
    }

    #username-display {
        font-size: 0.95em;
        color: #ecf0f1;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        text-align: left;
    }

    .logout-btn:hover {
        background: #c0392b;
    }

    /* ================= 按钮容器 ================= */
    .button-row {
        display: flex;
        gap: 4px;
        width: 100%;
        margin: 4px 0;
    }

    .auth-btn:hover {
        background: #2980b9;
        transform: translateY(-1px);
    }

    /* 外链按钮 */
    .external-links {
        display: flex;       /* 新增Flex布局 */
        gap: 4px;           /* 按钮间距 */
        width: 100%;        /* 确保容器宽度填满父级 */
    }

    .link-btn:hover {
        background: rgba(255,255,255,0.1);
        transform: translateY(-1px);
    }

    .btn-text {
        font-size: 0.95em;
    }

    .panel-divider {
        height: 1px;
        background: rgba(255,255,255,0.1);
        margin: 6px 0;          /* 减少分隔线间距 */
    }

    /* 桌面端悬停效果 */
    @media (hover: hover) {
        .username-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 6px rgba(255,255,255,0.15);
        }

        .logout-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 6px rgba(231, 76, 60, 0.3);
        }
    }

    /* 响应式调整 */
    @media (max-width: 768px) {
        .user-panel {
            padding: 4px 6px;
        }

        .auth-btn {
            padding: 4px 68px;
            font-size: 0.9em;
        }

        .external-links {
            flex-direction: column; /* 移动端垂直排列 */
            gap: 6px;              /* 调整间距 */
        }
        .link-btn {
            width: 100%;          /* 移动端填满宽度 */
            flex: none;           /* 禁用flex缩放 */
        }

        .btn-text {
            font-size: 0.9em;
        }

        #user-info {
            flex-direction: row; /* 保持行排列 */
            gap: 6px;
        }

        .username-btn {
            flex: 1 1 60%;
            padding: 6px 8px;
        }

        .logout-btn {
            flex: 1 1 40%;
            text-align: center;
        }
    }
</style>

<style>
    .auth-dialog {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.5);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 9999;
        backdrop-filter: blur(3px);
    }

    .auth-content {
        background: #ffffff;
        padding: 2rem;
        border-radius: 12px;
        min-width: 380px;
        box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        transform: translateY(-20px);
        opacity: 0;
        animation: dialogEnter 0.3s ease forwards;
    }

    @keyframes dialogEnter {
        to {
            transform: translateY(0);
            opacity: 1;
        }
    }

    .auth-title {
        color: #2c3e50;
        font-size: 1.5rem;
        margin: 0 0 1.5rem;
        font-weight: 600;
        text-align: center;
    }

    .auth-input-group {
        margin-bottom: 1.2rem;
    }

    .auth-label {
        display: block;
        color: #7f8c8d;
        font-size: 0.9rem;
        margin-bottom: 0.5rem;
    }

    .auth-input {
        width: 100%;
        padding: 0.8rem;
        border: 2px solid #ecf0f1;
        border-radius: 8px;
        font-size: 1rem;
        transition: all 0.3s ease;
    }

    .auth-input:focus {
        border-color: #3498db;
        box-shadow: 0 0 0 3px rgba(52,152,219,0.1);
        outline: none;
    }

    .auth-button-group {
        display: flex;
        gap: 1rem;
        margin-top: 1.5rem;
    }

    .auth-button {
        flex: 1;
        padding: 0.8rem 1.2rem;
        border: none;
        border-radius: 8px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .auth-button.confirm {
        background: #3498db;
        color: white;
    }

    .auth-button.confirm:hover {
        background: #2980b9;
        transform: translateY(-1px);
    }

    .auth-button.cancel {
        background: #f1f2f6;
        color: #2c3e50;
    }

    .auth-button.cancel:hover {
        background: #dfe4ea;
    }

    @media (max-width: 480px) {
        .auth-content {
            min-width: 90%;
            padding: 1.2rem;
        }

        .auth-input-group {
            margin-bottom: 0.8rem;
        }

        .auth-input {
            padding: 0.7rem;
            font-size: 0.9rem;
        }
    }
</style>
        <!-- source/_templates/_layout_issue_report.html -->
<div id="prompt-box" style="
    display: none;
    position: fixed;
    top: 20px;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(0,0,0,0.8);
    color: white;
    padding: 10px 20px;
    border-radius: 5px;
    z-index: 9999;
    text-align: center;
    font-size: 14px;
"></div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    'use strict'; // 添加严格模式

    // 获取所有DOM元素引用
    const reportButton = document.getElementById('report-button');
    const feedbackDialog = document.getElementById('feedback-dialog');
    const feedbackText = document.getElementById('inquire_input');
    const submitButton = document.getElementById('submit-feedback');
    const cancelButton = document.getElementById('cancel-feedback');
    const promptBox = document.getElementById('prompt-box');
    const chapterSelect = document.getElementById('chapter-select');
    const paragraphInput = document.getElementById('paragraph-input');
    const postTypeSelect = document.getElementById('post-type');
    console.log('帖子类型(postTypeSelect)DOM元素:', postTypeSelect); // 应输出<select>元素

    // 状态变量
    let hasUserInput = false; // 跟踪用户是否主动输入
    let selectedText = '';
    const language = 'en'; // 从模板引擎获取语言变量

    // 初始化时设置placeholder
    paragraphInput.placeholder = language === 'zh_CN' 
        ? '你可以先选择有问题的段落或手动输入...'
        : 'You can select text or type directly here...';

    // 获取当前激活的章节
    function getCurrentChapter() {
        try {
            // 通过激活的菜单项获取当前章节
            const currentLink = document.querySelector('.wy-menu .toctree-l1.current > a');
            if (currentLink) {
                return currentLink.textContent.replace('¶', '').trim();
            }

            // 如果没有找到激活的链接，尝试通过页面标题获取
            const pageTitle = document.querySelector('h1');
            if (pageTitle) {
                return pageTitle.textContent.split('\n')[0].trim();
            }

            // 如果以上方法都失败，尝试通过URL路径推断章节
            const pathParts = window.location.pathname.split('/');
            if (pathParts.length > 2) {
                return decodeURIComponent(pathParts[pathParts.length - 2]);
            }

            return null;
        } catch (error) {
            console.error('获取当前章节失败:', error);
            return null;
        }
    }

    // 填充章节选择框
    function populateChapters() {
        const chapterElements = document.querySelectorAll('.wy-menu .toctree-l1 > a');
        const chapters = Array.from(chapterElements).map(el => el.textContent.replace('¶', '').trim());
        const currentChapter = getCurrentChapter();

        console.log('提取全部章节:', chapters);
        console.log('当前页面章节:', currentChapter);

        if (chapters.length === 0) {
            console.error('未找到章节链接');
            return;
        }

        chapterSelect.innerHTML = '';

        // 添加默认选项
        const defaultOption = document.createElement('option');
        defaultOption.value = '';
        defaultOption.textContent = language === 'zh_CN' ? '-- 请选择章节 --' : '-- Select Chapter --';
        chapterSelect.appendChild(defaultOption);

        // 添加章节选项
        chapters.forEach(chapter => {
            const option = document.createElement('option');
            option.value = chapter;
            option.textContent = chapter;
            if (chapter === currentChapter) {
                option.selected = true;
            }
            chapterSelect.appendChild(option);
        });
    }

    // 初始化章节选择框
    populateChapters();

    // 报告按钮点击事件（处理文本选择）
    reportButton.addEventListener('click', function() {
        // 重置所有输入字段，每次重新inquire应该让对话框处于默认状态
        feedbackText.value = '';          // 清空问题输入框
        paragraphInput.value = '';        // 清空段落输入框
        selectedText = '';                // 清除之前选择的文本

        const selection = window.getSelection().toString().trim();
        if (selection) {
            paragraphInput.value = selection;
        } else {
            // 保持placeholder提示
            if (!paragraphInput.value.trim()) {
                paragraphInput.value = '';
            }
        }
        feedbackDialog.style.display = 'block';
    });

    // 监听输入事件
    paragraphInput.addEventListener('input', function() {
        // 标记用户已经输入
        this.placeholder = '';
    });

    // 提交按钮点击事件
    submitButton.addEventListener('click', function() {
        const userQuestion = feedbackText.value.trim();
        const selectedChapter = chapterSelect.value;
        const selectedPostType = postTypeSelect.value;
        const paragraphContent = paragraphInput.value.trim() || 'null';

        // 在提交事件顶部添加详细日志
        console.group('=== 提交调试信息 ===');
        console.log('章节选择值:', chapterSelect.value);
        console.log('帖子类型postTypeSelect DOM元素:', postTypeSelect);
        console.log('帖子类型postTypeSelect 选中的选项:', postTypeSelect.options[postTypeSelect.selectedIndex]);
        console.log('帖子类型postTypeSelect 实际值:', postTypeSelect.value); // 应输出'doc_correction' 对应文档纠错
          console.groupEnd();

        // 验证输入
        if (!userQuestion) {
            alert(language === 'zh_CN' ? '问题描述为空' : 'Issue description cannot be empty');
            return;
        }
        if (!selectedChapter) {
            alert(language === 'zh_CN' ? '请选择相关章节' : 'Please select a related chapter');
            return;
        }

        if (!selectedPostType) {
            alert(language === 'zh_CN' ? '请选择帖子类型' : 'Please select a post type');
            return;
        }

        // 获取用户名
        const username = localStorage.getItem('username') || 'Anonymous';

        // 构建提交数据
        const feedbackData = {
            user: username,
            chapters: selectedChapter,
            post_type: selectedPostType,
            paragraph: paragraphContent,
            question: userQuestion
        };

        console.log('完整提交数据:', feedbackData);

        // 发送到后端
        fetch('http://172.29.57.206:5000/submit', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(feedbackData)
        })
        .then(response => {
            if (!response.ok) throw new Error('Network response was not ok');
            return response.json();
        })
        .then(data => {
            console.log('提交成功:', data);
            promptBox.textContent = language === 'zh_CN' ? '问题已成功提交' : 'Issue submitted successfully';
            promptBox.style.display = 'block';
            setTimeout(() => promptBox.style.display = 'none', 5000);
        })
        .catch(error => {
            console.error('提交失败:', error);
            promptBox.textContent = language === 'zh_CN' ? '提交失败，请检查网络连接' : 'Submission failed, check your network';
            promptBox.style.display = 'block';
            setTimeout(() => promptBox.style.display = 'none', 5000);
        });

        // 关闭对话框
        feedbackDialog.style.display = 'none';
    });


    // 取消按钮点击事件
    cancelButton.addEventListener('click', function() {
        feedbackDialog.style.display = 'none';
    });

    // 初始化检查
    console.log('问题反馈系统已加载');
    console.log('当前语言:', language);
    console.log('检测到章节数量:', chapterSelect.options.length - 1);
});
</script> <!-- 问题回报 -->
    

    <style>
        /* 隐藏整个搜索栏容器 */
        .wy-side-nav-search > div[role="search"] {
            display: none !important;
        }

        /* 或者更精确地隐藏表单 */
        form#rtd-search-form {
            display: none !important;
        }
    </style>

    <style>
        .extension-container {
            position: fixed;
            left: 10px;
            bottom: 10px;
            z-index: 1000;
        }

        .extension-button {
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 5px;
            padding: 8px 15px;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .extension-button:hover {
            background-color: #2980b9;
        }
    </style>

    <style>
        /* 保留bottomleft-panel作为用户面板容器 */
        .bottomleft-panel {
            position: fixed;
            left: 0;
            bottom: 0;
            width: 300px;
            height: auto;
            background: #2d2d2d;
            border-top: 1px solid #404040;
            box-shadow: 0 -2px 12px rgba(0,0,0,0.2);
            z-index: 1001;
        }

        /* 新增userpanel-container的flex定义 */
        .userpanel-container {
            padding: 10px;
            width: 100%;
        }
        /* 增加字体配置 */
        .material-symbols-outlined {
            font-family: 'Material Symbols Outlined' !important;
            font-weight: 400 !important;
            font-style: normal !important;
            line-height: 1 !important;
            letter-spacing: normal !important;
            text-transform: none !important;
        }

        /* 调整父容器定位方式 */
        .userpanel-container {
            position: relative; /* 新增定位上下文 */
        }
    </style>

    <!-- 左上角标题距离控制：Ameba IoT Docs -->
    <style>
        /* 隐藏整个搜索栏容器 */
        .wy-side-nav-search > div[role="search"] {
            display: none !important;
        }

        /* 新增的标题间距调整样式（添加在此处） */
        div[role="navigation"] > div[role="search"] {
            margin-bottom: 4px !important;
        }

        a.icon.icon-home {
            display: inline-block;
            margin-bottom: 2px !important;
        }
    </style>

    <!-- 引入功能模块 -->
    
        
<script>
    // 初始化认证对话框
    window.initAuthDialogs = function() {
        function createAuthDialog(type) {
            const lang = document.getElementById('language-selector').value === 'cn' ? 'cn' : 'en';

            // 对话框容器
            const dialog = document.createElement('div');
            dialog.className = 'auth-dialog';  // 使用CSS类替代内联样式

            // 内容容器
            const content = document.createElement('div');
            content.className = 'auth-content';

            // 标题
            const title = document.createElement('h3');
            title.className = 'auth-title';
            title.textContent = type === 'register' 
                ? (lang === 'cn' ? '注册' : 'Register') 
                : (lang === 'cn' ? '登录' : 'Login');

            // 输入字段创建函数
            const createInput = (labelText, inputType) => {
                const container = document.createElement('div');
                container.className = 'auth-input-group';

                const label = document.createElement('label');
                label.textContent = labelText;

                const input = document.createElement('input');
                input.type = inputType;
                input.className = 'auth-input';

                container.appendChild(label);
                container.appendChild(input);
                return { container, input };
            };

            // 用户名输入
            const username = createInput(
                lang === 'cn' ? '用户名：' : 'Username:', 
                'text'
            );
            content.appendChild(username.container);

            // 密码输入
            const password = createInput(
                lang === 'cn' ? '密码：' : 'Password:', 
                'password'
            );
            content.appendChild(password.container);

            // Enter键支持
            const handleKeyPress = (e) => {
                if (e.key === 'Enter') confirmBtn.click();
            };

            // 确认密码（仅注册）
            let confirmPassword;
            let companyInput, productInput, emailInput;
            if (type === 'register') {
                confirmPassword = createInput(
                    lang === 'cn' ? '确认密码：' : 'Confirm Password:', 
                    'password'
                );
                content.appendChild(confirmPassword.container);

                // 工作单位
                const company = createInput(
                    lang === 'cn' ? '工作单位：' : 'Company:', 
                    'text'
                );
                content.appendChild(company.container);
                companyInput = company.input;

                // 产品信息 
                const product = createInput(
                    lang === 'cn' ? '产品信息：' : 'Product:', 
                    'text'
                );
                content.appendChild(product.container);
                productInput = product.input;

                // 工作邮箱
                const email = createInput(
                    lang === 'cn' ? '工作邮箱：' : 'Email:', 
                    'email'
                );
                email.input.autocomplete = 'email'; // ➕ 添加自动完成类型

                content.appendChild(email.container);
                emailInput = email.input;

                // 添加Enter键支持到新字段
                [companyInput, productInput, emailInput].forEach(input => {
                    input.addEventListener('keypress', handleKeyPress);
                });
            }

            // 按钮容器
            const buttonContainer = document.createElement('div');
            buttonContainer.className = 'auth-button-group';

            // 确认按钮
            const confirmBtn = document.createElement('button');
            confirmBtn.className = 'auth-confirm-btn';
            confirmBtn.textContent = lang === 'cn' ? '确认' : 'Confirm';

            username.input.addEventListener('keypress', handleKeyPress);
            password.input.addEventListener('keypress', handleKeyPress);
            if (confirmPassword) confirmPassword.input.addEventListener('keypress', handleKeyPress);

            // 确认按钮逻辑
            confirmBtn.onclick = () => {
                const usernameVal = username.input.value.trim();
                const passwordVal = password.input.value.trim();
                const companyVal = companyInput?.value.trim() || '';
                const productVal = productInput?.value.trim() || '';
                const emailVal = emailInput?.value.trim() || '';
                const confirmVal = confirmPassword ? confirmPassword.input.value.trim() : null;

                // 基础邮箱格式验证
                if (type === 'register' && emailVal) {
                    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                    if (!emailRegex.test(emailVal)) {
                        alert(lang === 'cn' 
                            ? '请输入有效邮箱地址' 
                            : 'Please enter a valid email address');
                        return;
                    }
                }

                // 验证逻辑
                if (!usernameVal || !passwordVal) {
                    alert(lang === 'cn' ? '用户名和密码不能为空！' : 'Username and password are required!');
                    return;
                }

                if (type === 'register' && passwordVal !== confirmVal) {
                    alert(lang === 'cn' ? '两次输入的密码不一致！' : 'Passwords do not match!');
                    return;
                }

                // fetch请求
                fetch('http://172.29.57.206:5000/auth', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': window.getCSRFToken()
                    },
                    body: JSON.stringify({
                        action: type, 
                        username: usernameVal, 
                        password: passwordVal,
                        company: companyVal,
                        product: productVal,
                        email: emailVal
                    }),
                    credentials: 'include'
                })
                .then(response => {
                    console.log('[DEBUG] 完整响应头:', [...response.headers.entries()]);
                    console.log('Access-Control-Allow-Origin:', response.headers.get('Access-Control-Allow-Origin'));
                    console.log('Access-Control-Allow-Credentials:', response.headers.get('Access-Control-Allow-Credentials'));
                    console.log('登录响应 Cookies:', response.headers.get('Set-Cookie'));
                    return response.json();
                })
                .then(async (data) => {
                    // 成功处理逻辑
                    if (data.success) {
                        console.log('initAuthDialogs 登录成功，当前 Cookies:', document.cookie);
                        console.log('initAuthDialogs CSRF Token:', window.getCSRFToken());

                        localStorage.setItem('auth_session', JSON.stringify({
                            username: data.username, 
                            expires: Date.now() + 3600000
                        }));

                        localStorage.setItem('isLoggedIn', 'true');
                        localStorage.setItem('username', usernameVal);
                        
                        document.getElementById('auth-buttons').style.display = 'none';
                        document.getElementById('user-info').style.display = 'flex';
                        document.getElementById('username-display').textContent = localStorage.getItem('username') || '';
                        document.body.removeChild(dialog);

                        Swal.fire({
                            icon: 'success',
                            title: lang === 'cn' ? '登录成功' : 'Logged In',
                            showConfirmButton: false,
                            timer: 500
                        });
                    } else {
                        document.body.removeChild(dialog);
                        window.syncLoginState();
                        Swal.fire({
                            icon: 'fail',
                            title: lang === 'cn' ? '登录失败' : 'Logged In Fail',
                            showConfirmButton: false,
                            timer: 500
                        });
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert(lang === 'cn' ? '网络错误' : 'Network error');
                });
            };

            // 取消按钮
            const cancelBtn = document.createElement('button');
            cancelBtn.className = 'auth-cancel-btn';
            cancelBtn.textContent = lang === 'cn' ? '取消' : 'Cancel';
            cancelBtn.onclick = () => document.body.removeChild(dialog);

            // 组装元素
            buttonContainer.appendChild(confirmBtn);
            buttonContainer.appendChild(cancelBtn);
            content.appendChild(buttonContainer);
            dialog.appendChild(content);
            document.body.appendChild(dialog);

            // 点击外部关闭
            dialog.addEventListener('click', (e) => {
                if (e.target === dialog) document.body.removeChild(dialog);
            });
        }

        // 事件绑定
        document.getElementById('register-button').addEventListener('click', () => createAuthDialog('register'));
        document.getElementById('login-button').addEventListener('click', () => createAuthDialog('login'));
    }

    // 注销功能
    async function handleLogout() {
        try {
            const lang = (window.location.pathname.includes('/zh_CN') || 
                        document.documentElement.lang === 'zh_CN') ? 'cn' : 'en';

            // 更新本地存储和UI
            //localStorage.removeItem('isLoggedIn');
            localStorage.setItem('isLoggedIn', 'false');
            localStorage.removeItem('username');

            // 强制刷新显示状态
            document.getElementById('auth-buttons').style.display = 'flex';
            document.getElementById('user-info').style.display = 'none';
            document.getElementById('username-display').textContent = localStorage.getItem('username') || '';

            const response = await fetch('http://172.29.57.206:5000/logout', {
                method: 'GET',
                headers: {
                    'X-CSRFToken': window.getCSRFToken(),
                    'Content-Type': 'application/json'
                },
                credentials: 'include'
            });

            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }

            await Swal.fire({
                icon: 'success',
                title: lang === 'cn' ? '登出成功' : 'Logged Out',
                timer: 1500
            });
        } catch (error) {
            console.error('登出流程异常:', error);
            Swal.fire({
                icon: 'error',
                title: lang === 'cn' ? '登出异常' : 'Logout Failed',
                text: lang === 'cn' ? '请尝试清除浏览器缓存' : 'Please clear browser cache'
            });
        }
    }

    // 同步登录状态
    window.syncLoginState = function() {
        const isLoggedIn = localStorage.getItem('isLoggedIn') === 'true';
        document.getElementById('auth-buttons').style.display = isLoggedIn ? 'none' : 'flex';
        document.getElementById('user-info').style.display = isLoggedIn ? 'flex' : 'none';
        if (isLoggedIn) {
            document.getElementById('username-display').textContent = localStorage.getItem('username') || '';
        } else {

        }
    }

</script>
    
    
<script>
    /* ====================== 嵌入式配置开始 ====================== */
    const embeddedConfig = {
        "freertos": {
            "name": "FreeRTOS",
            "languages": {
                "en": ["latest"],
                "cn": ["latest"]
            }
        },
        "linux": {
            "name": "Linux",
            "languages": {
                "en": ["latest"],
                "cn": ["latest"]
            }
        }
    };
    /* ====================== 嵌入式配置结束 ====================== */
</script>
    
<script>
    // 获取基础URL路径
    function getBaseURL() {
        const url = new URL(window.location.href);
        console.log('[DEBUG] getBaseURL:');

        if (url.protocol === 'file:') {
            // 本地路径处理
            const pathParts = url.pathname.split('/').filter(part => part !== '');
            const index = pathParts.indexOf('build');
            console.log('[DEBUG] getBaseURL0:', pathParts.slice(0, index + 1).join('/'));
            return `file://${pathParts.slice(0, index + 1).join('/')}/`;
        } else {
            // 网络路径处理
            const basePath = url.pathname.split('/')[1]; // 直接取第一个有效路径段
            console.log('[DEBUG] getBaseURL:', url.origin, basePath);
            return `${url.origin}/${basePath}/`;
        }
    }

    // 获取当前URL路径分段
    function getCurrentSegments() {
        const url = new URL(window.location.href);
        let segments = url.pathname.split('/').filter(segment => segment);

        console.log('[DEBUG] getCurrentSegments:');

        if (url.protocol === 'file:') {
            // 本地路径处理
            const index = segments.indexOf('build');
            segments = segments.slice(index + 1); // 去掉 build 及之前的路径
            console.log('[DEBUG] getCurrentSegments0:', segments);
        } else {
            // 网络路径处理
            segments = segments.slice(3); // 去掉 ameba-iot-docs/
            console.log('[DEBUG] getCurrentSegments:', segments);
        }

        return {
            osKey: segments[0] || 'freertos', // 默认为 freertos
            language: segments[1] || 'en',   // 默认为 en
            version: segments[2] || 'latest' // 默认为 latest
        };
    }
</script>
    
<script>
    // 获取OS显示名称列表
    function getOSNames(data) {
        return Object.keys(data).map(key => data[key].name);
    }

    // 获取指定OS的语言列表
    function getLanguages(data, osKey) {
        return Object.keys(data[osKey]?.languages || {});
    }

    // 获取指定OS和语言的版本列表
    function getVersions(data, osKey, language) {
        return data[osKey]?.languages?.[language] || ['latest'];
    }

    // 根据显示名称查找OS键
    function findOSKey(data, displayName) {
        return Object.keys(data).find(key => data[key].name === displayName);
    }
</script>
    
<script>
    // 验证并修正路径参数
    function validateSegments(segments) {
        const currentOSName = embeddedConfig[segments.osKey]?.name;

        // 如果 OS 无效，默认设置为 FreeRTOS
        if (!currentOSName) {
            console.warn("Invalid OS key, defaulting to FreeRTOS");
            segments.osKey = 'freertos';
        }

        // 如果语言无效，默认设置为 en
        if (!getLanguages(embeddedConfig, segments.osKey).includes(segments.language)) {
            console.warn("Invalid language, defaulting to en");
            segments.language = 'en';
        }

        return segments;
    }

    // 生成选择器HTML
    function generateSelectorsHTML(segments) {
        return `
        <div class="selectors-grid">
            <!-- 系统选择器 -->
            <div class="selector-group">
                <select id="os-selector" class="selector-dropdown">
                    ${Object.keys(embeddedConfig).map(key => `
                        <option value="${key}">${embeddedConfig[key].name}</option>
                    `).join('')}
                </select>
            </div>

            <!-- 语言和版本组合（修正类名） -->
            <div class="dual-selector-group"> <!-- 修改此处 -->
                <div class="selector-group">
                    <select id="language-selector" class="selector-dropdown">
                        ${getLanguages(embeddedConfig, segments.osKey).map(lang => `
                            <option value="${lang}">${lang}</option>
                        `).join('')}
                    </select>
                </div>

                <div class="selector-group">
                    <select id="version-selector" class="selector-dropdown">
                        ${getVersions(embeddedConfig, segments.osKey, segments.language).map(ver => `
                            <option value="${ver}">${ver}</option>
                        `).join('')}
                    </select>
                </div>
            </div>
        </div>
        ${generateUserPanelHTML(segments)}`;
    }

    // 生成用户面板HTML
    function generateUserPanelHTML(segments) {
        return `
            <div class="user-panel">
                <!-- 用户名显示（登录后可见） -->
                <div id="user-info" style="display: ${localStorage.getItem('isLoggedIn') ? 'flex' : 'none'}">
                    <button class="username-btn")">
                        <span class="btn-icon">👤</span>
                        <span id="username-display">${localStorage.getItem('username') || ''}</span>
                    </button>
                    <button class="logout-btn" onclick="handleLogout()")">
                        <span class="btn-icon">🚪</span>
                        <span id="btn-text">${segments.language === 'cn' ? '注销' : 'Logout'}</span>
                    </button>
                </div>

                <!-- 登录注册按钮（未登录时可见） -->
                <div id="auth-buttons" class="button-row" style="display: ${localStorage.getItem('isLoggedIn') ? 'none' : 'flex'}">
                    <button class="auth-btn" id="login-button">
                        <span class="btn-icon">🔓</span> <!-- 登录图标 -->
                        ${segments.language === 'cn' ? '登录' : 'Login'}
                    </button>
                    <button class="auth-btn" id="register-button">
                        <span class="btn-icon">✍️</span> <!-- 注册图标 -->
                        ${segments.language === 'cn' ? '注册' : 'Register'}
                    </button>
                </div>

                <!-- 分隔线 -->
                <div class="panel-divider"></div>

                <!-- 外链按钮 -->
                <div class="external-links">
                    <button class="link-btn official" onclick="window.open('https://www.realmcu.com/', '_blank')">
                        <span class="btn-icon">🌐</span>
                        <span class="btn-text">${segments.language === 'cn' ? '官网' : 'Official'}</span>
                    </button>
                    <button class="link-btn forum" onclick="window.open('http://172.29.57.206:5000/view', '_blank')">
                        <span class="btn-icon">💬</span>
                        <span class="btn-text">${segments.language === 'cn' ? '论坛' : 'Forum'}</span>
                    </button>
                </div>
            </div>
        `;
    }

    // 设置初始选中值
    function setInitialValues(segments) {
        document.getElementById('os-selector').value = segments.osKey;
        document.getElementById('language-selector').value = segments.language;

        const versionSelector = document.getElementById('version-selector');
        const availableVersions = getVersions(embeddedConfig, segments.osKey, segments.language);
        versionSelector.value = availableVersions.includes(segments.version) ? segments.version : availableVersions[0] || 'latest';
    }
</script>
    
<script>
    // 绑定事件监听
    function bindEvents(baseURL, segments) {
        document.getElementById('os-selector').addEventListener('change', () => {
            const newOSKey = document.getElementById('os-selector').value;
            const availableLangs = getLanguages(embeddedConfig, newOSKey);
            const defaultLang = availableLangs[0] || 'en';
            const defaultVersion = getVersions(embeddedConfig, newOSKey, defaultLang)[0] || 'latest';
            redirectTo(`${baseURL}${newOSKey}/${defaultLang}/${defaultVersion}/`);
        });

        document.getElementById('language-selector').addEventListener('change', () => {
            const newLang = document.getElementById('language-selector').value;
            const defaultVersion = getVersions(embeddedConfig, segments.osKey, newLang)[0] || 'latest';
            redirectTo(`${baseURL}${segments.osKey}/${newLang}/${defaultVersion}/`);
        });

        document.getElementById('version-selector').addEventListener('change', () => {
            const newVer = document.getElementById('version-selector').value;
            redirectTo(`${baseURL}${segments.osKey}/${segments.language}/${newVer}/`);
        });
    }

    // 跳转函数
    function redirectTo(path) {
        const url = new URL(path, window.location.href);
        if (url.protocol === 'file:') {
            url.pathname += 'index.html';
        }
        window.location.href = url.href;
    }
</script>

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
    

          
          
          <a href="../../index.html" class="icon icon-home">
            Ameba IoT Docs
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

    
    <div id="topleft-panel" style="display: block !important; padding: 0; background: none; border: none;"></div>

    
        
        <div class="bottomleft-panel">
            <div class="userpanel-container"></div>
        </div>
    

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            try {
                const segments = validateSegments(getCurrentSegments());
                const baseURL = getBaseURL();

                // 渲染HTML
                document.getElementById('topleft-panel').innerHTML = generateSelectorsHTML(segments);

                // 设置初始值
                setInitialValues(segments);

                // 绑定事件
                bindEvents(baseURL, segments);

                // 初始化认证逻辑
                
                    window.initAuthDialogs();
                    window.syncLoginState();

                    // 将 user-panel 移动到 bottomleft-panel 内
                    const userPanel = document.querySelector('.user-panel');
                    const settingsContainer = document.querySelector('.userpanel-container');
                    if (userPanel && settingsContainer) {
                        settingsContainer.appendChild(userPanel); // 直接添加为子元素
                    }
                
            } catch (error) {
                console.error("Error initializing selectors:", error);
            }
        });
    </script>

        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../0_ameba_product/0_ameba_product_center_index.html">Products Center</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_ameba_sdk/0_ameba_sdks_index.html">Ameba SDK</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_ameba_solutions/0_ameba_solutions_index.html">Ameba Solutions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_gcc_build_environment/0_gcc_build_index.html">0.1 GCC Build Environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_gdb_debug/0_gdb_debug_index.html">0.2 GDB Debug</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="0_build_system_index.html">0.3 Build System</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Overview</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#concepts">Concepts</a></li>
<li class="toctree-l3"><a class="reference internal" href="#global-compilation-configuration">Global Compilation Configuration</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#compilation-configuration-contents">Compilation Configuration Contents</a></li>
<li class="toctree-l4"><a class="reference internal" href="#scope-of-global-compilation-configuration">Scope of Global Compilation Configuration</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#component-compilation-cmakelists-txt">Component Compilation CMakeLists.txt</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#component-public-part">Component Public Part</a></li>
<li class="toctree-l4"><a class="reference internal" href="#component-private-part">Component Private Part</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#best-practices">Best Practices</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#modifying-existing-component-build-config">Modifying Existing Component Build Config</a></li>
<li class="toctree-l3"><a class="reference internal" href="#quickly-compile-link-source-files-for-testing">Quickly Compile &amp; Link Source Files for Testing</a></li>
<li class="toctree-l3"><a class="reference internal" href="#integrating-code-with-standalone-build-system">Integrating Code with Standalone Build System</a></li>
<li class="toctree-l3"><a class="reference internal" href="#adjusting-submodule-organization-relationships-in-components">Adjusting Submodule Organization Relationships in Components</a></li>
<li class="toctree-l3"><a class="reference internal" href="#adding-new-components-in-component-directory">Adding New Components in Component Directory</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#commonly-used-cmake-interfaces-and-preset-constants">Commonly Used CMake Interfaces and Preset Constants</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#list-operations">List Operations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#ameba-list-append">ameba_list_append</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ameba-list-append-if">ameba_list_append_if</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ameba-list-append-ifnot">ameba_list_append_ifnot</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ameba-list-append-ifdef">ameba_list_append_ifdef</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#add-library">Add Library</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#ameba-add-internal-library">ameba_add_internal_library</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ameba-port-standalone-internal-library">ameba_port_standalone_internal_library</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ameba-add-external-app-library">ameba_add_external_app_library</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#add-subdirectory">Add Subdirectory</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#ameba-add-subdirectory">ameba_add_subdirectory</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ameba-add-subdirectory-if">ameba_add_subdirectory_if</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ameba-add-subdirectory-ifnot">ameba_add_subdirectory_ifnot</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ameba-add-subdirectory-if-exist">ameba_add_subdirectory_if_exist</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#constants-definition">Constants Definition</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#general-constants">General Constants</a></li>
<li class="toctree-l4"><a class="reference internal" href="#soc-project-related-constants">SOC Project-related Constants</a></li>
<li class="toctree-l4"><a class="reference internal" href="#mcu-project-related-constants">MCU Project-related Constants</a></li>
<li class="toctree-l4"><a class="reference internal" href="#component-related-constants">Component-related Constants</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#frequently-asked-questions-suggestions">Frequently Asked Questions &amp; Suggestions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#view-detailed-compilation-parameters-of-a-source-file">View Detailed Compilation Parameters of a Source File</a></li>
<li class="toctree-l3"><a class="reference internal" href="#undefined-reference-error">Undefined Reference Error</a></li>
<li class="toctree-l3"><a class="reference internal" href="#useful-types-for-complex-logic-processing">Useful Types for Complex Logic Processing</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#soc-type">SOC Type</a></li>
<li class="toctree-l4"><a class="reference internal" href="#mcu-type">MCU Type</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#common-cmake-debugging-methods">Common CMake Debugging Methods</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#logging">Logging</a></li>
<li class="toctree-l4"><a class="reference internal" href="#troubleshooting-common-cmake-errors">Troubleshooting Common CMake Errors</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#copied-and-replaced-a-source-file-but-did-not-trigger-recompilation">Copied and replaced a source file but did not trigger recompilation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#advanced-learning-readings">Advanced Learning Readings</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#special-compilation-configurations">Special Compilation Configurations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#set-compilation-configuration-per-source-file">Set Compilation Configuration Per Source File</a></li>
<li class="toctree-l4"><a class="reference internal" href="#set-compile-options-per-source-file-type">Set Compile Options Per Source File Type</a></li>
<li class="toctree-l4"><a class="reference internal" href="#suppress-compilation-warnings-as-errors">Suppress Compilation Warnings as Errors</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#kconfig-system">Kconfig System</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#kconfig-overview">Kconfig Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="#introduction-to-conf-files">Introduction to conf Files</a></li>
<li class="toctree-l3"><a class="reference internal" href="#kconfig-automatic-update-check">Kconfig Automatic Update Check</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../0_sdk_example/0_sdk_example_index.html">0.4 SDK Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_memory_layout/0_layout_index.html">0.5 Flash &amp; RAM Layout</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_user_config/0_usrcfg_index.html">0.6 User Config</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_tools/0_tools_index.html">0.7 Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_at_command/0_at_command_index.html">0.8 AT Commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_file_system/0_vfs_index.html">0.9 Virtual File System</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_ftl/0_ftl_index.html">0.a Flash Translation Layer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1_mpu_cache/0_mpu_cache_index.html">1.0 MPU and Cache</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1_boot_process/0_boot_index.html">1.1 Boot Process</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1_ota/0_ota_index.html">1.2 OTA</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1_otpc/0_otpc_index.html">1.3 OTPC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1_chipen/0_chipen_index.html">1.4 Chip Enable</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1_ipc/0_ipc_index.html">1.5 Inter Processor Communication</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1_pinmux/0_pinmux_index.html">1.6 Pin Multiplexing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1_gpio/0_gpio_index.html">1.7 GPIO &amp; Pin Control</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1_power_save/0_ps_index.html">1.9 Power Save</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2_whc_wifi_bridge/0_wifi_bridge_index.html">2.0 WHC Bridge</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2_whc_fullmac/0_fullmac_index.html">2.1 WHC FullMAC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2_wifi_tunnel/0_wifi_tunnel_index.html">2.2 Wi-Fi R-Mesh</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2_wifi_csi/0_wifi_csi_index.html">2.3 Wi-Fi CSI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2_wifi_adaptivity_test/0_wifi_adaptivity_index.html">2.4 Wi-Fi Adaptivity Test</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_security/0_security_index.html">3.1 Security &amp; Encryption</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_trng/0_trng_index.html">3.2 True Random Number Generator</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_crypto_engine/0_crypto_engine_index.html">3.9 Crypto Engine</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_ecdsa_engine/0_ecdsa_index.html">3.a ECDSA Engine</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_eddsa_engine/0_eddsa_index.html">3.b EDDSA Engine</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_rsa_engine/0_rsa_index.html">3.c RSA Engine</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_ap_trustzone/0_ap_tz_index.html">3.d AP Secure Service</a></li>
<li class="toctree-l1"><a class="reference internal" href="../4_ai/0_ai_index.html">4.1 AI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../4_ai_voice/0_ai_voice_index.html">4.2 AIVoice</a></li>
<li class="toctree-l1"><a class="reference internal" href="../4_multimedia/0_multimedia_index.html">4.3 Multimedia</a></li>
<li class="toctree-l1"><a class="reference internal" href="../4_dsp/0_dsp_index.html">4.4 DSP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../6_mass_production/0_mp_index.html">6.1 Mass Production</a></li>
<li class="toctree-l1"><a class="reference internal" href="../6_mptools/0_mptools_index.html">6.2 MP Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../7_usb/0_usb_index.html">7.1 USB Host &amp; Device</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_dmac/0_dmac_index.html">8.1 DMA Controller</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_psram/0_psram_index.html">8.2 PSRAM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_thermal/0_thermal_index.html">8.3 Thermal Meter</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_adc/0_adc_index.html">8.4 ADC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_ir/0_ir_index.html">8.5 IR</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_ledc/0_ledc_index.html">8.6 LED Controller</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_cap_touch/0_cap_touch_index.html">8.7 Cap-Touch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_key_scan/0_key_scan_index.html">8.8 Key-Scan</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_rtc_io/0_rtc_io_index.html">8.9 RTC-IO</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_lcdc/0_lcdc_index.html">8.a LCD Controller</a></li>
<li class="toctree-l1"><a class="reference internal" href="../10_api_docs/0_api_index.html">10.0 API Reference</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Ameba IoT Docs</a>
      </nav>

      <div class="wy-nav-content">
    
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="0_build_system_index.html">Build System</a></li>
      <li class="breadcrumb-item active">Overview</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <span class="target" id="build-system"></span><!-- 下拉菜单 -->
<div style="margin: 20px 0; text-align: left;">
    <div style="display: flex; align-items: center; gap: 10px;">
        <span style="font-size: 14px;">IC: </span>
        <select class="tab-selector" style="height: 22px; padding: 2px 8px; font-size: 13px;">
            <option value="RTL8721Dx">RTL8721Dx</option>
            <option value="RTL8720E">RTL8720E</option>
            <option value="RTL8726E">RTL8726E</option>
            <option value="RTL8730E">RTL8730E</option>
        </select>
    </div>
</div>

<!-- 修复后的 JavaScript -->
<script>
document.addEventListener("DOMContentLoaded", function() {
    const selector = document.querySelector('.tab-selector');

    selector.addEventListener('change', function() {
        const targetTab = this.value;
        const tabs = document.querySelectorAll('.sphinx-tabs-tab');
        let found = false;

        tabs.forEach(tab => {
            const tabText = tab.textContent.trim();
            if (tabText === targetTab) {
                tab.click();
                window.dispatchEvent(new Event('resize')); // 触发插件更新
                found = true;
            }
        });

        if (!found) {
            console.error("未找到选项卡:", targetTab);
        }
    });
});
</script><section id="overview">
<h1>Overview<a class="headerlink" href="#overview" title="Link to this heading"></a></h1>
<section id="concepts">
<span id="build-concept-definitions"></span><h2>Concepts<a class="headerlink" href="#concepts" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p><strong>SOC Project</strong>: Each SOC project root directory contains a <code class="file docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> as the build entry point. All MCU projects under it are added here.</p></li>
<li><p><strong>MCU Project</strong>: Each MCU project uses unified toolchain and configuration parameters (some configurations may vary due to firmware or ROM). Different MCU projects may use different toolchains. An MCU project includes builds of one or more firmwares.</p></li>
<li><p><strong>Firmware</strong>: Mainly includes <code class="file docutils literal notranslate"><span class="pre">image1</span></code>, <code class="file docutils literal notranslate"><span class="pre">image2</span></code>, <code class="file docutils literal notranslate"><span class="pre">image3</span></code>, with differences as follows:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">image1</span></code>: Defines the common infrastructure for bootloader and system flash layout in MCU systems, providing a secure bootloader with convenient software upgrade support.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">image2</span></code>: The main application firmware of the SOC, typically containing a real-time OS (FreeRTOS) and application tasks.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">image3</span></code>: Highly configurable, allowing users to include only required security services. Protected by Read Protection (RDP), decrypted in the secure bootloader, and loaded into TrustZone-protected SRAM.</p></li>
</ul>
</li>
<li><p><strong>Component</strong>: Components are organized under the <code class="file docutils literal notranslate"><span class="pre">component</span></code> directory at the same level as SOC projects. Each subdirectory represents a functional module with its own <code class="file docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> defining compilation and linking configurations.</p></li>
<li><p><strong>Firmware Build</strong>: In each MCU project’s <code class="file docutils literal notranslate"><span class="pre">[asdk|vsdk]/make/[image1|image2|image3]/CMakeLists.txt</span></code>, add required components and define generation rules.</p></li>
</ul>
<p>The project’s <code class="file docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> directory structure and invocation relationships are shown below:</p>
<figure class="align-center" id="build-cmake-project-structure">
<a class="reference internal image-reference" href="../../_images/build_cmake_project_structure.svg"><img alt="../../_images/build_cmake_project_structure.svg" height="886" src="../../_images/build_cmake_project_structure.svg" width="1216" /></a>
</figure>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>In the diagram above, the <code class="file docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> in <code class="file docutils literal notranslate"><span class="pre">image1</span></code>, <code class="file docutils literal notranslate"><span class="pre">image2</span></code>, and <code class="file docutils literal notranslate"><span class="pre">image3</span></code> directories can <strong>independently add components for their respective firmwares</strong>.</p>
</div>
<p>Directory structure of <code class="file docutils literal notranslate"><span class="pre">component/cmake</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>cmake
├── flags                              # Global compile and link options
│   ├── ca32
│   │   ├── compile_options.cmake
│   │   └── link_options.cmake
│   ├── common
│   │   ├── compile_options.cmake
│   │   └── link_options.cmake
│   ├── km0
│   │   ├── compile_options.cmake
│   │   └── link_options.cmake
│   ├── km4
│   │   ├── compile_options.cmake
│   │   └── link_options.cmake
│   └── kr4
│       ├── compile_options.cmake
│       └── link_options.cmake
├── CMakeLists-template.cmake        # CMakeLists.txt template for component
├── common.cmake                     # Project related APIs
├── global_define.cmake              # Global defined parameters
├── utility_base.cmake               # Utility APIs (lower level)
├── utility.cmake                    # Utility APIs (upper level)
└── toolchain                        # Toolchain defines
    ├── ameba-toolchain-asdk-10.3.1.cmake
    ├── ameba-toolchain-asdk-12.3.1.cmake
    ├── ameba-toolchain-check.cmake
    ├── ameba-toolchain-common.cmake
    └── ameba-toolchain-vsdk-10.3.1.cmake
</pre></div>
</div>
</section>
<section id="global-compilation-configuration">
<span id="build-global-compile-config"></span><h2>Global Compilation Configuration<a class="headerlink" href="#global-compilation-configuration" title="Link to this heading"></a></h2>
<section id="compilation-configuration-contents">
<h3>Compilation Configuration Contents<a class="headerlink" href="#compilation-configuration-contents" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p><strong>Include directories</strong></p></li>
<li><p><strong>Compile options</strong></p></li>
<li><p><strong>Definitions</strong></p></li>
<li><p><strong>Link options</strong></p></li>
<li><p><strong>Link libraries</strong></p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p><strong>Include directories, compile options, and definitions</strong> are used for component compilation.</p></li>
<li><p><strong>Link options</strong> and <strong>link libraries</strong> are used for firmware linking.</p></li>
</ul>
</div>
</section>
<section id="scope-of-global-compilation-configuration">
<h3>Scope of Global Compilation Configuration<a class="headerlink" href="#scope-of-global-compilation-configuration" title="Link to this heading"></a></h3>
<p>The <strong>global compilation configuration</strong> applies to each MCU project. For example, <code class="docutils literal notranslate"><span class="pre">RTL8721Dx</span></code> has separate configurations for <code class="docutils literal notranslate"><span class="pre">km0</span></code> and <code class="docutils literal notranslate"><span class="pre">km4</span></code>, while <code class="docutils literal notranslate"><span class="pre">RTL8730E</span></code> has configurations for <code class="docutils literal notranslate"><span class="pre">km0</span></code>, <code class="docutils literal notranslate"><span class="pre">km4</span></code>, and <code class="docutils literal notranslate"><span class="pre">ca32</span></code>. These configurations are isolated. <strong>Components under the same MCU project use the same global compilation configuration</strong>. See the following diagram:</p>
<figure class="align-center" id="build-cmake-project-structure-with-config">
<a class="reference internal image-reference" href="../../_images/build_cmake_project_structure_with_config.svg"><img alt="../../_images/build_cmake_project_structure_with_config.svg" height="885" src="../../_images/build_cmake_project_structure_with_config.svg" width="1268" /></a>
</figure>
<p>Key points:</p>
<ul class="simple">
<li><p>Each MCU project contains an independent compilation scope.</p></li>
<li><p>Different firmwares (<code class="file docutils literal notranslate"><span class="pre">image1</span></code>, <code class="file docutils literal notranslate"><span class="pre">image2</span></code>, <code class="file docutils literal notranslate"><span class="pre">image3</span></code>) under the same MCU project share the same compilation config.</p></li>
<li><p>The same component is compiled with <strong>different global configurations</strong> across MCU projects (e.g., <code class="docutils literal notranslate"><span class="pre">at_cmd</span></code> in <code class="docutils literal notranslate"><span class="pre">project_mcu1</span></code> vs. <code class="docutils literal notranslate"><span class="pre">project_mcu2</span></code>).</p></li>
</ul>
</section>
</section>
<section id="component-compilation-cmakelists-txt">
<span id="build-component-cmake-structure"></span><h2>Component Compilation CMakeLists.txt<a class="headerlink" href="#component-compilation-cmakelists-txt" title="Link to this heading"></a></h2>
<p>Consists of <a class="reference internal" href="#build-component-cmake-public-part"><span class="std std-ref">Component Public Part</span></a> and <a class="reference internal" href="#build-component-cmake-private-part"><span class="std std-ref">Component Private Part</span></a>:</p>
<ul class="simple">
<li><p>The former appends configurations to the <a class="reference internal" href="#build-global-compile-config"><span class="std std-ref">Global Compilation Configuration</span></a>.</p></li>
<li><p>The latter defines the <strong>component’s library</strong> build configuration.</p></li>
</ul>
<section id="component-public-part">
<span id="build-component-cmake-public-part"></span><h3>Component Public Part<a class="headerlink" href="#component-public-part" title="Link to this heading"></a></h3>
<p>Appends the following to the <a class="reference internal" href="#build-global-compile-config"><span class="std std-ref">Global Compilation Configuration</span></a>:</p>
<ul class="simple">
<li><p><strong>Include directories</strong>: Added to global if other components need headers from this component.</p></li>
<li><p><strong>Definitions</strong>: Global preprocessor macros added to global when this component is added (rarely used).</p></li>
<li><p><strong>Link libraries</strong>: Required if the component is provided as a prebuilt library (not source). Use <a class="reference internal" href="#build-ameba-add-external-app-library"><span class="std std-ref">ameba_add_external_app_library</span></a> to build the library.</p></li>
</ul>
<p>Configuration variables: <code class="docutils literal notranslate"><span class="pre">public_includes</span></code>, <code class="docutils literal notranslate"><span class="pre">public_definitions</span></code>, <code class="docutils literal notranslate"><span class="pre">public_libraries</span></code>. Update these in the highlighted section of code block below. See examples in <code class="file docutils literal notranslate"><span class="pre">cmake/CMakeLists-template.cmake</span></code> and APIs in <a class="reference internal" href="#build-cmake-api-list"><span class="std std-ref">List Operations</span></a>.</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c">##########################################################################################</span>
<span class="linenos"> 2</span><span class="c">## * This part defines public part of the component</span>
<span class="linenos"> 3</span><span class="c">## * Public part will be used as global build configures for all component</span>
<span class="linenos"> 4</span>
<span class="linenos"> 5</span><span class="nb">set</span><span class="p">(</span><span class="s">public_includes</span><span class="p">)</span><span class="w">                </span><span class="c">#public include directories, NOTE: relative path is OK</span>
<span class="linenos"> 6</span><span class="nb">set</span><span class="p">(</span><span class="s">public_definitions</span><span class="p">)</span><span class="w">             </span><span class="c">#public definitions</span>
<span class="linenos"> 7</span><span class="nb">set</span><span class="p">(</span><span class="s">public_libraries</span><span class="p">)</span><span class="w">               </span><span class="c">#public libraries(files), NOTE: linked with whole-archive options</span>
<span class="linenos"> 8</span>
<span class="linenos"> 9</span><span class="c">#------------------------------------------------------------------#</span>
<span class="linenos">10</span><span class="c"># Component public part, user config begin(DO NOT remove this line)</span>
<span class="hll"><span class="linenos">11</span>
</span><span class="hll"><span class="linenos">12</span><span class="c"># set public_includes, public_definitions, public_libraries in this section</span>
</span><span class="hll"><span class="linenos">13</span>
</span><span class="linenos">14</span><span class="c"># Component public part, user config end(DO NOT remove this line)</span>
<span class="linenos">15</span><span class="c">#------------------------------------------------------------------#</span>
<span class="linenos">16</span>
<span class="linenos">17</span><span class="c">#WARNING: Fixed section, DO NOT change!</span>
<span class="linenos">18</span><span class="nb">ameba_global_include</span><span class="p">(</span><span class="o">${</span><span class="nv">public_includes</span><span class="o">}</span><span class="p">)</span>
<span class="linenos">19</span><span class="nb">ameba_global_define</span><span class="p">(</span><span class="o">${</span><span class="nv">public_defines</span><span class="o">}</span><span class="p">)</span>
<span class="linenos">20</span><span class="nb">ameba_global_library</span><span class="p">(</span><span class="o">${</span><span class="nv">public_libraries</span><span class="o">}</span><span class="p">)</span><span class="w"> </span><span class="c">#default: whole-achived</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If there’s no need to update the three types of configurations mentioned above for the current component, the highlighted code section can be left blank.</p>
</div>
</section>
<section id="component-private-part">
<span id="build-component-cmake-private-part"></span><h3>Component Private Part<a class="headerlink" href="#component-private-part" title="Link to this heading"></a></h3>
<p>Defines the component library build:</p>
<ul class="simple">
<li><p><strong>Source files</strong>: Source files for current component</p></li>
<li><p><strong>Private includes</strong>: Only for current component</p></li>
<li><p><strong>Private definitions</strong>: Only for current component</p></li>
<li><p><strong>Private compile options</strong>: Only for current component</p></li>
</ul>
<p>Configuration variables: <code class="docutils literal notranslate"><span class="pre">private_sources</span></code>, <code class="docutils literal notranslate"><span class="pre">private_includes</span></code>, <code class="docutils literal notranslate"><span class="pre">private_definitions</span></code>, <code class="docutils literal notranslate"><span class="pre">private_compile_options</span></code>. Update these in the highlighted section of code block below. See examples in <code class="file docutils literal notranslate"><span class="pre">cmake/CMakeLists-template.cmake</span></code> and APIs in <a class="reference internal" href="#build-cmake-api-list"><span class="std std-ref">List Operations</span></a>.</p>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>The final compilation configuration of a component (particularly <strong>include directories</strong>, <strong>definitions</strong> and <strong>compile options</strong>) is composed of both <a class="reference internal" href="#build-component-cmake-private-part"><span class="std std-ref">Component Private Part</span></a> and <a class="reference internal" href="#build-component-cmake-public-part"><span class="std std-ref">Component Public Part</span></a>, with <strong>the former taking higher priority for include directories and compile options</strong> . For example, the actual header search paths for a component include:</p>
<ul class="simple">
<li><p><strong>Private include directories</strong> added by the current component.</p></li>
<li><p><strong>Global include directories</strong> from <a class="reference internal" href="#build-global-compile-config"><span class="std std-ref">Global Compilation Configuration</span></a>, which includes paths appended by <strong>both the current component</strong> and <strong>other components</strong>.</p></li>
</ul>
<p>Therefore, configurations already added in <a class="reference internal" href="#build-component-cmake-public-part"><span class="std std-ref">Component Public Part</span></a> should <strong>not be duplicated</strong> in <a class="reference internal" href="#build-component-cmake-private-part"><span class="std std-ref">Component Private Part</span></a>.</p>
<p>General recommendations:</p>
<ul class="simple">
<li><p>Prefer placing include directories in the <a class="reference internal" href="#build-component-cmake-private-part"><span class="std std-ref">Component Private Part</span></a> to avoid header file pollution.</p></li>
<li><p>Exceptions: For generic or low-level components used by many others, placing includes in <a class="reference internal" href="#build-component-cmake-public-part"><span class="std std-ref">Component Public Part</span></a> is preferred to improve reusability.</p></li>
</ul>
</div>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c">##########################################################################################</span>
<span class="linenos"> 2</span><span class="c">## * This part defines private part of the component</span>
<span class="linenos"> 3</span><span class="c">## * Private part is used to build target of current component</span>
<span class="linenos"> 4</span><span class="c">## * NOTE: The build API guarantees the global build configures(mentioned above)</span>
<span class="linenos"> 5</span><span class="c">## *       applied to the target automatically. So if any configure was already added</span>
<span class="linenos"> 6</span><span class="c">## *       to public above, it&#39;s unnecessary to add again below.</span>
<span class="linenos"> 7</span>
<span class="linenos"> 8</span><span class="c">#NOTE: User defined section, add your private build configures here</span>
<span class="linenos"> 9</span><span class="c"># You may use if-else condition to set these predefined variable</span>
<span class="linenos">10</span><span class="c"># They are only for ameba_add_internal_library/ameba_add_external_app_library/ameba_add_external_soc_library</span>
<span class="linenos">11</span><span class="nb">set</span><span class="p">(</span><span class="s">private_sources</span><span class="p">)</span><span class="w">                 </span><span class="c">#private source files, NOTE: relative path is OK</span>
<span class="linenos">12</span><span class="nb">set</span><span class="p">(</span><span class="s">private_includes</span><span class="p">)</span><span class="w">                </span><span class="c">#private include directories, NOTE: relative path is OK</span>
<span class="linenos">13</span><span class="nb">set</span><span class="p">(</span><span class="s">private_definitions</span><span class="p">)</span><span class="w">             </span><span class="c">#private definitions</span>
<span class="linenos">14</span><span class="nb">set</span><span class="p">(</span><span class="s">private_compile_options</span><span class="p">)</span><span class="w">         </span><span class="c">#private compile_options</span>
<span class="linenos">15</span>
<span class="linenos">16</span><span class="c">#------------------------------#</span>
<span class="linenos">17</span><span class="c"># Component private part, user config begin</span>
<span class="hll"><span class="linenos">18</span>
</span><span class="hll"><span class="linenos">19</span><span class="w"> </span><span class="c"># set private_sources, private_includes, private_definitions, private_compile_options in this section</span>
</span><span class="hll"><span class="linenos">20</span>
</span><span class="linenos">21</span><span class="c"># Component private part, user config end</span>
<span class="linenos">22</span><span class="c">#------------------------------#</span>
<span class="linenos">23</span>
<span class="linenos">24</span><span class="c">#WARNING: Select right API based on your component&#39;s release/not-release/standalone</span>
<span class="linenos">25</span>
<span class="linenos">26</span><span class="c">###NOTE: For open-source component, always build from source</span>
<span class="hll"><span class="linenos">27</span><span class="nb">ameba_add_internal_library</span><span class="p">(</span><span class="s">foo</span>
</span><span class="linenos">28</span><span class="w">    </span><span class="s">p_SOURCES</span>
<span class="linenos">29</span><span class="w">        </span><span class="o">${</span><span class="nv">private_sources</span><span class="o">}</span>
<span class="linenos">30</span><span class="w">    </span><span class="s">p_INCLUDES</span>
<span class="linenos">31</span><span class="w">        </span><span class="o">${</span><span class="nv">private_includes</span><span class="o">}</span>
<span class="linenos">32</span><span class="w">    </span><span class="s">p_DEFINITIONS</span>
<span class="linenos">33</span><span class="w">        </span><span class="o">${</span><span class="nv">private_definitions</span><span class="o">}</span>
<span class="linenos">34</span><span class="w">    </span><span class="s">p_COMPILE_OPTIONS</span>
<span class="linenos">35</span><span class="w">        </span><span class="o">${</span><span class="nv">private_compile_options</span><span class="o">}</span>
<span class="linenos">36</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>The code block above uses <a class="reference internal" href="#build-ameba-add-internal-library"><span class="std std-ref">ameba_add_internal_library</span></a> to generate library files. Other APIs can also be selected as needed. For details, see <a class="reference internal" href="#build-cmake-api-add-library"><span class="std std-ref">Add Library</span></a>. For modifications to the highlighted code section, refer to <a class="reference internal" href="#build-modify-existing-component-build-config"><span class="std std-ref">Modifying Existing Component Build Config</span></a>.</p></li>
<li><p>If the component already has a directory with standalone build scripts, see <a class="reference internal" href="#build-porting-standalone-code"><span class="std std-ref">Integrating Code with Standalone Build System</span></a>.</p></li>
</ul>
</div>
</section>
</section>
</section>
<section id="best-practices">
<h1>Best Practices<a class="headerlink" href="#best-practices" title="Link to this heading"></a></h1>
<section id="modifying-existing-component-build-config">
<span id="build-modify-existing-component-build-config"></span><h2>Modifying Existing Component Build Config<a class="headerlink" href="#modifying-existing-component-build-config" title="Link to this heading"></a></h2>
<p>Refer to the instructions in <a class="reference internal" href="#build-component-cmake-structure"><span class="std std-ref">Component Compilation CMakeLists.txt</span></a>, utilize <a class="reference internal" href="#build-some-types-for-logic-process"><span class="std std-ref">Useful Types for Complex Logic Processing</span></a>, and note that APIs from <a class="reference internal" href="#build-cmake-api-list"><span class="std std-ref">List Operations</span></a> can be called multiple times. Below are some examples:</p>
<ul>
<li><p>Add public header file paths. It is recommended to use relative paths:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">ameba_list_append</span><span class="p">(</span><span class="s">public_includes</span>
<span class="w">    </span><span class="o">${</span><span class="nv">CMAKE_CURRENT_SOURCE_DIR</span><span class="o">}</span><span class="w">        </span><span class="c"># Access current dir by CMAKE_CURRENT_SOURCE_DIR, same as .</span>
<span class="w">    </span><span class="o">${</span><span class="nv">CMAKE_CURRENT_SOURCE_DIR</span><span class="o">}</span><span class="s">/foo</span><span class="w">    </span><span class="c"># Access sub dir by CMAKE_CURRENT_SOURCE_DIR, same as ./foo</span>
<span class="w">    </span><span class="s">foo</span><span class="w">                                </span><span class="c"># Access sub dir directly</span>
<span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>Add the link library paths. For the variables used here, you can refer to <a class="reference internal" href="#build-cmake-api-some-const-variable-mcu-proj"><span class="std std-ref">MCU Project-related Constants</span></a>:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">ameba_list_append</span><span class="p">(</span><span class="s">public_libraries</span>
<span class="w">    </span><span class="o">${</span><span class="nv">c_SDK_LIB_APP_DIR</span><span class="o">}</span><span class="s">/lib_foo.a</span>
<span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>Add private sources. It is recommended to use relative paths:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">ameba_list_append</span><span class="p">(</span><span class="s">private_sources</span>
<span class="w">    </span><span class="s">foo/foo.c</span>
<span class="w">    </span><span class="s">bar/bar.c</span>
<span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>Add private header file paths. It is recommended to use relative paths:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">ameba_list_append</span><span class="p">(</span><span class="s">public_includes</span>
<span class="w">    </span><span class="s">../common</span><span class="w">  </span><span class="c"># Access parent dir</span>
<span class="w">    </span><span class="s">foo</span>
<span class="w">    </span><span class="s">bar</span>
<span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>Add definitions:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">ameba_list_append</span><span class="p">(</span><span class="s">private_definitions</span>
<span class="w">    </span><span class="s">__RTOS__</span>
<span class="w">    </span><span class="s">MBEDTLS_CONFIG_FILE=</span><span class="s2">&quot;mbedtls/config.h&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>Add compile options:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">ameba_list_append</span><span class="p">(</span><span class="s">private_compile_options</span>
<span class="w">    </span><span class="s">-Wno-unused-parameter</span>
<span class="p">)</span>
</pre></div>
</div>
</li>
</ul>
</section>
<section id="quickly-compile-link-source-files-for-testing">
<span id="build-compile-some-source-and-link-to-image"></span><h2>Quickly Compile &amp; Link Source Files for Testing<a class="headerlink" href="#quickly-compile-link-source-files-for-testing" title="Link to this heading"></a></h2>
<p>Steps:</p>
<ol class="arabic">
<li><p>Copy <code class="file docutils literal notranslate"><span class="pre">cmake/CMakeLists-template.cmake</span></code> to your source directory as <code class="file docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code>.</p></li>
<li><p>Refer to <a class="reference internal" href="#build-modify-existing-component-build-config"><span class="std std-ref">Modifying Existing Component Build Config</span></a> configure <a class="reference internal" href="#build-component-cmake-public-part"><span class="std std-ref">Component Public Part</span></a> and <a class="reference internal" href="#build-component-cmake-private-part"><span class="std std-ref">Component Private Part</span></a>.</p></li>
<li><p>Select <a class="reference internal" href="#build-ameba-add-internal-library"><span class="std std-ref">ameba_add_internal_library</span></a> in <a class="reference internal" href="#build-component-cmake-private-part"><span class="std std-ref">Component Private Part</span></a>.</p></li>
<li><p>Refer to <a class="reference internal" href="#build-cmake-project-structure"><span class="std std-ref">CMakeLists.txt invocation relationships</span></a> add the component directory in the firmware’s <code class="file docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code>:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">ameba_add_subdirectory</span><span class="p">(</span><span class="s">path/to/your/cmakelists</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>Compile and test</p></li>
</ol>
</section>
<section id="integrating-code-with-standalone-build-system">
<span id="build-porting-standalone-code"></span><h2>Integrating Code with Standalone Build System<a class="headerlink" href="#integrating-code-with-standalone-build-system" title="Link to this heading"></a></h2>
<p>For third-party code with independent build systems (e.g., CMake/Makefile-based components), non-intrusive integration solutions can be implemented to link them into the firmware. Specific adaptation strategies should be selected based on their build system types:</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-0-0-0" aria-selected="true" class="sphinx-tabs-tab" id="tab-0-0-0" name="0-0" role="tab" tabindex="0">CMake</button><button aria-controls="panel-0-0-1" aria-selected="false" class="sphinx-tabs-tab" id="tab-0-0-1" name="0-1" role="tab" tabindex="-1">Makefile</button></div><div aria-labelledby="tab-0-0-0" class="sphinx-tabs-panel" id="panel-0-0-0" name="0-0" role="tabpanel" tabindex="0"><ol class="arabic">
<li><p>Create a wrapper <code class="file docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> in some directory using the template <code class="file docutils literal notranslate"><span class="pre">cmake/CMakeLists-template.cmake</span></code>.</p></li>
<li><p>Refer to <a class="reference internal" href="#build-modify-existing-component-build-config"><span class="std std-ref">Modifying Existing Component Build Config</span></a> to config <a class="reference internal" href="#build-component-cmake-public-part"><span class="std std-ref">Component Public Part</span></a></p></li>
<li><p>In <a class="reference internal" href="#build-component-cmake-private-part"><span class="std std-ref">Component Private Part</span></a>, add the original CMake project via <code class="xref py py-func docutils literal notranslate"><span class="pre">ameba_add_subdirectory()</span></code> and use <a class="reference internal" href="#build-ameba-port-standalone-internal-library"><span class="std std-ref">ameba_port_standalone_internal_library</span></a> to link the target:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">ameba_add_subdirectory</span><span class="p">(</span><span class="s">path/to/your/cmakelists</span><span class="p">)</span><span class="w"> </span><span class="c"># Add the real CMakeLists.txt dir of the wrapped component</span>
<span class="nb">ameba_port_standalone_internal_library</span><span class="p">(</span><span class="s">foo</span><span class="p">)</span><span class="w">     </span><span class="c"># Add the real target of the wrapped component to link</span>
</pre></div>
</div>
</li>
<li><p>Refer to <a class="reference internal" href="#build-cmake-project-structure"><span class="std std-ref">CMakeLists.txt invocation relationships</span></a> add the component directory in the firmware’s <code class="file docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code>:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">ameba_add_subdirectory</span><span class="p">(</span><span class="s">path/to/your/wrap/cmakelists</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>Compile and test</p></li>
</ol>
</div><div aria-labelledby="tab-0-0-1" class="sphinx-tabs-panel" hidden="true" id="panel-0-0-1" name="0-1" role="tabpanel" tabindex="0"><ol class="arabic">
<li><p>Create a wrapper <code class="file docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> in some directory using the template <code class="file docutils literal notranslate"><span class="pre">cmake/CMakeLists-template.cmake</span></code>.</p></li>
<li><p>Refer to <a class="reference internal" href="#build-modify-existing-component-build-config"><span class="std std-ref">Modifying Existing Component Build Config</span></a> to configure the <a class="reference internal" href="#build-component-cmake-public-part"><span class="std std-ref">Component Public Part</span></a>, specifically setting the <code class="docutils literal notranslate"><span class="pre">public_libraries</span></code> variable to the path of the final library file.</p></li>
<li><p>In <a class="reference internal" href="#build-component-cmake-private-part"><span class="std std-ref">Component Private Part</span></a>, Use <code class="docutils literal notranslate"><span class="pre">add_custom_target</span></code> to invoke makefile as below:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">add_custom_target</span><span class="p">(</span><span class="s">foo</span><span class="w"> </span><span class="s">ALL</span><span class="w">                                     </span><span class="c"># Replace foo with new name as you wish</span>
<span class="w">    </span><span class="s">COMMAND</span><span class="w"> </span><span class="o">${</span><span class="nv">CMAKE_COMMAND</span><span class="o">}</span><span class="w"> </span><span class="s">-E</span><span class="w"> </span><span class="s">echo</span><span class="w"> </span><span class="s2">&quot;Building foo project&quot;</span><span class="w">   </span><span class="c"># Some prompt message while building</span>
<span class="w">    </span><span class="s">COMMAND</span><span class="w"> </span><span class="s">make</span><span class="w"> </span><span class="s">-j</span><span class="w"> </span><span class="s">-C</span><span class="w"> </span><span class="s">/path/to/your/makefile</span><span class="w"> </span><span class="s">all</span><span class="w">             </span><span class="c"># Set your makefile path</span>
<span class="w">    </span><span class="s">COMMENT</span><span class="w"> </span><span class="s2">&quot;Building foo project using make&quot;</span>
<span class="p">)</span>

<span class="nb">ameba_target_depend</span><span class="p">(</span><span class="o">${</span><span class="nv">c_CURRENT_IMAGE</span><span class="o">}</span><span class="w"> </span><span class="s">foo</span><span class="p">)</span><span class="w">                   </span><span class="c"># Add dependency, foo MUST be same as in add_custom_target above</span>
</pre></div>
</div>
</li>
<li><p>Refer to <a class="reference internal" href="#build-cmake-project-structure"><span class="std std-ref">CMakeLists.txt invocation relationships</span></a> add the component directory in the firmware’s <code class="file docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code>:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">ameba_add_subdirectory</span><span class="p">(</span><span class="s">path/to/your/wrap/cmakelists</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>Compile and test</p></li>
</ol>
</div></div>
</section>
<section id="adjusting-submodule-organization-relationships-in-components">
<h2>Adjusting Submodule Organization Relationships in Components<a class="headerlink" href="#adjusting-submodule-organization-relationships-in-components" title="Link to this heading"></a></h2>
<p>When a component is complex and contains multiple subcomponents, the <code class="file docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> in the component root directory should manage their organizational relationships. Pay attention to:</p>
<ul>
<li><p><strong>Configuration Checks</strong>: Since <strong>MCU projects generally don’t check switches and directly add components</strong>, configuration checks must be performed here. Example from <code class="file docutils literal notranslate"><span class="pre">component/bluetooth/CMakeLists.txt</span></code>:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">if</span><span class="p">(</span><span class="s">NOT</span><span class="w"> </span><span class="s">CONFIG_BT</span><span class="p">)</span>
<span class="w">    </span><span class="nb">ameba_info</span><span class="p">(</span><span class="s2">&quot;CONFIG_BT is off, bluetooth will not be built&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nb">return</span><span class="p">()</span>
<span class="nb">endif</span><span class="p">()</span>
</pre></div>
</div>
</li>
<li><p><strong>Subcomponent Addition Logic</strong>: When splitting subcomponents, handle the addition logic using <a class="reference internal" href="#build-some-types-for-logic-process"><span class="std std-ref">Useful Types for Complex Logic Processing</span></a> Example from <code class="file docutils literal notranslate"><span class="pre">component/bluetooth/CMakeLists.txt</span></code>:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">ameba_add_subdirectory_ifnot</span><span class="p">(</span><span class="s">CONFIG_BT_INIC</span><span class="w"> </span><span class="s">api</span><span class="p">)</span>
<span class="nb">ameba_add_subdirectory_if</span><span class="p">(</span><span class="s">CONFIG_BT_AUDIO_CODEC_SUPPORT</span><span class="w"> </span><span class="s">bt_audio</span><span class="p">)</span>
<span class="nb">ameba_add_subdirectory</span><span class="p">(</span><span class="s">bt_mp</span><span class="p">)</span>
<span class="nb">ameba_add_subdirectory</span><span class="p">(</span><span class="s">driver</span><span class="p">)</span>
<span class="nb">ameba_add_subdirectory_ifnot</span><span class="p">(</span><span class="s">CONFIG_BT_INIC</span><span class="w"> </span><span class="s">example</span><span class="p">)</span>
<span class="nb">ameba_add_subdirectory</span><span class="p">(</span><span class="s">osif</span><span class="p">)</span>
<span class="nb">ameba_add_subdirectory</span><span class="p">(</span><span class="s">rtk_coex</span><span class="p">)</span>
<span class="nb">if</span><span class="p">(</span><span class="s">CONFIG_BT_ZEPHYR</span><span class="p">)</span>
<span class="w">    </span><span class="nb">ameba_add_subdirectory</span><span class="p">(</span><span class="s">zephyr</span><span class="p">)</span>
<span class="nb">elseif</span><span class="p">(</span><span class="s">NOT</span><span class="w"> </span><span class="s">CONFIG_BT_INIC</span><span class="p">)</span>
<span class="w">    </span><span class="nb">ameba_add_subdirectory</span><span class="p">(</span><span class="s">rtk_stack</span><span class="p">)</span><span class="w">  </span><span class="c"># refer to ble_mesh_stack</span>
<span class="nb">endif</span><span class="p">()</span>
</pre></div>
</div>
</li>
</ul>
</section>
<section id="adding-new-components-in-component-directory">
<h2>Adding New Components in Component Directory<a class="headerlink" href="#adding-new-components-in-component-directory" title="Link to this heading"></a></h2>
<p>To add a new independent component:</p>
<ol class="arabic">
<li><p>Add component path variables in <code class="file docutils literal notranslate"><span class="pre">cmake/global_define.cmake</span></code> as below:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">ameba_set</span><span class="p">(</span><span class="s">c_CMPT_WIFI_DIR</span><span class="w">         </span><span class="o">${</span><span class="nv">c_COMPONENT_DIR</span><span class="o">}</span><span class="s">/wifi</span><span class="p">)</span>
<span class="nb">ameba_set</span><span class="p">(</span><span class="s">c_CMPT_WPAN_DIR</span><span class="w">         </span><span class="o">${</span><span class="nv">c_COMPONENT_DIR</span><span class="o">}</span><span class="s">/wpan</span><span class="p">)</span>

<span class="nb">ameba_set</span><span class="p">(</span><span class="s">c_CMPT_CRASHDUMP_DIR</span><span class="w">    </span><span class="o">${</span><span class="nv">c_COMPONENT_DIR</span><span class="o">}</span><span class="s">/soc/common/crashdump</span><span class="p">)</span>
<span class="nb">ameba_set</span><span class="p">(</span><span class="s">c_CMPT_LZMA_DIR</span><span class="w">         </span><span class="o">${</span><span class="nv">c_COMPONENT_DIR</span><span class="o">}</span><span class="s">/soc/common/lzma</span><span class="p">)</span>

<span class="hll"><span class="nb">ameba_set</span><span class="p">(</span><span class="s">c_CMPT_FOO_DIR</span><span class="w">         </span><span class="o">${</span><span class="nv">c_COMPONENT_DIR</span><span class="o">}</span><span class="s">/foo</span><span class="p">)</span><span class="w">  </span><span class="c"># new component</span>
</span></pre></div>
</div>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>For SOC/MCU-related components, add them in the <code class="xref py py-func docutils literal notranslate"><span class="pre">ameba_reset_global_define()</span></code> macro:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">macro</span><span class="p">(</span><span class="s">ameba_reset_global_define</span><span class="p">)</span>
<span class="w">    </span><span class="nb">ameba_set</span><span class="p">(</span><span class="s">c_CMPT_USRCFG_DIR</span><span class="w"> </span><span class="o">${</span><span class="nv">c_COMPONENT_DIR</span><span class="o">}</span><span class="s">/soc/usrcfg/</span><span class="o">${</span><span class="nv">c_SOC_TYPE</span><span class="o">}</span><span class="p">)</span>
<span class="w">    </span><span class="nb">ameba_set</span><span class="p">(</span><span class="s">c_CMPT_BOOTLOADER_DIR</span><span class="w"> </span><span class="o">${</span><span class="nv">c_CMPT_SOC_DIR</span><span class="o">}</span><span class="s">/bootloader</span><span class="p">)</span>

<span class="hll"><span class="w">    </span><span class="nb">ameba_set</span><span class="p">(</span><span class="s">c_CMPT_FOO_DIR</span><span class="w"> </span><span class="o">${</span><span class="nv">c_CMPT_SOC_DIR</span><span class="o">}</span><span class="s">/foo</span><span class="p">)</span><span class="w">  </span><span class="c"># new component</span>
</span><span class="nb">endmacro</span><span class="p">()</span>
</pre></div>
</div>
</div>
</li>
<li><p>Create component directory under <code class="file docutils literal notranslate"><span class="pre">component</span></code> and add <code class="file docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> following <a class="reference internal" href="#build-component-cmake-structure"><span class="std std-ref">Component Compilation CMakeLists.txt</span></a>.</p></li>
<li><p>Add in firmware’s <code class="file docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code>:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">ameba_add_subdirectory</span><span class="p">(</span><span class="o">${</span><span class="nv">c_CMPT_FOO_DIR</span><span class="o">}</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ol>
</section>
</section>
<section id="commonly-used-cmake-interfaces-and-preset-constants">
<h1>Commonly Used CMake Interfaces and Preset Constants<a class="headerlink" href="#commonly-used-cmake-interfaces-and-preset-constants" title="Link to this heading"></a></h1>
<section id="list-operations">
<span id="build-cmake-api-list"></span><h2>List Operations<a class="headerlink" href="#list-operations" title="Link to this heading"></a></h2>
<section id="ameba-list-append">
<h3>ameba_list_append<a class="headerlink" href="#ameba-list-append" title="Link to this heading"></a></h3>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">ameba_list_append</span><span class="p">(</span><span class="s">&lt;list_name&gt;</span><span class="w"> </span><span class="s">[&lt;value&gt;</span><span class="w"> </span><span class="s">...]</span><span class="p">)</span>
</pre></div>
</div>
<p>Appends elements to a list, supports appending multiple elements. Parameter description:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">list_name</span></code>: List variable name</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">value</span></code>: Value(s) to append</p></li>
</ul>
</section>
<section id="ameba-list-append-if">
<h3>ameba_list_append_if<a class="headerlink" href="#ameba-list-append-if" title="Link to this heading"></a></h3>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">ameba_list_append_if</span><span class="p">(</span><span class="s">&lt;condition&gt;</span><span class="w"> </span><span class="s">&lt;list_name&gt;</span><span class="w"> </span><span class="s">[&lt;value&gt;</span><span class="w"> </span><span class="s">...]</span><span class="w"> </span><span class="s">[p_ELSE</span><span class="w"> </span><span class="s">&lt;else</span><span class="w"> </span><span class="s">value&gt;</span><span class="w"> </span><span class="s">...]</span><span class="p">)</span>
</pre></div>
</div>
<p>Appends elements to a list conditionally, supports appending multiple elements. Parameter description:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">condition</span></code>: Variable name representing the condition</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">list_name</span></code>: List variable name</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">value</span></code>: Value(s) to append when <code class="docutils literal notranslate"><span class="pre">condition</span></code> is true</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">p_ELSE</span></code>: Optional keyword parameter, followed by value(s) to append when <code class="docutils literal notranslate"><span class="pre">condition</span></code> is false</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">else</span> <span class="pre">value</span></code>: Value(s) to append when <code class="docutils literal notranslate"><span class="pre">condition</span></code> is false</p></li>
</ul>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>If the variable represented by <code class="docutils literal notranslate"><span class="pre">condition</span></code> is undefined or defined with a bool value of <code class="docutils literal notranslate"><span class="pre">FALSE</span></code>, it will be considered as false.</p>
</div>
</section>
<section id="ameba-list-append-ifnot">
<h3>ameba_list_append_ifnot<a class="headerlink" href="#ameba-list-append-ifnot" title="Link to this heading"></a></h3>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">ameba_list_append_ifnot</span><span class="p">(</span><span class="s">&lt;condition&gt;</span><span class="w"> </span><span class="s">&lt;list_name&gt;</span><span class="w"> </span><span class="s">[&lt;value&gt;</span><span class="w"> </span><span class="s">...]</span><span class="w"> </span><span class="s">[p_ELSE</span><span class="w"> </span><span class="s">&lt;else</span><span class="w"> </span><span class="s">value&gt;</span><span class="w"> </span><span class="s">...]</span><span class="p">)</span>
</pre></div>
</div>
<p>Appends elements to a list conditionally (opposite functionality to <code class="xref py py-func docutils literal notranslate"><span class="pre">ameba_list_append_if()</span></code>). Parameter description:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">condition</span></code>: Variable name representing the condition</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">list_name</span></code>: List variable name</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">value</span></code>: Value(s) to append when <code class="docutils literal notranslate"><span class="pre">condition</span></code> is false</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">p_ELSE</span></code>: Optional keyword parameter, followed by value(s) to append when <code class="docutils literal notranslate"><span class="pre">condition</span></code> is true</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">else</span> <span class="pre">value</span></code>: Value(s) to append when <code class="docutils literal notranslate"><span class="pre">condition</span></code> is true</p></li>
</ul>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>If the variable represented by <code class="docutils literal notranslate"><span class="pre">condition</span></code> is undefined or defined with a bool value of <code class="docutils literal notranslate"><span class="pre">FALSE</span></code>, it will be considered as false.</p>
</div>
</section>
<section id="ameba-list-append-ifdef">
<h3>ameba_list_append_ifdef<a class="headerlink" href="#ameba-list-append-ifdef" title="Link to this heading"></a></h3>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">ameba_list_append_ifdef</span><span class="p">(</span><span class="s">&lt;condition&gt;</span><span class="w"> </span><span class="s">&lt;list_name&gt;</span><span class="w"> </span><span class="s">[&lt;value&gt;</span><span class="w"> </span><span class="s">...]</span><span class="w"> </span><span class="s">[p_ELSE</span><span class="w"> </span><span class="s">&lt;else</span><span class="w"> </span><span class="s">value&gt;</span><span class="w"> </span><span class="s">...]</span><span class="p">)</span>
</pre></div>
</div>
<p>Appends elements to a list based on variable definition status. Parameter description:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">condition</span></code>: Variable name representing the condition</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">list_name</span></code>: List variable name</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">value</span></code>: Value(s) to append when <code class="docutils literal notranslate"><span class="pre">condition</span></code> is defined (Note: <code class="docutils literal notranslate"><span class="pre">condition</span></code> can be <code class="docutils literal notranslate"><span class="pre">FALSE</span></code>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">p_ELSE</span></code>: Optional keyword parameter, followed by value(s) to append when <code class="docutils literal notranslate"><span class="pre">condition</span></code> is undefined</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">else</span> <span class="pre">value</span></code>: Value(s) to append when <code class="docutils literal notranslate"><span class="pre">condition</span></code> is undefined</p></li>
</ul>
</section>
</section>
<section id="add-library">
<span id="build-cmake-api-add-library"></span><h2>Add Library<a class="headerlink" href="#add-library" title="Link to this heading"></a></h2>
<p>The following APIs are used to compile code into static libraries or to perform further processing on existing targets.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>These APIs have the following characteristics:</p>
<ul class="simple">
<li><p>The firmware that links the static library <strong>depends on which firmware’s</strong> <code class="file docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> it is added in. For example, if added in <a class="reference internal" href="#build-cmake-project-structure"><span class="std std-ref">image2/CMakeLists.txt</span></a>, the static library will be linked to firmware <code class="docutils literal notranslate"><span class="pre">image2</span></code>.</p></li>
<li><p>The actual target name generated by the <code class="docutils literal notranslate"><span class="pre">name</span></code> parameter in these APIs is combined with other information such as <a class="reference internal" href="#build-cmake-api-some-const-variable"><span class="std std-ref">c_MCU_PROJECT_NAME</span></a> and <a class="reference internal" href="#build-cmake-api-some-const-variable"><span class="std std-ref">c_CURRENT_IMAGE</span></a>. Users can obtain the real target name using the variable <code class="docutils literal notranslate"><span class="pre">c_CURRENT_TARGET_NAME</span></code> after API calls.</p></li>
<li><p>These APIs internally apply <a class="reference internal" href="#build-global-compile-config"><span class="std std-ref">Global Compilation Configuration</span></a> to compile the current target.</p></li>
</ul>
</div>
<section id="ameba-add-internal-library">
<span id="build-ameba-add-internal-library"></span><h3>ameba_add_internal_library<a class="headerlink" href="#ameba-add-internal-library" title="Link to this heading"></a></h3>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">ameba_add_internal_library</span><span class="p">(</span><span class="s">&lt;name&gt;</span>
<span class="w">                           </span><span class="s">[p_SOURCES</span><span class="w"> </span><span class="s">&lt;sources&gt;</span><span class="w"> </span><span class="s">...]</span>
<span class="w">                           </span><span class="s">[p_INCLUDES</span><span class="w"> </span><span class="s">&lt;include</span><span class="w"> </span><span class="s">dirs&gt;</span><span class="w"> </span><span class="s">...]</span>
<span class="w">                           </span><span class="s">[p_COMPILE_OPTIONS</span><span class="w"> </span><span class="s">&lt;compile</span><span class="w"> </span><span class="s">options&gt;</span><span class="w"> </span><span class="s">...]</span>
<span class="w">                           </span><span class="s">[p_DEFINITIONS</span><span class="w"> </span><span class="s">&lt;definitions&gt;</span><span class="w"> </span><span class="s">...]</span>
<span class="w">                           </span><span class="s">[p_DEPENDENCIES</span><span class="w"> </span><span class="s">&lt;dependencies&gt;</span><span class="w"> </span><span class="s">...]</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Adds a static library, compiles it, and <strong>automatically links the target to the current firmware</strong>. The library file is generated under the <code class="file docutils literal notranslate"><span class="pre">build</span></code> directory. Parameter descriptions:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">name</span></code>: Target name. The actual library file is <code class="docutils literal notranslate"><span class="pre">lib_${name}.a</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">p_SOURCES</span></code>: Source files for the target.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">p_INCLUDES</span></code>: Include directories for the target.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">p_COMPILE_OPTIONS</span></code>: Compile options for the target.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">p_DEFINITIONS</span></code>: Preprocessor definitions for the target.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">p_DEPENDENCIES</span></code>: Dependencies for the target.</p></li>
</ul>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>The library file generated by this API resides in the build directory. It does not check <code class="docutils literal notranslate"><span class="pre">CONFIG_AMEBA_RLS</span></code> internally and is always active.</p>
</div>
</section>
<section id="ameba-port-standalone-internal-library">
<span id="build-ameba-port-standalone-internal-library"></span><h3>ameba_port_standalone_internal_library<a class="headerlink" href="#ameba-port-standalone-internal-library" title="Link to this heading"></a></h3>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">ameba_port_standalone_internal_library</span><span class="p">(</span><span class="s">&lt;name&gt;</span><span class="p">)</span>
</pre></div>
</div>
<p>Links an <strong>existing</strong> static library target <strong>to the current firmware</strong>:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">name</span></code>: Target name.</p></li>
</ul>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Particularly useful for non-intrusive adaptation of third-party library <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> refer to <a class="reference internal" href="#build-porting-standalone-code"><span class="std std-ref">Integrating Code with Standalone Build System</span></a>.</p>
</div>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>This API does not check <code class="docutils literal notranslate"><span class="pre">CONFIG_AMEBA_RLS</span></code> internally and is always active.</p>
</div>
</section>
<section id="ameba-add-external-app-library">
<span id="build-ameba-add-external-app-library"></span><h3>ameba_add_external_app_library<a class="headerlink" href="#ameba-add-external-app-library" title="Link to this heading"></a></h3>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">ameba_add_external_app_library</span><span class="p">(</span><span class="s">&lt;name&gt;</span>
<span class="w">                               </span><span class="s">[p_SOURCES</span><span class="w"> </span><span class="s">&lt;sources&gt;</span><span class="w"> </span><span class="s">...]</span>
<span class="w">                               </span><span class="s">[p_INCLUDES</span><span class="w"> </span><span class="s">&lt;include</span><span class="w"> </span><span class="s">dirs&gt;</span><span class="w"> </span><span class="s">...]</span>
<span class="w">                               </span><span class="s">[p_COMPILE_OPTIONS</span><span class="w"> </span><span class="s">&lt;compile</span><span class="w"> </span><span class="s">options&gt;</span><span class="w"> </span><span class="s">...]</span>
<span class="w">                               </span><span class="s">[p_DEFINITIONS</span><span class="w"> </span><span class="s">&lt;definitions&gt;</span><span class="w"> </span><span class="s">...]</span>
<span class="w">                               </span><span class="s">[p_DEPENDENCIES</span><span class="w"> </span><span class="s">&lt;dependencies&gt;</span><span class="w"> </span><span class="s">...]</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Adds a static library, compiles it, but <strong>does not automatically link the target to the current firmware</strong>. It must be specified in <a class="reference internal" href="#build-component-cmake-public-part"><span class="std std-ref">Component Public Part</span></a>. The library file is output to the <code class="docutils literal notranslate"><span class="pre">${c_SDK_LIB_APP_DIR}</span></code> directory (see <a class="reference internal" href="#build-cmake-api-some-const-variable-mcu-proj"><span class="std std-ref">MCU Project-related Constants</span></a>) and undergoes <code class="docutils literal notranslate"><span class="pre">objcopy</span> <span class="pre">-g</span> <span class="pre">-D</span></code> processing. Parameter descriptions:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">name</span></code>: Target name. The actual library file is <code class="docutils literal notranslate"><span class="pre">lib_${name}.a</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">p_SOURCES</span></code>: Source files for the target.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">p_INCLUDES</span></code>: Include directories for the target.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">p_COMPILE_OPTIONS</span></code>: Compile options for the target.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">p_DEFINITIONS</span></code>: Preprocessor definitions for the target.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">p_DEPENDENCIES</span></code>: Dependencies for the target.</p></li>
</ul>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>This API does nothing and returns immediately if <code class="docutils literal notranslate"><span class="pre">CONFIG_AMEBA_RLS</span></code> is <code class="docutils literal notranslate"><span class="pre">TRUE</span></code>.</p>
</div>
</section>
</section>
<section id="add-subdirectory">
<h2>Add Subdirectory<a class="headerlink" href="#add-subdirectory" title="Link to this heading"></a></h2>
<section id="ameba-add-subdirectory">
<span id="build-ameba-add-subdirectory"></span><h3>ameba_add_subdirectory<a class="headerlink" href="#ameba-add-subdirectory" title="Link to this heading"></a></h3>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">ameba_add_subdirectory</span><span class="p">(</span><span class="s">&lt;dir&gt;</span><span class="p">)</span>
</pre></div>
</div>
<p>Add a directory for compilation. Refer to <a class="reference external" href="https://cmake.org/cmake/help/latest/command/add_subdirectory.html">add_subdirectory</a>. When <code class="docutils literal notranslate"><span class="pre">dir</span></code> is an external path, the last-level directory name will be used as <code class="docutils literal notranslate"><span class="pre">binary_dir</span></code>. Parameter description:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">dir</span></code>: Directory to be added for compilation</p></li>
</ul>
</section>
<section id="ameba-add-subdirectory-if">
<h3>ameba_add_subdirectory_if<a class="headerlink" href="#ameba-add-subdirectory-if" title="Link to this heading"></a></h3>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">ameba_add_subdirectory_if</span><span class="p">(</span><span class="s">&lt;condition&gt;</span><span class="w"> </span><span class="s">&lt;dir&gt;</span><span class="p">)</span>
</pre></div>
</div>
<p>Add a directory for compilation based on specified condition. Other behaviors are same as <a class="reference internal" href="#build-ameba-add-subdirectory"><span class="std std-ref">ameba_add_subdirectory</span></a>. Parameter description:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">condition</span></code>: Variable name representing the condition</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dir</span></code>: Directory to add for compilation when condition is met</p></li>
</ul>
</section>
<section id="ameba-add-subdirectory-ifnot">
<h3>ameba_add_subdirectory_ifnot<a class="headerlink" href="#ameba-add-subdirectory-ifnot" title="Link to this heading"></a></h3>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">ameba_add_subdirectory_ifnot</span><span class="p">(</span><span class="s">&lt;condition&gt;</span><span class="w"> </span><span class="s">&lt;dir&gt;</span><span class="p">)</span>
</pre></div>
</div>
<p>Add a directory for compilation based on specified condition. Other behaviors are same as <a class="reference internal" href="#build-ameba-add-subdirectory"><span class="std std-ref">ameba_add_subdirectory</span></a>. Parameter description:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">condition</span></code>: Variable name representing the condition</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dir</span></code>: Directory to add for compilation when condition is NOT met</p></li>
</ul>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>Variables represented by <code class="docutils literal notranslate"><span class="pre">condition</span></code> that are undefined or defined with a bool value of <code class="docutils literal notranslate"><span class="pre">FALSE</span></code> will be considered unmet</p>
</div>
</section>
<section id="ameba-add-subdirectory-if-exist">
<h3>ameba_add_subdirectory_if_exist<a class="headerlink" href="#ameba-add-subdirectory-if-exist" title="Link to this heading"></a></h3>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">ameba_add_subdirectory_if_exist</span><span class="p">(</span><span class="s">&lt;dir&gt;</span><span class="p">)</span>
</pre></div>
</div>
<p>When path doesn’t exist: silently return if <code class="docutils literal notranslate"><span class="pre">CONFIG_AMEBA_RLS</span></code> is <code class="docutils literal notranslate"><span class="pre">TRUE</span></code>, otherwise throw error. When path exists, behaves same as <a class="reference internal" href="#build-ameba-add-subdirectory"><span class="std std-ref">ameba_add_subdirectory</span></a>. Parameter description:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">dir</span></code>: Directory to add for compilation when path exists</p></li>
</ul>
</section>
</section>
<section id="constants-definition">
<span id="build-cmake-api-some-const-variable"></span><h2>Constants Definition<a class="headerlink" href="#constants-definition" title="Link to this heading"></a></h2>
<p>The CMake script <code class="file docutils literal notranslate"><span class="pre">cmake/global_define.cmake</span></code> defines several constants that can be directly used in script writing. Some examples are listed below:</p>
<section id="general-constants">
<h3>General Constants<a class="headerlink" href="#general-constants" title="Link to this heading"></a></h3>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 30.0%" />
<col style="width: 70.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Variable Name</p></th>
<th class="head"><p>Value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">c_BASEDIR</span></code></p></td>
<td><p>Root dir of the repo</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">c_CMAKE_FILES_DIR</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">${c_BASEDIR}/cmake</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">c_COMPONENT_DIR</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">${c_BASEDIR}/component</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">c_EMPTY_C_FILE</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">${c_CMAKE_FILES_DIR}/empty_file.c</span></code></p></td>
</tr>
</tbody>
</table>
</section>
<section id="soc-project-related-constants">
<h3>SOC Project-related Constants<a class="headerlink" href="#soc-project-related-constants" title="Link to this heading"></a></h3>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 30.0%" />
<col style="width: 70.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Variable Name</p></th>
<th class="head"><p>Value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">c_SOC_TYPE</span></code></p></td>
<td><p>One of [“amebadplus”, “amebalite”, “amebasmart”]</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">c_SOC_TYPE_UPPER</span></code></p></td>
<td><p>One of [“AMEBADPLUS”, “AMEBALITE”, “AMEBASMART”]</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">c_SOC_TYPE_CAMEL</span></code></p></td>
<td><p>One of [“AebaDplus”, “AmebaLite”, “AmebaSmart”]</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">c_SOC_PROJECT_DIR</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">${c_BASEDIR}/${c_SOC_TYPE}_gcc_project</span></code></p></td>
</tr>
</tbody>
</table>
</section>
<section id="mcu-project-related-constants">
<span id="build-cmake-api-some-const-variable-mcu-proj"></span><h3>MCU Project-related Constants<a class="headerlink" href="#mcu-project-related-constants" title="Link to this heading"></a></h3>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 30.0%" />
<col style="width: 70.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Variable Name</p></th>
<th class="head"><p>Value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">c_MCU_TYPE</span></code></p></td>
<td><p>One of [“km0”, “km4”, “kr4”, “ca32”, …]</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">c_MCU_PROJECT_NAME</span></code></p></td>
<td><p>If MCU project folder name is project_xxx, value is xxx</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">c_CURRENT_IMAGE</span></code></p></td>
<td><p>Current image target name, value like: target_img2_km4</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">c_MCU_KCONFIG_FILE</span></code></p></td>
<td><p>Kconfig file path for current MCU project</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">c_MCU_PROJECT_DIR</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">${c_SOC_PROJECT_DIR}/project_${c_MCU_TYPE}</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">c_SDK_LIB_APP_DIR</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">${c_MCU_PROJECT_DIR}/[asdk|vsdk]/lib/application</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">c_SDK_LIB_SOC_DIR</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">${c_MCU_PROJECT_DIR}/[asdk|vsdk]/lib/soc</span></code></p></td>
</tr>
</tbody>
</table>
</section>
<section id="component-related-constants">
<h3>Component-related Constants<a class="headerlink" href="#component-related-constants" title="Link to this heading"></a></h3>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 30.0%" />
<col style="width: 70.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Variable Name</p></th>
<th class="head"><p>Value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">c_CMPT_APP_DIR</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">${c_COMPONENT_DIR}/application</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">c_CMPT_AT_CMD_DIR</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">${c_COMPONENT_DIR}/at_cmd</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">c_CMPT_AUDIO_DIR</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">${c_COMPONENT_DIR}/audio</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">c_CMPT_BLUETOOTH_DIR</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">${c_COMPONENT_DIR}/bluetooth</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">c_CMPT_DYN_APP_DIR</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">${c_COMPONENT_DIR}/dynamic_app</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">c_CMPT_ETHERNET_DIR</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">${c_COMPONENT_DIR}/ethernet</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">c_CMPT_EXAMPLE_DIR</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">${c_COMPONENT_DIR}/example</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">c_CMPT_FILE_SYSTEM_DIR</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">${c_COMPONENT_DIR}/file_system</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">c_CMPT_LWIP_DIR</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">${c_COMPONENT_DIR}/lwip</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">c_CMPT_NETWORK_DIR</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">${c_COMPONENT_DIR}/network</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">c_CMPT_OS_DIR</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">${c_COMPONENT_DIR}/os</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">c_CMPT_RTK_COEX_DIR</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">${c_COMPONENT_DIR}/rtk_coex</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">c_CMPT_SDIO_DIR</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">${c_COMPONENT_DIR}/sdio</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">c_CMPT_SSL_DIR</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">${c_COMPONENT_DIR}/ssl</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">c_CMPT_UI_DIR</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">${c_COMPONENT_DIR}/ui</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">c_CMPT_USB_DIR</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">${c_COMPONENT_DIR}/usb</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">c_CMPT_UTILS_DIR</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">${c_COMPONENT_DIR}/utils</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">c_CMPT_TFLITE_DIR</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">${c_COMPONENT_DIR}/tflite_micro</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">c_CMPT_WIFI_DIR</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">${c_COMPONENT_DIR}/wifi</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">c_CMPT_WPAN_DIR</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">${c_COMPONENT_DIR}/wpan</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">c_CMPT_CRASHDUMP_DIR</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">${c_COMPONENT_DIR}/soc/common/crashdump</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">c_CMPT_LZMA_DIR</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">${c_COMPONENT_DIR}/soc/common/lzma</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">c_CMPT_SOC_DIR</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">${c_COMPONENT_DIR}/soc/${c_SOC_TYPE}</span></code></p></td>
</tr>
</tbody>
</table>
</section>
</section>
</section>
<section id="frequently-asked-questions-suggestions">
<h1>Frequently Asked Questions &amp; Suggestions<a class="headerlink" href="#frequently-asked-questions-suggestions" title="Link to this heading"></a></h1>
<section id="view-detailed-compilation-parameters-of-a-source-file">
<span id="build-check-source-compile-detail"></span><h2>View Detailed Compilation Parameters of a Source File<a class="headerlink" href="#view-detailed-compilation-parameters-of-a-source-file" title="Link to this heading"></a></h2>
<p>Add the following code at the beginning of the target source file or introduce syntax errors, then compile. The compiler will report errors at the corresponding source file location and print detailed compilation parameters.</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="c">#error debug</span>
</pre></div>
</div>
</section>
<section id="undefined-reference-error">
<span id="build-debug-link-error-undefined-reference"></span><h2>Undefined Reference Error<a class="headerlink" href="#undefined-reference-error" title="Link to this heading"></a></h2>
<p>This error typically occurs during the linking stage when generating axf files. Common causes include:</p>
<ul class="simple">
<li><p><strong>Cause 1</strong>: The library containing the symbol is not linked</p></li>
<li><p><strong>Cause 2</strong>: The source file containing the symbol is not compiled</p></li>
<li><p><strong>Cause 3</strong>: The code block containing the symbol is not compiled</p></li>
</ul>
<p>The following uses <code class="docutils literal notranslate"><span class="pre">RTL8721Dx</span></code> as an example to demonstrate troubleshooting steps for the above causes. Below is a sample link error output (partial information retained for demonstration):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="linenos"> 1</span>[5/42] Linking C executable project_km4/asdk/make/image2/target_img2_km4.axf
</span><span class="hll"><span class="linenos"> 2</span>FAILED: project_km4/asdk/make/image2/target_img2_km4.axf
</span><span class="linenos"> 3</span>ccache /opt/rtk-toolchain/asdk-10.3.1-4354/linux/newlib/bin/arm-none-eabi-gcc
<span class="linenos"> 4</span>-O2
<span class="linenos"> 5</span>-o project_km4/asdk/make/image2/target_img2_km4.axf
<span class="linenos"> 6</span>
<span class="linenos"> 7</span>-Wl,--whole-archive
<span class="linenos"> 8</span>project_km4/asdk/make/image2/at_cmd/lib_at_cmd.a
<span class="hll"><span class="linenos"> 9</span>project_km4/asdk/make/image2/swlib/lib_swlib.a
</span><span class="linenos">10</span>project_km4/asdk/make/image2/file_system/fatfs/lib_fatfs.a
<span class="linenos">11</span>project_km4/asdk/make/image2/file_system/littlefs/lib_littlefs.a
<span class="linenos">12</span>project_km4/asdk/make/image2/file_system/kv/lib_kv.a
<span class="linenos">13</span>project_km4/asdk/make/image2/file_system/vfs/lib_vfs.a
<span class="linenos">14</span>project_km4/asdk/make/image2/fwlib/lib_fwlib.a
<span class="linenos">15</span>project_km4/asdk/make/image2/hal/lib_hal.a
<span class="linenos">16</span>project_km4/asdk/make/image2/misc/lib_misc.a
<span class="linenos">17</span>project_km4/asdk/make/image2/lwip/lib_lwip.a
<span class="linenos">18</span>
<span class="linenos">19</span>-Wl,--no-whole-archive
<span class="linenos">20</span>
<span class="linenos">21</span>-lm
<span class="linenos">22</span>-O2
<span class="linenos">23</span>-o project_km4/asdk/make/image2/target_img2_km4.axf
<span class="linenos">24</span>
<span class="linenos">25</span>-Wl,--whole-archive
<span class="linenos">26</span>project_km4/asdk/make/image2/at_cmd/lib_at_cmd.a
<span class="linenos">27</span>project_km4/asdk/make/image2/cmsis-dsp/lib_cmsis_dsp.a
<span class="linenos">28</span>
<span class="linenos">29</span>-Wl,--no-whole-archive
<span class="linenos">30</span>
<span class="linenos">31</span>-lm
<span class="linenos">32</span>-lstdc++
<span class="hll"><span class="linenos">33</span>ld: amebadplus_gcc_project/project_km4/asdk/lib/soc/lib_chipinfo.a(ameba_rom_patch.o): in function `io_assert_failed&#39;:
</span><span class="hll"><span class="linenos">34</span>(.text.io_assert_failed+0x12): undefined reference to `rtk_log_write_nano&#39;
</span></pre></div>
</div>
<p>Key information from highlighted lines 1, 2, 33, 34:</p>
<ul class="simple">
<li><p><strong>MCU Project</strong>: <code class="docutils literal notranslate"><span class="pre">km4</span></code></p></li>
<li><p><strong>Firmware</strong>: image2, <strong>File</strong>: <code class="file docutils literal notranslate"><span class="pre">target_img2_km4.axf</span></code></p></li>
<li><p><strong>Undefined symbol</strong>: <code class="docutils literal notranslate"><span class="pre">rtk_log_write_nano</span></code>, called in function <code class="xref py py-func docutils literal notranslate"><span class="pre">io_assert_failed()</span></code></p></li>
<li><p><strong>Source file</strong>: <code class="file docutils literal notranslate"><span class="pre">log.c</span></code></p></li>
<li><p><strong>Component</strong>: <code class="docutils literal notranslate"><span class="pre">swlib</span></code></p></li>
<li><p><strong>Library</strong>: <code class="file docutils literal notranslate"><span class="pre">lib_swlib.a</span></code></p></li>
</ul>
<p>Troubleshooting steps:</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-1-1-0" aria-selected="true" class="sphinx-tabs-tab" id="tab-1-1-0" name="1-0" role="tab" tabindex="0">Cause 1</button><button aria-controls="panel-1-1-1" aria-selected="false" class="sphinx-tabs-tab" id="tab-1-1-1" name="1-1" role="tab" tabindex="-1">Cause 2</button><button aria-controls="panel-1-1-2" aria-selected="false" class="sphinx-tabs-tab" id="tab-1-1-2" name="1-2" role="tab" tabindex="-1">Cause 3</button></div><div aria-labelledby="tab-1-1-0" class="sphinx-tabs-panel" id="panel-1-1-0" name="1-0" role="tabpanel" tabindex="0"><p><strong>The library containing the symbol is not linked</strong></p>
<ol class="arabic simple">
<li><p>Verify if link parameters contain <code class="file docutils literal notranslate"><span class="pre">lib_swlib.a</span></code></p></li>
<li><p>Line 9 shows <code class="file docutils literal notranslate"><span class="pre">project_km4/asdk/make/image2/swlib/lib_swlib.a</span></code> is linked. If missing, check:</p>
<ul class="simple">
<li><p>Whether <code class="docutils literal notranslate"><span class="pre">swlib</span></code> component is added in image2’s <code class="file docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code></p></li>
<li><p>Check the component’s <code class="file docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code>. If APIs such as <a class="reference internal" href="#build-ameba-add-external-app-library"><span class="std std-ref">ameba_add_external_app_library</span></a> are used, ensure that the <code class="docutils literal notranslate"><span class="pre">public_libraries</span></code> in their <a class="reference internal" href="#build-component-cmake-public-part"><span class="std std-ref">Component Public Part</span></a> are correctly added.</p></li>
</ul>
</li>
</ol>
</div><div aria-labelledby="tab-1-1-1" class="sphinx-tabs-panel" hidden="true" id="panel-1-1-1" name="1-1" role="tabpanel" tabindex="0"><p><strong>The source file containing the symbol is not compiled</strong></p>
<ol class="arabic simple">
<li><p>Search for <code class="file docutils literal notranslate"><span class="pre">log.o</span></code> in CMake’s <code class="file docutils literal notranslate"><span class="pre">build</span></code> directory:</p></li>
</ol>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-2-2-0" aria-selected="true" class="sphinx-tabs-tab" id="tab-2-2-0" name="2-0" role="tab" tabindex="0">Linux</button><button aria-controls="panel-2-2-1" aria-selected="false" class="sphinx-tabs-tab" id="tab-2-2-1" name="2-1" role="tab" tabindex="-1">Windows</button></div><div aria-labelledby="tab-2-2-0" class="sphinx-tabs-panel" id="panel-2-2-0" name="2-0" role="tabpanel" tabindex="0"><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>find<span class="w"> </span>build/project_km4<span class="w"> </span>-name<span class="w"> </span>log.o
</pre></div>
</div>
<p>Sample output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">build</span><span class="o">/</span><span class="n">project_km4</span><span class="o">/</span><span class="n">asdk</span><span class="o">/</span><span class="n">make</span><span class="o">/</span><span class="n">image1</span><span class="o">/</span><span class="n">swlib</span><span class="o">/</span><span class="n">CMakeFiles</span><span class="o">/</span><span class="n">swlib_target_loader_km4</span><span class="o">.</span><span class="n">dir</span><span class="o">/</span><span class="n">log</span><span class="o">.</span><span class="n">o</span>
<span class="hll"><span class="n">build</span><span class="o">/</span><span class="n">project_km4</span><span class="o">/</span><span class="n">asdk</span><span class="o">/</span><span class="n">make</span><span class="o">/</span><span class="n">image2</span><span class="o">/</span><span class="n">swlib</span><span class="o">/</span><span class="n">CMakeFiles</span><span class="o">/</span><span class="n">swlib_target_img2_km4</span><span class="o">.</span><span class="n">dir</span><span class="o">/</span><span class="n">log</span><span class="o">.</span><span class="n">o</span>
</span></pre></div>
</div>
</div><div aria-labelledby="tab-2-2-1" class="sphinx-tabs-panel" hidden="true" id="panel-2-2-1" name="2-1" role="tabpanel" tabindex="0"><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>dir<span class="w"> </span>/s<span class="w"> </span>build<span class="se">\p</span>roject_km4<span class="se">\l</span>og.o
</pre></div>
</div>
<p>Sample output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">C</span><span class="p">:</span>\<span class="n">Users</span>\<span class="n">sdk</span>\<span class="n">amebadplus_gcc_project</span>\<span class="n">build</span>\<span class="n">project_km4</span>\<span class="n">asdk</span>\<span class="n">make</span>\<span class="n">image1</span>\<span class="n">swlib</span>\<span class="n">CMakeFiles</span>\<span class="n">swlib_target_loader_km4</span><span class="o">.</span><span class="n">dir</span>
<span class="mi">2025</span><span class="o">/</span><span class="mi">03</span><span class="o">/</span><span class="mi">12</span>  <span class="mi">14</span><span class="p">:</span><span class="mi">56</span>            <span class="mi">21</span><span class="p">,</span><span class="mi">096</span> <span class="n">log</span><span class="o">.</span><span class="n">o</span>

<span class="hll"><span class="n">C</span><span class="p">:</span>\<span class="n">Users</span>\<span class="n">sdk</span>\<span class="n">amebadplus_gcc_project</span>\<span class="n">build</span>\<span class="n">project_km4</span>\<span class="n">asdk</span>\<span class="n">make</span>\<span class="n">image2</span>\<span class="n">swlib</span>\<span class="n">CMakeFiles</span>\<span class="n">swlib_image2_km4</span><span class="o">.</span><span class="n">dir</span>
</span><span class="hll"><span class="mi">2025</span><span class="o">/</span><span class="mi">03</span><span class="o">/</span><span class="mi">12</span>  <span class="mi">14</span><span class="p">:</span><span class="mi">56</span>            <span class="mi">21</span><span class="p">,</span><span class="mi">096</span> <span class="n">log</span><span class="o">.</span><span class="n">o</span>
</span></pre></div>
</div>
</div></div>
<ol class="arabic simple" start="2">
<li><p>If highlighted entries are missing, check <code class="docutils literal notranslate"><span class="pre">swlib</span></code>’s <code class="file docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> for source file omissions or logic errors</p></li>
</ol>
</div><div aria-labelledby="tab-1-1-2" class="sphinx-tabs-panel" hidden="true" id="panel-1-1-2" name="1-2" role="tabpanel" tabindex="0"><p><strong>The code block containing the symbol is not compiled</strong></p>
<ol class="arabic">
<li><p>Locate <code class="file docutils literal notranslate"><span class="pre">log.o</span></code> using steps from <strong>Cause 2</strong></p></li>
<li><p>Check if <code class="file docutils literal notranslate"><span class="pre">log.o</span></code> contains the symbol using toolchain commands(refer to <a class="reference internal" href="../0_gcc_build_environment/1_gcc_build_environment_toprst.html#install-toolchain"><span class="std std-ref">Installing Toolchain</span></a> get the directory of toolchain):</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-3-3-0" aria-selected="true" class="sphinx-tabs-tab" id="tab-3-3-0" name="3-0" role="tab" tabindex="0">Linux</button><button aria-controls="panel-3-3-1" aria-selected="false" class="sphinx-tabs-tab" id="tab-3-3-1" name="3-1" role="tab" tabindex="-1">Windows</button></div><div aria-labelledby="tab-3-3-0" class="sphinx-tabs-panel" id="panel-3-3-0" name="3-0" role="tabpanel" tabindex="0"><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>/opt/rtk-toolchain/asdk-10.3.1/linux/newlib/bin/arm-none-eabi-nm<span class="w"> </span>build/project_km4/asdk/make/image2/swlib/CMakeFiles/swlib_target_img2_km4.dir/log.o<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-w<span class="w"> </span>rtk_log_write_nano
</pre></div>
</div>
</div><div aria-labelledby="tab-3-3-1" class="sphinx-tabs-panel" hidden="true" id="panel-3-3-1" name="3-1" role="tabpanel" tabindex="0"><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>C:<span class="se">\r</span>tk-toolchain<span class="se">\a</span>sdk-10.3.1-4354<span class="se">\m</span>ingw32<span class="se">\n</span>ewlib<span class="se">\b</span>in<span class="se">\a</span>rm-none-eabi-nm.exe<span class="w"> </span>build<span class="se">\p</span>roject_km4<span class="se">\a</span>sdk<span class="se">\m</span>ake<span class="se">\i</span>mage2<span class="se">\s</span>wlib<span class="se">\C</span>MakeFiles<span class="se">\s</span>wlib_image2_km4.dir<span class="se">\l</span>og.o<span class="w"> </span><span class="p">|</span><span class="w"> </span>findstr<span class="w"> </span>/R<span class="w"> </span><span class="s2">&quot;\&lt;rtk_log_write_nano\&gt;&quot;</span>
</pre></div>
</div>
</div></div>
</li>
<li><p>Valid output should contain (note <code class="docutils literal notranslate"><span class="pre">T</span></code> type):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">00000000</span> <span class="n">T</span> <span class="n">rtk_log_write_nano</span>
</pre></div>
</div>
<p>If missing, check conditional compilation in <code class="file docutils literal notranslate"><span class="pre">log.c</span></code></p>
</li>
</ol>
</div></div>
</section>
<section id="useful-types-for-complex-logic-processing">
<span id="build-some-types-for-logic-process"></span><h2>Useful Types for Complex Logic Processing<a class="headerlink" href="#useful-types-for-complex-logic-processing" title="Link to this heading"></a></h2>
<section id="soc-type">
<span id="build-soc-type"></span><h3>SOC Type<a class="headerlink" href="#soc-type" title="Link to this heading"></a></h3>
<p>Identify SOC types (e.g., <code class="docutils literal notranslate"><span class="pre">amebadplus</span></code>, <code class="docutils literal notranslate"><span class="pre">amebalite</span></code>, <code class="docutils literal notranslate"><span class="pre">amebasmart</span></code>) using variables: <code class="docutils literal notranslate"><span class="pre">CONFIG_AMEBADPLUS</span></code>, <code class="docutils literal notranslate"><span class="pre">CONFIG_AMEBALITE</span></code>, <code class="docutils literal notranslate"><span class="pre">CONFIG_AMEBASMART</span></code></p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">if</span><span class="p">(</span><span class="s">CONFIG_AMEBADPLUS</span><span class="p">)</span>
<span class="w">    </span><span class="c"># Add code for amebadplus here</span>
<span class="nb">elseif</span><span class="p">(</span><span class="s">CONFIG_AMEBALITE</span><span class="p">)</span>
<span class="w">    </span><span class="c"># Add code for amebalite here</span>
<span class="nb">elseif</span><span class="p">(</span><span class="s">CONFIG_AMEBASMART</span><span class="p">)</span>
<span class="w">    </span><span class="c"># Add code for amebasmart here</span>
<span class="nb">endif</span><span class="p">()</span>
</pre></div>
</div>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<ol class="arabic">
<li><p>SOC type distinctions should be minimized. Prefer feature-based configuration switches instead.</p></li>
<li><p>If such usage is mandatory, adhere to the principle of <strong>upward compatibility</strong> to ensure future SOC type additions <strong>require no modification of this logic</strong> (e.g., avoid adding new <code class="docutils literal notranslate"><span class="pre">elseif</span></code> clauses). Example implementation in <code class="file docutils literal notranslate"><span class="pre">component/rtk_coex/CMakeLists.txt</span></code>:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="nb">if</span><span class="p">(</span><span class="s">NOT</span><span class="w"> </span><span class="s">CONFIG_AMEBAD</span><span class="p">)</span>
</span><span class="w">    </span><span class="nb">if</span><span class="w"> </span><span class="p">(</span><span class="s">CONFIG_COEXIST_HOST</span><span class="p">)</span>
<span class="w">        </span><span class="nb">include</span><span class="p">(</span><span class="s">rtk_coex_api.cmake</span><span class="p">)</span>
<span class="w">    </span><span class="nb">endif</span><span class="p">()</span>
<span class="nb">endif</span><span class="p">()</span>
</pre></div>
</div>
</li>
</ol>
</div>
</section>
<section id="mcu-type">
<span id="build-mcu-type"></span><h3>MCU Type<a class="headerlink" href="#mcu-type" title="Link to this heading"></a></h3>
<p>Identify MCU types (e.g., <code class="docutils literal notranslate"><span class="pre">km0</span></code>, <code class="docutils literal notranslate"><span class="pre">km4</span></code>, <code class="docutils literal notranslate"><span class="pre">kr4</span></code>, <code class="docutils literal notranslate"><span class="pre">ca32</span></code>) using string variable <code class="docutils literal notranslate"><span class="pre">c_MCU_TYPE</span></code>:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">if</span><span class="p">(</span><span class="o">${</span><span class="nv">c_MCU_TYPE</span><span class="o">}</span><span class="w"> </span><span class="s">STREQUAL</span><span class="w"> </span><span class="s2">&quot;km0&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="c"># Add code for km0 here</span>
<span class="nb">elseif</span><span class="p">(</span><span class="o">${</span><span class="nv">c_MCU_TYPE</span><span class="o">}</span><span class="w"> </span><span class="s">STREQUAL</span><span class="w"> </span><span class="s2">&quot;km4&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="c"># Add code for km4 here</span>
<span class="nb">elseif</span><span class="p">(</span><span class="o">${</span><span class="nv">c_SOC_TYPE</span><span class="o">}</span><span class="w"> </span><span class="s">STREUQAL</span><span class="w"> </span><span class="s2">&quot;ca32&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="c"># Add code for ca32 here</span>
<span class="nb">endif</span><span class="p">()</span>
</pre></div>
</div>
</section>
</section>
<section id="common-cmake-debugging-methods">
<h2>Common CMake Debugging Methods<a class="headerlink" href="#common-cmake-debugging-methods" title="Link to this heading"></a></h2>
<section id="logging">
<h3>Logging<a class="headerlink" href="#logging" title="Link to this heading"></a></h3>
<p>Use CMake’s built-in <code class="xref py py-func docutils literal notranslate"><span class="pre">message()</span></code> or more readable alternatives: <code class="xref py py-func docutils literal notranslate"><span class="pre">ameba_debug()</span></code>, <code class="xref py py-func docutils literal notranslate"><span class="pre">ameba_info()</span></code>, <code class="xref py py-func docutils literal notranslate"><span class="pre">ameba_warning()</span></code>, <code class="xref py py-func docutils literal notranslate"><span class="pre">ameba_fatal()</span></code>.</p>
<p>Example usage to halt execution for analysis:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">message</span><span class="p">(</span><span class="s">FATAL_ERROR</span><span class="w"> </span><span class="s2">&quot;stop here&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="troubleshooting-common-cmake-errors">
<h3>Troubleshooting Common CMake Errors<a class="headerlink" href="#troubleshooting-common-cmake-errors" title="Link to this heading"></a></h3>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Always check the <strong>first</strong> error in terminal output when troubleshooting CMake issues</p>
</div>
<section id="external-command-parameter-error">
<h4>External Command Parameter Error<a class="headerlink" href="#external-command-parameter-error" title="Link to this heading"></a></h4>
<p>Typically caused by incorrect parameters in <code class="docutils literal notranslate"><span class="pre">COMMAND</span></code> sections of <code class="xref py py-func docutils literal notranslate"><span class="pre">add_custom_target()</span></code> or <code class="xref py py-func docutils literal notranslate"><span class="pre">add_custom_command()</span></code>, often due to empty CMake variables. Sample error output showing CMake’s <code class="docutils literal notranslate"><span class="pre">-E</span></code> usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="n">FAILED</span><span class="p">:</span> <span class="n">build</span><span class="o">/</span><span class="n">lib_atcmd</span><span class="o">.</span><span class="n">a</span>
<span class="hll"><span class="linenos">2</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">cmake</span> <span class="o">-</span><span class="n">E</span> <span class="n">copy</span> <span class="n">build</span><span class="o">/</span><span class="n">lib_atcmd</span><span class="o">.</span><span class="n">a</span>
</span><span class="hll"><span class="linenos">3</span><span class="n">CMake</span> <span class="n">Error</span><span class="p">:</span> <span class="n">cmake</span> <span class="n">version</span> <span class="mf">3.30.2</span>
</span><span class="hll"><span class="linenos">4</span><span class="n">Usage</span><span class="p">:</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">cmake</span> <span class="o">-</span><span class="n">E</span> <span class="o">&lt;</span><span class="n">command</span><span class="o">&gt;</span> <span class="p">[</span><span class="n">arguments</span><span class="o">...</span><span class="p">]</span>
</span><span class="hll"><span class="linenos">5</span><span class="n">Available</span> <span class="n">commands</span><span class="p">:</span>
</span><span class="linenos">6</span><span class="n">capabilities</span>              <span class="o">-</span> <span class="n">Report</span> <span class="n">capabilities</span> <span class="n">built</span> <span class="n">into</span> <span class="n">cmake</span> <span class="ow">in</span> <span class="n">JSON</span> <span class="nb">format</span>
<span class="linenos">7</span><span class="n">cat</span> <span class="p">[</span><span class="o">--</span><span class="p">]</span> <span class="o">&lt;</span><span class="n">files</span><span class="o">&gt;...</span>       <span class="o">-</span> <span class="n">concat</span> <span class="n">the</span> <span class="n">files</span> <span class="ow">and</span> <span class="nb">print</span> <span class="n">them</span> <span class="n">to</span> <span class="n">the</span> <span class="n">standard</span> <span class="n">output</span>
<span class="linenos">8</span><span class="n">chdir</span> <span class="nb">dir</span> <span class="n">cmd</span> <span class="p">[</span><span class="n">args</span><span class="o">...</span><span class="p">]</span>   <span class="o">-</span> <span class="n">run</span> <span class="n">command</span> <span class="ow">in</span> <span class="n">a</span> <span class="n">given</span> <span class="n">directory</span>
<span class="linenos">9</span><span class="o">...</span>
</pre></div>
</div>
<p>Corresponding CMake code example:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="nb">add_custom_command</span><span class="p">(</span>
<span class="linenos">2</span><span class="w">    </span><span class="s">OUTPUT</span><span class="w"> </span><span class="s">lib/lib_atcmd.a</span>
<span class="hll"><span class="linenos">3</span><span class="w">    </span><span class="s">COMMAND</span><span class="w"> </span><span class="o">${</span><span class="nv">CMAKE_COMMAND</span><span class="o">}</span><span class="w"> </span><span class="s">-E</span><span class="w"> </span><span class="s">copy</span><span class="w"> </span><span class="s">build/lib_atcmd.a</span><span class="w"> </span><span class="o">${</span><span class="nv">output_path</span><span class="o">}</span>
</span><span class="linenos">4</span><span class="w">    </span><span class="s">DEPENDS</span><span class="w"> </span><span class="s">build/lib_atcmd.a</span>
<span class="linenos">5</span><span class="p">)</span>
</pre></div>
</div>
<p>This error occurs when <code class="docutils literal notranslate"><span class="pre">${output_path}</span></code> is empty, resulting in incomplete copy command as shown in line 2.</p>
</section>
</section>
</section>
<section id="copied-and-replaced-a-source-file-but-did-not-trigger-recompilation">
<h2>Copied and replaced a source file but did not trigger recompilation<a class="headerlink" href="#copied-and-replaced-a-source-file-but-did-not-trigger-recompilation" title="Link to this heading"></a></h2>
<p>The CMake build system uses incremental compilation by default, meaning it only recompiles when source code or header files change. Its mechanism for detecting changes is ​**based on whether the file’s modification timestamp is newer than the previous build**.</p>
<p>When replacing a file with an older version (via copy-paste) while keeping its original modification timestamp (default behavior in Windows Explorer), the incremental compilation ​**will not be triggered** because the timestamp remains unchanged.</p>
<p>Recommended solutions for Windows environments:
1. ​**Create a new file** and copy the content into it (generates a new timestamp)
2. Use the <code class="docutils literal notranslate"><span class="pre">build.py</span> <span class="pre">-c</span></code> command to clean the build directory</p>
</section>
</section>
<section id="advanced-learning-readings">
<h1>Advanced Learning Readings<a class="headerlink" href="#advanced-learning-readings" title="Link to this heading"></a></h1>
<section id="special-compilation-configurations">
<h2>Special Compilation Configurations<a class="headerlink" href="#special-compilation-configurations" title="Link to this heading"></a></h2>
<section id="set-compilation-configuration-per-source-file">
<h3>Set Compilation Configuration Per Source File<a class="headerlink" href="#set-compilation-configuration-per-source-file" title="Link to this heading"></a></h3>
<p>To set compilation configurations, such as predefined macros, for specific source files. For example, adding a predefined macro <code class="docutils literal notranslate"><span class="pre">__FILE_Z_STR__</span></code> to each source file that expands to the filename string of the corresponding source file. Implementation is as follows:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">ameba_list_append</span><span class="p">(</span><span class="s">private_sources</span>
<span class="w">    </span><span class="s">foo.c</span>
<span class="w">    </span><span class="s">bar.c</span>
<span class="p">)</span>

<span class="nb">foreach</span><span class="p">(</span><span class="s">src</span><span class="w"> </span><span class="o">${</span><span class="nv">private_sources</span><span class="o">}</span><span class="p">)</span>
<span class="w">    </span><span class="nb">cmake_path</span><span class="p">(</span><span class="s">GET</span><span class="w"> </span><span class="s">src</span><span class="w"> </span><span class="s">FILENAME</span><span class="w"> </span><span class="s">filename</span><span class="p">)</span>
<span class="w">    </span><span class="nb">set_source_files_properties</span><span class="p">(</span><span class="o">${</span><span class="nv">src</span><span class="o">}</span><span class="w"> </span><span class="s">PROPERTIES</span><span class="w"> </span><span class="s">COMPILE_DEFINITIONS</span><span class="w"> </span><span class="s2">&quot;__FILE_Z_STR__=\&quot;</span><span class="o">${</span><span class="nv">filename</span><span class="o">}</span><span class="s">\&quot;&quot;)</span>
<span class="s">endforeach(</span><span class="p">)</span>
</pre></div>
</div>
<p>Use the CMake built-in interface <a class="reference external" href="https://cmake.org/cmake/help/latest/command/set_source_files_properties.html">set_source_files_properties</a> to precisely set compilation configurations for each source file.</p>
</section>
<section id="set-compile-options-per-source-file-type">
<h3>Set Compile Options Per Source File Type<a class="headerlink" href="#set-compile-options-per-source-file-type" title="Link to this heading"></a></h3>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">ameba_list_append</span><span class="p">(</span><span class="s">private_compile_options</span>
<span class="w">    </span><span class="s">-Wno-multichar</span><span class="w">                              </span><span class="c"># for both asm/c/cpp language</span>
<span class="w">    </span><span class="o">$&lt;</span><span class="nv">$&lt;COMPILE_LANGUAGE:C</span><span class="o">&gt;</span><span class="s">:-Wno-pointer-sign&gt;</span><span class="w">  </span><span class="c"># for c language only</span>
<span class="w">    </span><span class="o">$&lt;</span><span class="nv">$&lt;COMPILE_LANGUAGE:CXX</span><span class="o">&gt;</span><span class="s">:-Wno-narrowing&gt;</span><span class="w">   </span><span class="c"># for cpp language only</span>
<span class="w">    </span><span class="o">$&lt;</span><span class="nv">$&lt;COMPILE_LANGUAGE:CXX</span><span class="o">&gt;</span><span class="s">:-std=c++17&gt;</span><span class="w">       </span><span class="c"># for cpp language only</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="suppress-compilation-warnings-as-errors">
<h3>Suppress Compilation Warnings as Errors<a class="headerlink" href="#suppress-compilation-warnings-as-errors" title="Link to this heading"></a></h3>
<p>The global compilation configuration in <code class="file docutils literal notranslate"><span class="pre">cmake/flags/common/compile_options.cmake</span></code> enables <code class="docutils literal notranslate"><span class="pre">-Werror</span></code> by default, which ​treats all compilation warnings as errors. To disable this behavior, use one of the following methods:</p>
<ul>
<li><p>​Method 1: Component-Specific Disable. Add compilation options in the target component’s <code class="file docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code>:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">ameba_list_append</span><span class="p">(</span><span class="s">private_compile_options</span>
<span class="hll"><span class="w">    </span><span class="s">-Wno-error</span><span class="w">  </span><span class="c"># Disable warning-as-error for this component</span>
</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>​Method 2: Global Disable. Modify the global configuration file <code class="file docutils literal notranslate"><span class="pre">cmake/flags/common/compile_options.cmake</span></code> and ​comment out the <code class="docutils literal notranslate"><span class="pre">-Werror</span></code> line</p></li>
</ul>
</section>
</section>
</section>
<section id="kconfig-system">
<h1>Kconfig System<a class="headerlink" href="#kconfig-system" title="Link to this heading"></a></h1>
<section id="kconfig-overview">
<h2>Kconfig Overview<a class="headerlink" href="#kconfig-overview" title="Link to this heading"></a></h2>
<p><strong>Organization Structure</strong></p>
<blockquote>
<div><p>The configuration system uses Kconfig to organize. Top Kconfig file under <code class="docutils literal notranslate"><span class="pre">amebaxxx_gcc_project</span></code> references sub-Kconfig under each component, generating files for CMake. As following figure show:</p>
<figure class="align-center">
<a class="reference internal image-reference" href="../../_images/kconfig_tree.svg"><img alt="../../_images/kconfig_tree.svg" height="597" src="../../_images/kconfig_tree.svg" width="873" /></a>
</figure>
<p>Mutual references between Kconfig files can use following syntax:</p>
<ol class="arabic">
<li><p><code class="docutils literal notranslate"><span class="pre">source</span></code> :</p>
<p>The <code class="docutils literal notranslate"><span class="pre">source</span></code> statement can reference a path relative to the top-level Kconfig. For example, a top-level Kconfig loacated at <code class="docutils literal notranslate"><span class="pre">${top_kconfig_path}</span></code> can use the following statement:</p>
<div class="highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="n">source</span><span class="w"> </span><span class="s2">&quot;subdir/Kconfig&quot;</span>
</pre></div>
</div>
<p>This will incorporate <code class="docutils literal notranslate"><span class="pre">{top_kconfig_path}/subdir/Kconfig</span></code> file into the top-level Kconfig. If <code class="docutils literal notranslate"><span class="pre">{top_kconfig_path}/subdir/Kconfig</span></code> file does not exist, a Kconfig error will pop.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">osource</span></code> :</p>
<p>The file path referenced after <code class="docutils literal notranslate"><span class="pre">osource</span></code> will not cause an error even if it does not exist.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">rsource</span></code> :</p>
<p>The path referenced by <code class="docutils literal notranslate"><span class="pre">rsource</span></code> is relative to the Kconfig file using the <code class="docutils literal notranslate"><span class="pre">rsource</span></code> statement, rather than the top-level Kconfig.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">orsource</span></code> :</p>
<p>This statement is based on <code class="docutils literal notranslate"><span class="pre">rsource</span></code>, allowing the referenced file path to not exist.</p>
</li>
</ol>
</div></blockquote>
<p>Below are some common usages and notice of Kconfig. For more detailed information about Kconfig, please refer to: <a class="reference external" href="https://docs.kernel.org/kbuild/kconfig-language.html">https://docs.kernel.org/kbuild/kconfig-language.html</a></p>
<p><strong>Defining Kconfig Symbols</strong></p>
<blockquote>
<div><p>Defining a Kconfig symbol follows the below format:</p>
<div class="highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="n">config</span><span class="w"> </span><span class="no">FOO</span>
<span class="w">   </span><span class="n">bool</span><span class="w"> </span><span class="s2">&quot;choose FOO&quot;</span>
<span class="w">   </span><span class="n">default</span><span class="w"> </span><span class="n">n</span>
</pre></div>
</div>
<p>The above Kconfig structure defines a <code class="docutils literal notranslate"><span class="pre">bool</span></code> type config symbol, which appears in the visualization interface as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span> <span class="p">]</span>  <span class="n">choose</span> <span class="n">FOO</span>
</pre></div>
</div>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;choose</span> <span class="pre">FOO&quot;</span></code> is the prompt text, which will be displayed in the visualization configuration interface. If <code class="docutils literal notranslate"><span class="pre">&quot;choose</span> <span class="pre">FOO&quot;</span></code> is removed, the configuration item will not appear in the visualization interface. Besides <code class="docutils literal notranslate"><span class="pre">bool</span></code> type, other types such as <code class="docutils literal notranslate"><span class="pre">string</span></code>, <code class="docutils literal notranslate"><span class="pre">hex</span></code>, <code class="docutils literal notranslate"><span class="pre">int</span></code>, etc., can also be defined.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">default</span> <span class="pre">n</span></code> indicates “no”, meaning this item will not be selected by default. <code class="docutils literal notranslate"><span class="pre">default</span> <span class="pre">n</span></code> can be omitted. Note that the default value defined by <code class="docutils literal notranslate"><span class="pre">default</span></code> only takes effect if the user has never touched this config item.</p></li>
<li><p>Further, conditional expressions can expand Kconfig functionality. For example, the following writing means that when <code class="docutils literal notranslate"><span class="pre">BAR</span></code> is selected, the <code class="docutils literal notranslate"><span class="pre">FOO</span></code> item will be displayed in the menu, and when both <code class="docutils literal notranslate"><span class="pre">BAR</span></code> and <code class="docutils literal notranslate"><span class="pre">TIZ</span></code> are selected, the default value of <code class="docutils literal notranslate"><span class="pre">FOO</span></code> will be <code class="docutils literal notranslate"><span class="pre">y</span></code>.</p>
<blockquote>
<div><div class="highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="n">config</span><span class="w"> </span><span class="no">FOO</span>
<span class="w">   </span><span class="n">bool</span><span class="w"> </span><span class="s2">&quot;choose FOO&quot;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="no">BAR</span>
<span class="w">   </span><span class="n">default</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="no">BAR</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="no">TIZ</span>
</pre></div>
</div>
</div></blockquote>
</li>
</ul>
</div></blockquote>
<p><strong>Dependencies in Kconfig</strong></p>
<blockquote>
<div><ol class="arabic">
<li><p>Adding dependencies with <code class="docutils literal notranslate"><span class="pre">depends</span> <span class="pre">on</span></code></p>
<p>Through <code class="docutils literal notranslate"><span class="pre">depends</span> <span class="pre">on</span></code>, all entries under this config item can be added with dependencies. The following two writings are equivalent:</p>
<div class="highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="n">config</span><span class="w"> </span><span class="no">FOO</span>
<span class="w">   </span><span class="n">depends</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="no">BAR</span>
<span class="w">   </span><span class="n">bool</span><span class="w"> </span><span class="s2">&quot;choose FOO&quot;</span>
<span class="w">   </span><span class="n">default</span><span class="w"> </span><span class="n">y</span>

<span class="c1">## equal to</span>

<span class="n">config</span><span class="w"> </span><span class="no">FOO</span>
<span class="w">   </span><span class="n">bool</span><span class="w"> </span><span class="s2">&quot;choose FOO&quot;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="no">BAR</span>
<span class="w">   </span><span class="n">default</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="no">BAR</span>
</pre></div>
</div>
</li>
<li><p>Adding reverse dependencies with <code class="docutils literal notranslate"><span class="pre">select</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">select</span></code> forces another config to be selected when a config is chosen, regardless of whether this config has other dependency relationships. For example, in the following example, when <code class="docutils literal notranslate"><span class="pre">BUZZ</span></code> is selected, <code class="docutils literal notranslate"><span class="pre">FOO</span></code> will definitely be selected regardless of the value of <code class="docutils literal notranslate"><span class="pre">BAR</span></code>, and it cannot be deselected through the visualization interface.</p>
<div class="highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="n">config</span><span class="w"> </span><span class="no">BUZZ</span>
<span class="w">   </span><span class="n">bool</span><span class="w"> </span><span class="s2">&quot;choose BUZZ&quot;</span>
<span class="w">   </span><span class="nb">select</span><span class="w"> </span><span class="no">FOO</span>

<span class="n">config</span><span class="w"> </span><span class="no">FOO</span>
<span class="w">   </span><span class="n">depends</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="no">BAR</span>
<span class="w">   </span><span class="n">bool</span><span class="w"> </span><span class="s2">&quot;choose FOO&quot;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">select</span></code> can only select bool-type configs.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">select</span></code> is commonly used for invisible configs or those without dependencies.</p></li>
</ul>
</div>
</li>
</ol>
</div></blockquote>
<p><strong>Invisible Config Items</strong></p>
<blockquote>
<div><p>When no prompt text is defined under a config, this config item is invisible, meaning it cannot be manually selected or deselected by the user. Its value is generally selected through dependency items or defined by <code class="docutils literal notranslate"><span class="pre">default</span></code> values. For example:</p>
<div class="highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="n">config</span><span class="w"> </span><span class="no">BAR</span>
<span class="w">   </span><span class="n">bool</span><span class="w"> </span><span class="s2">&quot;BAR&quot;</span>
<span class="w">   </span><span class="nb">select</span><span class="w"> </span><span class="no">FOO</span>

<span class="n">config</span><span class="w"> </span><span class="no">FOO</span>
<span class="w">   </span><span class="n">bool</span>
<span class="w">   </span><span class="n">default</span><span class="w"> </span><span class="n">n</span>

<span class="c1">##equal to</span>

<span class="n">config</span><span class="w"> </span><span class="no">FOO</span>
<span class="w">   </span><span class="n">bool</span>
<span class="w">   </span><span class="n">default</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="no">BAR</span>

<span class="c1">##also equal to</span>

<span class="n">config</span><span class="w"> </span><span class="no">FOO</span>
<span class="w">   </span><span class="n">depends</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="no">BAR</span>
<span class="w">   </span><span class="n">bool</span>
<span class="w">   </span><span class="n">default</span><span class="w"> </span><span class="n">y</span>
</pre></div>
</div>
<p>If it is not a bool type:</p>
<div class="highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="n">config</span><span class="w"> </span><span class="no">NUM</span>
<span class="w">   </span><span class="n">int</span>
<span class="w">   </span><span class="n">default</span><span class="w"> </span><span class="mi">255</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="no">BAR</span>
<span class="w">   </span><span class="n">default</span><span class="w"> </span><span class="mi">65535</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="o">!</span><span class="no">BAR</span>
</pre></div>
</div>
</div></blockquote>
</section>
<section id="introduction-to-conf-files">
<span id="write-conf-files"></span><h2>Introduction to conf Files<a class="headerlink" href="#introduction-to-conf-files" title="Link to this heading"></a></h2>
<p><strong>conf File Format</strong></p>
<blockquote>
<div><p>Conf files replace the UI-based menuconfig approach by writing user-defined configuration items into them. Conf files consist of multiple configuration items, each following this format:</p>
<div class="highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="no">CONFIG_</span><span class="o">&lt;</span><span class="n">name1</span><span class="o">&gt;=&lt;</span><span class="n">value</span><span class="o">&gt;</span>

<span class="no">CONFIG_</span><span class="o">&lt;</span><span class="n">name2</span><span class="o">&gt;=&lt;</span><span class="n">value</span><span class="o">&gt;</span>

<span class="o">...</span>
</pre></div>
</div>
<p>There should be no spaces around the <code class="docutils literal notranslate"><span class="pre">=</span></code> sign.</p>
</div></blockquote>
<p><strong>Writing conf Files</strong></p>
<blockquote>
<div><ul class="simple">
<li><p>The writing style of conf files is similar to <code class="docutils literal notranslate"><span class="pre">.config</span></code> files, but note that <code class="docutils literal notranslate"><span class="pre">.config</span></code> files contain all config items, whether they are visible to the user or not. However, conf files can only set config items visible to the user.</p></li>
<li><p>Similar to UI menuconfig, this direct configuration method essentially selects/deselects some items defined in Kconfig files, replacing interactive input with parameter input.</p></li>
</ul>
<p>For example, consider the following Kconfig:</p>
<div class="highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="n">config</span><span class="w"> </span><span class="no">SUPPORT_ATCMD</span>
<span class="w">   </span><span class="n">bool</span><span class="w"> </span><span class="s2">&quot;Enable ATCMD&quot;</span>
<span class="w">   </span><span class="n">default</span><span class="w"> </span><span class="n">n</span>
<span class="k">if</span><span class="w"> </span><span class="no">SUPPORT_ATCMD</span>
<span class="w">   </span><span class="n">choice</span>
<span class="w">      </span><span class="n">default</span><span class="w"> </span><span class="no">ATCMD_MANUAL_TEST</span>
<span class="w">      </span><span class="n">prompt</span><span class="w"> </span><span class="s2">&quot;ATCMD Mode&quot;</span>
<span class="w">      </span><span class="n">config</span><span class="w"> </span><span class="no">ATCMD_MANUAL_TEST</span>
<span class="w">            </span><span class="n">bool</span><span class="w"> </span><span class="s2">&quot;Manual Test Mode&quot;</span>
<span class="w">      </span><span class="n">config</span><span class="w"> </span><span class="no">ATCMD_HOST_CONTROL</span>
<span class="w">            </span><span class="n">bool</span><span class="w"> </span><span class="s2">&quot;Host Control Mode&quot;</span>
<span class="w">   </span><span class="n">endchoice</span>
<span class="w">   </span><span class="n">config</span><span class="w"> </span><span class="no">ATCMD_NETWORK</span>
<span class="w">      </span><span class="n">bool</span><span class="w"> </span><span class="s2">&quot;Enable Network&quot;</span>
<span class="w">      </span><span class="n">default</span><span class="w"> </span><span class="n">n</span>
<span class="w">   </span><span class="n">config</span><span class="w"> </span><span class="no">ATCMD_SOCKET</span>
<span class="w">      </span><span class="n">bool</span><span class="w"> </span><span class="s2">&quot;Enable Socket&quot;</span>
<span class="n">endif</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="n">Enable</span> <span class="n">ATCMD</span>
   <span class="n">ATCMD</span> <span class="n">Mode</span> <span class="p">(</span><span class="n">Manual</span> <span class="n">Test</span> <span class="n">Mode</span><span class="p">)</span>  <span class="o">---&gt;</span>
<span class="p">[</span> <span class="p">]</span>     <span class="n">Enable</span> <span class="n">Longer</span> <span class="n">CMD</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span>     <span class="n">Enable</span> <span class="n">Network</span>
<span class="p">[</span> <span class="p">]</span>     <span class="n">Enable</span> <span class="n">Socket</span>
</pre></div>
</div>
<p>The corresponding conf file should be written as:</p>
<div class="highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="no">CONFIG_SUPPORT_ATCMD</span><span class="o">=</span><span class="n">y</span>

<span class="no">CONFIG_ATCMD_NETWORK</span><span class="o">=</span><span class="n">y</span>
</pre></div>
</div>
<p>Since <code class="docutils literal notranslate"><span class="pre">ATCMD_MANUAL_TEST</span></code> is the default choice value, it can be omitted in the conf file as <code class="docutils literal notranslate"><span class="pre">CONFIG_ATCMD_MANUAL_TEST=y</span></code>.</p>
<p>In the <code class="docutils literal notranslate"><span class="pre">{SDK}/amebaxxx_gcc_project/utils/confs_daily_build</span></code> directory, various common configuration collection files are provided, which users can refer to for creating their own conf files.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Users can save the current configurations as a conf file using <a class="reference internal" href="../0_gcc_build_environment/1_gcc_build_environment_toprst.html#gen-conf-file"><span class="std std-ref">menuconfig.py -s</span></a>.</p>
</div>
</div></blockquote>
<p><strong>default.conf</strong></p>
<blockquote>
<div><ul class="simple">
<li><p>In <code class="docutils literal notranslate"><span class="pre">{SDK}/amebaxxx_gcc_project</span></code> directory, there is a configuration file named <code class="docutils literal notranslate"><span class="pre">default.conf</span></code>, defining the <a class="reference internal" href="../0_gcc_build_environment/1_gcc_build_environment_toprst.html#init-config"><span class="std std-ref">initial configuration</span></a> for building this SOC project.</p></li>
<li><p>Specifically, <code class="docutils literal notranslate"><span class="pre">menuconfig.py</span> <span class="pre">-f</span></code> implicitly includes the rule of <code class="docutils literal notranslate"><span class="pre">menuconfig.py</span> <span class="pre">-f</span> <span class="pre">default.conf</span></code>, so when users write conf files, they can omit config items already configured in the <code class="docutils literal notranslate"><span class="pre">default.conf</span></code> file, meaning they only need to write incremental configurations compared to <code class="docutils literal notranslate"><span class="pre">default.conf</span></code>. If certain options in <code class="docutils literal notranslate"><span class="pre">default.conf</span></code> need to be disabled, set the corresponding config items to <code class="docutils literal notranslate"><span class="pre">n</span></code>.</p></li>
<li><p>Default values in Kconfig only take effect if a specific config item is not touched, while <code class="docutils literal notranslate"><span class="pre">default.conf</span></code> files act as a series of default inputs, thus having higher priority than default values in Kconfig.</p></li>
</ul>
</div></blockquote>
<p><strong>prj.conf</strong></p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">prj.conf</span></code> is located under <a class="reference internal" href="../0_gcc_build_environment/1_gcc_build_environment_toprst.html#build-example"><span class="std std-ref">example</span></a> or the user-created <a class="reference internal" href="../0_gcc_build_environment/1_gcc_build_environment_toprst.html#creat-project"><span class="std std-ref">project path</span></a>, recording the configuration items needed for this example or external project. Users can configure the project using <code class="docutils literal notranslate"><span class="pre">menuconfig.py</span> <span class="pre">-f</span> <span class="pre">/.../prj.conf</span></code>. Additionally, when users have not configured through the UI or specified other conf files, <code class="docutils literal notranslate"><span class="pre">prj.conf</span></code> will be used as the <a class="reference internal" href="../0_gcc_build_environment/1_gcc_build_environment_toprst.html#init-config"><span class="std std-ref">initial configuration</span></a>.</p></li>
<li><p>The priority of <code class="docutils literal notranslate"><span class="pre">prj.conf</span></code> is higher than that of <code class="docutils literal notranslate"><span class="pre">default.conf</span></code>.</p></li>
</ul>
</div></blockquote>
</section>
<section id="kconfig-automatic-update-check">
<h2>Kconfig Automatic Update Check<a class="headerlink" href="#kconfig-automatic-update-check" title="Link to this heading"></a></h2>
<p>When the Kconfig file or <code class="docutils literal notranslate"><span class="pre">default.conf</span></code> file is updated (e.g., pulled from a remote repository), but the files in the menuconfig folder are still based on the previous Kconfig, running <code class="docutils literal notranslate"><span class="pre">build.py</span></code> directly can lead to unexpected behavior. To prevent this, a check for Kconfig updates is performed before each compilation.</p>
<p>The anchor file for this check is <code class="docutils literal notranslate"><span class="pre">menuconfig/.config_default</span></code>, which is generated based on <code class="docutils literal notranslate"><span class="pre">default.conf</span></code> before each compilation. It contains the default configuration values for the SOC. If the newly generated <code class="docutils literal notranslate"><span class="pre">menuconfig/.config_default</span></code> differs from an existing file in the <code class="docutils literal notranslate"><span class="pre">menuconfig</span></code> folder, the console will display the differences and prompt the user to decide:</p>
<ul class="simple">
<li><p>If user determines that the Kconfig update can be ignored, press <kbd class="kbd docutils literal notranslate">Enter</kbd> to continue using the current <code class="docutils literal notranslate"><span class="pre">.config</span></code> configuration.</p></li>
<li><p>If user believes ignoring the Kconfig update may affect the compilation results, press <kbd class="kbd compound docutils literal notranslate"><kbd class="kbd docutils literal notranslate">Ctrl</kbd>+<kbd class="kbd docutils literal notranslate">C</kbd></kbd> to exit. After exiting, the user can reconfigure using the visualization interface or via <code class="docutils literal notranslate"><span class="pre">menuconfig.py</span> <span class="pre">-f</span></code>, or clean the <code class="docutils literal notranslate"><span class="pre">menuconfig</span></code> folder using <code class="docutils literal notranslate"><span class="pre">menuconfig.py</span> <span class="pre">-c</span></code> or <code class="docutils literal notranslate"><span class="pre">build.py</span> <span class="pre">-p</span></code>, and then compile using the default configuration.</p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="0_build_system_index.html" class="btn btn-neutral float-left" title="Build System" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../0_sdk_example/0_sdk_example_index.html" class="btn btn-neutral float-right" title="SDK Examples" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Realsil.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
    <!-- 问题反馈按钮和对话框 -->
    
        <button id="report-button">Inquire</button>
    
    <div id="feedback-dialog" class="feedback-dialog" style="display: none;">
        <div class="form-group">
            <label style="font-weight: bold;">Please select the related chapter:</label>
            <select id="chapter-select">
                <option value="">Select Chapter</option>
                <!-- 章节选项将通过JavaScript动态填充 -->
            </select>
        </div>

        <div class="form-group">
            <label style="font-weight: bold;">Post Type</label>
            <select id="post-type" class="form-control" required>
                <option value="">-- Select Type --</option>
                <option value="doc_correction">Document Correction</option>
                <option value="tech_consult">Technical Consult</option>
                <option value="tech_summary">Technical Summary</option>
                <option value="operation_flow">Operation Flow</option>
            </select>
        </div>

        <div class="form-group">
            <label style="font-weight: bold;">Related Paragraph:</label>
            <textarea
                id="paragraph-input"
                placeholder="{{ '你可以先选择有问题的段落或手动输入...' if language == 'zh_CN' else 'You can select text or type directly here...' }}"
                rows="4"
            ></textarea>
        </div>

        <div class="form-group">
            <label style="font-weight: bold;">Please describe your issue:</label>
            <textarea
                id="inquire_input"
                placeholder="Feature enhancement in progress, please stay tuned...">
            </textarea>
        </div>

        <button id="submit-feedback">Submit</button>
        <button id="cancel-feedback">Cancel</button>
    </div>

    <style>
        .form-group {
            margin: 5px 0;  /* 基础间距 */
        }

        /* 相邻表单项缩小上方间距 */
        .form-group + .form-group {
            margin-top: 10px;
        }

        /* 段落输入框底部微调 */
        #paragraph-input, #inquire_input {
            margin: 2px 0; /* 上下间距 */
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            resize: vertical;
            min-height: 100px;

            /* 占位符样式 */
            &::placeholder {
                color: #999;
                font-style: italic;
            }
        }
    </style>

      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
     

    
        
        <script>
            // 路由守卫配置
            const ROUTER_CONFIG = {
                baseUrl: 'http://172.29.57.206:5000',
                checkInterval: 30000 // 30秒检查一次
            };

            window.getStoredUsername = function() {
                try {
                    const session = localStorage.getItem('auth_session');
                    if (!session) return null;
                    const { username, expires } = JSON.parse(session);
                    if (Date.now() > expires) {
                        localStorage.removeItem('auth_session');
                        return null;
                    }
                    return username;
                } catch (e) {
                    console.error('读取存储会话失败:', e);
                    return null;
                }
            }

            // 增强型路由守卫
            function setupRouteGuard() {
                const originalPushState = history.pushState;
                const originalReplaceState = history.replaceState;
            
                function wrappedHistoryMethod(method) {
                    return function(state, title, url) {
                        if (url) {
                            const urlObj = new URL(url, window.location.origin);
                            verifyNavigation(urlObj.pathname).then(allowed => {
                                if (allowed) {
                                    method.apply(history, [state, title, url]);
                                }
                            });
                        } else {
                            method.apply(history, [state, title, url]);
                        }
                    };
                }

                history.pushState = wrappedHistoryMethod(originalPushState);
                history.replaceState = wrappedHistoryMethod(originalReplaceState);

                window.addEventListener('popstate', () => {
                    verifyNavigation(window.location.pathname);
                });
            }

            // CSRF Token处理：获取CSRF令牌
            window.getCSRFToken = function() {
                // 从 Cookie 中获取 CSRF Token
                const cookieValue = document.cookie
                    .split('; ')
                    .find(row => row.startsWith('csrf_token='))
                    ?.split('=')[1];
                return cookieValue || '';
            }

            // 统一验证逻辑
            function verifyNavigation(path, isBackgroundCheck = false) {
                console.log('[NDA Auth] verifyNavigation fetch check_nda_access ...');

                if (isExemptPath(path)) return Promise.resolve(true);

                const page = new URL(path, window.location.origin).pathname.split('/').pop();
                console.log('[DEBUG] 提取的页面名称:', page);

                return fetch('http://172.29.57.206:5000/check_nda_access', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': window.getCSRFToken()
                    },
                    body: JSON.stringify({
                        path: page,
                        username: window.getStoredUsername() || 'null' //  注意：后端从 session 取用户名，此处不需要传 username
                    }),
                    credentials: 'include'
                })
                .then(response => {
                    // 关键：先检查状态码再解析 JSON
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json(); // 显式解析 JSON
                })
                .then(data => {
                    console.log('[DEBUG] data.access:', data.access);
                    return data.access ?? false;
                })
                .catch(error => {
                    console.error('[ERROR] 验证失败:', error);
                    return false;
                });
            }

            // 初始化
            document.addEventListener('DOMContentLoaded', () => {
                verifyNavigation(window.location.pathname);
                setupRouteGuard();
            });
        </script>
    

    


</body>
</html>