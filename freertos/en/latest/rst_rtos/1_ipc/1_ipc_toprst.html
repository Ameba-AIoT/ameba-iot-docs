

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Introduction &mdash; Ameba IoT Docs  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
      <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=b0e775ca" />
      <link rel="stylesheet" type="text/css" href="../../_static/tabs.css?v=a5c4661c" />
      <link rel="stylesheet" type="text/css" href="../../_static/_static/custom.css" />

  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../../_static/toggleprompt.js?v=d7ede5d2"></script>
        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
        <script src="../../_static/tabs.js?v=3030b3cb"></script>
        <script>let toggleHintShow = 'Click to show';</script>
        <script>let toggleHintHide = 'Click to hide';</script>
        <script>let toggleOpenOnPrint = 'true';</script>
        <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Pin Multiplexing Instructions" href="../1_pinmux/0_pinmux_index.html" />
    <link rel="prev" title="Inter-Processor Communication (IPC)" href="0_ipc_index.html" />
   
  
  <script type="text/javascript" src="../../_static/js/selector.js"></script>

  <style>
    .wy-nav-content {max-width: 1000px;} /* 设置最大宽度 */
  </style>

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            Ameba IoT Docs
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../0_ameba_product/0_ameba_product_center_index.html">Products Center</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_ameba_sdk/0_ameba_sdks_index.html">Ameba SDK</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_ameba_solutions/0_ameba_solutions_index.html">Ameba Solutions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_gcc_build_environment/0_gcc_build_index.html">0.1 GCC Build Environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_gdb_debug/0_gdb_debug_index.html">0.2 GDB Debug</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_gcc_build_library/0_gcc_build_library_index.html">0.3 GCC Build Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_sdk_example/0_sdk_example_index.html">0.4 SDK Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_memory_layout/0_layout_index.html">0.5 Flash &amp; RAM Layout</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_user_config/0_usrcfg_index.html">0.6 User Config</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_tools/0_tools_index.html">0.7 Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_at_command/0_at_command_index.html">0.8 AT Command</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_file_system/0_vfs_index.html">0.9 Virtual File System</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1_mpu_cache/0_mpu_cache_index.html">1.0 MPU and Cache</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1_boot_process/0_boot_index.html">1.1 BOOT Process</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1_ota/0_ota_index.html">1.2 OTA</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1_otpc/0_otpc_index.html">1.3 OTPC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1_chipen/0_chipen_index.html">1.4 CHIPEN</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="0_ipc_index.html">1.5 Inter Processor Communication</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="#how-to-use-ipc">How to Use IPC</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#suggested-usage-of-ipc-get-message">Suggested Usage of ipc_get_message()</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#troubleshooting">Troubleshooting</a></li>
<li class="toctree-l2"><a class="reference internal" href="#ipc-application">IPC Application</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../1_pinmux/0_pinmux_index.html">1.6 PINMUX</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1_gpio/0_gpio_index.html">1.7 GPIO</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1_power_save/0_ps_index.html">1.9 Power Save</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2_whc_wifi_bridge/0_wifi_bridge_index.html">2.1 WHC Bridge</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2_whc_fullmac/0_fullmac_index.html">2.2 WHC FullMAC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2_wifi_tunnel/0_wifi_tunnel_index.html">2.3 Wi-Fi R-Mesh</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2_wifi_csi/0_wifi_csi_index.html">2.5 Wi-Fi CSI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2_wifi_adaptivity_test/0_wifi_adaptivity_index.html">2.6 Wi-Fi Adaptivity Test</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_security/0_security_index.html">3.1 Security &amp; Encryption</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_trng/0_trng_index.html">3.2 True Random Number Generator</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_nda_huk_derivation/0_huk_derivation_index_nda.html">3.3 HUK Derivation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_nda_rdp/0_rdp_index_nda.html">3.4 RDP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_nda_rsip/0_rsip_index_nda.html">3.5 RSIP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_nda_secure_boot/0_secure_boot_index_nda.html">3.6 Secure Boot</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_nda_swd_protection/0_swd_protection_index_nda.html">3.7 SWD Protection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_nda_tfm/0_tfm_index_nda.html">3.8 Trusted Firmware-M (TF-M)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_crypto_engine/0_crypto_engine_index.html">3.9 Crypto Engine</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_ecdsa_engine/0_ecdsa_index.html">3.a ECDSA Engine</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_eddsa_engine/0_eddsa_index.html">3.b EDDSA Engine</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_rsa_engine/0_rsa_index.html">3.c RSA Engine</a></li>
<li class="toctree-l1"><a class="reference internal" href="../4_ai/0_ai_index.html">4.1 AI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../4_ai_voice/0_ai_voice_index.html">4.2 AIVoice</a></li>
<li class="toctree-l1"><a class="reference internal" href="../4_multimedia/0_multimedia_index.html">4.3 Multimedia</a></li>
<li class="toctree-l1"><a class="reference internal" href="../4_dsp/0_dsp_index.html">4.4 DSP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../6_mass_production/0_mp_index.html">6.1 Mass Production</a></li>
<li class="toctree-l1"><a class="reference internal" href="../6_mp_image/0_mp_image_index.html">6.2 MP Image</a></li>
<li class="toctree-l1"><a class="reference internal" href="../6_mptools/0_mptools_index.html">6.3 MP Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../7_usb/0_usb_index.html">7.1 USB Host &amp; Device</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_dmac/0_dmac_index.html">8.1 DMA Controllor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_psram/0_psram_index.html">8.2 PSRAM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_thermal/0_thermal_index.html">8.3 Thermal Meter</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_adc/0_adc_index.html">8.4 ADC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_ir/0_ir_index.html">8.5 IR</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_ledc/0_ledc_index.html">8.6 LEDC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_cap_touch/0_cap_touch_index.html">8.7 Cap-Touch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_key_scan/0_key_scan_index.html">8.8 Key-Scan</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_rtc_io/0_rtc_io_index.html">8.9 RTC-IO</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_lcdc/0_lcdc_index.html">8.A LCDC</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Ameba IoT Docs</a>
      </nav>

      <div class="wy-nav-content">

        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="0_ipc_index.html">Inter-Processor Communication (IPC)</a></li>
      <li class="breadcrumb-item active">Introduction</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <span class="target" id="ipc"></span><!-- 下拉菜单 -->
<div style="margin: 20px 0; text-align: left;">
    <div style="display: flex; align-items: center; gap: 10px;">
        <span style="font-size: 14px;">IC: </span>
        <select class="tab-selector" style="height: 22px; padding: 2px 8px; font-size: 13px;">
            <option value="RTL8721Dx">RTL8721Dx</option>
            <option value="RTL8720E">RTL8720E</option>
            <option value="RTL8726E">RTL8726E</option>
            <option value="RTL8730E">RTL8730E</option>
        </select>
    </div>
</div>

<!-- 修复后的 JavaScript -->
<script>
document.addEventListener("DOMContentLoaded", function() {
    const selector = document.querySelector('.tab-selector');

    selector.addEventListener('change', function() {
        const targetTab = this.value;
        const tabs = document.querySelectorAll('.sphinx-tabs-tab');
        let found = false;

        tabs.forEach(tab => {
            const tabText = tab.textContent.trim();
            if (tabText === targetTab) {
                tab.click();
                window.dispatchEvent(new Event('resize')); // 触发插件更新
                found = true;
            }
        });

        if (!found) {
            console.error("未找到选项卡:", targetTab);
        }
    });
});
</script><section id="introduction">
<h1>Introduction<a class="headerlink" href="#introduction" title="Link to this heading"></a></h1>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-0-0-0" aria-selected="true" class="sphinx-tabs-tab" id="tab-0-0-0" name="0-0" role="tab" tabindex="0">RTL8721Dx</button><button aria-controls="panel-0-0-1" aria-selected="false" class="sphinx-tabs-tab" id="tab-0-0-1" name="0-1" role="tab" tabindex="-1">RTL8726E</button><button aria-controls="panel-0-0-2" aria-selected="false" class="sphinx-tabs-tab" id="tab-0-0-2" name="0-2" role="tab" tabindex="-1">RTL8720E</button><button aria-controls="panel-0-0-3" aria-selected="false" class="sphinx-tabs-tab" id="tab-0-0-3" name="0-3" role="tab" tabindex="-1">RTL8730E</button></div><div aria-labelledby="tab-0-0-0" class="sphinx-tabs-panel" id="panel-0-0-0" name="0-0" role="tabpanel" tabindex="0"><p>The inter-processor communication (IPC) hardware is designed to make multi-CPUs communicate with each other.
Also, a KM0 shared SRAM is used to transmit information to each other. The block diagram is shown below.</p>
<figure class="align-center" id="id2">
<a class="reference internal image-reference" href="../../_images/ipc_block_diagram.svg"><img alt="../../_images/ipc_block_diagram.svg" height="97" src="../../_images/ipc_block_diagram.svg" width="368" /></a>
<figcaption>
<p><span class="caption-text">IPC block diagram</span><a class="headerlink" href="#id2" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>There are 2 directions for 2 cores to communicate with each other: KM0 ←→ KM4. There are 16 TX channels and 16 RX channels for each direction. All the channels are processed independently. That means one core can send different information to another core through different channels at any time, the channels will not affect each other.</p>
<p>Each channel has one transmit side and one receive side, the transmit side and the receive side of the same channel is a pair. For example, KM0 sends an IPC to KM4 through channel 7, the transmit side is KM0 channel 7, and receive side is KM4 channel 7, and information is sent from KM0 channel 7 to KM4 channel 7.</p>
<figure class="align-center" id="id3">
<a class="reference internal image-reference" href="../../_images/ipc_schematic_diagram.svg"><img alt="../../_images/ipc_schematic_diagram.svg" height="127" src="../../_images/ipc_schematic_diagram.svg" width="484" /></a>
<figcaption>
<p><span class="caption-text">IPC schematic diagram</span><a class="headerlink" href="#id3" title="Link to this image"></a></p>
</figcaption>
</figure>
</div><div aria-labelledby="tab-0-0-1" class="sphinx-tabs-panel" hidden="true" id="panel-0-0-1" name="0-1" role="tabpanel" tabindex="0"><p>The inter-processor communication (IPC) hardware is designed to make multi-CPUs communicate with each other.
Also, a shared SRAM is used to transmit information to each other. The block diagram is shown below.</p>
<figure class="align-center" id="id4">
<a class="reference internal image-reference" href="../../_images/ipc_block_diagram_8726EA.svg"><img alt="../../_images/ipc_block_diagram_8726EA.svg" height="136" src="../../_images/ipc_block_diagram_8726EA.svg" width="282" /></a>
<figcaption>
<p><span class="caption-text">IPC block diagram</span><a class="headerlink" href="#id4" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>There are six directions for three cores to communicate with each other: KR4 ←→ KM4, KM4 ←→ DSP, KR4 ←→ DSP, and 16 channels for each direction. All the channels are processed independently, which means that one core can send different information to another core through different channels at any time, the channels will not affect each other.</p>
<p>Each channel has one transmit side and one receive side, the transmit side and the receive side of the same channel is a pair. For example, KR4 sends an IPC to KM4 through channel 4, the transmit side is KR4 channel 4, and the receive side is KM4 channel 4; and information is sent from KR4 channel 4 to KM4 channel 4.</p>
<figure class="align-center" id="id5">
<a class="reference internal image-reference" href="../../_images/ipc_schematic_diagram_8726EA.svg"><img alt="../../_images/ipc_schematic_diagram_8726EA.svg" height="284" src="../../_images/ipc_schematic_diagram_8726EA.svg" width="729" /></a>
<figcaption>
<p><span class="caption-text">IPC schematic diagram</span><a class="headerlink" href="#id5" title="Link to this image"></a></p>
</figcaption>
</figure>
</div><div aria-labelledby="tab-0-0-2" class="sphinx-tabs-panel" hidden="true" id="panel-0-0-2" name="0-2" role="tabpanel" tabindex="0"><p>The inter-processor communication (IPC) hardware is designed to make multi-CPUs communicate with each other.
Also, a shared SRAM is used to transmit information to each other. The block diagram is shown below.</p>
<figure class="align-center" id="id6">
<a class="reference internal image-reference" href="../../_images/ipc_block_diagram_8720EA.svg"><img alt="../../_images/ipc_block_diagram_8720EA.svg" height="49" src="../../_images/ipc_block_diagram_8720EA.svg" width="282" /></a>
<figcaption>
<p><span class="caption-text">IPC block diagram</span><a class="headerlink" href="#id6" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>There are two directions for KM4 and KR4 to communicate with each other, and 8 channels for each direction. All the channels are processed independently, which means that one core can send different information to the other core through different channels at any time, the channels will not affect each other.</p>
<p>Each channel has one transmit side and one receive side, the transmit side and the receive side of the same channel is a pair. For example, KR4 sends an IPC to KM4 through channel 4, the transmit side is KR4 channel 4, and the receive side is KM4 channel 4; and information is sent from KR4 channel 4 to KM4 channel 4.</p>
<figure class="align-center" id="id7">
<a class="reference internal image-reference" href="../../_images/ipc_schematic_diagram_8720EA.svg"><img alt="../../_images/ipc_schematic_diagram_8720EA.svg" height="96" src="../../_images/ipc_schematic_diagram_8720EA.svg" width="404" /></a>
<figcaption>
<p><span class="caption-text">IPC schematic diagram</span><a class="headerlink" href="#id7" title="Link to this image"></a></p>
</figcaption>
</figure>
</div><div aria-labelledby="tab-0-0-3" class="sphinx-tabs-panel" hidden="true" id="panel-0-0-3" name="0-3" role="tabpanel" tabindex="0"><p>There are multi-CPUs named CA32 (AP), KM4 (NP) and KM0 integrated in SoC.
The inter-processor communication (IPC) hardware is designed to make these CPUs communicate with each other.
Also, a KM0 shared SRAM is used to transmit information to each other. The block diagram is shown below.</p>
<figure class="align-center" id="id8">
<a class="reference internal image-reference" href="../../_images/ipc_block_diagram.svg"><img alt="../../_images/ipc_block_diagram.svg" height="97" src="../../_images/ipc_block_diagram.svg" width="368" /></a>
<figcaption>
<p><span class="caption-text">IPC block diagram</span><a class="headerlink" href="#id8" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>There are 6 directions for 3 cores to communicate with each other: KM0 ←→ NP, NP ←→ AP, KM0 ←→ AP. There are 8 channels for each direction. All the channels are processed independently. That means one core can send different information to another core through different channels at any time, the channels will not affect each other.</p>
<p>Each channel has one transmit side and one receive side, the transmit side and the receive side of the same channel is a pair. For example, KM0 sends an IPC to NP through channel 7, the transmit side is KM0 channel 7, and receive side is NP channel 7, and information is sent from KM0 channel 7 to NP channel 7.</p>
<figure class="align-center" id="id9">
<a class="reference internal image-reference" href="../../_images/ipc_schematic_diagram.svg"><img alt="../../_images/ipc_schematic_diagram.svg" height="127" src="../../_images/ipc_schematic_diagram.svg" width="484" /></a>
<figcaption>
<p><span class="caption-text">IPC schematic diagram</span><a class="headerlink" href="#id9" title="Link to this image"></a></p>
</figcaption>
</figure>
</div></div>
</section>
<section id="how-to-use-ipc">
<h1>How to Use IPC<a class="headerlink" href="#how-to-use-ipc" title="Link to this heading"></a></h1>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-1-1-0" aria-selected="true" class="sphinx-tabs-tab" id="tab-1-1-0" name="1-0" role="tab" tabindex="0">RTL8721Dx</button><button aria-controls="panel-1-1-1" aria-selected="false" class="sphinx-tabs-tab" id="tab-1-1-1" name="1-1" role="tab" tabindex="-1">RTL8720E</button><button aria-controls="panel-1-1-2" aria-selected="false" class="sphinx-tabs-tab" id="tab-1-1-2" name="1-2" role="tab" tabindex="-1">RTL8726E</button><button aria-controls="panel-1-1-3" aria-selected="false" class="sphinx-tabs-tab" id="tab-1-1-3" name="1-3" role="tab" tabindex="-1">RTL8730E</button></div><div aria-labelledby="tab-1-1-0" class="sphinx-tabs-panel" id="panel-1-1-0" name="1-0" role="tabpanel" tabindex="0"><p>For example, KM0 sends an IPC to KM4 through channel 8.</p>
<ol class="arabic">
<li><p>Register the receiver IRQ handler function of the selected channel in receiver IPC.</p>
<p>In this case, add a new IPC_INIT_TABLE in the KM4 for channel 8 of KM0 to KM4. Rx IRQ handler, Rx IRQ data, Tx IRQ handler, Tx IRQ data, IPC direction and IPC channel should be set and defined. If message exchange is needed, you should specify the message type: data or point.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="n">IPC_TABLE_DATA_SECTION</span>
<span class="linenos">2</span><span class="n">Const</span><span class="w"> </span><span class="n">IPC_INIT_TABLE</span><span class="w"> </span><span class="n">ipc_channel8_table</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">3</span><span class="p">{</span><span class="n">IPC_USER_DATA</span><span class="p">,</span><span class="w"> </span><span class="n">IPC_CHANNEL8_ipc_int</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">VOID</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">IPC_TXHandler</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">VOID</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="nb">NULL</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">IPC_KM0_TO_KM4</span><span class="p">,</span><span class="w"> </span><span class="n">IPC_N2A_Channel8</span><span class="p">},</span>
<span class="linenos">4</span><span class="p">};</span>
</pre></div>
</div>
</li>
<li><p>Uncomment the corresponding channel in <code class="docutils literal notranslate"><span class="pre">ameba_ipccfg.h</span></code> and add some description as shown below. This macro is used in step <a class="reference internal" href="#ipc-usage-procedure-step-5"><span class="std std-ref">5</span></a>.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="cm">/** @defgroup IPC_KM0_Tx_Channel</span>
<span class="linenos"> 2</span><span class="cm">* @{</span>
<span class="linenos"> 3</span><span class="cm">*/</span>
<span class="linenos"> 4</span><span class="cp">#define IPC_N2A_TICKLESS_INDICATION  0  </span><span class="cm">/*!&lt; KM0 -&gt; KM4 Tickless indicate */</span>
<span class="linenos"> 5</span><span class="cp">#define IPC_N2A_WAKE_AP          1  </span><span class="cm">/*!&lt; KM0 -&gt; KM4 Wakeup*/</span>
<span class="linenos"> 6</span><span class="cp">#define IPC_N2A_WIFI_FW_INFO      2  </span><span class="cm">/*!&lt; KM0 -&gt; KM4 FW Info*/</span>
<span class="linenos"> 7</span><span class="cp">#define IPC_N2A_FLASHPG_REQ        3  </span><span class="cm">/*!&lt; KM0 -&gt; KM4 Flash Program REQUEST*/</span>
<span class="linenos"> 8</span><span class="cp">#define IPC_N2A_LOGUART_RX_SWITCH    4  </span><span class="cm">/*!&lt; KM0 -&gt; KM4 Loguart Rx Switch*/</span>
<span class="linenos"> 9</span><span class="cp">#define IPC_N2A_BT_API_TRAN        5  </span><span class="cm">/*!&lt; KM0 -&gt; KM4 BT API Exchange */</span>
<span class="linenos">10</span><span class="c1">// #define IPC_N2A_BT_DATA_TRAN      5  /*!&lt; KM0 -&gt; KM4 BT DATA Exchange */</span>
<span class="linenos">11</span><span class="cp">#define IPC_N2A_WIFI_TRX_TRAN      6  </span><span class="cm">/*!&lt; KM0 -&gt; KM4 WIFI Message Exchange */</span>
<span class="linenos">12</span><span class="cp">#define IPC_N2A_WIFI_API_TRAN      7  </span><span class="cm">/*!&lt; KM0 -&gt; KM4 API WIFI Message Exchange */</span>
<span class="hll"><span class="linenos">13</span><span class="cp">#define IPC_N2A_Channel8        8</span>
</span><span class="linenos">14</span><span class="c1">//#define IPC_N2A_Channel9        9</span>
<span class="linenos">15</span><span class="c1">//#define IPC_N2A_Channel10        10</span>
<span class="linenos">16</span><span class="c1">//#define IPC_N2A_Channel11        11</span>
<span class="linenos">17</span><span class="c1">//#define IPC_N2A_Channel12        12</span>
<span class="linenos">18</span><span class="c1">//#define IPC_N2A_Channel13        13</span>
<span class="linenos">19</span><span class="c1">//#define IPC_N2A_Channel14        14</span>
<span class="linenos">20</span><span class="c1">//#define IPC_N2A_Channel15        15</span>
<span class="linenos">21</span><span class="cm">/**</span>
<span class="linenos">22</span><span class="cm">* @}</span>
<span class="linenos">23</span><span class="cm">*/</span>
</pre></div>
</div>
</li>
<li><p>Register the transmit IRQ handler function of the selected channel in transmit IPC and uncomment the corresponding channel. This step is <code class="docutils literal notranslate"><span class="pre">optional</span></code> , because this step is for register Tx interrupt, which is for transmit IPC to know that the receiver IPC has received this IPC. In this case, add a new IPC_INIT_TABLE in the KM0 for channel 8 of KM0 to KM4.</p></li>
</ol>
<ol class="arabic simple" id="ipc-usage-procedure-step-4" start="4">
<li><p>SDK will enable the IPC receiver interrupt of KM4 and transmit interrupt of KM0 (if configured in step3) according to <code class="docutils literal notranslate"><span class="pre">IPC_INIT_TABLE</span></code> , and register the corresponding IRQ handler and data for the channel.</p></li>
</ol>
<ol class="arabic" id="ipc-usage-procedure-step-5" start="5">
<li><p>When KM0 sends an IPC request to KM4 through channel 8, it should call <code class="docutils literal notranslate"><span class="pre">ipc_send_message()</span></code> and specify the channel number and message. If no message is needed, just input NULL for the third parameter of <code class="docutils literal notranslate"><span class="pre">ipc_send_message</span> <span class="pre">()</span></code> .</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="n">IPC_MSG_STRUCT</span><span class="w"> </span><span class="n">ipc_msg_temp</span><span class="p">;</span>
<span class="linenos">2</span><span class="c1">// init ipc_msg</span>
<span class="linenos">3</span><span class="n">ipc_msg_temp</span><span class="p">.</span><span class="n">msg_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">IPC_USER_POINT</span><span class="p">;</span>
<span class="linenos">4</span><span class="n">ipc_msg_temp</span><span class="p">.</span><span class="n">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">u32</span><span class="p">)</span><span class="o">&amp;</span><span class="n">tmp_np_log_buf</span><span class="p">;</span>
<span class="linenos">5</span><span class="n">ipc_msg_temp</span><span class="p">.</span><span class="n">msg_len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="linenos">6</span><span class="n">ipc_msg_temp</span><span class="p">.</span><span class="n">rsvd</span><span class="w"> </span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
<span class="linenos">7</span><span class="c1">//send ipc message</span>
<span class="linenos">8</span><span class="n">ipc_send_message</span><span class="p">(</span><span class="n">IPC_KM0_TO_KM4</span><span class="p">,</span><span class="w"> </span><span class="n">IPC_N2A_Channel8</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">ipc_msg_temp</span><span class="p">);</span>
</pre></div>
</div>
</li>
<li><p>After receiving IPC from KM0 channel8, KM4 will enter IPC interrupt handler and the corresponding receive IRQ handler will be executed, call <code class="docutils literal notranslate"><span class="pre">ipc_get_message()</span></code> to get the message if needed.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">PIPC_MSG_STRUCT</span><span class="w"> </span><span class="n">ipc_msg_temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">PIPC_MSG_STRUCT</span><span class="p">)</span><span class="n">ipc_get_message</span><span class="p">(</span><span class="n">IPC_KM0_TO_KM4</span><span class="p">,</span><span class="w"> </span><span class="n">IPC_N2A_Channel8</span><span class="p">);</span>
</pre></div>
</div>
</li>
<li><p>If you have configured in step3, after KM4 receives the IPC, KM0 also enters IPC interrupt handler and executes the corresponding transmit IRQ handler.</p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Several channels are already used by Realtek, you can use the remaining channels.</p>
</div>
</div><div aria-labelledby="tab-1-1-1" class="sphinx-tabs-panel" hidden="true" id="panel-1-1-1" name="1-1" role="tabpanel" tabindex="0"><p>For example, KR4 sends an IPC to KM4 through channel 4.</p>
<ol class="arabic">
<li><p>Select IPC channel.</p>
<p>Uncomment the corresponding channel in <code class="file docutils literal notranslate"><span class="pre">ameba_ipc.h</span></code>  and add some description as below. In this case, uncomment the macro <code class="docutils literal notranslate"><span class="pre">IPC_R2M_Channel4</span></code> which means KR4 to KM4 channel 4.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cm">/** @defgroup IPC_KR4_Tx_Channel</span>
<span class="cm">* @{</span>
<span class="cm">*/</span>
<span class="cp">#define IPC_R2M_TICKLESS_INDICATION    0  </span><span class="cm">/*!&lt; KR4 --&gt; KM4 Tickless indicate */</span>
<span class="cp">#define IPC_R2M_WAKE_AP                1  </span><span class="cm">/*!&lt; KR4 --&gt; KM4 Wakeup*/</span>
<span class="cp">#define IPC_R2M_FLASHPG_REQ            2  </span><span class="cm">/*!&lt; KR4 --&gt; KM4 Flash Program REQUEST*/</span>
<span class="cp">#define IPC_R2M_WIFI_FW_INFO           2  </span><span class="cm">/*!&lt; KR4 --&gt; KM4 FW Info*/</span>
<span class="c1">//#define IPC_R2M_Channel3             3</span>
<span class="hll"><span class="cp">#define IPC_R2M_Channel4               4  </span><span class="cm">/*Add your Description Here*/</span>
</span><span class="c1">//#define IPC_R2M_Channel5             5</span>
<span class="cp">#define IPC_R2M_WIFI_TRX_TRAN          6  </span><span class="cm">/*!&lt; NP --&gt; AP WIFI Message Exchange */</span>
<span class="cp">#define IPC_R2M_WIFI_API_TRAN          7  </span><span class="cm">/*!&lt; NP --&gt; AP API WIFI Message Exchange */</span>
<span class="cm">/**</span>
<span class="cm">* @}</span>
<span class="cm">*/</span>
</pre></div>
</div>
</li>
<li><p>Register IRQ handler function of the selected channel.</p>
<p>Add struct <code class="docutils literal notranslate"><span class="pre">IPC_INIT_TABLE</span></code> into your code and put this struct in IPC table section by add <code class="docutils literal notranslate"><span class="pre">IPC_TABLE_DATA_SECTION</span></code>. This struct specifies the direction, channel, mode and IRQ function of IPC as below.</p>
<dl class="field-list">
<dt class="field-odd">&lt;USER_MSG_TYPE&gt;<span class="colon">:</span></dt>
<dd class="field-odd"><p>This parameter can be</p>
<div class="line-block">
<div class="line"><strong>IPC_USER_DATA</strong>: The contents of this IPC is data.</div>
<div class="line"><strong>IPC_USER_POINT</strong>: The contents of this IPC is pointer which points to address of actual data.</div>
</div>
</dd>
<dt class="field-even">&lt;RxFunc&gt;<span class="colon">:</span></dt>
<dd class="field-even"><p>The callback function that CPU executes after receiving IPC.</p>
</dd>
<dt class="field-odd">&lt;RxIrqData&gt;<span class="colon">:</span></dt>
<dd class="field-odd"><p>The parameters that are passed into the rx callback function.</p>
</dd>
<dt class="field-even">&lt;TxFunc&gt;<span class="colon">:</span></dt>
<dd class="field-even"><p>The callback function that CPU executes after sending IPC.</p>
</dd>
<dt class="field-odd">&lt;TxIrqData&gt;<span class="colon">:</span></dt>
<dd class="field-odd"><p>The parameters that are passed into the tx callback function</p>
</dd>
<dt class="field-even">&lt;IPC_Direction&gt;<span class="colon">:</span></dt>
<dd class="field-even"><p>This parameter can be</p>
<div class="line-block">
<div class="line"><strong>IPC_KR4_TO_KM4</strong>: IPC is sent from KR4 to KM4.</div>
<div class="line"><strong>IPC_KM4_TO_KR4</strong>: IPC is sent from KM4 to KR4.</div>
<div class="line"><strong>IPC_KR4_TO_DSP</strong>: IPC is sent from KR4 to DSP.</div>
<div class="line"><strong>IPC_KM4_TO_DSP</strong>: IPC is sent from KM4 to DSP.</div>
<div class="line"><strong>IPC_DSP_TO_KR4</strong>: IPC is sent from DSP to KR4.</div>
<div class="line"><strong>IPC_DSP_TO_KM4</strong>: IPC is sent from DSP to KM4.</div>
</div>
</dd>
<dt class="field-odd">&lt;IPC_R2M_Channel4&gt;<span class="colon">:</span></dt>
<dd class="field-odd"><p>IPC channel used, this macro is selected in the previous step.</p>
</dd>
</dl>
<p>The SDK will automatically enable the IPC interrupt and register the corresponding IRQ handler and data for the channel. In this example, KM4 will enter IRQ_function_int after KR4 sends IPC through channel 4.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">IRQ_function_int</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
<span class="cm">/* Add your code here*/</span>
<span class="p">}</span>

<span class="n">IPC_TABLE_DATA_SECTION</span>
<span class="k">const</span><span class="w"> </span><span class="n">IPC_INIT_TABLE</span><span class="w"> </span><span class="n">ipc_R2M_CH4_table</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="p">{</span><span class="n">IPC_USER_DATA</span><span class="p">,</span><span class="w"> </span><span class="n">IRQ_function_int</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">VOID</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">IPC_TXHandler</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">VOID</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">IPC_KR4_TO_KM4</span><span class="p">,</span><span class="w"> </span><span class="n">IPC_R2M_Channel4</span><span class="p">},</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><p>Send IPC request.</p>
<p>When KR4 sends an IPC request to KM4 through channel 4, it should call <code class="xref py py-func docutils literal notranslate"><span class="pre">ipc_send_message()</span></code>  and specify the channel number and message. If no message is needed, just input <code class="docutils literal notranslate"><span class="pre">NULL</span></code> for the third parameter of <code class="xref py py-func docutils literal notranslate"><span class="pre">ipc_send_message()</span></code> .</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">IPC_MSG_STRUCT</span><span class="w"> </span><span class="n">ipc_msg</span><span class="p">;</span>
<span class="cm">/*init ipc_msg here*/</span>
<span class="n">ipc_msg</span><span class="p">.</span><span class="n">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">u32</span><span class="p">)</span><span class="o">&amp;</span><span class="n">tmp_np_log_</span><span class="w"> </span><span class="n">buf</span><span class="p">;</span>
<span class="cm">/*init ipc_msg end*/</span>
<span class="n">ipc_send_message</span><span class="p">(</span><span class="n">IPC_KR4_TO_KM4</span><span class="p">,</span><span class="w"> </span><span class="n">IPC_R2M_Channel4</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ipc_msg</span><span class="p">);</span>
</pre></div>
</div>
</li>
<li><p>Get IPC message if needed.</p>
<p>After receiving IPC from KR4 channel 4, KM4 will enter IPC interrupt handler and the corresponding receive IRQ handler will be executed, call <code class="xref py py-func docutils literal notranslate"><span class="pre">ipc_get_message()</span></code> to get the message if needed.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">PIPC_MSG_STRUCT</span><span class="w"> </span><span class="n">ipc_msg_temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">PIPC_MSG_STRUCT</span><span class="p">)</span><span class="n">ipc_get_message</span><span class="p">(</span><span class="n">IPC_KR4_TO_KM4</span><span class="p">,</span><span class="w"> </span><span class="n">IPC_R2M_Channel4</span><span class="p">);</span>
</pre></div>
</div>
</li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Several channels are already used by Realtek, you can use the remaining channels.</p>
</div>
</div><div aria-labelledby="tab-1-1-2" class="sphinx-tabs-panel" hidden="true" id="panel-1-1-2" name="1-2" role="tabpanel" tabindex="0"><p>For example, KR4 sends an IPC to KM4 through channel 4.</p>
<ol class="arabic">
<li><p>Select IPC channel.</p>
<p>Uncomment the corresponding channel in <code class="file docutils literal notranslate"><span class="pre">ameba_ipc.h</span></code>  and add some description as below. In this case, uncomment the macro <code class="docutils literal notranslate"><span class="pre">IPC_R2M_Channel4</span></code> which means KR4 to KM4 channel 4.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cm">/** @defgroup IPC_KR4_Tx_Channel</span>
<span class="cm">* @{</span>
<span class="cm">*/</span>
<span class="cp">#define IPC_R2M_TICKLESS_INDICATION    0  </span><span class="cm">/*!&lt; KR4 --&gt; KM4 Tickless indicate */</span>
<span class="cp">#define IPC_R2M_WAKE_AP                1  </span><span class="cm">/*!&lt; KR4 --&gt; KM4 Wakeup*/</span>
<span class="cp">#define IPC_R2M_FLASHPG_REQ            2  </span><span class="cm">/*!&lt; KR4 --&gt; KM4 Flash Program REQUEST*/</span>
<span class="cp">#define IPC_R2M_WIFI_FW_INFO           2  </span><span class="cm">/*!&lt; KR4 --&gt; KM4 FW Info*/</span>
<span class="c1">//#define IPC_R2M_Channel3             3</span>
<span class="hll"><span class="cp">#define IPC_R2M_Channel4               4  </span><span class="cm">/*Add your Description Here*/</span>
</span><span class="c1">//#define IPC_R2M_Channel5             5</span>
<span class="cp">#define IPC_R2M_WIFI_TRX_TRAN          6  </span><span class="cm">/*!&lt; NP --&gt; AP WIFI Message Exchange */</span>
<span class="cp">#define IPC_R2M_WIFI_API_TRAN          7  </span><span class="cm">/*!&lt; NP --&gt; AP API WIFI Message Exchange */</span>
<span class="cm">/**</span>
<span class="cm">* @}</span>
<span class="cm">*/</span>
</pre></div>
</div>
</li>
<li><p>Register IRQ handler function of the selected channel.</p>
<p>Add struct <code class="docutils literal notranslate"><span class="pre">IPC_INIT_TABLE</span></code> into your code and put this struct in IPC table section by add <code class="docutils literal notranslate"><span class="pre">IPC_TABLE_DATA_SECTION</span></code>. This struct specifies the direction, channel, mode and IRQ function of IPC as below.</p>
<dl class="field-list">
<dt class="field-odd">&lt;USER_MSG_TYPE&gt;<span class="colon">:</span></dt>
<dd class="field-odd"><p>This parameter can be</p>
<div class="line-block">
<div class="line"><strong>IPC_USER_DATA</strong>: The contents of this IPC is data.</div>
<div class="line"><strong>IPC_USER_POINT</strong>: The contents of this IPC is pointer which points to address of actual data.</div>
</div>
</dd>
<dt class="field-even">&lt;RxFunc&gt;<span class="colon">:</span></dt>
<dd class="field-even"><p>The callback function that CPU executes after receiving IPC.</p>
</dd>
<dt class="field-odd">&lt;RxIrqData&gt;<span class="colon">:</span></dt>
<dd class="field-odd"><p>The parameters that are passed into the rx callback function.</p>
</dd>
<dt class="field-even">&lt;TxFunc&gt;<span class="colon">:</span></dt>
<dd class="field-even"><p>The callback function that CPU executes after sending IPC.</p>
</dd>
<dt class="field-odd">&lt;TxIrqData&gt;<span class="colon">:</span></dt>
<dd class="field-odd"><p>The parameters that are passed into the tx callback function</p>
</dd>
<dt class="field-even">&lt;IPC_Direction&gt;<span class="colon">:</span></dt>
<dd class="field-even"><p>This parameter can be</p>
<div class="line-block">
<div class="line"><strong>IPC_KR4_TO_KM4</strong>: IPC is sent from KR4 to KM4.</div>
<div class="line"><strong>IPC_KM4_TO_KR4</strong>: IPC is sent from KM4 to KR4.</div>
<div class="line"><strong>IPC_KR4_TO_DSP</strong>: IPC is sent from KR4 to DSP.</div>
<div class="line"><strong>IPC_KM4_TO_DSP</strong>: IPC is sent from KM4 to DSP.</div>
<div class="line"><strong>IPC_DSP_TO_KR4</strong>: IPC is sent from DSP to KR4.</div>
<div class="line"><strong>IPC_DSP_TO_KM4</strong>: IPC is sent from DSP to KM4.</div>
</div>
</dd>
<dt class="field-odd">&lt;IPC_R2M_Channel4&gt;<span class="colon">:</span></dt>
<dd class="field-odd"><p>IPC channel used, this macro is selected in the previous step.</p>
</dd>
</dl>
<p>The SDK will automatically enable the IPC interrupt and register the corresponding IRQ handler and data for the channel. In this example, KM4 will enter IRQ_function_int after KR4 sends IPC through channel 4.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">IRQ_function_int</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
<span class="cm">/* Add your code here*/</span>
<span class="p">}</span>

<span class="n">IPC_TABLE_DATA_SECTION</span>
<span class="k">const</span><span class="w"> </span><span class="n">IPC_INIT_TABLE</span><span class="w"> </span><span class="n">ipc_R2M_CH4_table</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="p">{</span><span class="n">IPC_USER_DATA</span><span class="p">,</span><span class="w"> </span><span class="n">IRQ_function_int</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">VOID</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">IPC_TXHandler</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">VOID</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">IPC_KR4_TO_KM4</span><span class="p">,</span><span class="w"> </span><span class="n">IPC_R2M_Channel4</span><span class="p">},</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><p>Send IPC request.</p>
<p>When KR4 sends an IPC request to KM4 through channel 4, it should call <code class="xref py py-func docutils literal notranslate"><span class="pre">ipc_send_message()</span></code>  and specify the channel number and message. If no message is needed, just input <code class="docutils literal notranslate"><span class="pre">NULL</span></code> for the third parameter of <code class="xref py py-func docutils literal notranslate"><span class="pre">ipc_send_message()</span></code> .</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">IPC_MSG_STRUCT</span><span class="w"> </span><span class="n">ipc_msg</span><span class="p">;</span>
<span class="cm">/*init ipc_msg here*/</span>
<span class="n">ipc_msg</span><span class="p">.</span><span class="n">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">u32</span><span class="p">)</span><span class="o">&amp;</span><span class="n">tmp_np_log_</span><span class="w"> </span><span class="n">buf</span><span class="p">;</span>
<span class="cm">/*init ipc_msg end*/</span>
<span class="n">ipc_send_message</span><span class="p">(</span><span class="n">IPC_KR4_TO_KM4</span><span class="p">,</span><span class="w"> </span><span class="n">IPC_R2M_Channel4</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ipc_msg</span><span class="p">);</span>
</pre></div>
</div>
</li>
<li><p>Get IPC message if needed.</p>
<p>After receiving IPC from KR4 channel 4, KM4 will enter IPC interrupt handler and the corresponding receive IRQ handler will be executed, call <code class="xref py py-func docutils literal notranslate"><span class="pre">ipc_get_message()</span></code> to get the message if needed.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">PIPC_MSG_STRUCT</span><span class="w"> </span><span class="n">ipc_msg_temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">PIPC_MSG_STRUCT</span><span class="p">)</span><span class="n">ipc_get_message</span><span class="p">(</span><span class="n">IPC_KR4_TO_KM4</span><span class="p">,</span><span class="w"> </span><span class="n">IPC_R2M_Channel4</span><span class="p">);</span>
</pre></div>
</div>
</li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Several channels are already used by Realtek, you can use the remaining channels.</p>
</div>
</div><div aria-labelledby="tab-1-1-3" class="sphinx-tabs-panel" hidden="true" id="panel-1-1-3" name="1-3" role="tabpanel" tabindex="0"><p>For example, KM0 sends an IPC to NP through channel 7.</p>
<ol class="arabic">
<li><p>Select IPC channel.</p>
<p>Uncomment the corresponding channel in <code class="file docutils literal notranslate"><span class="pre">ameba_ipc.h</span></code>  and add some description as shown below. This macro is used in the next step. In this case, uncomment the macro <cite>IPC_L2N_Channel7</cite> which means LP to NP channel7.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cm">/** @defgroup IPC_LP_Tx_Channel</span>
<span class="cm">* @{</span>
<span class="cm">*/</span>
<span class="cp">#define IPC_L2N_LOGUART_RX_SWITCH   0  </span><span class="cm">/*!&lt;  LP --&gt;  NP Loguart Rx Switch*/</span>
<span class="cp">#define IPC_L2N_WAKE_NP             1</span>
<span class="cp">#define IPC_L2N_FLASHPG_REQ         2  </span><span class="cm">/*!&lt;  LP --&gt;  NP Flash Program REQUEST*/</span>
<span class="c1">//#define IPC_L2N_Channel3          3</span>
<span class="c1">//#define IPC_L2N_Channel4          4</span>
<span class="c1">//#define IPC_L2N_Channel5          5</span>
<span class="c1">//#define IPC_L2N_Channel6          6</span>
<span class="hll"><span class="cp">#define IPC_L2N_Channel7            7  </span><span class="cm">/*!&lt;  LP --&gt;  Add your Description Here*/</span>
</span>
<span class="cp">#define IPC_L2A_LOGUART_RX_SWITCH   0  </span><span class="cm">/*!&lt;  LP --&gt;  AP Loguart Rx Switch*/</span>
<span class="c1">//#define IPC_L2A_Channel1          1</span>
<span class="c1">//#define IPC_L2A_Channel2          2</span>
<span class="c1">//#define IPC_L2A_Channel3          3</span>
<span class="c1">//#define IPC_L2A_Channel4          4</span>
<span class="c1">//#define IPC_L2A_Channel5          5</span>
<span class="c1">//#define IPC_L2A_Channel6          6</span>
<span class="c1">//#define IPC_L2A_Channel7          7</span>
<span class="cm">/** @} */</span>
</pre></div>
</div>
</li>
<li><p>Register IRQ handler function of the selected channel.</p>
<p>Add structure <code class="docutils literal notranslate"><span class="pre">IPC_INIT_TABLE</span></code> into your code and put this structure in IPC table section by add <code class="docutils literal notranslate"><span class="pre">IPC_TABLE_DATA_SECTION</span></code>. This structure specifies the direction, channel, mode and IRQ function of IPC as shown below.</p>
<dl class="field-list">
<dt class="field-odd">&lt;USER_MSG_TYPE&gt;<span class="colon">:</span></dt>
<dd class="field-odd"><p>This parameter can be</p>
<div class="line-block">
<div class="line"><strong>IPC_USER_DATA</strong>: The contents of this IPC is data.</div>
<div class="line"><strong>IPC_USER_POINT</strong>: The contents of this IPC is pointer which points to address of actual data.</div>
</div>
</dd>
<dt class="field-even">&lt;RxFunc&gt;<span class="colon">:</span></dt>
<dd class="field-even"><p>The callback function that CPU executes after receiving IPC.</p>
</dd>
<dt class="field-odd">&lt;RxIrqData&gt;<span class="colon">:</span></dt>
<dd class="field-odd"><p>The parameters that are passed into the rx callback function.</p>
</dd>
<dt class="field-even">&lt;TxFunc&gt;<span class="colon">:</span></dt>
<dd class="field-even"><p>The callback function that CPU executes after sending IPC.</p>
</dd>
<dt class="field-odd">&lt;TxIrqData&gt;<span class="colon">:</span></dt>
<dd class="field-odd"><p>The parameters that are passed into the tx callback function</p>
</dd>
<dt class="field-even">&lt;IPC_Direction&gt;<span class="colon">:</span></dt>
<dd class="field-even"><p>This parameter can be</p>
<div class="line-block">
<div class="line"><strong>IPC_LP_TO_NP</strong>: IPC is sent from KM0 to NP.</div>
<div class="line"><strong>IPC_LP_TO_AP</strong>: IPC is sent from KM0 to AP.</div>
<div class="line"><strong>IPC_NP_TO_LP</strong>: IPC is sent from NP to KM0.</div>
<div class="line"><strong>IPC_NP_TO_AP</strong>: IPC is sent from NP to AP.</div>
<div class="line"><strong>IPC_AP_TO_LP</strong>: IPC is sent from AP to KM0.</div>
<div class="line"><strong>IPC_AP_TO_NP</strong>: IPC is sent from AP to NP.</div>
</div>
</dd>
<dt class="field-odd">&lt;IPC_L2C_Channel7&gt;<span class="colon">:</span></dt>
<dd class="field-odd"><p>IPC channel used, this macro is selected in the previous step.</p>
</dd>
</dl>
<p>The SDK will automatically enable the IPC interrupt and register the corresponding IRQ handler and data for the channel. In this example, NP will enter <code class="xref py py-func docutils literal notranslate"><span class="pre">IRQ_function_int()</span></code> after KM0 send IPC through channel7.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">IRQ_function_int</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">   </span><span class="cm">/* Add your code here*/</span>
<span class="p">}</span>

<span class="n">IPC_TABLE_DATA_SECTION</span>
<span class="k">const</span><span class="w"> </span><span class="n">IPC_INIT_TABLE</span><span class="w"> </span><span class="n">ipc_L2N_CH7_table</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="p">{</span><span class="n">IPC_USER_DATA</span><span class="p">,</span><span class="w"> </span><span class="n">IRQ_function_int</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">VOID</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">IPC_TXHandler</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">VOID</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">IPC_LP_TO_NP</span><span class="p">,</span><span class="w"> </span><span class="n">IPC_L2N_Channel7</span><span class="p">},</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><p>Send IPC request.</p>
<p>When KM0 sends an IPC request to NP through channel 7, it should call <code class="xref py py-func docutils literal notranslate"><span class="pre">ipc_send_message()</span></code> and specify the channel number and message. If no message is needed, just input <code class="docutils literal notranslate"><span class="pre">NULL</span></code> for the third parameter of <code class="xref py py-func docutils literal notranslate"><span class="pre">ipc_send_message()</span></code>.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">IPC_MSG_STRUCT</span><span class="w"> </span><span class="n">ipc_msg</span><span class="p">;</span>
<span class="cm">/*init ipc_msg here*/</span>
<span class="n">ipc_msg</span><span class="p">.</span><span class="n">msg_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">IPC_USER_POINT</span><span class="p">;</span>
<span class="n">ipc_msg</span><span class="p">.</span><span class="n">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">u32</span><span class="p">)</span><span class="o">&amp;</span><span class="n">tmp_np_log_buf</span><span class="p">;</span>
<span class="cm">/*init ipc_msg end*/</span>
<span class="n">ipc_send_message</span><span class="p">(</span><span class="n">IPC_LP_TO_NP</span><span class="p">,</span><span class="w"> </span><span class="n">IPC_L2N_Channel7</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ipc_msg</span><span class="p">);</span>
</pre></div>
</div>
</li>
<li><p>Get IPC message if needed.</p>
<p>After receiving IPC from KM0 channel7, NP will enter IPC interrupt handler and the corresponding receive IRQ handler will be executed, call <code class="docutils literal notranslate"><span class="pre">ipc_get_message()</span></code> to get the message if needed.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">PIPC_MSG_STRUCT</span><span class="w"> </span><span class="n">ipc_msg_temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">PIPC_MSG_STRUCT</span><span class="p">)</span><span class="n">ipc_get_message</span><span class="p">(</span><span class="n">IPC_LP_TO_NP</span><span class="p">,</span><span class="w"> </span><span class="n">IPC_L2N_Channel7</span><span class="p">);</span>
</pre></div>
</div>
</li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Several channels are already used by Realtek, you can use the remaining channels.</p>
</div>
</div></div>
<section id="suggested-usage-of-ipc-get-message">
<h2>Suggested Usage of ipc_get_message()<a class="headerlink" href="#suggested-usage-of-ipc-get-message" title="Link to this heading"></a></h2>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-2-2-0" aria-selected="true" class="sphinx-tabs-tab" id="tab-2-2-0" name="2-0" role="tab" tabindex="0">RTL8721Dx</button><button aria-controls="panel-2-2-1" aria-selected="false" class="sphinx-tabs-tab" id="tab-2-2-1" name="2-1" role="tab" tabindex="-1">RTL8720E</button><button aria-controls="panel-2-2-2" aria-selected="false" class="sphinx-tabs-tab" id="tab-2-2-2" name="2-2" role="tab" tabindex="-1">RTL8726E</button><button aria-controls="panel-2-2-3" aria-selected="false" class="sphinx-tabs-tab" id="tab-2-2-3" name="2-3" role="tab" tabindex="-1">RTL8730E</button></div><div aria-labelledby="tab-2-2-0" class="sphinx-tabs-panel" id="panel-2-2-0" name="2-0" role="tabpanel" tabindex="0"><ul>
<li><p>Use <code class="docutils literal notranslate"><span class="pre">ipc_get_message()</span></code> in IPC interrupt handle or user interrupt handler.</p>
<blockquote>
<div><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="kt">void</span><span class="w"> </span><span class="nf">IPC_CHANNEL8_ipc_int</span><span class="p">(</span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">Data</span><span class="p">,</span><span class="w"> </span><span class="n">u32</span><span class="w"> </span><span class="n">IrqStatus</span><span class="p">,</span><span class="w"> </span><span class="n">u32</span><span class="w"> </span><span class="n">ChanNum</span><span class="p">)</span>
<span class="linenos">2</span><span class="p">{</span>
<span class="linenos">3</span><span class="cm">/* To avoid gcc warnings */</span>
<span class="linenos">4</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"> </span><span class="n">Data</span><span class="p">;</span>
<span class="linenos">5</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"> </span><span class="n">IrqStatus</span><span class="p">;</span>
<span class="linenos">6</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"> </span><span class="n">ChanNum</span><span class="p">;</span>
<span class="linenos">7</span><span class="n">PIPC_MSG_STRUCT</span><span class="w">  </span><span class="n">ipc_msg_temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">PIPC_MSG_STRUCT</span><span class="p">)</span><span class="n">ipc_get_message</span><span class="p">(</span><span class="n">IPC_KM0_TO_KM4</span><span class="p">,</span><span class="w"> </span><span class="n">IPC_N2A_Channel8</span><span class="p">);</span>
<span class="linenos">8</span><span class="n">u32</span><span class="w"> </span><span class="n">addr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ipc_msg_temp</span><span class="o">-&gt;</span><span class="n">msg</span><span class="p">;</span>
<span class="linenos">9</span><span class="p">}</span>
</pre></div>
</div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="n">IPC_TABLE_DATA_SECTION</span>
<span class="linenos">2</span><span class="k">const</span><span class="w"> </span><span class="n">IPC_INIT_TABLE</span><span class="w"> </span><span class="n">ipc_channel8_table</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">3</span><span class="p">{</span><span class="n">IPC_USER_DATA</span><span class="p">,</span><span class="w"> </span><span class="n">IPC_CHANNEL8_ipc_int</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">VOID</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">IPC_TXHandler</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">VOID</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">IPC_KM0_TO_KM4</span><span class="p">,</span><span class="w"> </span><span class="n">IPC_N2A_Channel8</span><span class="p">},</span>
<span class="linenos">4</span><span class="p">};</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">IPC_MSG_STRUCT</span></code> is no need to cache invalidation any more after <code class="docutils literal notranslate"><span class="pre">ipc_get_message()</span></code>.</p>
<blockquote>
<div><figure class="align-center">
<a class="reference internal image-reference" href="../../_images/ipc_suggested_usage_fig1.png"><img alt="../../_images/ipc_suggested_usage_fig1.png" src="../../_images/ipc_suggested_usage_fig1.png" style="width: 437.5px; height: 63.5px;" /></a>
</figure>
</div></blockquote>
</li>
<li><p>Forcing <code class="docutils literal notranslate"><span class="pre">IPC_MSG_STRUCT</span></code> type conversion has risks.</p>
<blockquote>
<div><figure class="align-center">
<a class="reference internal image-reference" href="../../_images/ipc_suggested_usage_fig2.png"><img alt="../../_images/ipc_suggested_usage_fig2.png" src="../../_images/ipc_suggested_usage_fig2.png" style="width: 628.5px; height: 221.0px;" /></a>
</figure>
</div></blockquote>
</li>
<li><p>Using <code class="docutils literal notranslate"><span class="pre">ipc_get_message()</span></code> in task also has risks.</p>
<blockquote>
<div><figure class="align-center">
<a class="reference internal image-reference" href="../../_images/ipc_suggested_usage_fig3.png"><img alt="../../_images/ipc_suggested_usage_fig3.png" src="../../_images/ipc_suggested_usage_fig3.png" style="width: 536.0px; height: 266.5px;" /></a>
</figure>
</div></blockquote>
</li>
<li><p>If <code class="docutils literal notranslate"><span class="pre">ipc_get_message()</span></code> needs to be used in <code class="docutils literal notranslate"><span class="pre">task</span></code> , do as follows:</p>
<blockquote>
<div><ol class="loweralpha simple">
<li><p>Task takes the semaphore.</p></li>
<li><p>In IPC Rx user interrupt handle, using <code class="docutils literal notranslate"><span class="pre">ipc_get_message()</span></code> to get a message.</p></li>
<li><p>Copy the message to another memory after getting message in the same Rx user interrupt handle.</p></li>
<li><p>Give semaphore.</p></li>
</ol>
<p>Then task can use the message.</p>
</div></blockquote>
</li>
</ul>
</div><div aria-labelledby="tab-2-2-1" class="sphinx-tabs-panel" hidden="true" id="panel-2-2-1" name="2-1" role="tabpanel" tabindex="0"></div><div aria-labelledby="tab-2-2-2" class="sphinx-tabs-panel" hidden="true" id="panel-2-2-2" name="2-2" role="tabpanel" tabindex="0"></div><div aria-labelledby="tab-2-2-3" class="sphinx-tabs-panel" hidden="true" id="panel-2-2-3" name="2-3" role="tabpanel" tabindex="0"><ul class="simple">
<li><p>Use <code class="docutils literal notranslate"><span class="pre">ipc_get_message()</span></code> in IPC interrupt handle or user interrupt handler.</p></li>
</ul>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">IPC_CHANNEL8_ipc_int</span><span class="p">(</span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">Data</span><span class="p">,</span><span class="w"> </span><span class="n">u32</span><span class="w"> </span><span class="n">IrqStatus</span><span class="p">,</span><span class="w"> </span><span class="n">u32</span><span class="w"> </span><span class="n">ChanNum</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">      </span><span class="cm">/* To avoid gcc warnings */</span>
<span class="w">      </span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"> </span><span class="n">Data</span><span class="p">;</span>
<span class="w">      </span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"> </span><span class="n">IrqStatus</span><span class="p">;</span>
<span class="w">      </span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"> </span><span class="n">ChanNum</span><span class="p">;</span>
<span class="w">      </span><span class="n">PIPC_MSG_STRUCT</span><span class="w">  </span><span class="n">ipc_msg_temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">PIPC_MSG_STRUCT</span><span class="p">)</span><span class="n">ipc_get_message</span><span class="p">(</span><span class="n">IPC_LP_TO_NP</span><span class="p">,</span><span class="w"> </span><span class="n">IPC_L2N_Channel8</span><span class="p">);</span>
<span class="w">      </span><span class="n">u32</span><span class="w"> </span><span class="n">addr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ipc_msg_temp</span><span class="o">-&gt;</span><span class="n">msg</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">IPC_TABLE_DATA_SECTION</span>
<span class="k">const</span><span class="w"> </span><span class="n">IPC_INIT_TABLE</span><span class="w"> </span><span class="n">ipc_channel8_table</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="p">{</span><span class="n">IPC_USER_DATA</span><span class="p">,</span><span class="w"> </span><span class="n">IPC_CHANNEL8_ipc_int</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">VOID</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">IPC_TXHandler</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">VOID</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">IPC_LP_TO_NP</span><span class="p">,</span><span class="w"> </span><span class="n">IPC_L2N_Channel8</span><span class="p">},</span>
<span class="p">};</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">IPC_MSG_STRUCT</span></code> is no need to cache invalidation any more after <code class="docutils literal notranslate"><span class="pre">ipc_get_message()</span></code>.</p></li>
</ul>
<figure class="align-center">
<a class="reference internal image-reference" href="../../_images/not_do_cache_invalid_smart.png"><img alt="../../_images/not_do_cache_invalid_smart.png" src="../../_images/not_do_cache_invalid_smart.png" style="width: 437.5px; height: 63.5px;" /></a>
</figure>
<ul class="simple">
<li><p>Forcing <code class="docutils literal notranslate"><span class="pre">IPC_MSG_STRUCT</span></code> type conversion has risks.</p></li>
</ul>
<figure class="align-center">
<a class="reference internal image-reference" href="../../_images/not_do_conver_smart.png"><img alt="../../_images/not_do_conver_smart.png" src="../../_images/not_do_conver_smart.png" style="width: 628.5px; height: 221.0px;" /></a>
</figure>
<ul class="simple">
<li><p>Using <code class="docutils literal notranslate"><span class="pre">ipc_get_message()</span></code> in task also has risks.</p></li>
</ul>
<figure class="align-center">
<a class="reference internal image-reference" href="../../_images/not_use_in_task_smart.png"><img alt="../../_images/not_use_in_task_smart.png" src="../../_images/not_use_in_task_smart.png" style="width: 536.0px; height: 266.5px;" /></a>
</figure>
<ul class="simple">
<li><p>If <code class="docutils literal notranslate"><span class="pre">ipc_get_message()</span></code> needs to be used in <code class="docutils literal notranslate"><span class="pre">task</span></code> , do as follows:</p>
<ol class="loweralpha simple">
<li><p>Task takes the semaphore.</p></li>
<li><p>In IPC Rx user interrupt handle, using <code class="docutils literal notranslate"><span class="pre">ipc_get_message()</span></code> to get a message.</p></li>
<li><p>Copy the message to another memory after getting message in the same Rx user interrupt handle.</p></li>
<li><p>Give semaphore.</p></li>
</ol>
</li>
</ul>
<p>Then task can use the message.</p>
</div></div>
</section>
</section>
<section id="troubleshooting">
<h1>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Link to this heading"></a></h1>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-3-3-0" aria-selected="true" class="sphinx-tabs-tab" id="tab-3-3-0" name="3-0" role="tab" tabindex="0">RTL8721Dx</button><button aria-controls="panel-3-3-1" aria-selected="false" class="sphinx-tabs-tab" id="tab-3-3-1" name="3-1" role="tab" tabindex="-1">RTL8720E</button><button aria-controls="panel-3-3-2" aria-selected="false" class="sphinx-tabs-tab" id="tab-3-3-2" name="3-2" role="tab" tabindex="-1">RTL8726E</button><button aria-controls="panel-3-3-3" aria-selected="false" class="sphinx-tabs-tab" id="tab-3-3-3" name="3-3" role="tab" tabindex="-1">RTL8730E</button></div><div aria-labelledby="tab-3-3-0" class="sphinx-tabs-panel" id="panel-3-3-0" name="3-0" role="tabpanel" tabindex="0"><p>If <code class="docutils literal notranslate"><span class="pre">Channel</span> <span class="pre">Conflict</span> <span class="pre">for</span> <span class="pre">CPU</span> <span class="pre">xx</span> <span class="pre">Channel</span> <span class="pre">xx!</span></code> log shows up, it means two IRQ functions are registered in the same channel.
For example, if IRQFunc1 and IRQFunc2 are both registered in KM4 for KM0 to KM4 channel1, the log will show up as below.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>14:23:03.905 [MODULE_IPC-LEVEL_ERROR]: Channel Conflict for CPU 1 Channel1 ! Ignore If CPU Has Reset
</pre></div>
</div>
<figure class="align-center">
<a class="reference internal image-reference" href="../../_images/ipc_troubleshooting.png"><img alt="../../_images/ipc_troubleshooting.png" src="../../_images/ipc_troubleshooting.png" style="width: 857.6px; height: 616.8000000000001px;" /></a>
</figure>
</div><div aria-labelledby="tab-3-3-1" class="sphinx-tabs-panel" hidden="true" id="panel-3-3-1" name="3-1" role="tabpanel" tabindex="0"><blockquote>
<div><p>If <code class="docutils literal notranslate"><span class="pre">Channel</span> <span class="pre">Conflict</span> <span class="pre">for</span> <span class="pre">Channel</span> <span class="pre">xx!</span></code> log shows up, it means two IRQ functions are registered in the same channel.
For example, if IRQFunc1 and IRQFunc2 are both registered in KM4 for KR4 to KM4 channel 1, the log will show up as below.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="mi">14</span><span class="o">:</span><span class="mi">23</span><span class="o">:</span><span class="mf">03.905</span><span class="w"> </span><span class="p">[</span><span class="n">MODULE_IPC</span><span class="o">-</span><span class="n">LEVEL_ERROR</span><span class="p">]</span><span class="o">:</span><span class="w"> </span><span class="n">Channel</span><span class="w"> </span><span class="n">Conflict</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Channel</span><span class="w"> </span><span class="mi">25</span><span class="o">!</span>
</pre></div>
</div>
</div></blockquote>
</div><div aria-labelledby="tab-3-3-2" class="sphinx-tabs-panel" hidden="true" id="panel-3-3-2" name="3-2" role="tabpanel" tabindex="0"><blockquote>
<div><p>If <code class="docutils literal notranslate"><span class="pre">Channel</span> <span class="pre">Conflict</span> <span class="pre">for</span> <span class="pre">Channel</span> <span class="pre">xx!</span></code> log shows up, it means two IRQ functions are registered in the same channel.
For example, if IRQFunc1 and IRQFunc2 are both registered in KM4 for KR4 to KM4 channel 1, the log will show up as below.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="mi">14</span><span class="o">:</span><span class="mi">23</span><span class="o">:</span><span class="mf">03.905</span><span class="w"> </span><span class="p">[</span><span class="n">MODULE_IPC</span><span class="o">-</span><span class="n">LEVEL_ERROR</span><span class="p">]</span><span class="o">:</span><span class="w"> </span><span class="n">Channel</span><span class="w"> </span><span class="n">Conflict</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Channel</span><span class="w"> </span><span class="mi">25</span><span class="o">!</span>
</pre></div>
</div>
</div></blockquote>
</div><div aria-labelledby="tab-3-3-3" class="sphinx-tabs-panel" hidden="true" id="panel-3-3-3" name="3-3" role="tabpanel" tabindex="0"><p>If <code class="docutils literal notranslate"><span class="pre">Channel</span> <span class="pre">Conflict</span> <span class="pre">for</span> <span class="pre">CPU</span> <span class="pre">xx</span> <span class="pre">Channel</span> <span class="pre">xx!</span></code> log shows up, it means two IRQ functions are registered in the same channel.
For example, if IRQFunc1 and IRQFunc2 are both registered in KM4 for KM0 to KM4 channel1, the log will show up as below.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>[MODULE_IPC-LEVEL_ERROR]: Channel Conflict for Channel 25!
</pre></div>
</div>
</div></div>
</section>
<section id="ipc-application">
<h1>IPC Application<a class="headerlink" href="#ipc-application" title="Link to this heading"></a></h1>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-4-4-0" aria-selected="true" class="sphinx-tabs-tab" id="tab-4-4-0" name="4-0" role="tab" tabindex="0">RTL8726E</button><button aria-controls="panel-4-4-1" aria-selected="false" class="sphinx-tabs-tab" id="tab-4-4-1" name="4-1" role="tab" tabindex="-1">RTL8720E</button></div><div aria-labelledby="tab-4-4-0" class="sphinx-tabs-panel" id="panel-4-4-0" name="4-0" role="tabpanel" tabindex="0"><p><strong>Introduction</strong></p>
<p>IPC queue is designed for cores communication. Define an IPC queue between every two cores, and the two cores can send and receive messages through this IPC queue.</p>
<p>IPC Message Queue:</p>
<ol class="arabic simple">
<li><p>Packets send data from Core A to Core B through IPC message queue.</p></li>
<li><p>Sender copy a complete packet into queue.</p></li>
<li><p>Receiver copy packet with custom size from queue.</p></li>
</ol>
<p>For receiver, IPC interrupt is necessary.</p>
<figure class="align-center" id="id10">
<a class="reference internal image-reference" href="../../_images/ipc_message_queue_block_diagram_lite.svg"><img alt="../../_images/ipc_message_queue_block_diagram_lite.svg" height="179" src="../../_images/ipc_message_queue_block_diagram_lite.svg" width="709" /></a>
<figcaption>
<p><span class="caption-text">IPC Message Queue block diagram</span><a class="headerlink" href="#id10" title="Link to this image"></a></p>
</figcaption>
</figure>
<p><strong>How to Use IPC Application</strong></p>
<p>Before use IPC application, users should enable this function and initial it in each core.</p>
<ul class="simple">
<li><p>For KM4: <span class="menuselection">make menuconfig &gt; MENUCONFIG FOR KM4 CONFIG &gt; CONFIG IPC Message Queue &gt; Enable IPC Message Queue</span></p></li>
<li><p>For KR4: <span class="menuselection">make menuconfig &gt; MENUCONFIG FOR KR4 CONFIG &gt; CONFIG IPC Message Queue &gt; Enable IPC Message Queue</span></p></li>
<li><p>For DSP: Open project_dsp with Xplorer, then click <span class="menuselection">project_dsp &gt; Build Properties &gt; Symbols</span>, and set <span class="guilabel">CONFIG_RPC_EN</span> to 1</p></li>
</ul>
<p>The procedure will call <code class="xref py py-func docutils literal notranslate"><span class="pre">ipc_app_init()</span></code> in <code class="xref py py-func docutils literal notranslate"><span class="pre">main()</span></code> to initial IPC application when IPC application is enabled. The initialization include IPC queue initialization.</p>
<p><strong>How to Use IPC Queue</strong></p>
<p>For example, communication between KM4 and KR4 through <code class="docutils literal notranslate"><span class="pre">IPC_ID_KR4_TO_KM4</span></code>.</p>
<ol class="arabic">
<li><p><code class="docutils literal notranslate"><span class="pre">IPC_ID_KR4_TO_KM4</span></code> definition in enumeration <code class="docutils literal notranslate"><span class="pre">IPC_ID</span></code> in <code class="file docutils literal notranslate"><span class="pre">ipc.h</span></code> is shown below. This definition is used in <a class="reference internal" href="#e-how-to-use-ipc-queue-step-2"><span class="std std-ref">Stap 2</span></a>.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">typedef</span><span class="w"> </span><span class="k">enum</span><span class="w"> </span><span class="p">{</span>
<span class="hll"><span class="w">   </span><span class="n">IPC_ID_KR4_TO_KM4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
</span><span class="w">   </span><span class="n">IPC_ID_KM4_TO_KR4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">   </span><span class="n">IPC_ID_KR4_TO_DSP</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span>
<span class="w">   </span><span class="n">IPC_ID_DSP_TO_KR4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span>
<span class="w">   </span><span class="n">IPC_ID_DSP_TO_KM4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span>
<span class="w">   </span><span class="n">IPC_ID_KM4_TO_DSP</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span>
<span class="w">   </span><span class="cm">/*14-19 used for RPC*/</span>
<span class="w">   </span><span class="n">IPC_ID_NUM</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="mi">20</span>
<span class="p">}</span><span class="w"> </span><span class="n">IPC_ID</span><span class="p">;</span>
</pre></div>
</div>
</li>
</ol>
<ol class="arabic" id="e-how-to-use-ipc-queue-step-2" start="2">
<li><p>When KR4 sends a message to KM4 through <code class="docutils literal notranslate"><span class="pre">IPC_ID_KR4_TO_KM4</span></code>, it should call <code class="xref py py-func docutils literal notranslate"><span class="pre">IPC_Message_Queue_Send()</span></code> and specify the queue ID and message.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int32_t</span><span class="w"> </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="n">IPC_Message_Queue_Send</span><span class="p">(</span><span class="n">IPC_ID_KR4_TO_KM4</span><span class="p">,</span><span class="w"> </span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="n">IMQ_BUF_SIZE</span><span class="p">,</span><span class="w"> </span><span class="n">WAIT_FOREVER</span><span class="p">);</span>
</pre></div>
</div>
</li>
<li><p>When KM4 receives a message from KR4 through IPC_ID_KR4_TO_KM4, it should call <code class="xref py py-func docutils literal notranslate"><span class="pre">IPC_Message_Queue_Recv()</span></code> and the queue ID and a buffer to receive message.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">IMQ_BUF_SIZE</span><span class="p">;</span>
<span class="kt">int32_t</span><span class="w"> </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="n">IPC_Message_Queue_Recv</span><span class="p">(</span><span class="n">IPC_ID_KR4_TO_KM4</span><span class="p">,</span><span class="w"> </span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">size</span><span class="p">);</span>
</pre></div>
</div>
</li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>The memory regions are only defined in AP core, the maximum data region is 40kB.</p></li>
<li><p>Users can use default test demo to verify IPC queue by command <code class="docutils literal notranslate"><span class="pre">test_ipc_message</span></code> in console both in KR4 and KM4.</p></li>
</ul>
</div>
</div><div aria-labelledby="tab-4-4-1" class="sphinx-tabs-panel" hidden="true" id="panel-4-4-1" name="4-1" role="tabpanel" tabindex="0"><p><strong>Introduction</strong></p>
<p>IPC queue is designed for cores communication. Define an IPC queue between every two cores, and the two cores can send and receive messages through this IPC queue.</p>
<p>IPC Message Queue:</p>
<ol class="arabic simple">
<li><p>Packets send data from Core A to Core B through IPC message queue.</p></li>
<li><p>Sender copy a complete packet into queue.</p></li>
<li><p>Receiver copy packet with custom size from queue.</p></li>
</ol>
<p>For receiver, IPC interrupt is necessary.</p>
<figure class="align-center" id="id11">
<a class="reference internal image-reference" href="../../_images/ipc_message_queue_block_diagram_lite.svg"><img alt="../../_images/ipc_message_queue_block_diagram_lite.svg" height="179" src="../../_images/ipc_message_queue_block_diagram_lite.svg" width="709" /></a>
<figcaption>
<p><span class="caption-text">IPC Message Queue block diagram</span><a class="headerlink" href="#id11" title="Link to this image"></a></p>
</figcaption>
</figure>
<p><strong>How to Use IPC Application</strong></p>
<p>Before use IPC application, users should enable this function and initial it in each core.</p>
<ul class="simple">
<li><p>For KM4: <span class="menuselection">make menuconfig &gt; MENUCONFIG FOR KM4 CONFIG &gt; CONFIG IPC Message Queue &gt; Enable IPC Message Queue</span></p></li>
<li><p>For KR4: <span class="menuselection">make menuconfig &gt; MENUCONFIG FOR KR4 CONFIG &gt; CONFIG IPC Message Queue &gt; Enable IPC Message Queue</span></p></li>
</ul>
<p>The procedure will call <code class="xref py py-func docutils literal notranslate"><span class="pre">ipc_app_init()</span></code> in <code class="xref py py-func docutils literal notranslate"><span class="pre">main()</span></code> to initial IPC application when IPC application is enabled. The initialization include IPC queue initialization.</p>
<p><strong>How to Use IPC Queue</strong></p>
<p>For example, communication between KM4 and KR4 through <code class="docutils literal notranslate"><span class="pre">IPC_ID_KR4_TO_KM4</span></code>.</p>
<ol class="arabic">
<li><p><code class="docutils literal notranslate"><span class="pre">IPC_ID_KR4_TO_KM4</span></code> definition in enumeration <code class="docutils literal notranslate"><span class="pre">IPC_ID</span></code> in <code class="file docutils literal notranslate"><span class="pre">ipc.h</span></code> is shown below. This definition is used in <a class="reference internal" href="#id1"><span class="std std-ref">Stap 2</span></a>.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">typedef</span><span class="w"> </span><span class="k">enum</span><span class="w"> </span><span class="p">{</span>
<span class="hll"><span class="w">   </span><span class="n">IPC_ID_KR4_TO_KM4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
</span><span class="w">   </span><span class="n">IPC_ID_KM4_TO_KR4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">   </span><span class="cm">/*14-19 used for RPC*/</span>
<span class="w">   </span><span class="n">IPC_ID_NUM</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="mi">20</span>
<span class="p">}</span><span class="w"> </span><span class="n">IPC_ID</span><span class="p">;</span>
</pre></div>
</div>
</li>
</ol>
<ol class="arabic" id="id1" start="2">
<li><p>When KR4 sends a message to KM4 through <code class="docutils literal notranslate"><span class="pre">IPC_ID_KR4_TO_KM4</span></code>, it should call <code class="xref py py-func docutils literal notranslate"><span class="pre">IPC_Message_Queue_Send()</span></code> and specify the queue ID and message.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int32_t</span><span class="w"> </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="n">IPC_Message_Queue_Send</span><span class="p">(</span><span class="n">IPC_ID_KR4_TO_KM4</span><span class="p">,</span><span class="w"> </span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="n">IMQ_BUF_SIZE</span><span class="p">,</span><span class="w"> </span><span class="n">WAIT_FOREVER</span><span class="p">);</span>
</pre></div>
</div>
</li>
<li><p>When KM4 receives a message from KR4 through IPC_ID_KR4_TO_KM4, it should call <code class="xref py py-func docutils literal notranslate"><span class="pre">IPC_Message_Queue_Recv()</span></code> and the queue ID and a buffer to receive message.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">IMQ_BUF_SIZE</span><span class="p">;</span>
<span class="kt">int32_t</span><span class="w"> </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="n">IPC_Message_Queue_Recv</span><span class="p">(</span><span class="n">IPC_ID_KR4_TO_KM4</span><span class="p">,</span><span class="w"> </span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">size</span><span class="p">);</span>
</pre></div>
</div>
</li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>The memory regions are only defined in AP core, the maximum data region is 40kB.</p></li>
<li><p>Users can use default test demo to verify IPC queue by command <code class="docutils literal notranslate"><span class="pre">test_ipc_message</span></code> in console both in KR4 and KM4.</p></li>
</ul>
</div>
</div></div>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="0_ipc_index.html" class="btn btn-neutral float-left" title="Inter-Processor Communication (IPC)" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../1_pinmux/0_pinmux_index.html" class="btn btn-neutral float-right" title="Pin Multiplexing Instructions" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Realsil.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>

      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 



</body>
</html>