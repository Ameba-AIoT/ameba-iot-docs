

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Introduction &mdash; Ameba IoT Docs  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
      <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=b0e775ca" />
      <link rel="stylesheet" type="text/css" href="../../_static/tabs.css?v=a5c4661c" />
      <link rel="stylesheet" type="text/css" href="../../_static/_static/custom.css" />

  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../../_static/toggleprompt.js?v=d7ede5d2"></script>
        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
        <script src="../../_static/tabs.js?v=3030b3cb"></script>
        <script>let toggleHintShow = 'Click to show';</script>
        <script>let toggleHintHide = 'Click to hide';</script>
        <script>let toggleOpenOnPrint = 'true';</script>
        <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="MPU and Cache" href="../1_mpu_cache/0_mpu_cache_index.html" />
    <link rel="prev" title="Virtual File System" href="0_vfs_index.html" />
   
  
  <script type="text/javascript" src="../../_static/js/selector.js"></script>

  <style>
    .wy-nav-content {max-width: 1000px;} /* 设置最大宽度 */
  </style>

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            Ameba IoT Docs
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../0_ameba_product/0_ameba_product_center_index.html">Products Center</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_ameba_sdk/0_ameba_sdks_index.html">Ameba SDK</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_ameba_solutions/0_ameba_solutions_index.html">Ameba Solutions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_gcc_build_environment/0_gcc_build_index.html">0.1 GCC Build Environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_gdb_debug/0_gdb_debug_index.html">0.2 GDB Debug</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_gcc_build_library/0_gcc_build_library_index.html">0.3 GCC Build Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_sdk_example/0_sdk_example_index.html">0.4 SDK Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_memory_layout/0_layout_index.html">0.5 Flash &amp; RAM Layout</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_user_config/0_usrcfg_index.html">0.6 User Config</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_tools/0_tools_index.html">0.7 Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_at_command/0_at_command_index.html">0.8 AT Command</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="0_vfs_index.html">0.9 Virtual File System</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="#vfs-initialization">VFS Initialization</a></li>
<li class="toctree-l2"><a class="reference internal" href="#usage-of-vfs">Usage of VFS</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#vfs-on-flash">VFS on Flash</a></li>
<li class="toctree-l3"><a class="reference internal" href="#vfs-on-sd-card">VFS on SD card</a></li>
<li class="toctree-l3"><a class="reference internal" href="#vfs-within-app-image">VFS within APP Image</a></li>
<li class="toctree-l3"><a class="reference internal" href="#common-file-operation">Common File Operation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#key-value-operation">Key-Value Operation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#code-conversion">Code Conversion</a></li>
<li class="toctree-l3"><a class="reference internal" href="#vfs-encryption">VFS Encryption</a></li>
<li class="toctree-l3"><a class="reference internal" href="#vfs-bin-file-generation">VFS Bin File Generation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#littlefs-bin-file-generation">LittleFS Bin File Generation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#fatfs-bin-file-generation">FatFS Bin File Generation</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../1_mpu_cache/0_mpu_cache_index.html">1.0 MPU and Cache</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1_boot_process/0_boot_index.html">1.1 BOOT Process</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1_ota/0_ota_index.html">1.2 OTA</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1_otpc/0_otpc_index.html">1.3 OTPC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1_chipen/0_chipen_index.html">1.4 CHIPEN</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1_ipc/0_ipc_index.html">1.5 Inter Processor Communication</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1_pinmux/0_pinmux_index.html">1.6 PINMUX</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1_gpio/0_gpio_index.html">1.7 GPIO</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1_power_save/0_ps_index.html">1.9 Power Save</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2_whc_wifi_bridge/0_wifi_bridge_index.html">2.1 WHC Bridge</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2_whc_fullmac/0_fullmac_index.html">2.2 WHC FullMAC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2_wifi_tunnel/0_wifi_tunnel_index.html">2.3 Wi-Fi R-Mesh</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2_wifi_csi/0_wifi_csi_index.html">2.5 Wi-Fi CSI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2_wifi_adaptivity_test/0_wifi_adaptivity_index.html">2.6 Wi-Fi Adaptivity Test</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_security/0_security_index.html">3.1 Security &amp; Encryption</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_trng/0_trng_index.html">3.2 True Random Number Generator</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_nda_huk_derivation/0_huk_derivation_index_nda.html">3.3 HUK Derivation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_nda_rdp/0_rdp_index_nda.html">3.4 RDP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_nda_rsip/0_rsip_index_nda.html">3.5 RSIP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_nda_secure_boot/0_secure_boot_index_nda.html">3.6 Secure Boot</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_nda_swd_protection/0_swd_protection_index_nda.html">3.7 SWD Protection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_nda_tfm/0_tfm_index_nda.html">3.8 Trusted Firmware-M (TF-M)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_crypto_engine/0_crypto_engine_index.html">3.9 Crypto Engine</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_ecdsa_engine/0_ecdsa_index.html">3.a ECDSA Engine</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_eddsa_engine/0_eddsa_index.html">3.b EDDSA Engine</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_rsa_engine/0_rsa_index.html">3.c RSA Engine</a></li>
<li class="toctree-l1"><a class="reference internal" href="../4_ai/0_ai_index.html">4.1 AI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../4_ai_voice/0_ai_voice_index.html">4.2 AIVoice</a></li>
<li class="toctree-l1"><a class="reference internal" href="../4_multimedia/0_multimedia_index.html">4.3 Multimedia</a></li>
<li class="toctree-l1"><a class="reference internal" href="../4_dsp/0_dsp_index.html">4.4 DSP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../6_mass_production/0_mp_index.html">6.1 Mass Production</a></li>
<li class="toctree-l1"><a class="reference internal" href="../6_mp_image/0_mp_image_index.html">6.2 MP Image</a></li>
<li class="toctree-l1"><a class="reference internal" href="../6_mptools/0_mptools_index.html">6.3 MP Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../7_usb/0_usb_index.html">7.1 USB Host &amp; Device</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_dmac/0_dmac_index.html">8.1 DMA Controllor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_psram/0_psram_index.html">8.2 PSRAM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_thermal/0_thermal_index.html">8.3 Thermal Meter</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_adc/0_adc_index.html">8.4 ADC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_ir/0_ir_index.html">8.5 IR</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_ledc/0_ledc_index.html">8.6 LEDC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_cap_touch/0_cap_touch_index.html">8.7 Cap-Touch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_key_scan/0_key_scan_index.html">8.8 Key-Scan</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_rtc_io/0_rtc_io_index.html">8.9 RTC-IO</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_lcdc/0_lcdc_index.html">8.A LCDC</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Ameba IoT Docs</a>
      </nav>

      <div class="wy-nav-content">

        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="0_vfs_index.html">Virtual File System</a></li>
      <li class="breadcrumb-item active">Introduction</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <span class="target" id="virtual-file-system"></span><!-- 下拉菜单 -->
<div style="margin: 20px 0; text-align: left;">
    <div style="display: flex; align-items: center; gap: 10px;">
        <span style="font-size: 14px;">IC: </span>
        <select class="tab-selector" style="height: 22px; padding: 2px 8px; font-size: 13px;">
            <option value="RTL8721Dx">RTL8721Dx</option>
            <option value="RTL8720E">RTL8720E</option>
            <option value="RTL8726E">RTL8726E</option>
            <option value="RTL8730E">RTL8730E</option>
        </select>
    </div>
</div>

<!-- 修复后的 JavaScript -->
<script>
document.addEventListener("DOMContentLoaded", function() {
    const selector = document.querySelector('.tab-selector');

    selector.addEventListener('change', function() {
        const targetTab = this.value;
        const tabs = document.querySelectorAll('.sphinx-tabs-tab');
        let found = false;

        tabs.forEach(tab => {
            const tabText = tab.textContent.trim();
            if (tabText === targetTab) {
                tab.click();
                window.dispatchEvent(new Event('resize')); // 触发插件更新
                found = true;
            }
        });

        if (!found) {
            console.error("未找到选项卡:", targetTab);
        }
    });
});
</script><section id="introduction">
<h1>Introduction<a class="headerlink" href="#introduction" title="Link to this heading"></a></h1>
<p>This section introduces how to run Virtual File System (VFS) on Ameba SoC, including FatFS and LittleFS as the underlying implementation. Users can ignore the differences between different file systems by using VFS. The VFS provides common file operation interfaces like fopen, fclose, fwrite, fread, etc. The Key-Value (KV) interfaces are based on these common file operations. The architecture of VFS is illustrated below.</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-0-0-0" aria-selected="true" class="sphinx-tabs-tab" id="tab-0-0-0" name="0-0" role="tab" tabindex="0">RTL8721Dx</button><button aria-controls="panel-0-0-1" aria-selected="false" class="sphinx-tabs-tab" id="tab-0-0-1" name="0-1" role="tab" tabindex="-1">RTL8720E</button><button aria-controls="panel-0-0-2" aria-selected="false" class="sphinx-tabs-tab" id="tab-0-0-2" name="0-2" role="tab" tabindex="-1">RTL8726E</button><button aria-controls="panel-0-0-3" aria-selected="false" class="sphinx-tabs-tab" id="tab-0-0-3" name="0-3" role="tab" tabindex="-1">RTL8730E</button></div><div aria-labelledby="tab-0-0-0" class="sphinx-tabs-panel" id="panel-0-0-0" name="0-0" role="tabpanel" tabindex="0"><figure class="align-center" id="id6">
<a class="reference internal image-reference" href="../../_images/vfs_architecture_lite_dplus.svg"><img alt="../../_images/vfs_architecture_lite_dplus.svg" height="285" src="../../_images/vfs_architecture_lite_dplus.svg" width="403" /></a>
<figcaption>
<p><span class="caption-text">Architecture of VFS</span><a class="headerlink" href="#id6" title="Link to this image"></a></p>
</figcaption>
</figure>
</div><div aria-labelledby="tab-0-0-1" class="sphinx-tabs-panel" hidden="true" id="panel-0-0-1" name="0-1" role="tabpanel" tabindex="0"><figure class="align-center" id="id7">
<a class="reference internal image-reference" href="../../_images/vfs_architecture_lite_dplus.svg"><img alt="../../_images/vfs_architecture_lite_dplus.svg" height="285" src="../../_images/vfs_architecture_lite_dplus.svg" width="403" /></a>
<figcaption>
<p><span class="caption-text">Architecture of VFS</span><a class="headerlink" href="#id7" title="Link to this image"></a></p>
</figcaption>
</figure>
</div><div aria-labelledby="tab-0-0-2" class="sphinx-tabs-panel" hidden="true" id="panel-0-0-2" name="0-2" role="tabpanel" tabindex="0"><figure class="align-center" id="id8">
<a class="reference internal image-reference" href="../../_images/vfs_architecture_lite_dplus.svg"><img alt="../../_images/vfs_architecture_lite_dplus.svg" height="285" src="../../_images/vfs_architecture_lite_dplus.svg" width="403" /></a>
<figcaption>
<p><span class="caption-text">Architecture of VFS</span><a class="headerlink" href="#id8" title="Link to this image"></a></p>
</figcaption>
</figure>
</div><div aria-labelledby="tab-0-0-3" class="sphinx-tabs-panel" hidden="true" id="panel-0-0-3" name="0-3" role="tabpanel" tabindex="0"><figure class="align-center" id="id9">
<a class="reference internal image-reference" href="../../_images/vfs_architecture_smart.svg"><img alt="../../_images/vfs_architecture_smart.svg" height="310" src="../../_images/vfs_architecture_smart.svg" width="403" /></a>
<figcaption>
<p><span class="caption-text">Architecture of VFS</span><a class="headerlink" href="#id9" title="Link to this image"></a></p>
</figcaption>
</figure>
</div></div>
</section>
<section id="vfs-initialization">
<h1>VFS Initialization<a class="headerlink" href="#vfs-initialization" title="Link to this heading"></a></h1>
<p>By default, the VFS has been initialized in <code class="file docutils literal notranslate"><span class="pre">main.c</span></code>.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">app_filesystem_init</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">  </span><span class="n">vfs_init</span><span class="p">();</span>

<span class="cp">#ifdef CONFIG_FATFS_WITHIN_APP_IMG</span>
<span class="w">  </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vfs_user_register</span><span class="p">(</span><span class="s">&quot;fat&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">VFS_FATFS</span><span class="p">,</span><span class="w"> </span><span class="n">VFS_INF_FLASH</span><span class="p">,</span><span class="w"> </span><span class="n">VFS_REGION_2</span><span class="p">,</span><span class="w"> </span><span class="n">VFS_RO</span><span class="p">);</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ret</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">RTK_LOGI</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;VFS-FAT Init Success </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">     </span><span class="n">RTK_LOGI</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;VFS-FAT Init Fail </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="cp">#endif</span>

<span class="w">  </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vfs_user_register</span><span class="p">(</span><span class="n">VFS_PREFIX</span><span class="p">,</span><span class="w"> </span><span class="n">VFS_LITTLEFS</span><span class="p">,</span><span class="w"> </span><span class="n">VFS_INF_FLASH</span><span class="p">,</span><span class="w"> </span><span class="n">VFS_REGION_1</span><span class="p">,</span><span class="w"> </span><span class="n">VFS_RW</span><span class="p">);</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ret</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rt_kv_init</span><span class="p">();</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ret</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">RTK_LOGI</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;File System Init Success</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="w">      </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="n">RTK_LOGE</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;File System Init Fail </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="k">return</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The <code class="xref py py-func docutils literal notranslate"><span class="pre">vfs_user_register()</span></code> API will mount VFS to the Flash (or SD card, if supported) by users’ configuration. If failed to mount, this API will check whether the Flash is clean (0xFF). And if the Flash is clean, it will program the Flash to initialize VFS.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">vfs_user_register</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">prefix</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">vfs_type</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">interface</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">region</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">flag</span><span class="p">)</span>
</pre></div>
</div>
<p>Where:</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-1-1-0" aria-selected="true" class="sphinx-tabs-tab" id="tab-1-1-0" name="1-0" role="tab" tabindex="0">RTL8721Dx</button><button aria-controls="panel-1-1-1" aria-selected="false" class="sphinx-tabs-tab" id="tab-1-1-1" name="1-1" role="tab" tabindex="-1">RTL8720E</button><button aria-controls="panel-1-1-2" aria-selected="false" class="sphinx-tabs-tab" id="tab-1-1-2" name="1-2" role="tab" tabindex="-1">RTL8726E</button><button aria-controls="panel-1-1-3" aria-selected="false" class="sphinx-tabs-tab" id="tab-1-1-3" name="1-3" role="tab" tabindex="-1">RTL8730E</button></div><div aria-labelledby="tab-1-1-0" class="sphinx-tabs-panel" id="panel-1-1-0" name="1-0" role="tabpanel" tabindex="0"><dl class="field-list simple">
<dt class="field-odd"><strong>prefix</strong><span class="colon">:</span></dt>
<dd class="field-odd"><p>defined by users, used to distinguish different file systems</p>
</dd>
<dt class="field-even"><strong>vfs_type</strong><span class="colon">:</span></dt>
<dd class="field-even"><p>file system type of the underlying implementation (<strong>FatFS</strong> or <strong>LittleFS</strong>)</p>
</dd>
<dt class="field-odd"><strong>interface</strong><span class="colon">:</span></dt>
<dd class="field-odd"><p>memory type (Flash only)</p>
</dd>
<dt class="field-even"><strong>region</strong><span class="colon">:</span></dt>
<dd class="field-even"><p>Flash partition (<strong>VFS1</strong> or <strong>VFS2</strong>, described in Section <a class="reference internal" href="#vfs-on-flash"><span class="std std-ref">VFS on Flash</span></a>)</p>
</dd>
<dt class="field-odd"><strong>flag</strong><span class="colon">:</span></dt>
<dd class="field-odd"><p>operation authority of file system (read-write or read-only)</p>
</dd>
</dl>
</div><div aria-labelledby="tab-1-1-1" class="sphinx-tabs-panel" hidden="true" id="panel-1-1-1" name="1-1" role="tabpanel" tabindex="0"><dl class="field-list simple">
<dt class="field-odd"><strong>prefix</strong><span class="colon">:</span></dt>
<dd class="field-odd"><p>defined by users, used to distinguish different file systems</p>
</dd>
<dt class="field-even"><strong>vfs_type</strong><span class="colon">:</span></dt>
<dd class="field-even"><p>file system type of the underlying implementation (<strong>FatFS</strong> or <strong>LittleFS</strong>)</p>
</dd>
<dt class="field-odd"><strong>interface</strong><span class="colon">:</span></dt>
<dd class="field-odd"><p>memory type (Flash only)</p>
</dd>
<dt class="field-even"><strong>region</strong><span class="colon">:</span></dt>
<dd class="field-even"><p>Flash partition (<strong>VFS1</strong> or <strong>VFS2</strong>, described in Section <a class="reference internal" href="#vfs-on-flash"><span class="std std-ref">VFS on Flash</span></a>)</p>
</dd>
<dt class="field-odd"><strong>flag</strong><span class="colon">:</span></dt>
<dd class="field-odd"><p>operation authority of file system (read-write or read-only)</p>
</dd>
</dl>
</div><div aria-labelledby="tab-1-1-2" class="sphinx-tabs-panel" hidden="true" id="panel-1-1-2" name="1-2" role="tabpanel" tabindex="0"><dl class="field-list simple">
<dt class="field-odd"><strong>prefix</strong><span class="colon">:</span></dt>
<dd class="field-odd"><p>defined by users, used to distinguish different file systems</p>
</dd>
<dt class="field-even"><strong>vfs_type</strong><span class="colon">:</span></dt>
<dd class="field-even"><p>file system type of the underlying implementation (<strong>FatFS</strong> or <strong>LittleFS</strong>)</p>
</dd>
<dt class="field-odd"><strong>interface</strong><span class="colon">:</span></dt>
<dd class="field-odd"><p>memory type (Flash only)</p>
</dd>
<dt class="field-even"><strong>region</strong><span class="colon">:</span></dt>
<dd class="field-even"><p>Flash partition (<strong>VFS1</strong> or <strong>VFS2</strong>, described in Section <a class="reference internal" href="#vfs-on-flash"><span class="std std-ref">VFS on Flash</span></a>)</p>
</dd>
<dt class="field-odd"><strong>flag</strong><span class="colon">:</span></dt>
<dd class="field-odd"><p>operation authority of file system (read-write or read-only)</p>
</dd>
</dl>
</div><div aria-labelledby="tab-1-1-3" class="sphinx-tabs-panel" hidden="true" id="panel-1-1-3" name="1-3" role="tabpanel" tabindex="0"><dl class="field-list simple">
<dt class="field-odd"><strong>prefix</strong><span class="colon">:</span></dt>
<dd class="field-odd"><p>defined by users, used to distinguish different file systems</p>
</dd>
<dt class="field-even"><strong>vfs_type</strong><span class="colon">:</span></dt>
<dd class="field-even"><p>file system type of the underlying implementation (<strong>FatFS</strong> or <strong>LittleFS</strong>)</p>
</dd>
<dt class="field-odd"><strong>interface</strong><span class="colon">:</span></dt>
<dd class="field-odd"><p>memory type (Flash for LittleFS, Flash and SD card for FatFS)</p>
</dd>
<dt class="field-even"><strong>region</strong><span class="colon">:</span></dt>
<dd class="field-even"><p>Flash partition (<strong>VFS1</strong> or <strong>VFS2</strong>, described in Section <a class="reference internal" href="#vfs-on-flash"><span class="std std-ref">VFS on Flash</span></a>)</p>
</dd>
<dt class="field-odd"><strong>flag</strong><span class="colon">:</span></dt>
<dd class="field-odd"><p>operation authority of file system (read-write or read-only)</p>
</dd>
</dl>
</div></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><em>vfs_type</em> of VFS1 is set to <strong>LittleFS</strong> by default for read-write balance and power failure protection. To ensure proper utilization of <strong>FatFS</strong>, it is essential to configure the relevant settings in the menuconfig.</p>
</div>
</section>
<section id="usage-of-vfs">
<h1>Usage of VFS<a class="headerlink" href="#usage-of-vfs" title="Link to this heading"></a></h1>
<section id="vfs-on-flash">
<span id="id1"></span><h2>VFS on Flash<a class="headerlink" href="#vfs-on-flash" title="Link to this heading"></a></h2>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-2-2-0" aria-selected="true" class="sphinx-tabs-tab" id="tab-2-2-0" name="2-0" role="tab" tabindex="0">RTL8730E</button><button aria-controls="panel-2-2-1" aria-selected="false" class="sphinx-tabs-tab" id="tab-2-2-1" name="2-1" role="tab" tabindex="-1">RTL8720E</button><button aria-controls="panel-2-2-2" aria-selected="false" class="sphinx-tabs-tab" id="tab-2-2-2" name="2-2" role="tab" tabindex="-1">RTL8726E</button><button aria-controls="panel-2-2-3" aria-selected="false" class="sphinx-tabs-tab" id="tab-2-2-3" name="2-3" role="tab" tabindex="-1">RTL8721Dx</button></div><div aria-labelledby="tab-2-2-0" class="sphinx-tabs-panel" id="panel-2-2-0" name="2-0" role="tabpanel" tabindex="0"><p>Adjust the Flash partitions appropriately if the VFS interfaces are set to the Flash, and modify VFS1 or VFS2 (according to register region in <code class="file docutils literal notranslate"><span class="pre">main.c</span></code>) in <cite>Flash_Layout[]</cite> in <code class="docutils literal notranslate"><span class="pre">{SDK}\component\soc\amebasmart\usrcfg\ameba_flashcfg.c</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The Flash type should be considered when changing the Flash layout.</p>
<ul class="simple">
<li><p>NOR Flash for FatFS and LittleFS</p></li>
<li><p>NAND Flash only for LittleFS</p></li>
</ul>
</div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">FlashLayoutInfo_TypeDef</span><span class="w"> </span><span class="n">Flash_Layout_Nor</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="cm">/*Region_Type,         [StartAddr,     EndAddr]                */</span>
<span class="w">   </span><span class="p">{</span><span class="n">IMG_BOOT</span><span class="p">,</span><span class="w">                     </span><span class="mh">0x08000000</span><span class="p">,</span><span class="w"> </span><span class="mh">0x0801FFFF</span><span class="p">},</span><span class="w"> </span><span class="c1">//Boot Manifest(4K) + KM4 Bootloader(124K)</span>
<span class="w">   </span><span class="c1">//Users should modify below according to their own memory</span>
<span class="w">   </span><span class="p">{</span><span class="n">IMG_APP_OTA1</span><span class="p">,</span><span class="w">                 </span><span class="mh">0x08020000</span><span class="p">,</span><span class="w"> </span><span class="mh">0x082FFFFF</span><span class="p">},</span><span class="w"> </span><span class="c1">//Certificate(4K) + Manifest(4K) + KR4 &amp; KM4   Application OTA1 + Manifest(4K) + RDP IMG OTA1</span>
<span class="w">   </span><span class="c1">// + AP IMG OTA1</span>
<span class="w">   </span><span class="p">{</span><span class="n">IMG_BOOT_OTA2</span><span class="p">,</span><span class="w">        </span><span class="mh">0x08300000</span><span class="p">,</span><span class="w"> </span><span class="mh">0x0833FFFF</span><span class="p">},</span><span class="w"> </span><span class="c1">//Boot Manifest(4K) + KM4 Bootloader(252K) OTA</span>
<span class="w">   </span><span class="p">{</span><span class="n">IMG_APP_OTA2</span><span class="p">,</span><span class="w">                 </span><span class="mh">0x08340000</span><span class="p">,</span><span class="w"> </span><span class="mh">0x0861FFFF</span><span class="p">},</span><span class="w"> </span><span class="c1">//Certificate(4K) + Manifest(4K) + KR4 &amp; KM4   Application OTA2 + Manifest(4K) + RDP IMG OTA2</span>
<span class="w">   </span><span class="c1">// + AP IMG OTA2</span>
<span class="w">   </span><span class="p">{</span><span class="n">FTL</span><span class="p">,</span><span class="w">                          </span><span class="mh">0x08620000</span><span class="p">,</span><span class="w"> </span><span class="mh">0x08622FFF</span><span class="p">},</span><span class="w"> </span><span class="c1">//FTL for BT(&gt;=12K), The start offset of flash    pages which is allocated to FTL physical map.</span>
<span class="hll"><span class="w">   </span><span class="p">{</span><span class="n">VFS1</span><span class="p">,</span><span class="w">                                 </span><span class="mh">0x08623000</span><span class="p">,</span><span class="w"> </span><span class="mh">0x08642FFF</span><span class="p">},</span><span class="w"> </span><span class="c1">//VFS region 1 (128K)</span>
</span><span class="hll"><span class="w">   </span><span class="p">{</span><span class="n">VFS2</span><span class="p">,</span><span class="w">                                 </span><span class="mh">0xFFFFFFFF</span><span class="p">,</span><span class="w"> </span><span class="mh">0xFFFFFFFF</span><span class="p">},</span><span class="w"> </span><span class="c1">//VFS region 2</span>
</span><span class="w">   </span><span class="p">{</span><span class="n">USER</span><span class="p">,</span><span class="w">                                 </span><span class="mh">0xFFFFFFFF</span><span class="p">,</span><span class="w"> </span><span class="mh">0xFFFFFFFF</span><span class="p">},</span><span class="w"> </span><span class="c1">//reserve for user</span>
<span class="w">   </span><span class="cm">/* End */</span>
<span class="w">   </span><span class="p">{</span><span class="mh">0xFF</span><span class="p">,</span><span class="w">                                 </span><span class="mh">0xFFFFFFFF</span><span class="p">,</span><span class="w"> </span><span class="mh">0xFFFFFFFF</span><span class="p">},</span>
<span class="p">};</span>
</pre></div>
</div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">FlashLayoutInfo_TypeDef</span><span class="w"> </span><span class="n">Flash_Layout_Nand</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="cm">/*Region_Type,         [StartAddr,     EndAddr]                */</span>
<span class="w">   </span><span class="p">{</span><span class="n">IMG_BOOT</span><span class="p">,</span><span class="w">                     </span><span class="mh">0x08000000</span><span class="p">,</span><span class="w"> </span><span class="mh">0x0801FFFF</span><span class="p">},</span><span class="w"> </span><span class="c1">//Boot Manifest(4K) + KM4 Bootloader(124K)</span>
<span class="w">   </span><span class="c1">//Users should modify below according to their own memory</span>
<span class="w">   </span><span class="p">{</span><span class="n">IMG_APP_OTA1</span><span class="p">,</span><span class="w">                 </span><span class="mh">0x08020000</span><span class="p">,</span><span class="w"> </span><span class="mh">0x082FFFFF</span><span class="p">},</span><span class="w"> </span><span class="c1">//Certificate(4K) + Manifest(4K) + KR4 &amp; KM4   Application OTA1 + Manifest(4K) + RDP IMG OTA1</span>
<span class="w">   </span><span class="c1">// + AP IMG OTA1</span>
<span class="w">   </span><span class="p">{</span><span class="n">IMG_BOOT_OTA2</span><span class="p">,</span><span class="w">        </span><span class="mh">0x08300000</span><span class="p">,</span><span class="w"> </span><span class="mh">0x0833FFFF</span><span class="p">},</span><span class="w"> </span><span class="c1">//Boot Manifest(4K) + KM4 Bootloader(252K) OTA</span>
<span class="w">   </span><span class="p">{</span><span class="n">IMG_APP_OTA2</span><span class="p">,</span><span class="w">                 </span><span class="mh">0x08340000</span><span class="p">,</span><span class="w"> </span><span class="mh">0x0861FFFF</span><span class="p">},</span><span class="w"> </span><span class="c1">//Certificate(4K) + Manifest(4K) + KR4 &amp; KM4   Application OTA2 + Manifest(4K) + RDP IMG OTA2</span>
<span class="w">   </span><span class="c1">// + AP IMG OTA2</span>
<span class="w">   </span><span class="p">{</span><span class="n">FTL</span><span class="p">,</span><span class="w">                          </span><span class="mh">0x0C400000</span><span class="p">,</span><span class="w"> </span><span class="mh">0x0C45FFFF</span><span class="p">},</span><span class="w"> </span><span class="c1">//FTL for BT(&gt;=384K), The start offset of flash   pages which is allocated to FTL physical map.</span>
<span class="hll"><span class="w">   </span><span class="p">{</span><span class="n">VFS1</span><span class="p">,</span><span class="w">                                 </span><span class="mh">0x0C460000</span><span class="p">,</span><span class="w"> </span><span class="mh">0x0C55FFFF</span><span class="p">},</span><span class="w"> </span><span class="c1">//VFS region 1(1024K)</span>
</span><span class="hll"><span class="w">   </span><span class="p">{</span><span class="n">VFS2</span><span class="p">,</span><span class="w">                                 </span><span class="mh">0xFFFFFFFF</span><span class="p">,</span><span class="w"> </span><span class="mh">0xFFFFFFFF</span><span class="p">},</span><span class="w"> </span><span class="c1">//VFS region 2</span>
</span><span class="w">   </span><span class="p">{</span><span class="n">USER</span><span class="p">,</span><span class="w">                                 </span><span class="mh">0xFFFFFFFF</span><span class="p">,</span><span class="w"> </span><span class="mh">0xFFFFFFFF</span><span class="p">},</span><span class="w"> </span><span class="c1">//reserve for user</span>
<span class="w">   </span><span class="cm">/* End */</span>
<span class="w">   </span><span class="p">{</span><span class="mh">0xFF</span><span class="p">,</span><span class="w">                                 </span><span class="mh">0xFFFFFFFF</span><span class="p">,</span><span class="w"> </span><span class="mh">0xFFFFFFFF</span><span class="p">},</span>
<span class="p">};</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>The <strong>VFS1</strong> region must exist, and its size should always be larger than 128KB.</p></li>
<li><p>There are two VFS regions at most.</p></li>
</ul>
</div>
</div><div aria-labelledby="tab-2-2-1" class="sphinx-tabs-panel" hidden="true" id="panel-2-2-1" name="2-1" role="tabpanel" tabindex="0"><p>Adjust the Flash partitions appropriately if the VFS interfaces are set to the Flash, and modify VFS1 or VFS2 (according to register region in <code class="file docutils literal notranslate"><span class="pre">main.c</span></code>) in <cite>Flash_Layout[]</cite> in <code class="docutils literal notranslate"><span class="pre">{SDK}component\soc\amebalite\usrcfg\ameba_flashcfg.c</span></code>.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">FlashLayoutInfo_TypeDef</span><span class="w"> </span><span class="n">Flash_Layout</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="cm">/*Region_Type,    [StartAddr,     EndAddr]                */</span>
<span class="w">   </span><span class="p">{</span><span class="n">IMG_BOOT</span><span class="p">,</span><span class="w">      </span><span class="mh">0x08000000</span><span class="p">,</span><span class="w"> </span><span class="mh">0x08013FFF</span><span class="p">},</span><span class="w"> </span><span class="c1">//Boot Manifest(4K) + KM4 Bootloader(76K)</span>
<span class="w">   </span><span class="c1">//Users should modify below according to their own memory</span>
<span class="w">   </span><span class="p">{</span><span class="n">IMG_APP_OTA1</span><span class="p">,</span><span class="w">  </span><span class="mh">0x08014000</span><span class="p">,</span><span class="w"> </span><span class="mh">0x081F3FFF</span><span class="p">},</span><span class="w"> </span><span class="c1">//Certificate(4K) + Manifest(4K) + KR4 &amp; KM4  Application OTA1 + Manifest(4K) + RDP IMG OTA1</span>

<span class="w">   </span><span class="p">{</span><span class="n">IMG_BOOT_OTA2</span><span class="p">,</span><span class="w"> </span><span class="mh">0x08200000</span><span class="p">,</span><span class="w"> </span><span class="mh">0x08213FFF</span><span class="p">},</span><span class="w"> </span><span class="c1">//Boot Manifest(4K) + KM4 Bootloader(76K) OTA</span>
<span class="w">   </span><span class="p">{</span><span class="n">IMG_APP_OTA2</span><span class="p">,</span><span class="w">  </span><span class="mh">0x08214000</span><span class="p">,</span><span class="w"> </span><span class="mh">0x083DCFFF</span><span class="p">},</span><span class="w"> </span><span class="c1">//Certificate(4K) + Manifest(4K) + KR4 &amp; KM4  Application OTA2 + Manifest(4K) + RDP IMG OTA2</span>
<span class="w">   </span><span class="p">{</span><span class="n">FTL</span><span class="p">,</span><span class="w">           </span><span class="mh">0x083DD000</span><span class="p">,</span><span class="w"> </span><span class="mh">0x083DFFFF</span><span class="p">},</span><span class="w"> </span><span class="c1">//FTL for BT(&gt;=12K), The start offset of flash   pages which is allocated to FTL physical map.</span>
<span class="hll"><span class="w">   </span><span class="p">{</span><span class="n">VFS1</span><span class="p">,</span><span class="w">          </span><span class="mh">0x083E0000</span><span class="p">,</span><span class="w"> </span><span class="mh">0x083FFFFF</span><span class="p">},</span><span class="w"> </span><span class="c1">//VFS region 1 (128K)</span>
</span><span class="w">   </span><span class="p">{</span><span class="n">IMG_DSP</span><span class="p">,</span><span class="w">       </span><span class="mh">0x08400000</span><span class="p">,</span><span class="w"> </span><span class="mh">0x086FFFFF</span><span class="p">},</span><span class="w"> </span><span class="c1">//Manifest(4K) + DSP IMG, only one DSP region in    layout</span>
<span class="w">   </span><span class="p">{</span><span class="n">VFS2</span><span class="p">,</span><span class="w">          </span><span class="mh">0xFFFFFFFF</span><span class="p">,</span><span class="w"> </span><span class="mh">0xFFFFFFFF</span><span class="p">},</span><span class="w"> </span><span class="c1">//VFS region 2</span>
<span class="w">   </span><span class="p">{</span><span class="n">USER</span><span class="p">,</span><span class="w">          </span><span class="mh">0xFFFFFFFF</span><span class="p">,</span><span class="w"> </span><span class="mh">0xFFFFFFFF</span><span class="p">},</span><span class="w"> </span><span class="c1">//reserve for user</span>

<span class="w">   </span><span class="cm">/* End */</span>
<span class="w">   </span><span class="p">{</span><span class="mh">0xFF</span><span class="p">,</span><span class="w">          </span><span class="mh">0xFFFFFFFF</span><span class="p">,</span><span class="w"> </span><span class="mh">0xFFFFFFFF</span><span class="p">},</span>
<span class="p">};</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>The <strong>VFS1</strong> region must exist, and its size should always be larger than 128KB.</p></li>
<li><p>There are two VFS regions at most.</p></li>
</ul>
</div>
</div><div aria-labelledby="tab-2-2-2" class="sphinx-tabs-panel" hidden="true" id="panel-2-2-2" name="2-2" role="tabpanel" tabindex="0"><p>Adjust the Flash partitions appropriately if the VFS interfaces are set to the Flash, and modify VFS1 or VFS2 (according to register region in <code class="file docutils literal notranslate"><span class="pre">main.c</span></code>) in <cite>Flash_Layout[]</cite> in <code class="docutils literal notranslate"><span class="pre">{SDK}component\soc\amebalite\usrcfg\ameba_flashcfg.c</span></code>.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">FlashLayoutInfo_TypeDef</span><span class="w"> </span><span class="n">Flash_Layout</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="cm">/*Region_Type,    [StartAddr,     EndAddr]                */</span>
<span class="w">   </span><span class="p">{</span><span class="n">IMG_BOOT</span><span class="p">,</span><span class="w">      </span><span class="mh">0x08000000</span><span class="p">,</span><span class="w"> </span><span class="mh">0x08013FFF</span><span class="p">},</span><span class="w"> </span><span class="c1">//Boot Manifest(4K) + KM4 Bootloader(76K)</span>
<span class="w">   </span><span class="c1">//Users should modify below according to their own memory</span>
<span class="w">   </span><span class="p">{</span><span class="n">IMG_APP_OTA1</span><span class="p">,</span><span class="w">  </span><span class="mh">0x08014000</span><span class="p">,</span><span class="w"> </span><span class="mh">0x081F3FFF</span><span class="p">},</span><span class="w"> </span><span class="c1">//Certificate(4K) + Manifest(4K) + KR4 &amp; KM4  Application OTA1 + Manifest(4K) + RDP IMG OTA1</span>

<span class="w">   </span><span class="p">{</span><span class="n">IMG_BOOT_OTA2</span><span class="p">,</span><span class="w"> </span><span class="mh">0x08200000</span><span class="p">,</span><span class="w"> </span><span class="mh">0x08213FFF</span><span class="p">},</span><span class="w"> </span><span class="c1">//Boot Manifest(4K) + KM4 Bootloader(76K) OTA</span>
<span class="w">   </span><span class="p">{</span><span class="n">IMG_APP_OTA2</span><span class="p">,</span><span class="w">  </span><span class="mh">0x08214000</span><span class="p">,</span><span class="w"> </span><span class="mh">0x083DCFFF</span><span class="p">},</span><span class="w"> </span><span class="c1">//Certificate(4K) + Manifest(4K) + KR4 &amp; KM4  Application OTA2 + Manifest(4K) + RDP IMG OTA2</span>
<span class="w">   </span><span class="p">{</span><span class="n">FTL</span><span class="p">,</span><span class="w">           </span><span class="mh">0x083DD000</span><span class="p">,</span><span class="w"> </span><span class="mh">0x083DFFFF</span><span class="p">},</span><span class="w"> </span><span class="c1">//FTL for BT(&gt;=12K), The start offset of flash   pages which is allocated to FTL physical map.</span>
<span class="hll"><span class="w">   </span><span class="p">{</span><span class="n">VFS1</span><span class="p">,</span><span class="w">          </span><span class="mh">0x083E0000</span><span class="p">,</span><span class="w"> </span><span class="mh">0x083FFFFF</span><span class="p">},</span><span class="w"> </span><span class="c1">//VFS region 1 (128K)</span>
</span><span class="w">   </span><span class="p">{</span><span class="n">IMG_DSP</span><span class="p">,</span><span class="w">       </span><span class="mh">0x08400000</span><span class="p">,</span><span class="w"> </span><span class="mh">0x086FFFFF</span><span class="p">},</span><span class="w"> </span><span class="c1">//Manifest(4K) + DSP IMG, only one DSP region in    layout</span>
<span class="w">   </span><span class="p">{</span><span class="n">VFS2</span><span class="p">,</span><span class="w">          </span><span class="mh">0xFFFFFFFF</span><span class="p">,</span><span class="w"> </span><span class="mh">0xFFFFFFFF</span><span class="p">},</span><span class="w"> </span><span class="c1">//VFS region 2</span>
<span class="w">   </span><span class="p">{</span><span class="n">USER</span><span class="p">,</span><span class="w">          </span><span class="mh">0xFFFFFFFF</span><span class="p">,</span><span class="w"> </span><span class="mh">0xFFFFFFFF</span><span class="p">},</span><span class="w"> </span><span class="c1">//reserve for user</span>

<span class="w">   </span><span class="cm">/* End */</span>
<span class="w">   </span><span class="p">{</span><span class="mh">0xFF</span><span class="p">,</span><span class="w">          </span><span class="mh">0xFFFFFFFF</span><span class="p">,</span><span class="w"> </span><span class="mh">0xFFFFFFFF</span><span class="p">},</span>
<span class="p">};</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>The <strong>VFS1</strong> region must exist, and its size should always be larger than 128KB.</p></li>
<li><p>There are two VFS regions at most.</p></li>
</ul>
</div>
</div><div aria-labelledby="tab-2-2-3" class="sphinx-tabs-panel" hidden="true" id="panel-2-2-3" name="2-3" role="tabpanel" tabindex="0"><p>Adjust the Flash partitions appropriately if the VFS interfaces are set to the Flash, and modify <strong>VFS1</strong> or <strong>VFS2</strong> (according to register region in <code class="file docutils literal notranslate"><span class="pre">main.c</span></code>) in <cite>Flash_Layout[]</cite> in <code class="docutils literal notranslate"><span class="pre">{SDK}\component\soc\amebadplus\usrcfg\ameba_flashcfg.c</span></code>.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">const</span><span class="w"> </span><span class="n">FlashLayoutInfo_TypeDef</span><span class="w"> </span><span class="n">Flash_Layout</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="cm">/*Region_Type,  [StartAddr, EndAddr]   */</span>
<span class="w">    </span><span class="p">{</span><span class="n">IMG_BOOT</span><span class="p">,</span><span class="w">      </span><span class="mh">0x08000000</span><span class="p">,</span><span class="w"> </span><span class="mh">0x08013FFF</span><span class="p">},</span><span class="w"> </span><span class="c1">//Boot Manifest(4K) + KM4 Bootloader(76K)</span>
<span class="w">    </span><span class="c1">//Users should modify below according to their own memory</span>
<span class="w">    </span><span class="p">{</span><span class="n">IMG_APP_OTA1</span><span class="p">,</span><span class="w">  </span><span class="mh">0x08014000</span><span class="p">,</span><span class="w"> </span><span class="mh">0x081F3FFF</span><span class="p">},</span><span class="w"> </span><span class="c1">//Certificate(4K) + Manifest(4K) + KM4    Application OTA1 + Manifest(4K) + RDP IMG OTA1</span>

<span class="w">    </span><span class="p">{</span><span class="n">IMG_BOOT_OTA2</span><span class="p">,</span><span class="w"> </span><span class="mh">0x08200000</span><span class="p">,</span><span class="w"> </span><span class="mh">0x08213FFF</span><span class="p">},</span><span class="w"> </span><span class="c1">//Boot Manifest(4K) + KM4 Bootloader(76K) OTA</span>
<span class="w">    </span><span class="p">{</span><span class="n">IMG_APP_OTA2</span><span class="p">,</span><span class="w">  </span><span class="mh">0x08214000</span><span class="p">,</span><span class="w"> </span><span class="mh">0x083DCFFF</span><span class="p">},</span><span class="w"> </span><span class="c1">//Certificate(4K) + Manifest(4K) + KM4    Application OTA2 + Manifest(4K) + RDP IMG OTA2</span>

<span class="w">    </span><span class="p">{</span><span class="n">FTL</span><span class="p">,</span><span class="w">           </span><span class="mh">0x083DD000</span><span class="p">,</span><span class="w"> </span><span class="mh">0x083DFFFF</span><span class="p">},</span><span class="w"> </span><span class="c1">//FTL for BT(&gt;=12K), The start offset of flash  pages which is allocated to FTL physical map.</span>
<span class="hll"><span class="w">    </span><span class="p">{</span><span class="n">VFS1</span><span class="p">,</span><span class="w">          </span><span class="mh">0x083E0000</span><span class="p">,</span><span class="w"> </span><span class="mh">0x083FFFFF</span><span class="p">},</span><span class="w"> </span><span class="c1">//VFS region 1 (128K)</span>
</span><span class="w">    </span><span class="p">{</span><span class="n">VFS2</span><span class="p">,</span><span class="w">          </span><span class="mh">0xFFFFFFFF</span><span class="p">,</span><span class="w"> </span><span class="mh">0xFFFFFFFF</span><span class="p">},</span><span class="w"> </span><span class="c1">//VFS region 2</span>
<span class="w">    </span><span class="p">{</span><span class="n">USER</span><span class="p">,</span><span class="w">          </span><span class="mh">0xFFFFFFFF</span><span class="p">,</span><span class="w"> </span><span class="mh">0xFFFFFFFF</span><span class="p">},</span><span class="w"> </span><span class="c1">//Reserved for users</span>

<span class="w">    </span><span class="cm">/* End */</span>
<span class="w">    </span><span class="p">{</span><span class="mh">0xFF</span><span class="p">,</span><span class="w">          </span><span class="mh">0xFFFFFFFF</span><span class="p">,</span><span class="w"> </span><span class="mh">0xFFFFFFFF</span><span class="p">},</span>
<span class="p">};</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>The <strong>VFS1</strong> region must exist, and its size should always be larger than 128KB.</p></li>
<li><p>There are two VFS regions at most.</p></li>
</ul>
</div>
</div></div>
</section>
<section id="vfs-on-sd-card">
<h2>VFS on SD card<a class="headerlink" href="#vfs-on-sd-card" title="Link to this heading"></a></h2>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-3-3-0" aria-selected="true" class="sphinx-tabs-tab" id="tab-3-3-0" name="3-0" role="tab" tabindex="0">RTL8730E</button><button aria-controls="panel-3-3-1" aria-selected="false" class="sphinx-tabs-tab" id="tab-3-3-1" name="3-1" role="tab" tabindex="-1">RTL8721Dx</button><button aria-controls="panel-3-3-2" aria-selected="false" class="sphinx-tabs-tab" id="tab-3-3-2" name="3-2" role="tab" tabindex="-1">RTL8720E</button><button aria-controls="panel-3-3-3" aria-selected="false" class="sphinx-tabs-tab" id="tab-3-3-3" name="3-3" role="tab" tabindex="-1">RTL8726E</button></div><div aria-labelledby="tab-3-3-0" class="sphinx-tabs-panel" id="panel-3-3-0" name="3-0" role="tabpanel" tabindex="0"><p>The SD card is only supported by FatFS, <cite>vfs_type</cite> should be set to FatFS when <cite>interface</cite> is set to SD card. Menuconfig VFS Fatfs SD configuration should be set.</p>
</div><div aria-labelledby="tab-3-3-1" class="sphinx-tabs-panel" hidden="true" id="panel-3-3-1" name="3-1" role="tabpanel" tabindex="0"><p>Not Support</p>
</div><div aria-labelledby="tab-3-3-2" class="sphinx-tabs-panel" hidden="true" id="panel-3-3-2" name="3-2" role="tabpanel" tabindex="0"><p>Not Support</p>
</div><div aria-labelledby="tab-3-3-3" class="sphinx-tabs-panel" hidden="true" id="panel-3-3-3" name="3-3" role="tabpanel" tabindex="0"><p>Not Support</p>
</div></div>
</section>
<section id="vfs-within-app-image">
<h2>VFS within APP Image<a class="headerlink" href="#vfs-within-app-image" title="Link to this heading"></a></h2>
<p>If the user only intends to use read-only files through VFS, VFS provides a more convenient read-only configuration feature on flash. The detailed steps are as follows:</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-4-4-0" aria-selected="true" class="sphinx-tabs-tab" id="tab-4-4-0" name="4-0" role="tab" tabindex="0">RTL8730E</button><button aria-controls="panel-4-4-1" aria-selected="false" class="sphinx-tabs-tab" id="tab-4-4-1" name="4-1" role="tab" tabindex="-1">RTL8720E</button><button aria-controls="panel-4-4-2" aria-selected="false" class="sphinx-tabs-tab" id="tab-4-4-2" name="4-2" role="tab" tabindex="-1">RTL8726E</button><button aria-controls="panel-4-4-3" aria-selected="false" class="sphinx-tabs-tab" id="tab-4-4-3" name="4-3" role="tab" tabindex="-1">RTL8721Dx</button></div><div aria-labelledby="tab-4-4-0" class="sphinx-tabs-panel" id="panel-4-4-0" name="4-0" role="tabpanel" tabindex="0"><ol class="arabic simple">
<li><p>Prepare the read-only files and convert them into a FAT-formatted bin file. Refer to section <a class="reference internal" href="#fatfs-bin-file-generation"><span class="std std-ref">FatFS Bin File Generation</span></a> for the method.</p></li>
<li><p>Name the bin file <code class="file docutils literal notranslate"><span class="pre">fatfs.bin</span></code> and place it in <code class="docutils literal notranslate"><span class="pre">{SDK}\amebasmart_gcc_project</span></code>.</p></li>
<li><p>Enable the following configurations in the menuconfig:</p></li>
</ol>
<figure class="align-center">
<a class="reference internal image-reference" href="../../_images/vfs_within_app_image_1.png"><img alt="../../_images/vfs_within_app_image_1.png" src="../../_images/vfs_within_app_image_1.png" style="width: 299.7px; height: 114.3px;" /></a>
</figure>
<figure class="align-center">
<a class="reference internal image-reference" href="../../_images/vfs_within_app_image_2.png"><img alt="../../_images/vfs_within_app_image_2.png" src="../../_images/vfs_within_app_image_2.png" style="width: 221.4px; height: 75.60000000000001px;" /></a>
</figure>
<ol class="arabic simple" start="4">
<li><p>Rebuild the application firmware.</p></li>
</ol>
<p>The application firmware (<code class="file docutils literal notranslate"><span class="pre">km0_km4_ca32_app.bin</span></code>) will include a read-only VFS area in FAT format, which will be mounted during the startup process.</p>
</div><div aria-labelledby="tab-4-4-1" class="sphinx-tabs-panel" hidden="true" id="panel-4-4-1" name="4-1" role="tabpanel" tabindex="0"><ol class="arabic simple">
<li><p>Prepare the read-only files and convert them into a FAT-formatted bin file. Refer to section <a class="reference internal" href="#fatfs-bin-file-generation"><span class="std std-ref">FatFS Bin File Generation</span></a> for the method.</p></li>
<li><p>Name the bin file <code class="file docutils literal notranslate"><span class="pre">fatfs.bin</span></code> and place it in <code class="docutils literal notranslate"><span class="pre">{SDK}\amebalite_gcc_project</span></code>.</p></li>
<li><p>Enable the following configurations in the menuconfig:</p></li>
</ol>
<figure class="align-center">
<a class="reference internal image-reference" href="../../_images/vfs_within_app_image_1.png"><img alt="../../_images/vfs_within_app_image_1.png" src="../../_images/vfs_within_app_image_1.png" style="width: 299.7px; height: 114.3px;" /></a>
</figure>
<figure class="align-center">
<a class="reference internal image-reference" href="../../_images/vfs_within_app_image_2.png"><img alt="../../_images/vfs_within_app_image_2.png" src="../../_images/vfs_within_app_image_2.png" style="width: 221.4px; height: 75.60000000000001px;" /></a>
</figure>
<ol class="arabic simple" start="4">
<li><p>Rebuild the application firmware.</p></li>
</ol>
<p>The application firmware (<code class="file docutils literal notranslate"><span class="pre">kr4_km4_app.bin</span></code>) will include a read-only VFS area in FAT format, which will be mounted during the startup process.</p>
</div><div aria-labelledby="tab-4-4-2" class="sphinx-tabs-panel" hidden="true" id="panel-4-4-2" name="4-2" role="tabpanel" tabindex="0"><ol class="arabic simple">
<li><p>Prepare the read-only files and convert them into a FAT-formatted bin file. Refer to section <a class="reference internal" href="#fatfs-bin-file-generation"><span class="std std-ref">FatFS Bin File Generation</span></a> for the method.</p></li>
<li><p>Name the bin file <code class="file docutils literal notranslate"><span class="pre">fatfs.bin</span></code> and place it in <code class="docutils literal notranslate"><span class="pre">{SDK}\amebalite_gcc_project</span></code>.</p></li>
<li><p>Enable the following configurations in the menuconfig:</p></li>
</ol>
<figure class="align-center">
<a class="reference internal image-reference" href="../../_images/vfs_within_app_image_1.png"><img alt="../../_images/vfs_within_app_image_1.png" src="../../_images/vfs_within_app_image_1.png" style="width: 299.7px; height: 114.3px;" /></a>
</figure>
<figure class="align-center">
<a class="reference internal image-reference" href="../../_images/vfs_within_app_image_2.png"><img alt="../../_images/vfs_within_app_image_2.png" src="../../_images/vfs_within_app_image_2.png" style="width: 221.4px; height: 75.60000000000001px;" /></a>
</figure>
<ol class="arabic simple" start="4">
<li><p>Rebuild the application firmware.</p></li>
</ol>
<p>The application firmware (<code class="file docutils literal notranslate"><span class="pre">kr4_km4_app.bin</span></code>) will include a read-only VFS area in FAT format, which will be mounted during the startup process.</p>
</div><div aria-labelledby="tab-4-4-3" class="sphinx-tabs-panel" hidden="true" id="panel-4-4-3" name="4-3" role="tabpanel" tabindex="0"><ol class="arabic simple">
<li><p>Prepare the read-only files and convert them into a FAT-formatted bin file. Refer to section <a class="reference internal" href="#fatfs-bin-file-generation"><span class="std std-ref">FatFS Bin File Generation</span></a> for the method.</p></li>
<li><p>Name the bin file <code class="file docutils literal notranslate"><span class="pre">fatfs.bin</span></code> and place it in <code class="docutils literal notranslate"><span class="pre">{SDK}\amebadplus_gcc_project</span></code>.</p></li>
<li><p>Enable the following configurations in the menuconfig:</p></li>
</ol>
<figure class="align-center">
<a class="reference internal image-reference" href="../../_images/vfs_within_app_image_1.png"><img alt="../../_images/vfs_within_app_image_1.png" src="../../_images/vfs_within_app_image_1.png" style="width: 299.7px; height: 114.3px;" /></a>
</figure>
<figure class="align-center">
<a class="reference internal image-reference" href="../../_images/vfs_within_app_image_2.png"><img alt="../../_images/vfs_within_app_image_2.png" src="../../_images/vfs_within_app_image_2.png" style="width: 221.4px; height: 75.60000000000001px;" /></a>
</figure>
<ol class="arabic simple" start="4">
<li><p>Rebuild the application firmware.</p></li>
</ol>
<p>The application firmware (<code class="file docutils literal notranslate"><span class="pre">km0_km4_app.bin</span></code>) will include a read-only VFS area in FAT format, which will be mounted during the startup process.</p>
</div></div>
<p>After startup, you will see the log <strong>VFS-FAT Init Success</strong> indicating that the read-only file system has been successfully mounted.</p>
<p>For the file usage method, refer to Section <a class="reference internal" href="#common-file-operation"><span class="std std-ref">Common File Operation</span></a> or <a class="reference internal" href="#key-value-operation"><span class="std std-ref">Key-Value Operation</span></a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To optimize the effective space utilization of the read-only file system, only FAT format is currently supported.</p>
</div>
</section>
<section id="common-file-operation">
<span id="id2"></span><h2>Common File Operation<a class="headerlink" href="#common-file-operation" title="Link to this heading"></a></h2>
<p>The common file operation interfaces used in VFS are listed below:</p>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 30.0%" />
<col style="width: 40.0%" />
<col style="width: 30.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>API</p></th>
<th class="head"><p>Parameter</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>fopen</p></td>
<td><ul class="simple">
<li><p>const char * filename</p></li>
<li><p>const char * mode</p></li>
</ul>
</td>
<td><p>Open the filename pointed to, by filename using the given mode</p></td>
</tr>
<tr class="row-odd"><td><p>fclose</p></td>
<td><p>FILE * stream</p></td>
<td><p>Close the stream</p></td>
</tr>
<tr class="row-even"><td><p>fread</p></td>
<td><ul class="simple">
<li><p>void * ptr</p></li>
<li><p>size_t size</p></li>
<li><p>size_t count</p></li>
<li><p>FILE * stream</p></li>
</ul>
</td>
<td><p>Read data from the given stream by ptr into the array pointed to</p></td>
</tr>
<tr class="row-odd"><td><p>fwrite</p></td>
<td><ul class="simple">
<li><p>const void * ptr</p></li>
<li><p>size_t size</p></li>
<li><p>size_t count</p></li>
<li><p>FILE * stream</p></li>
</ul>
</td>
<td><p>Write data from the array pointed to by ptr to the given stream</p></td>
</tr>
<tr class="row-even"><td><p>fseek</p></td>
<td><ul class="simple">
<li><p>FILE * stream</p></li>
<li><p>long int offset</p></li>
<li><p>int origin</p></li>
</ul>
</td>
<td><p>Set the file position of the stream to the given offset</p></td>
</tr>
<tr class="row-odd"><td><p>rewind</p></td>
<td><p>FILE * stream</p></td>
<td><p>Set the file position to the beginning of the file of the given stream</p></td>
</tr>
<tr class="row-even"><td><p>fgetpos</p></td>
<td><ul class="simple">
<li><p>FILE * stream</p></li>
<li><p>fpos_t * p</p></li>
</ul>
</td>
<td><p>Get the current file position of the stream and writes it to pos</p></td>
</tr>
<tr class="row-odd"><td><p>fsetpos</p></td>
<td><ul class="simple">
<li><p>FILE * stream</p></li>
<li><p>fpos_t * p</p></li>
</ul>
</td>
<td><p>Set the file position of the given stream to the given position</p></td>
</tr>
<tr class="row-even"><td><p>fflush</p></td>
<td><p>FILE * stream</p></td>
<td><p>Flush the output buffer of a stream</p></td>
</tr>
<tr class="row-odd"><td><p>remove</p></td>
<td><p>const char * filename</p></td>
<td><p>Delete the given filename so that it is no longer accessible</p></td>
</tr>
<tr class="row-even"><td><p>rename</p></td>
<td><ul class="simple">
<li><p>const char * oldname</p></li>
<li><p>const char * newname</p></li>
</ul>
</td>
<td><p>Cause the filename referred to from old_filename to new_filename</p></td>
</tr>
<tr class="row-odd"><td><p>feof</p></td>
<td><p>FILE * stream</p></td>
<td><p>Test the end-of-file indicator for the given stream</p></td>
</tr>
<tr class="row-even"><td><p>ferror</p></td>
<td><p>FILE * stream</p></td>
<td><p>Test the error indicator for the given stream</p></td>
</tr>
<tr class="row-odd"><td><p>ftell</p></td>
<td><p>FILE * stream</p></td>
<td><p>Return the current file position of the given stream</p></td>
</tr>
<tr class="row-even"><td><p>ftruncate</p></td>
<td><ul class="simple">
<li><p>FILE * stream</p></li>
<li><p>off_t length</p></li>
</ul>
</td>
<td><p>Truncate a file to a specified length</p></td>
</tr>
<tr class="row-odd"><td><p>opendir</p></td>
<td><p>const char * name</p></td>
<td><p>Open a directory</p></td>
</tr>
<tr class="row-even"><td><p>readdir</p></td>
<td><p>DIR * pdir</p></td>
<td><p>Read a directory</p></td>
</tr>
<tr class="row-odd"><td><p>closedir</p></td>
<td><p>DIR * dirp</p></td>
<td><p>Close a directory</p></td>
</tr>
<tr class="row-even"><td><p>rmdir</p></td>
<td><p>const char * path</p></td>
<td><p>Remove a directory</p></td>
</tr>
<tr class="row-odd"><td><p>mkdir</p></td>
<td><ul class="simple">
<li><p>const char * pathname</p></li>
<li><p>mode_t mode</p></li>
</ul>
</td>
<td><p>Make a directory</p></td>
</tr>
<tr class="row-even"><td><p>access</p></td>
<td><ul class="simple">
<li><p>const char * pathname</p></li>
<li><p>int mode</p></li>
</ul>
</td>
<td><p>Determine accessibility of a file</p></td>
</tr>
<tr class="row-odd"><td><p>stat</p></td>
<td><ul class="simple">
<li><p>const char * path</p></li>
<li><p>struct stat * buf</p></li>
</ul>
</td>
<td><p>Get file status</p></td>
</tr>
</tbody>
</table>
<p>Users can rebuild the project by <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">all</span> <span class="pre">EXAMPLE=vfs</span></code> to test how common file operations work. Test logs should be like below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>[example_vfs_thread] fwrite succeeded !!!
[example_vfs_thread] fread succeeded !!!
[example_vfs_thread] remove file succeeded !!!
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If successful, <code class="docutils literal notranslate"><span class="pre">fseek</span></code> returns offset according to the beginning of file which is different from standard interfaces.</p>
</div>
</section>
<section id="key-value-operation">
<span id="id3"></span><h2>Key-Value Operation<a class="headerlink" href="#key-value-operation" title="Link to this heading"></a></h2>
<p>Simple KV interfaces are also provided for users. All KV APIs are placed in <code class="docutils literal notranslate"><span class="pre">{SDK}\component\file_system\kv\kv.c</span></code>. Users can rebuild the project by <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">all</span> <span class="pre">EXAMPLE=kv</span></code> to test how KV APIs work. Test logs should be like below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rt_kv_set</span> <span class="n">success</span><span class="p">,</span> <span class="n">write</span> <span class="mi">28</span> <span class="n">letters</span><span class="o">.</span>
<span class="n">rt_kv_get</span> <span class="n">success</span><span class="p">,</span> <span class="n">read</span> <span class="mi">28</span> <span class="n">letters</span><span class="o">.</span>
<span class="n">rt_kv_delett</span> <span class="n">success</span><span class="o">.</span>
</pre></div>
</div>
</section>
<section id="code-conversion">
<h2>Code Conversion<a class="headerlink" href="#code-conversion" title="Link to this heading"></a></h2>
<p>The conversion between Unicode and other codes is not supported on FatFS by default.</p>
<p>Modify the macro <code class="docutils literal notranslate"><span class="pre">FF_CODE_PAGE</span></code> in <code class="docutils literal notranslate"><span class="pre">{SDK}\component\file_system\fatfs\r0.14b\include\ffconf.h</span></code>  to enable the code conversion function, where <code class="docutils literal notranslate"><span class="pre">FF_CODE_PAGE</span></code> should be chosen as code page number which is desired.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#define FF_CODE_PAGE  999</span>
<span class="cm">/* This option specifies the OEM code page to be used on the target system.</span>
<span class="cm">/  Incorrect code page setting can cause a file open failure.</span>
<span class="cm">/   437 - U.S.</span>
<span class="cm">/   720 - Arabic</span>
<span class="cm">/   737 - Greek</span>
<span class="cm">/   771 - KBL</span>
<span class="cm">/   775 - Baltic</span>
<span class="cm">/   850 - Latin 1</span>
<span class="cm">/   852 - Latin 2</span>
<span class="cm">/   855 - Cyrillic</span>
<span class="cm">/   857 - Turkish</span>
<span class="cm">/   860 - Portuguese</span>
<span class="cm">/   861 - Icelandic</span>
<span class="cm">/   862 - Hebrew</span>
<span class="cm">/   863 - Canadian French</span>
<span class="cm">/   864 - Arabic</span>
<span class="cm">/   865 - Nordic</span>
<span class="cm">/   866 - Russian</span>
<span class="cm">/   869 - Greek 2</span>
<span class="cm">/   932 - Japanese (DBCS)</span>
<span class="cm">/   936 - Simplified Chinese (DBCS)</span>
<span class="cm">/   949 - Korean (DBCS)</span>
<span class="cm">/   950 - Traditional Chinese (DBCS)</span>
<span class="cm">/   999 - Realtek defined for code size</span>
<span class="cm">/     0 - Include all code pages above and configured by f_setcp()</span>
<span class="cm">*/</span>
</pre></div>
</div>
</section>
<section id="vfs-encryption">
<h2>VFS Encryption<a class="headerlink" href="#vfs-encryption" title="Link to this heading"></a></h2>
<p>For special storage security needs, users can configure encryption and decryption interfaces of VFS. Specific interface usage instructions are listed in <code class="docutils literal notranslate"><span class="pre">{SDK}\component\example\storage\vfs_encrypt\readme.txt</span></code>. Users can rebuild the project by <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">all</span> <span class="pre">EXAMPLE=vfs_encrypt</span></code> to test how VFS encryption works. Test logs should be like below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>[example_vfs_encrypt_thread] fwrite succeeded !!!
[example_vfs_encrypt_thread] fread succeeded !!!
[example_vfs_encrypt_thread] remove file succeeded !!!
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Plaintext will be padded according to the length of grouped data. It will take more cost of memory space if using vfs encryption.</p>
</div>
</section>
<section id="vfs-bin-file-generation">
<span id="id4"></span><h2>VFS Bin File Generation<a class="headerlink" href="#vfs-bin-file-generation" title="Link to this heading"></a></h2>
<p>If data needs to be placed in the Flash in advance, VFS bin file can be generated on PC. After generating the bin file, it should be downloaded to VFS region according to the Flash layout.</p>
<section id="littlefs-bin-file-generation">
<h3>LittleFS Bin File Generation<a class="headerlink" href="#littlefs-bin-file-generation" title="Link to this heading"></a></h3>
<ol class="arabic">
<li><p>Prepare a needed object folder including files before generating LittleFS bin files. For example:</p>
<figure class="align-center">
<a class="reference internal image-reference" href="../../_images/littlefs_bin_generation_step1.png"><img alt="../../_images/littlefs_bin_generation_step1.png" src="../../_images/littlefs_bin_generation_step1.png" style="width: 154.8px; height: 178.20000000000002px;" /></a>
</figure>
<p><strong>AUDIO</strong> and <strong>KV</strong> directories will be LittleFS directory in the Flash. The <code class="docutils literal notranslate"><span class="pre">test</span></code> directory is equivalent to the root directory.</p>
</li>
<li><p>Use the command <code class="docutils literal notranslate"><span class="pre">$./mklittlefs</span> <span class="pre">-b</span> <span class="pre">4096</span> <span class="pre">-p</span> <span class="pre">256</span> <span class="pre">-s</span> <span class="pre">0x20000</span> <span class="pre">-c</span> <span class="pre">test</span> <span class="pre">image_littlefs.bin</span></code> in <code class="docutils literal notranslate"><span class="pre">mklittlefs</span></code> tool located at <code class="docutils literal notranslate"><span class="pre">\tools\littlefs</span></code> to generate LittleFS bin files.</p>
<p>Where:</p>
<dl class="field-list simple">
<dt class="field-odd">b<span class="colon">:</span></dt>
<dd class="field-odd"><p>block size decided by Flash</p>
</dd>
<dt class="field-even">p<span class="colon">:</span></dt>
<dd class="field-even"><p>page size</p>
</dd>
<dt class="field-odd">s<span class="colon">:</span></dt>
<dd class="field-odd"><p>bin file size</p>
</dd>
<dt class="field-even">c<span class="colon">:</span></dt>
<dd class="field-even"><p>object folder</p>
</dd>
<dt class="field-odd">&lt;Image_littlefs.bin&gt;<span class="colon">:</span></dt>
<dd class="field-odd"><p>LittleFS bin file name</p>
</dd>
</dl>
<figure class="align-center">
<a class="reference internal image-reference" href="../../_images/littlefs_bin_generation_step2.png"><img alt="../../_images/littlefs_bin_generation_step2.png" src="../../_images/littlefs_bin_generation_step2.png" style="width: 596.7px; height: 66.60000000000001px;" /></a>
</figure>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p><strong>-b 4096</strong> and <strong>-p 256</strong> are default configurations, users should adapt the configuration according to <em>block_size</em> and <em>cache_size</em> of <code class="docutils literal notranslate"><span class="pre">lfs_config</span></code> in <code class="docutils literal notranslate"><span class="pre">{SDK}\component\file_system\littlefs\littlefs_adapter.c</span></code>.</p></li>
<li><p><strong>-s 0x20000</strong> is according to VFS region mentioned in Section <a class="reference internal" href="#vfs-on-flash"><span class="std std-ref">VFS on Flash</span></a>.</p></li>
</ul>
</div>
</li>
<li><p>Download the image to the Flash.</p>
<p>The start address of Image Tool should be <code class="docutils literal notranslate"><span class="pre">StartAddr</span></code> of VFS Flash region mentioned in Section <a class="reference internal" href="#vfs-on-flash"><span class="std std-ref">VFS on Flash</span></a>. The end address of Image Tool should be it’s <code class="docutils literal notranslate"><span class="pre">EndAddr</span></code> + 1;</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-5-5-0" aria-selected="true" class="sphinx-tabs-tab" id="tab-5-5-0" name="5-0" role="tab" tabindex="0">RTL8721Dx</button><button aria-controls="panel-5-5-1" aria-selected="false" class="sphinx-tabs-tab" id="tab-5-5-1" name="5-1" role="tab" tabindex="-1">RTL8720E</button><button aria-controls="panel-5-5-2" aria-selected="false" class="sphinx-tabs-tab" id="tab-5-5-2" name="5-2" role="tab" tabindex="-1">RTL8726E</button><button aria-controls="panel-5-5-3" aria-selected="false" class="sphinx-tabs-tab" id="tab-5-5-3" name="5-3" role="tab" tabindex="-1">RTL8730E</button></div><div aria-labelledby="tab-5-5-0" class="sphinx-tabs-panel" id="panel-5-5-0" name="5-0" role="tabpanel" tabindex="0"><figure class="align-center">
<a class="reference internal image-reference" href="../../_images/littlefs_bin_download_dplus.png"><img alt="../../_images/littlefs_bin_download_dplus.png" src="../../_images/littlefs_bin_download_dplus.png" style="width: 777.6px; height: 112.8px;" /></a>
</figure>
</div><div aria-labelledby="tab-5-5-1" class="sphinx-tabs-panel" hidden="true" id="panel-5-5-1" name="5-1" role="tabpanel" tabindex="0"><figure class="align-center">
<a class="reference internal image-reference" href="../../_images/littlefs_bin_download_lite.png"><img alt="../../_images/littlefs_bin_download_lite.png" src="../../_images/littlefs_bin_download_lite.png" style="width: 772.2px; height: 108.0px;" /></a>
</figure>
</div><div aria-labelledby="tab-5-5-2" class="sphinx-tabs-panel" hidden="true" id="panel-5-5-2" name="5-2" role="tabpanel" tabindex="0"><figure class="align-center">
<a class="reference internal image-reference" href="../../_images/littlefs_bin_download_lite.png"><img alt="../../_images/littlefs_bin_download_lite.png" src="../../_images/littlefs_bin_download_lite.png" style="width: 772.2px; height: 108.0px;" /></a>
</figure>
</div><div aria-labelledby="tab-5-5-3" class="sphinx-tabs-panel" hidden="true" id="panel-5-5-3" name="5-3" role="tabpanel" tabindex="0"><figure class="align-center">
<a class="reference internal image-reference" href="../../_images/littlefs_bin_download_smart.png"><img alt="../../_images/littlefs_bin_download_smart.png" src="../../_images/littlefs_bin_download_smart.png" style="width: 775.8000000000001px; height: 105.3px;" /></a>
</figure>
</div></div>
</li>
</ol>
</section>
<section id="fatfs-bin-file-generation">
<span id="id5"></span><h3>FatFS Bin File Generation<a class="headerlink" href="#fatfs-bin-file-generation" title="Link to this heading"></a></h3>
<p>The steps to generate FatFS bin files are listed below:</p>
<ol class="arabic">
<li><p>Use command <code class="docutils literal notranslate"><span class="pre">root&#64;ubuntu</span> <span class="pre">#</span> <span class="pre">dd</span> <span class="pre">if=/dev/zero</span> <span class="pre">of=test.bin</span> <span class="pre">count=128</span> <span class="pre">bs=1KB</span></code> to create <code class="docutils literal notranslate"><span class="pre">test.bin</span></code> that has 64 blocks and each block is 1KB.</p></li>
<li><p>Use command <code class="docutils literal notranslate"><span class="pre">root&#64;ubuntu</span> <span class="pre">#</span> <span class="pre">mkfs.fat</span> <span class="pre">-S</span> <span class="pre">512</span> <span class="pre">-F</span> <span class="pre">12</span> <span class="pre">test.bin</span></code> to build a FAT file system.</p></li>
<li><p>Use command <code class="docutils literal notranslate"><span class="pre">root&#64;ubuntu</span> <span class="pre">#</span> <span class="pre">sudo</span> <span class="pre">mount</span> <span class="pre">test.bin</span> <span class="pre">./fs</span></code> to mount <code class="docutils literal notranslate"><span class="pre">test.bin</span></code> to file folder fs.</p></li>
<li><p>Use command <code class="docutils literal notranslate"><span class="pre">root&#64;ubuntu</span> <span class="pre">#</span> <span class="pre">sudo</span> <span class="pre">cp</span> <span class="pre">hello.txt</span> <span class="pre">./fs</span></code> to copy the files that users want to store into <code class="docutils literal notranslate"><span class="pre">test.bin</span></code>.</p>
<p>In this step, <code class="docutils literal notranslate"><span class="pre">hello.txt</span></code> is stored in <code class="docutils literal notranslate"><span class="pre">test.bin</span></code>.</p>
</li>
<li><p>Use command <code class="docutils literal notranslate"><span class="pre">root&#64;ubuntu</span> <span class="pre">#</span> <span class="pre">sudo</span> <span class="pre">umount</span> <span class="pre">./fs</span></code> to generate the FatFS file after unmounting <code class="docutils literal notranslate"><span class="pre">test.bin</span></code>.</p>
<p>Users should find other related information from the internet, and copy <code class="docutils literal notranslate"><span class="pre">test.bin</span></code> into user data area of Flash finally.</p>
</li>
<li><p>Refer to LittleFS Step 3 to write the generated bin file to the Flash.</p></li>
</ol>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="0_vfs_index.html" class="btn btn-neutral float-left" title="Virtual File System" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../1_mpu_cache/0_mpu_cache_index.html" class="btn btn-neutral float-right" title="MPU and Cache" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Realsil.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>

      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 



</body>
</html>