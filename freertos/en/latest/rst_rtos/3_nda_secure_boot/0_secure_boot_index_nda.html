

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Secure Boot &mdash; Ameba IoT Docs  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
      <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=b0e775ca" />
      <link rel="stylesheet" type="text/css" href="../../_static/tabs.css?v=a5c4661c" />
      <link rel="stylesheet" type="text/css" href="../../_static/_static/custom.css" />

  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../../_static/toggleprompt.js?v=d7ede5d2"></script>
        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
        <script src="../../_static/tabs.js?v=3030b3cb"></script>
        <script>let toggleHintShow = 'Click to show';</script>
        <script>let toggleHintHide = 'Click to hide';</script>
        <script>let toggleOpenOnPrint = 'true';</script>
        <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Secure Boot OTP" href="1_secure_boot_toprst.html" />
    <link rel="prev" title="RSIP-AES Entry" href="../3_nda_rsip/1_rsip_toprst.html" />
   
  
  <script type="text/javascript" src="../../_static/js/selector.js"></script>

  <style>
    .wy-nav-content {max-width: 1000px;} /* 设置最大宽度 */
  </style>

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            Ameba IoT Docs
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../0_ameba_product/0_ameba_product_center_index.html">Products Center</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_ameba_sdk/0_ameba_sdks_index.html">Ameba SDK</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_ameba_solutions/0_ameba_solutions_index.html">Ameba Solutions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_gcc_build_environment/0_gcc_build_index.html">0.1 GCC Build Environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_gdb_debug/0_gdb_debug_index.html">0.2 GDB Debug</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_gcc_build_library/0_gcc_build_library_index.html">0.3 GCC Build Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_sdk_example/0_sdk_example_index.html">0.4 SDK Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_memory_layout/0_layout_index.html">0.5 Flash &amp; RAM Layout</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_user_config/0_usrcfg_index.html">0.6 User Config</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_tools/0_tools_index.html">0.7 Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_at_command/0_at_command_index.html">0.8 AT Command</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_file_system/0_vfs_index.html">0.9 Virtual File System</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1_mpu_cache/0_mpu_cache_index.html">1.0 MPU and Cache</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1_boot_process/0_boot_index.html">1.1 BOOT Process</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1_ota/0_ota_index.html">1.2 OTA</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1_otpc/0_otpc_index.html">1.3 OTPC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1_chipen/0_chipen_index.html">1.4 CHIPEN</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1_ipc/0_ipc_index.html">1.5 Inter Processor Communication</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1_pinmux/0_pinmux_index.html">1.6 PINMUX</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1_gpio/0_gpio_index.html">1.7 GPIO</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1_power_save/0_ps_index.html">1.9 Power Save</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2_whc_wifi_bridge/0_wifi_bridge_index.html">2.1 WHC Bridge</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2_whc_fullmac/0_fullmac_index.html">2.2 WHC FullMAC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2_wifi_tunnel/0_wifi_tunnel_index.html">2.3 Wi-Fi R-Mesh</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2_wifi_csi/0_wifi_csi_index.html">2.5 Wi-Fi CSI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2_wifi_adaptivity_test/0_wifi_adaptivity_index.html">2.6 Wi-Fi Adaptivity Test</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_security/0_security_index.html">3.1 Security &amp; Encryption</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_trng/0_trng_index.html">3.2 True Random Number Generator</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_nda_huk_derivation/0_huk_derivation_index_nda.html">3.3 HUK Derivation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_nda_rdp/0_rdp_index_nda.html">3.4 RDP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_nda_rsip/0_rsip_index_nda.html">3.5 RSIP</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">3.6 Secure Boot</a><ul>
<li class="toctree-l2"><a class="reference internal" href="1_secure_boot_toprst.html#detail-informations">Detail Informations</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../3_nda_swd_protection/0_swd_protection_index_nda.html">3.7 SWD Protection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_nda_tfm/0_tfm_index_nda.html">3.8 Trusted Firmware-M (TF-M)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_crypto_engine/0_crypto_engine_index.html">3.9 Crypto Engine</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_ecdsa_engine/0_ecdsa_index.html">3.a ECDSA Engine</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_eddsa_engine/0_eddsa_index.html">3.b EDDSA Engine</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_rsa_engine/0_rsa_index.html">3.c RSA Engine</a></li>
<li class="toctree-l1"><a class="reference internal" href="../4_ai/0_ai_index.html">4.1 AI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../4_ai_voice/0_ai_voice_index.html">4.2 AIVoice</a></li>
<li class="toctree-l1"><a class="reference internal" href="../4_multimedia/0_multimedia_index.html">4.3 Multimedia</a></li>
<li class="toctree-l1"><a class="reference internal" href="../4_dsp/0_dsp_index.html">4.4 DSP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../6_mass_production/0_mp_index.html">6.1 Mass Production</a></li>
<li class="toctree-l1"><a class="reference internal" href="../6_mp_image/0_mp_image_index.html">6.2 MP Image</a></li>
<li class="toctree-l1"><a class="reference internal" href="../6_mptools/0_mptools_index.html">6.3 MP Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../7_usb/0_usb_index.html">7.1 USB Host &amp; Device</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_dmac/0_dmac_index.html">8.1 DMA Controllor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_psram/0_psram_index.html">8.2 PSRAM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_thermal/0_thermal_index.html">8.3 Thermal Meter</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_adc/0_adc_index.html">8.4 ADC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_ir/0_ir_index.html">8.5 IR</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_ledc/0_ledc_index.html">8.6 LEDC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_cap_touch/0_cap_touch_index.html">8.7 Cap-Touch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_key_scan/0_key_scan_index.html">8.8 Key-Scan</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_rtc_io/0_rtc_io_index.html">8.9 RTC-IO</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_lcdc/0_lcdc_index.html">8.A LCDC</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Ameba IoT Docs</a>
      </nav>

      <div class="wy-nav-content">

        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Secure Boot</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="secure-boot">
<h1>Secure Boot<a class="headerlink" href="#secure-boot" title="Link to this heading"></a></h1>
<p>Secure boot aims at firmware protection, which prevents attackers from modifying or replacing firmware
maliciously. When the chip is power on, the secure boot ROM executes to check the validation of the
image signature. If the signature is valid, authentication will be successful, which means that the
firmware is safe and the subsequent operations can be continued. Otherwise, the SoC clears the stack
and goes into an endless loop.</p>
<p>Users do not need to implement the secure boot code themselves, which is already contained in the SDK.</p>
<p>To generate the Public Key and signature of bootloader, we provide an image operation script named <code class="docutils literal notranslate"><span class="pre">axf2bin.py</span></code>. With the script, users can generate and append signature-related information to images. Refer to the following sections for operation details.</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-0-0-0" aria-selected="true" class="sphinx-tabs-tab" id="tab-0-0-0" name="0-0" role="tab" tabindex="0">RTL8721Dx</button><button aria-controls="panel-0-0-1" aria-selected="false" class="sphinx-tabs-tab" id="tab-0-0-1" name="0-1" role="tab" tabindex="-1">RTL8726E</button><button aria-controls="panel-0-0-2" aria-selected="false" class="sphinx-tabs-tab" id="tab-0-0-2" name="0-2" role="tab" tabindex="-1">RTL8730E</button></div><div aria-labelledby="tab-0-0-0" class="sphinx-tabs-panel" id="panel-0-0-0" name="0-0" role="tabpanel" tabindex="0"><p>The principle of secure boot is illustrated in below. With the <code class="docutils literal notranslate"><span class="pre">axf2bin.py</span></code>, the public key, signature, image hash and other fields are generated in the manifest.</p>
<figure class="align-center" id="id1">
<a class="reference internal image-reference" href="../../_images/secure_boot_diagram.svg"><img alt="../../_images/secure_boot_diagram.svg" height="315" src="../../_images/secure_boot_diagram.svg" width="585" /></a>
<figcaption>
<p><span class="caption-text">Secure boot diagram</span><a class="headerlink" href="#id1" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>The manifest (4KB) is located at the beginning of the image. Each of the following images has a manifest:</p>
<ul class="simple">
<li><p>KM4 bootloader</p></li>
<li><p>Key certificate</p></li>
<li><p>KM0 &amp; KM4 application image</p></li>
</ul>
<p>The images validation process is as follows:</p>
<ol class="arabic simple">
<li><p>KM4 Boot ROM validates KM4 bootloader.</p></li>
<li><p>KM4 bootloader validates the key certificate.</p></li>
</ol>
<p>The KM4 bootloader and key certificate are signed against RoT (Root of Trust) key. The RoTPK hash is stored in OTP.</p>
<p>The key pair of signing KM0 &amp; KM4 application image should be different from the RoT key pair. Users can choose one key or different keys to sign the image.</p>
<p>The key certificate contains the public key hash of other images. So KM4 bootloader verifies the certificate firstly to get the public key hash of the images of the following stage. Then it verifies the following stage images against the public key hash from the key certificate.</p>
<p>Refer to the <strong>Security</strong> chapter of User Manual for more signing and validation details.</p>
</div><div aria-labelledby="tab-0-0-1" class="sphinx-tabs-panel" hidden="true" id="panel-0-0-1" name="0-1" role="tabpanel" tabindex="0"><p>The principle of secure boot is illustrated in below. With the <code class="docutils literal notranslate"><span class="pre">axf2bin.py</span></code>, the public key, signature, image hash and other fields are generated in the manifest.</p>
<figure class="align-center" id="id2">
<a class="reference internal image-reference" href="../../_images/secure_boot_diagram_lite.svg"><img alt="../../_images/secure_boot_diagram_lite.svg" height="315" src="../../_images/secure_boot_diagram_lite.svg" width="570" /></a>
<figcaption>
<p><span class="caption-text">Secure boot diagram</span><a class="headerlink" href="#id2" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>The manifest (4KB) is located at the beginning of the image. Each of the following images has a manifest:</p>
<ul class="simple">
<li><p>KM4 bootloader</p></li>
<li><p>Key certificate</p></li>
<li><p>KR4 &amp; KM4 application image, including:</p></li>
<li><p>NSPE image (KR4 &amp; KM4 non-secure image)</p></li>
<li><p>SPE image (KM4 secure image, if exists)</p></li>
<li><p>DSP image (if exists)</p></li>
</ul>
<p>The images validation process is as follows:</p>
<ol class="arabic simple">
<li><p>KM4 Boot ROM validates KM4 bootloader.</p></li>
<li><p>KM4 bootloader validates the key certificate.</p></li>
<li><p>KM4 bootloader validates the KR4 &amp; KM4 application image and DSP image separately.</p></li>
</ol>
<p>The KM4 bootloader and key certificate are signed against RoT (Root of Trust) key. The RoTPK hash is stored in OTP.</p>
<p>The key pairs of signing KR4 &amp; KM4 application image and DSP image should be different from the RoT key pairs. Users can choose one key or different keys to sign the images.</p>
<p>The key certificate contains the public key hash of other images. So KM4 bootloader verifies the certificate firstly to get the public key hash of the images of the following stage. Then it verifies the following stage images against the public key hash from the key certificate.</p>
<p>Refer to the <strong>Security</strong> chapter of User Manual for more signing and validation details.</p>
</div><div aria-labelledby="tab-0-0-2" class="sphinx-tabs-panel" hidden="true" id="panel-0-0-2" name="0-2" role="tabpanel" tabindex="0"><p>The principle of secure boot is illustrated in below. With the <code class="docutils literal notranslate"><span class="pre">axf2bin.py</span></code>, the public key, signature, image hash and other fields are generated in the manifest.</p>
<figure class="align-center" id="id3">
<a class="reference internal image-reference" href="../../_images/secure_boot_diagram_smart.svg"><img alt="../../_images/secure_boot_diagram_smart.svg" height="315" src="../../_images/secure_boot_diagram_smart.svg" width="570" /></a>
<figcaption>
<p><span class="caption-text">Secure boot diagram</span><a class="headerlink" href="#id3" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>The manifest (4KB) is located at the beginning of the image. Each of the following images has a manifest:</p>
<ul class="simple">
<li><p>KM4 bootloader</p></li>
<li><p>Key certificate</p></li>
<li><p>KM0 &amp; KM4 &amp; CA32 application image</p></li>
</ul>
<p>The images validation process is as follows:</p>
<ol class="arabic simple">
<li><p>KM4 Boot ROM validates KM4 bootloader.</p></li>
<li><p>KM4 bootloader validates the key certificate.</p></li>
<li><p>KM4 bootloader validates KM0 &amp; KM4 &amp; CA32 application image, which includes NSPE image (KM0 &amp; KM4 non-secure image), SPE image (KM4 secure image), and AP image.</p></li>
</ol>
<p>KM4 bootloader and key certificate are signed against RoT (Root of Trust) key. The ROTPK hash is stored in OTP.</p>
<p>The key pair of signing KM0 &amp; KM4 &amp; CA32 application image should be different from the RoT key pair. Users should choose a different key  to sign the image.</p>
<p>The key certificate contains the public key hash of other images, such as NSPE, SPE, AP image, etc. So KM4 bootloader verifies the certificate firstly to get the public key hash of the images of the following stage. Then it verifies the following stage images against the public key hash from the key certificate.</p>
<p>Refer to the <strong>Security</strong> chapter of User Manual (UM0600) for more signing and validation details.</p>
<p><strong>Manifest</strong></p>
<p>Each signed image has a manifest, which contains the information of the image, such as hash, etc. The manifest structure is summarized as below.</p>
<figure class="align-center" id="id4">
<a class="reference internal image-reference" href="../../_images/manifest_structure_smart.svg"><img alt="../../_images/manifest_structure_smart.svg" height="352" src="../../_images/manifest_structure_smart.svg" width="933" /></a>
<figcaption>
<p><span class="caption-text">Manifest structure</span><a class="headerlink" href="#id4" title="Link to this image"></a></p>
</figcaption>
</figure>
<table class="docutils align-default" style="width: 100%">
<thead>
<tr class="row-odd"><th class="head"><p>Field</p></th>
<th class="head"><p>Size (bytes)</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Image Pattern</p></td>
<td><p>8</p></td>
<td><ul class="simple">
<li><p>For bootloader, this field is 0x96969999, 0xFC66CC3F.</p></li>
<li><p>For application image, this field is 0x35393138, 0x31313738.</p></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><p>Version</p></td>
<td><p>1</p></td>
<td><p>Version of the manifest format used</p></td>
</tr>
<tr class="row-even"><td><p>Image ID</p></td>
<td><p>1</p></td>
<td><p>Identifier for each image.</p>
<ul class="simple">
<li><p>0: bootloader</p></li>
<li><p>1: NSPE image</p></li>
<li><p>2: SPE image</p></li>
<li><p>3: AP image</p></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><p>Auth Alg</p></td>
<td><p>1</p></td>
<td><p>The authentication algorithm used to validate the image signature.</p>
<ul class="simple">
<li><p>0x0: ED25519</p></li>
<li><p>0x1: ECDSA_SECP192R1</p></li>
<li><p>0x2: ECDSA_SECP224R1</p></li>
<li><p>0x3: ECDSA_SECP256R1</p></li>
<li><p>0x6: ECDSA_BP256R1</p></li>
<li><p>0xA: ECDSA_SECP192K1</p></li>
<li><p>0xB: ECDSA_SECP224K1</p></li>
<li><p>0xC: ECDSA_SECP256K1</p></li>
</ul>
</td>
</tr>
<tr class="row-even"><td><p>Hash Alg</p></td>
<td><p>1</p></td>
<td><p>The cryptographic algorithm used to calculate the image hash value.</p>
<ul class="simple">
<li><p>0x0: SHA 256</p></li>
<li><p>0x1: SHA 384</p></li>
<li><p>0x2: SHA 512</p></li>
<li><p>0x3: HMAC-SHA256</p></li>
<li><p>0x4: HMAC-SHA384</p></li>
<li><p>0x5: HMAC-SHA512</p></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><p>Major Image Version</p></td>
<td><p>2</p></td>
<td><p>Major version used to prevent rollback attacks</p></td>
</tr>
<tr class="row-even"><td><p>Minor Image Version</p></td>
<td><p>2</p></td>
<td><p>Minor version used by OTA selection when the major version is the same</p></td>
</tr>
<tr class="row-odd"><td><p>Image Size</p></td>
<td><p>4</p></td>
<td><p>The image size in bytes</p></td>
</tr>
<tr class="row-even"><td><p>Security Epoch</p></td>
<td><p>4</p></td>
<td><div class="line-block">
<div class="line">Security epoch is to create control points such that an older security epoch cannot access data</div>
<div class="line">generated by a newer security version.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p>IV</p></td>
<td><p>16</p></td>
<td><p>IV used for RSIP or RDP</p></td>
</tr>
<tr class="row-even"><td><p>Image Hash</p></td>
<td><p>64</p></td>
<td><p>The expected hash value of the image once decrypted</p></td>
</tr>
<tr class="row-odd"><td><p>Public Key</p></td>
<td><p>144</p></td>
<td><p>Public key used to authenticate the signature</p></td>
</tr>
<tr class="row-even"><td><p>Manifest Signature</p></td>
<td><p>144</p></td>
<td><p>Digital signature that signs all the manifest fields except itself.</p></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <cite>Auth_Alg</cite> and <cite>Hash_Alg</cite> settings have lower priority than <cite>Auth_Alg</cite> and <cite>Hash_Alg</cite> configurations in OTP.</p>
<ul class="simple">
<li><p>If <cite>Auth_Alg</cite> and <cite>Hash_Alg</cite> in OTP are not programmed, it will refer to the <cite>Auth_Alg</cite> and <cite>Hash_Alg</cite> settings in the manifest.</p></li>
<li><p>Otherwise, the values should equal to the <cite>Auth_Alg</cite> and <cite>Hash_Alg</cite> settings in OTP. If not, secure boot will fail.</p></li>
</ul>
</div>
<p><strong>Key Certificate</strong></p>
<p>The key certificate maintains records for images.</p>
<figure class="align-center" id="id5">
<a class="reference internal image-reference" href="../../_images/key_certificate_structure_smart.svg"><img alt="../../_images/key_certificate_structure_smart.svg" height="535" src="../../_images/key_certificate_structure_smart.svg" width="1015" /></a>
<figcaption>
<p><span class="caption-text">Key certificate structure</span><a class="headerlink" href="#id5" title="Link to this image"></a></p>
</figcaption>
</figure>
<table class="docutils align-default" style="width: 100%">
<thead>
<tr class="row-odd"><th class="head"><p>Field</p></th>
<th class="head"><p>Size (bytes)</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Image Pattern</p></td>
<td><p>8</p></td>
<td><p>Fixed to 0x35393138, 0x31313738.</p></td>
</tr>
<tr class="row-odd"><td><p>Version</p></td>
<td><p>1</p></td>
<td><p>Format version</p></td>
</tr>
<tr class="row-even"><td><p>Image ID</p></td>
<td><p>1</p></td>
<td><p>Identifier for each image. For the certificate, this field is fixed to 4.</p></td>
</tr>
<tr class="row-odd"><td><p>Auth Alg</p></td>
<td><p>1</p></td>
<td><p>The authentication algorithm used to validate the signature.</p>
<ul class="simple">
<li><p>0x0: ED25519</p></li>
<li><p>0x1: ECDSA_SECP192R1</p></li>
<li><p>0x2: ECDSA_SECP224R1</p></li>
<li><p>0x3: ECDSA_SECP256R1</p></li>
<li><p>0x6: ECDSA_BP256R1</p></li>
<li><p>0xA: ECDSA_SECP192K1</p></li>
<li><p>0xB: ECDSA_SECP224K1</p></li>
<li><p>0xC: ECDSA_SECP256K1</p></li>
</ul>
</td>
</tr>
<tr class="row-even"><td><p>Hash Alg</p></td>
<td><p>1</p></td>
<td><p>The cryptographic algorithm used to calculate the hash value.</p>
<ul class="simple">
<li><p>0x0: SHA 256</p></li>
<li><p>0x1: SHA 384</p></li>
<li><p>0x2: SHA 512</p></li>
<li><p>0x3: HMAC-SHA256</p></li>
<li><p>0x4: HMAC-SHA384</p></li>
<li><p>0x5: HMAC-SHA512</p></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><p>Major Key Version</p></td>
<td><p>2</p></td>
<td><p>Major version used to prevent rollback attacks</p></td>
</tr>
<tr class="row-even"><td><p>Minor Key Version</p></td>
<td><p>2</p></td>
<td><p>Minor version used by OTA selection when the major version is the same</p></td>
</tr>
<tr class="row-odd"><td><p>Table Size</p></td>
<td><p>4</p></td>
<td><p>The size of the key certificate. The signature field is not included.</p></td>
</tr>
<tr class="row-even"><td><p>Entry Count</p></td>
<td><p>4</p></td>
<td><p>The entry number in the key certificate</p></td>
</tr>
<tr class="row-odd"><td><p>PK Entry</p></td>
<td><p>144</p></td>
<td><p>Contains the information of public key, which is used to validate certificate signature.</p></td>
</tr>
<tr class="row-even"><td><p>NSPE Key Entry</p></td>
<td><p>36</p></td>
<td><p>Contains the information of NSPE-PK hash.</p></td>
</tr>
<tr class="row-odd"><td><p>SPE Key Entry</p></td>
<td><p>36</p></td>
<td><p>Contains the information of SPE-PK hash.</p></td>
</tr>
<tr class="row-even"><td><p>AP Key Entry</p></td>
<td><p>36</p></td>
<td><p>Contains the information of AP PK hash.</p></td>
</tr>
<tr class="row-odd"><td><p>Signature</p></td>
<td><p>144</p></td>
<td><p>The ECC signature of partition table fields</p></td>
</tr>
</tbody>
</table>
<table class="docutils align-default" id="id6" style="width: 100%">
<caption><span class="caption-text">Certificate entry fields</span><a class="headerlink" href="#id6" title="Link to this table"></a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>Field</p></th>
<th class="head"><p>Size (bytes)</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Key ID</p></td>
<td><p>4</p></td>
<td><p>Identifier for each entry.</p>
<ul class="simple">
<li><p>0: NSPE key entry</p></li>
<li><p>1: SPE key entry</p></li>
<li><p>2: AP key entry</p></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><p>Hash</p></td>
<td><p>32</p></td>
<td><p>Stores the SHA256 of the corresponding public key.</p></td>
</tr>
</tbody>
</table>
</div></div>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="1_secure_boot_toprst.html#detail-informations">Detail Informations</a></li>
</ul>
</div>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../3_nda_rsip/1_rsip_toprst.html" class="btn btn-neutral float-left" title="RSIP-AES Entry" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="1_secure_boot_toprst.html" class="btn btn-neutral float-right" title="Secure Boot OTP" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Realsil.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>

      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 



</body>
</html>