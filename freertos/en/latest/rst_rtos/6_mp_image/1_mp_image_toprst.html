

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Introduction &mdash; Ameba IoT Docs  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
      <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=b0e775ca" />
      <link rel="stylesheet" type="text/css" href="../../_static/tabs.css?v=a5c4661c" />
      <link rel="stylesheet" type="text/css" href="../../_static/_static/custom.css" />

  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../../_static/toggleprompt.js?v=d7ede5d2"></script>
        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
        <script src="../../_static/tabs.js?v=3030b3cb"></script>
        <script>let toggleHintShow = 'Click to show';</script>
        <script>let toggleHintHide = 'Click to hide';</script>
        <script>let toggleOpenOnPrint = 'true';</script>
        <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="1-N MP Tool" href="../6_mptools/0_mptools_index.html" />
    <link rel="prev" title="MP Image" href="0_mp_image_index.html" />
   
  
  <script type="text/javascript" src="../../_static/js/selector.js"></script>

  <style>
    .wy-nav-content {max-width: 1000px;} /* 设置最大宽度 */
  </style>

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            Ameba IoT Docs
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../0_ameba_product/0_ameba_product_center_index.html">Products Center</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_ameba_sdk/0_ameba_sdks_index.html">Ameba SDK</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_ameba_solutions/0_ameba_solutions_index.html">Ameba Solutions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_gcc_build_environment/0_gcc_build_index.html">0.1 GCC Build Environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_gdb_debug/0_gdb_debug_index.html">0.2 GDB Debug</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_gcc_build_library/0_gcc_build_library_index.html">0.3 GCC Build Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_sdk_example/0_sdk_example_index.html">0.4 SDK Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_memory_layout/0_layout_index.html">0.5 Flash &amp; RAM Layout</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_user_config/0_usrcfg_index.html">0.6 User Config</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_tools/0_tools_index.html">0.7 Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_at_command/0_at_command_index.html">0.8 AT Command</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_file_system/0_vfs_index.html">0.9 Virtual File System</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1_mpu_cache/0_mpu_cache_index.html">1.0 MPU and Cache</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1_boot_process/0_boot_index.html">1.1 BOOT Process</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1_ota/0_ota_index.html">1.2 OTA</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1_otpc/0_otpc_index.html">1.3 OTPC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1_chipen/0_chipen_index.html">1.4 CHIPEN</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1_ipc/0_ipc_index.html">1.5 Inter Processor Communication</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1_pinmux/0_pinmux_index.html">1.6 PINMUX</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1_gpio/0_gpio_index.html">1.7 GPIO</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1_power_save/0_ps_index.html">1.9 Power Save</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2_whc_wifi_bridge/0_wifi_bridge_index.html">2.1 WHC Bridge</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2_whc_fullmac/0_fullmac_index.html">2.2 WHC FullMAC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2_wifi_tunnel/0_wifi_tunnel_index.html">2.3 Wi-Fi R-Mesh</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2_wifi_csi/0_wifi_csi_index.html">2.5 Wi-Fi CSI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2_wifi_adaptivity_test/0_wifi_adaptivity_index.html">2.6 Wi-Fi Adaptivity Test</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_security/0_security_index.html">3.1 Security &amp; Encryption</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_trng/0_trng_index.html">3.2 True Random Number Generator</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_nda_huk_derivation/0_huk_derivation_index_nda.html">3.3 HUK Derivation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_nda_rdp/0_rdp_index_nda.html">3.4 RDP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_nda_rsip/0_rsip_index_nda.html">3.5 RSIP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_nda_secure_boot/0_secure_boot_index_nda.html">3.6 Secure Boot</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_nda_swd_protection/0_swd_protection_index_nda.html">3.7 SWD Protection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_nda_tfm/0_tfm_index_nda.html">3.8 Trusted Firmware-M (TF-M)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_crypto_engine/0_crypto_engine_index.html">3.9 Crypto Engine</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_ecdsa_engine/0_ecdsa_index.html">3.a ECDSA Engine</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_eddsa_engine/0_eddsa_index.html">3.b EDDSA Engine</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_rsa_engine/0_rsa_index.html">3.c RSA Engine</a></li>
<li class="toctree-l1"><a class="reference internal" href="../4_ai/0_ai_index.html">4.1 AI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../4_ai_voice/0_ai_voice_index.html">4.2 AIVoice</a></li>
<li class="toctree-l1"><a class="reference internal" href="../4_multimedia/0_multimedia_index.html">4.3 Multimedia</a></li>
<li class="toctree-l1"><a class="reference internal" href="../4_dsp/0_dsp_index.html">4.4 DSP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../6_mass_production/0_mp_index.html">6.1 Mass Production</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="0_mp_image_index.html">6.2 MP Image</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="#how-to-build-mp-image">How to Build MP Image</a></li>
<li class="toctree-l2"><a class="reference internal" href="#how-to-combine-images">How to Combine Images</a></li>
<li class="toctree-l2"><a class="reference internal" href="#boot-flow">Boot Flow</a></li>
<li class="toctree-l2"><a class="reference internal" href="#how-to-switch-image">How to Switch Image</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../6_mptools/0_mptools_index.html">6.3 MP Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../7_usb/0_usb_index.html">7.1 USB Host &amp; Device</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_dmac/0_dmac_index.html">8.1 DMA Controllor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_psram/0_psram_index.html">8.2 PSRAM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_thermal/0_thermal_index.html">8.3 Thermal Meter</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_adc/0_adc_index.html">8.4 ADC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_ir/0_ir_index.html">8.5 IR</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_ledc/0_ledc_index.html">8.6 LEDC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_cap_touch/0_cap_touch_index.html">8.7 Cap-Touch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_key_scan/0_key_scan_index.html">8.8 Key-Scan</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_rtc_io/0_rtc_io_index.html">8.9 RTC-IO</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_lcdc/0_lcdc_index.html">8.A LCDC</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Ameba IoT Docs</a>
      </nav>

      <div class="wy-nav-content">

        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="0_mp_image_index.html">MP Image</a></li>
      <li class="breadcrumb-item active">Introduction</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <span class="target" id="mp-image"></span><!-- 下拉菜单 -->
<div style="margin: 20px 0; text-align: left;">
    <div style="display: flex; align-items: center; gap: 10px;">
        <span style="font-size: 14px;">IC: </span>
        <select class="tab-selector" style="height: 22px; padding: 2px 8px; font-size: 13px;">
            <option value="RTL8721Dx">RTL8721Dx</option>
            <option value="RTL8720E">RTL8720E</option>
            <option value="RTL8726E">RTL8726E</option>
            <option value="RTL8730E">RTL8730E</option>
        </select>
    </div>
</div>

<!-- 修复后的 JavaScript -->
<script>
document.addEventListener("DOMContentLoaded", function() {
    const selector = document.querySelector('.tab-selector');

    selector.addEventListener('change', function() {
        const targetTab = this.value;
        const tabs = document.querySelectorAll('.sphinx-tabs-tab');
        let found = false;

        tabs.forEach(tab => {
            const tabText = tab.textContent.trim();
            if (tabText === targetTab) {
                tab.click();
                window.dispatchEvent(new Event('resize')); // 触发插件更新
                found = true;
            }
        });

        if (!found) {
            console.error("未找到选项卡:", targetTab);
        }
    });
});
</script><section id="introduction">
<h1>Introduction<a class="headerlink" href="#introduction" title="Link to this heading"></a></h1>
<p>The MP image is used for Wi-Fi &amp; BT performance verification and Wi-Fi &amp; BT parameters calibration in massive production. This chapter mainly illustrates how to build and use the MP image.</p>
<p>Refer to the MP document for more details about MP flow.</p>
</section>
<section id="how-to-build-mp-image">
<span id="id1"></span><h1>How to Build MP Image<a class="headerlink" href="#how-to-build-mp-image" title="Link to this heading"></a></h1>
<p>The steps of building MP image are depcited below:</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-0-0-0" aria-selected="true" class="sphinx-tabs-tab" id="tab-0-0-0" name="0-0" role="tab" tabindex="0">RTL8721Dx</button><button aria-controls="panel-0-0-1" aria-selected="false" class="sphinx-tabs-tab" id="tab-0-0-1" name="0-1" role="tab" tabindex="-1">RTL8720E</button><button aria-controls="panel-0-0-2" aria-selected="false" class="sphinx-tabs-tab" id="tab-0-0-2" name="0-2" role="tab" tabindex="-1">RTL8726E</button><button aria-controls="panel-0-0-3" aria-selected="false" class="sphinx-tabs-tab" id="tab-0-0-3" name="0-3" role="tab" tabindex="-1">RTL8730E</button></div><div aria-labelledby="tab-0-0-0" class="sphinx-tabs-panel" id="panel-0-0-0" name="0-0" role="tabpanel" tabindex="0"><ol class="arabic">
<li><p>Navigate to work directory <code class="docutils literal notranslate"><span class="pre">{SDK}\amebadplus_gcc_project</span></code>.</p></li>
<li><p>Use command <code class="docutils literal notranslate"><span class="pre">./menuconfig.py</span></code> to modify the configurations.</p>
<ol class="loweralpha">
<li><p>Enable MP</p>
<figure class="align-center">
<a class="reference internal image-reference" href="../../_images/enable_mp_dplus.svg"><img alt="../../_images/enable_mp_dplus.svg" height="99" src="../../_images/enable_mp_dplus.svg" width="755" /></a>
</figure>
</li>
<li><p>Enable Wi-Fi, and configure KM4 as AP core and KM0 as NP core.</p>
<figure class="align-center">
<a class="reference internal image-reference" href="../../_images/enable_wifi_dplus.svg"><img alt="../../_images/enable_wifi_dplus.svg" height="76" src="../../_images/enable_wifi_dplus.svg" width="755" /></a>
</figure>
</li>
<li><p>Enable BT.</p>
<figure class="align-center">
<a class="reference internal image-reference" href="../../_images/enable_bt_dplus.svg"><img alt="../../_images/enable_bt_dplus.svg" height="61" src="../../_images/enable_bt_dplus.svg" width="568" /></a>
</figure>
</li>
<li><p>Save and exit the menuconfig.</p></li>
</ol>
</li>
<li><p>Use command <code class="docutils literal notranslate"><span class="pre">./build.py</span></code> to rebuild the projects of KM0 and KM4.</p></li>
</ol>
<p>The MP image <code class="docutils literal notranslate"><span class="pre">km0_km4_app_mp.bin</span></code> will be generated in <code class="docutils literal notranslate"><span class="pre">{SDK}\amebadplus_gcc_project</span></code> and all the images releated to the MP image can be found in the paths below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="n">SDK</span><span class="p">}</span>\<span class="n">amebadplus_gcc_project</span>\<span class="n">project_km4</span>\<span class="n">asdk</span>\<span class="n">image_mp</span>
<span class="p">{</span><span class="n">SDK</span><span class="p">}</span>\<span class="n">amebadplus_gcc_project</span>\<span class="n">project_km0</span>\<span class="n">asdk</span>\<span class="n">image_mp</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-0-0-1" class="sphinx-tabs-panel" hidden="true" id="panel-0-0-1" name="0-1" role="tabpanel" tabindex="0"><ol class="arabic">
<li><p>Navigate to work directory <code class="docutils literal notranslate"><span class="pre">{SDK}\amebalite_gcc_project</span></code>.</p></li>
<li><p>Use command <code class="docutils literal notranslate"><span class="pre">./menuconfig.py</span></code> to modify the configurations.</p>
<ol class="loweralpha">
<li><p>Enable MP</p>
<figure class="align-center">
<a class="reference internal image-reference" href="../../_images/enable_mp_lite.svg"><img alt="../../_images/enable_mp_lite.svg" height="75" src="../../_images/enable_mp_lite.svg" width="537" /></a>
</figure>
</li>
<li><p>Enable Wi-Fi, and configure KM4 as AP core and KR4 as NP core.</p>
<figure class="align-center">
<a class="reference internal image-reference" href="../../_images/enable_wifi_lite.svg"><img alt="../../_images/enable_wifi_lite.svg" height="42" src="../../_images/enable_wifi_lite.svg" width="580" /></a>
</figure>
</li>
<li><p>Enable BT, and configure KM4 as AP core and KR4 as NP core.</p>
<figure class="align-center">
<a class="reference internal image-reference" href="../../_images/enable_bt_lite.svg"><img alt="../../_images/enable_bt_lite.svg" height="67" src="../../_images/enable_bt_lite.svg" width="624" /></a>
</figure>
</li>
<li><p>Save and exit the menuconfig.</p></li>
</ol>
</li>
<li><p>Use command <code class="docutils literal notranslate"><span class="pre">./build.py</span></code> to rebuild project of KR4 and KM4.</p></li>
</ol>
<p>The MP image <code class="file docutils literal notranslate"><span class="pre">kr4_km4_app_mp.bin</span></code> will be generated in <code class="docutils literal notranslate"><span class="pre">{SDK}\amebalite_gcc_project</span></code> and all the images related to the MP image can be found in the paths below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="n">SDK</span><span class="p">}</span>\<span class="n">amebalite_gcc_project</span>\<span class="n">project_km4</span>\<span class="n">asdk</span>\<span class="n">image_mp</span>
<span class="p">{</span><span class="n">SDK</span><span class="p">}</span>\<span class="n">amebalite_gcc_project</span>\<span class="n">project_kr4</span>\<span class="n">asdk</span>\<span class="n">image_mp</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-0-0-2" class="sphinx-tabs-panel" hidden="true" id="panel-0-0-2" name="0-2" role="tabpanel" tabindex="0"><ol class="arabic">
<li><p>Navigate to work directory <code class="docutils literal notranslate"><span class="pre">{SDK}\amebalite_gcc_project</span></code>.</p></li>
<li><p>Use command <code class="docutils literal notranslate"><span class="pre">./menuconfig.py</span></code> to modify the configurations.</p>
<ol class="loweralpha">
<li><p>Enable MP</p>
<figure class="align-center">
<a class="reference internal image-reference" href="../../_images/enable_mp_lite.svg"><img alt="../../_images/enable_mp_lite.svg" height="75" src="../../_images/enable_mp_lite.svg" width="537" /></a>
</figure>
</li>
<li><p>Enable Wi-Fi, and configure KM4 as AP core and KR4 as NP core.</p>
<figure class="align-center">
<a class="reference internal image-reference" href="../../_images/enable_wifi_lite.svg"><img alt="../../_images/enable_wifi_lite.svg" height="42" src="../../_images/enable_wifi_lite.svg" width="580" /></a>
</figure>
</li>
<li><p>Enable BT, and configure KM4 as AP core and KR4 as NP core.</p>
<figure class="align-center">
<a class="reference internal image-reference" href="../../_images/enable_bt_lite.svg"><img alt="../../_images/enable_bt_lite.svg" height="67" src="../../_images/enable_bt_lite.svg" width="624" /></a>
</figure>
</li>
<li><p>Save and exit the menuconfig.</p></li>
</ol>
</li>
<li><p>Use command <code class="docutils literal notranslate"><span class="pre">./build.py</span></code> to rebuild project of KR4 and KM4.</p></li>
</ol>
<p>The MP image <code class="file docutils literal notranslate"><span class="pre">kr4_km4_dsp_app_mp.bin</span></code> will be generated in <code class="docutils literal notranslate"><span class="pre">{SDK}\amebalite_gcc_project</span></code> and all the images related to the MP image can be found in the paths below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="n">SDK</span><span class="p">}</span>\<span class="n">amebalite_gcc_project</span>\<span class="n">project_km4</span>\<span class="n">asdk</span>\<span class="n">image_mp</span>
<span class="p">{</span><span class="n">SDK</span><span class="p">}</span>\<span class="n">amebalite_gcc_project</span>\<span class="n">project_kr4</span>\<span class="n">asdk</span>\<span class="n">image_mp</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For details of mergeing DSP image into application image, refer to <a class="reference internal" href="../1_ota/1_ota_toprst.html#ota-firmware-update"><span class="std std-ref">OTA Firmware Update</span></a>.</p>
</div>
</div><div aria-labelledby="tab-0-0-3" class="sphinx-tabs-panel" hidden="true" id="panel-0-0-3" name="0-3" role="tabpanel" tabindex="0"><ol class="arabic">
<li><p>Navigate to work directory <code class="docutils literal notranslate"><span class="pre">{SDK}\amebasmart_gcc_project</span></code>.</p></li>
<li><p>Type command <code class="docutils literal notranslate"><span class="pre">./menuconfig.py</span></code> to modify the configurations.</p>
<ol class="loweralpha">
<li><p>Enable MP</p>
<figure class="align-center">
<a class="reference internal image-reference" href="../../_images/enable_mp_smart.svg"><img alt="../../_images/enable_mp_smart.svg" height="75" src="../../_images/enable_mp_smart.svg" width="747" /></a>
</figure>
</li>
<li><p>Enable Wi-Fi, and configure CA32 as AP core and KM4 as NP core.</p>
<figure class="align-center">
<a class="reference internal image-reference" href="../../_images/enable_wifi_smart.svg"><img alt="../../_images/enable_wifi_smart.svg" height="70" src="../../_images/enable_wifi_smart.svg" width="736" /></a>
</figure>
</li>
<li><p>Enable BT, and configure CA32 as AP core and KM4 as NP core.</p>
<figure class="align-center">
<a class="reference internal image-reference" href="../../_images/enable_bt_smart.svg"><img alt="../../_images/enable_bt_smart.svg" height="70" src="../../_images/enable_bt_smart.svg" width="743" /></a>
</figure>
</li>
<li><p>Save and exit the menuconfig.</p></li>
</ol>
</li>
<li><p>Type command <code class="docutils literal notranslate"><span class="pre">./build.py</span></code> to rebuild all projects.</p></li>
</ol>
<p>The MP image <code class="docutils literal notranslate"><span class="pre">km0_km4_ca32_app_mp.bin</span></code> will be generated in <code class="docutils literal notranslate"><span class="pre">{SDK}\amebasmart_gcc_project</span></code> and all the images releated to the MP image can be found in the paths below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="n">SDK</span><span class="p">}</span>\<span class="n">amebasmart_gcc_project</span>\<span class="n">project_lp</span>\<span class="n">asdk</span>\<span class="n">image_mp</span>
<span class="p">{</span><span class="n">SDK</span><span class="p">}</span>\<span class="n">amebasmart_gcc_project</span>\<span class="n">project_hp</span>\<span class="n">asdk</span>\<span class="n">image_mp</span>
<span class="p">{</span><span class="n">SDK</span><span class="p">}</span>\<span class="n">amebasmart_gcc_project</span>\<span class="n">project_ap</span>\<span class="n">asdk</span>\<span class="n">image_mp</span>
</pre></div>
</div>
</div></div>
</section>
<section id="how-to-combine-images">
<span id="id2"></span><h1>How to Combine Images<a class="headerlink" href="#how-to-combine-images" title="Link to this heading"></a></h1>
<p>Before downloading images into the chip, the MP image needs to be combined with normal image. In massive production, the MP image is used to calibrate the parameters first. After calibration, you can use the command illustrated in <a class="reference internal" href="#how-to-switch-image"><span class="std std-ref">How to Switch Image</span></a> to switch to the normal image and boot from it. Since the chip boots from OTA1 by default when both OTA1 and OTA2 images are valid and with the same version number, the MP image should be located in the OTA1 field.</p>
<p>The steps of combining images are depcited below:</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-1-1-0" aria-selected="true" class="sphinx-tabs-tab" id="tab-1-1-0" name="1-0" role="tab" tabindex="0">RTL8721Dx</button><button aria-controls="panel-1-1-1" aria-selected="false" class="sphinx-tabs-tab" id="tab-1-1-1" name="1-1" role="tab" tabindex="-1">RTL8720E</button><button aria-controls="panel-1-1-2" aria-selected="false" class="sphinx-tabs-tab" id="tab-1-1-2" name="1-2" role="tab" tabindex="-1">RTL8726E</button><button aria-controls="panel-1-1-3" aria-selected="false" class="sphinx-tabs-tab" id="tab-1-1-3" name="1-3" role="tab" tabindex="-1">RTL8730E</button></div><div aria-labelledby="tab-1-1-0" class="sphinx-tabs-panel" id="panel-1-1-0" name="1-0" role="tabpanel" tabindex="0"><ol class="arabic">
<li><p>Check if both the normal image and MP image are valid.</p></li>
<li><p>Use the <code class="docutils literal notranslate"><span class="pre">Ameba_1-10_MP_ImageTool_Linux</span></code> to combine all the images, including <code class="docutils literal notranslate"><span class="pre">km4_boot_all.bin</span></code>, <code class="docutils literal notranslate"><span class="pre">km0_km4_app_mp.bin</span></code> and <code class="docutils literal notranslate"><span class="pre">km0_km4_app.bin</span></code>, which are located in <code class="docutils literal notranslate"><span class="pre">{SDK}\amebadplus_gcc_project</span></code>.</p>
<blockquote>
<div><ol class="loweralpha">
<li><p>Set the highlight image offsets according to the Flash layout, which can be found in <code class="docutils literal notranslate"><span class="pre">{SDK}\component\soc\amebadplus\usrcfg\ameba_flashcfg.c</span></code>.</p>
<blockquote>
<div><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cm">/*</span>

<span class="cm">* @brif Flash layout is set according to Flash Layout in User Manual</span>
<span class="cm">*  In each entry, the first item is flash regoin type, the second item is start address, the second item is end address */</span>

<span class="hll"><span class="k">const</span><span class="w"> </span><span class="n">FlashLayoutInfo_TypeDef</span><span class="w"> </span><span class="n">Flash_Layout</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span class="w">    </span><span class="cm">/*Region_Type,      [StartAddr,     EndAddr]                */</span>
<span class="hll"><span class="w">    </span><span class="p">{</span><span class="n">IMG_BOOT</span><span class="p">,</span><span class="w">          </span><span class="mh">0x08000000</span><span class="p">,</span><span class="w"> </span><span class="mh">0x08013FFF</span><span class="p">},</span><span class="w"> </span><span class="c1">//Boot Manifest(4K) + KM4 Bootloader(76K)</span>
</span><span class="w">    </span><span class="c1">//Users should modify below according to their own memory</span>
<span class="w">    </span><span class="p">{</span><span class="n">IMG_APP_OTA1</span><span class="p">,</span><span class="w"> </span><span class="mh">0x08014000</span><span class="p">,</span><span class="w"> </span><span class="mh">0x081F3FFF</span><span class="p">},</span><span class="w"> </span><span class="c1">//Certificate(4K) + Manifest(4K) + KM4 Application OTA1 + Manifest(4K) + RDP IMG OTA1</span>
<span class="hll">
</span><span class="w">    </span><span class="p">{</span><span class="n">IMG_BOOT_OTA2</span><span class="p">,</span><span class="w"> </span><span class="mh">0x08200000</span><span class="p">,</span><span class="w"> </span><span class="mh">0x08213FFF</span><span class="p">},</span><span class="w"> </span><span class="c1">//Boot Manifest(4K) + KM4 Bootloader(76K) OTA</span>
<span class="w">    </span><span class="p">{</span><span class="n">IMG_APP_OTA2</span><span class="p">,</span><span class="w"> </span><span class="mh">0x08214000</span><span class="p">,</span><span class="w"> </span><span class="mh">0x083F3FFF</span><span class="p">},</span><span class="w"> </span><span class="c1">//Certificate(4K) + Manifest(4K) + KM4 Application OTA2 + Manifest(4K) + RDP IMG OTA2</span>

<span class="w">    </span><span class="p">{</span><span class="n">FTL</span><span class="p">,</span><span class="w">                       </span><span class="mh">0x08700000</span><span class="p">,</span><span class="w"> </span><span class="mh">0x08702FFF</span><span class="p">},</span><span class="w"> </span><span class="c1">//FTL for BT(&gt;=12K), The start offset of flash pages which is allocated to FTL physical map.</span>
<span class="w">    </span><span class="p">{</span><span class="n">VFS1</span><span class="p">,</span><span class="w">                      </span><span class="mh">0x08703000</span><span class="p">,</span><span class="w"> </span><span class="mh">0x08722FFF</span><span class="p">},</span><span class="w"> </span><span class="c1">//VFS region 1 (128K)</span>
<span class="w">    </span><span class="p">{</span><span class="n">USER</span><span class="p">,</span><span class="w">                      </span><span class="mh">0xFFFFFFFF</span><span class="p">,</span><span class="w"> </span><span class="mh">0xFFFFFFFF</span><span class="p">},</span><span class="w"> </span><span class="c1">//reserve for user</span>

<span class="w">    </span><span class="cm">/* End */</span>
<span class="w">    </span><span class="p">{</span><span class="mh">0xFF</span><span class="p">,</span><span class="w">                      </span><span class="mh">0xFFFFFFFF</span><span class="p">,</span><span class="w"> </span><span class="mh">0xFFFFFFFF</span><span class="p">},</span>
<span class="p">};</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Set <code class="docutils literal notranslate"><span class="pre">km0_km4_app_mp.bin</span></code> in <code class="docutils literal notranslate"><span class="pre">IMG_APP_OTA1</span></code> section</p></li>
<li><p>Set <code class="docutils literal notranslate"><span class="pre">km0_km4_app.bin</span></code> in <code class="docutils literal notranslate"><span class="pre">IMG_APP_OTA2</span></code> section</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Execute the command and save the combined image named <code class="docutils literal notranslate"><span class="pre">Image_All.bin</span></code>.</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="o">./</span><span class="n">Ameba_1</span><span class="o">-</span><span class="mi">10</span><span class="n">_MP_ImageTool_Linux</span> <span class="o">-</span><span class="n">combine</span> <span class="n">km4_boot_all</span><span class="o">.</span><span class="n">bin</span> <span class="mh">0x0000</span> <span class="n">km0_km4_app_mp</span><span class="o">.</span><span class="n">bin</span> <span class="mh">0x14000</span> <span class="n">km0_km4_app</span><span class="o">.</span><span class="n">bin</span> <span class="mh">0x214000</span>
</pre></div>
</div>
</div></blockquote>
</li>
</ol>
</div></blockquote>
</li>
<li><p>Download the <code class="docutils literal notranslate"><span class="pre">Image_All.bin</span></code> into the device after the combination is finished.</p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The normal image <code class="docutils literal notranslate"><span class="pre">km0_km4_app.bin</span></code> is built with MP disabled. Check the normal image in <code class="docutils literal notranslate"><span class="pre">{SDK}\amebadplus_gcc_project</span></code>. All the images related to normal image can be found in paths below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="n">SDK</span><span class="p">}</span>\<span class="n">amebadplus_gcc_project</span>\<span class="n">project_km4</span>\<span class="n">asdk</span>\<span class="n">image</span>
<span class="p">{</span><span class="n">SDK</span><span class="p">}</span>\<span class="n">amebadplus_gcc_project</span>\<span class="n">project_km0</span>\<span class="n">asdk</span>\<span class="n">image</span>
</pre></div>
</div>
</div>
</div><div aria-labelledby="tab-1-1-1" class="sphinx-tabs-panel" hidden="true" id="panel-1-1-1" name="1-1" role="tabpanel" tabindex="0"><ol class="arabic">
<li><p>Check if both the normal image and MP image are valid.</p></li>
<li><p>Use ImageTool to combine all the images, including <code class="file docutils literal notranslate"><span class="pre">km4_boot_all.bin</span></code>, <code class="file docutils literal notranslate"><span class="pre">kr4_km4_app_mp.bin</span></code> and <code class="file docutils literal notranslate"><span class="pre">kr4_km4_app.bin</span></code>, which are generated in <code class="docutils literal notranslate"><span class="pre">{SDK}\amebalite_gcc_project</span></code>.</p>
<ol class="loweralpha">
<li><p>Set the image offsets in Image Tool according to the Flash layout, which can be found in <code class="docutils literal notranslate"><span class="pre">{SDK}\component\soc\amebalite\</span> <span class="pre">usrcfg\ameba_flashcfg.c</span></code>.</p>
<ul class="simple">
<li><p>Set kr4_km4_app_mp.bin in <code class="docutils literal notranslate"><span class="pre">IMG_APP_OTA1</span></code> section.</p></li>
<li><p>Set kr4_km4_app.bin in <code class="docutils literal notranslate"><span class="pre">IMG_APP_OTA2</span></code> section.</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">FlashLayoutInfo_TypeDef</span> <span class="n">Flash_Layout</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
<span class="o">/*</span><span class="n">Region_Type</span><span class="p">,</span>      <span class="p">[</span><span class="n">StartAddr</span><span class="p">,</span>     <span class="n">EndAddr</span><span class="p">]</span> <span class="o">*/</span>
<span class="hll"><span class="p">{</span><span class="n">IMG_BOOT</span><span class="p">,</span>          <span class="mh">0x08000000</span><span class="p">,</span>     <span class="mh">0x08013FFF</span><span class="p">},</span>    <span class="o">//</span><span class="n">Boot</span> <span class="n">Manifest</span><span class="p">(</span><span class="mi">4</span><span class="n">K</span><span class="p">)</span> <span class="o">+</span> <span class="n">KM4</span> <span class="n">Bootloader</span><span class="p">(</span><span class="mi">76</span><span class="n">K</span><span class="p">)</span>
</span><span class="o">//</span><span class="n">Users</span> <span class="n">should</span> <span class="n">modify</span> <span class="n">below</span> <span class="n">according</span> <span class="n">to</span> <span class="n">their</span> <span class="n">own</span> <span class="n">memory</span>
<span class="hll"><span class="p">{</span><span class="n">IMG_APP_OTA1</span><span class="p">,</span>      <span class="mh">0x08014000</span><span class="p">,</span>     <span class="mh">0x08093FFF</span><span class="p">},</span>    <span class="o">//</span><span class="n">Certificate</span><span class="p">(</span><span class="mi">4</span><span class="n">K</span><span class="p">)</span> <span class="o">+</span> <span class="n">Manifest</span><span class="p">(</span><span class="mi">4</span><span class="n">K</span><span class="p">)</span> <span class="o">+</span> <span class="n">KM4</span> <span class="n">Application</span> <span class="n">OTA1</span>
</span><span class="p">{</span><span class="n">IMG_KR4_OTA1</span><span class="p">,</span>      <span class="mh">0x8094000</span><span class="p">,</span>      <span class="mh">0x081F3FFF</span><span class="p">},</span>    <span class="o">//</span><span class="n">Manifest</span><span class="p">(</span><span class="mi">4</span><span class="n">K</span><span class="p">)</span> <span class="o">+</span> <span class="n">KR4</span> <span class="n">Application</span> <span class="n">OTA1</span>

<span class="o">//</span><span class="p">{</span><span class="n">IMG_BOOT_OTA2</span><span class="p">,</span>   <span class="mh">0x08200000</span><span class="p">,</span>     <span class="mh">0x08213FFF</span><span class="p">},</span>    <span class="o">//</span><span class="n">Boot</span> <span class="n">Manifest</span><span class="p">(</span><span class="mi">4</span><span class="n">K</span><span class="p">)</span> <span class="o">+</span> <span class="n">KM4</span> <span class="n">Bootloader</span><span class="p">(</span><span class="mi">76</span><span class="n">K</span><span class="p">)</span> <span class="n">OTA2</span>
<span class="hll"><span class="p">{</span><span class="n">IMG_APP_OTA2</span><span class="p">,</span>      <span class="mh">0x08214000</span><span class="p">,</span>     <span class="mh">0x08293FFF</span><span class="p">},</span>    <span class="o">//</span><span class="n">Certificate</span><span class="p">(</span><span class="mi">4</span><span class="n">K</span><span class="p">)</span> <span class="o">+</span> <span class="n">Manifest</span><span class="p">(</span><span class="mi">4</span><span class="n">K</span><span class="p">)</span> <span class="o">+</span> <span class="n">KM4</span> <span class="n">Application</span> <span class="n">OTA2</span>
</span><span class="p">{</span><span class="n">IMG_KR4_OTA2</span><span class="p">,</span>      <span class="mh">0x08294000</span><span class="p">,</span>     <span class="mh">0x083F3FFF</span><span class="p">},</span>    <span class="o">//</span><span class="n">Manifest</span><span class="p">(</span><span class="mi">4</span><span class="n">K</span><span class="p">)</span> <span class="o">+</span> <span class="n">KR4</span> <span class="n">Application</span> <span class="n">OTA1</span>

<span class="p">{</span><span class="n">FTL</span><span class="p">,</span>                       <span class="mh">0x08700000</span><span class="p">,</span> <span class="mh">0x08702FFF</span><span class="p">},</span> <span class="o">//</span><span class="n">FTL</span> <span class="k">for</span> <span class="n">BT</span><span class="p">(</span><span class="o">&gt;=</span><span class="mi">12</span><span class="n">K</span><span class="p">),</span> <span class="n">The</span> <span class="n">start</span> <span class="n">offset</span> <span class="n">of</span> <span class="n">flash</span> <span class="n">pages</span> <span class="n">which</span> <span class="ow">is</span> <span class="n">allocated</span> <span class="n">to</span> <span class="n">FTL</span> <span class="n">physical</span> <span class="nb">map</span><span class="o">.</span>
<span class="p">{</span><span class="n">VFS1</span><span class="p">,</span>                      <span class="mh">0x08703000</span><span class="p">,</span> <span class="mh">0x08722FFF</span><span class="p">},</span> <span class="o">//</span><span class="n">VFS</span> <span class="n">region</span> <span class="mi">1</span> <span class="p">(</span><span class="mi">128</span><span class="n">K</span><span class="p">)</span>
<span class="p">{</span><span class="n">VFS2</span><span class="p">,</span>                      <span class="mh">0xFFFFFFFF</span><span class="p">,</span> <span class="mh">0xFFFFFFFF</span><span class="p">},</span> <span class="o">//</span><span class="n">VFS</span> <span class="n">region</span> <span class="mi">2</span>
<span class="p">{</span><span class="n">USER</span><span class="p">,</span>                      <span class="mh">0xFFFFFFFF</span><span class="p">,</span> <span class="mh">0xFFFFFFFF</span><span class="p">},</span> <span class="o">//</span><span class="n">reserve</span> <span class="k">for</span> <span class="n">user</span>

<span class="o">/*</span> <span class="n">End</span> <span class="o">*/</span>
<span class="p">{</span><span class="mh">0xFF</span><span class="p">,</span>                      <span class="mh">0xFFFFFFFF</span><span class="p">,</span> <span class="mh">0xFFFFFFFF</span><span class="p">},</span>
<span class="p">};</span>
</pre></div>
</div>
</li>
<li><p>Click <span class="guilabel">Generate</span> button in Image Tool, and save the combined image named <code class="file docutils literal notranslate"><span class="pre">Image_All.bin</span></code>.</p>
<figure class="align-center">
<a class="reference internal image-reference" href="../../_images/mp_generate_image_lite_20E.svg"><img alt="../../_images/mp_generate_image_lite_20E.svg" height="517" src="../../_images/mp_generate_image_lite_20E.svg" width="893" /></a>
</figure>
</li>
</ol>
</li>
<li><p>Download the <code class="file docutils literal notranslate"><span class="pre">Image_All.bin</span></code> into the device after the combination is finished.</p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The normal image <code class="file docutils literal notranslate"><span class="pre">kr4_km4_app.bin</span></code> is built with MP disabled. Check the normal image in <code class="docutils literal notranslate"><span class="pre">{SDK}\amebalite_gcc_project</span></code>. All the images related to normal image can be found in paths below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="n">SDK</span><span class="p">}</span>\<span class="n">amebalite_gcc_project</span>\<span class="n">project_km4</span>\<span class="n">asdk</span>\<span class="n">image</span><span class="o">.</span>
<span class="p">{</span><span class="n">SDK</span><span class="p">}</span>\<span class="n">amebalite_gcc_project</span>\<span class="n">project_kr4</span>\<span class="n">asdk</span>\<span class="n">image</span><span class="o">.</span>
</pre></div>
</div>
</div>
</div><div aria-labelledby="tab-1-1-2" class="sphinx-tabs-panel" hidden="true" id="panel-1-1-2" name="1-2" role="tabpanel" tabindex="0"><ol class="arabic">
<li><p>Check if both the normal image and MP image are valid.</p></li>
<li><p>Use ImageTool to combine all the images, including <code class="file docutils literal notranslate"><span class="pre">km4_boot_all.bin</span></code>, <code class="file docutils literal notranslate"><span class="pre">kr4_km4_dsp_app_mp.bin</span></code> and <code class="file docutils literal notranslate"><span class="pre">kr4_km4_dsp_app.bin</span></code>, which are generated in <code class="docutils literal notranslate"><span class="pre">{SDK}\amebalite_gcc_project</span></code>.</p>
<blockquote>
<div><ol class="loweralpha">
<li><p>Set the image offsets in Image Tool according to the Flash layout, which can be found in <code class="docutils literal notranslate"><span class="pre">{SDK}\component\soc\amebalite\</span> <span class="pre">usrcfg\ameba_flashcfg.c</span></code>.</p>
<blockquote>
<div><ul class="simple">
<li><p>Set kr4_km4_dsp_app_mp.bin in <code class="docutils literal notranslate"><span class="pre">IMG_APP_OTA1</span></code> section.</p></li>
<li><p>Set kr4_km4_dsp_app.bin in <code class="docutils literal notranslate"><span class="pre">IMG_APP_OTA2</span></code> section.</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">FlashLayoutInfo_TypeDef</span> <span class="n">Flash_Layout</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
<span class="o">/*</span><span class="n">Region_Type</span><span class="p">,</span>   <span class="p">[</span><span class="n">StartAddr</span><span class="p">,</span>     <span class="n">EndAddr</span><span class="p">]</span> <span class="o">*/</span>
<span class="hll"><span class="p">{</span><span class="n">IMG_BOOT</span><span class="p">,</span>               <span class="mh">0x08000000</span><span class="p">,</span>     <span class="mh">0x08013FFF</span><span class="p">},</span>    <span class="o">//</span><span class="n">Boot</span> <span class="n">Manifest</span><span class="p">(</span><span class="mi">4</span><span class="n">K</span><span class="p">)</span> <span class="o">+</span> <span class="n">KM4</span> <span class="n">Bootloader</span><span class="p">(</span><span class="mi">76</span><span class="n">K</span><span class="p">)</span>
</span><span class="o">//</span><span class="n">Users</span> <span class="n">should</span> <span class="n">modify</span> <span class="n">below</span> <span class="n">according</span> <span class="n">to</span> <span class="n">their</span> <span class="n">own</span> <span class="n">memory</span>
<span class="hll"><span class="p">{</span><span class="n">IMG_APP_OTA1</span><span class="p">,</span>   <span class="mh">0x08014000</span><span class="p">,</span>     <span class="mh">0x08093FFF</span><span class="p">},</span>    <span class="o">//</span><span class="n">Certificate</span><span class="p">(</span><span class="mi">4</span><span class="n">K</span><span class="p">)</span> <span class="o">+</span> <span class="n">Manifest</span><span class="p">(</span><span class="mi">4</span><span class="n">K</span><span class="p">)</span> <span class="o">+</span> <span class="n">KM4</span> <span class="n">Application</span> <span class="n">OTA1</span>
</span><span class="p">{</span><span class="n">IMG_KR4_OTA1</span><span class="p">,</span>   <span class="mh">0x8094000</span><span class="p">,</span>      <span class="mh">0x081F3FFF</span><span class="p">},</span>    <span class="o">//</span><span class="n">Manifest</span><span class="p">(</span><span class="mi">4</span><span class="n">K</span><span class="p">)</span> <span class="o">+</span> <span class="n">KR4</span> <span class="n">Application</span> <span class="n">OTA1</span>

<span class="o">//</span><span class="p">{</span><span class="n">IMG_BOOT_OTA2</span><span class="p">,</span>        <span class="mh">0x08200000</span><span class="p">,</span>     <span class="mh">0x08213FFF</span><span class="p">},</span>    <span class="o">//</span><span class="n">Boot</span> <span class="n">Manifest</span><span class="p">(</span><span class="mi">4</span><span class="n">K</span><span class="p">)</span> <span class="o">+</span> <span class="n">KM4</span> <span class="n">Bootloader</span><span class="p">(</span><span class="mi">76</span><span class="n">K</span><span class="p">)</span> <span class="n">OTA2</span>
<span class="hll"><span class="p">{</span><span class="n">IMG_APP_OTA2</span><span class="p">,</span>   <span class="mh">0x08214000</span><span class="p">,</span>     <span class="mh">0x08293FFF</span><span class="p">},</span>    <span class="o">//</span><span class="n">Certificate</span><span class="p">(</span><span class="mi">4</span><span class="n">K</span><span class="p">)</span> <span class="o">+</span> <span class="n">Manifest</span><span class="p">(</span><span class="mi">4</span><span class="n">K</span><span class="p">)</span> <span class="o">+</span> <span class="n">KM4</span> <span class="n">Application</span> <span class="n">OTA2</span>
</span><span class="p">{</span><span class="n">IMG_KR4_OTA2</span><span class="p">,</span>   <span class="mh">0x08294000</span><span class="p">,</span>     <span class="mh">0x083F3FFF</span><span class="p">},</span>    <span class="o">//</span><span class="n">Manifest</span><span class="p">(</span><span class="mi">4</span><span class="n">K</span><span class="p">)</span> <span class="o">+</span> <span class="n">KR4</span> <span class="n">Application</span> <span class="n">OTA1</span>

<span class="p">{</span><span class="n">FTL</span><span class="p">,</span>                    <span class="mh">0x08700000</span><span class="p">,</span> <span class="mh">0x08702FFF</span><span class="p">},</span> <span class="o">//</span><span class="n">FTL</span> <span class="k">for</span> <span class="n">BT</span><span class="p">(</span><span class="o">&gt;=</span><span class="mi">12</span><span class="n">K</span><span class="p">),</span> <span class="n">The</span> <span class="n">start</span> <span class="n">offset</span> <span class="n">of</span> <span class="n">flash</span> <span class="n">pages</span> <span class="n">which</span> <span class="ow">is</span> <span class="n">allocated</span> <span class="n">to</span> <span class="n">FTL</span> <span class="n">physical</span> <span class="nb">map</span><span class="o">.</span>
<span class="p">{</span><span class="n">VFS1</span><span class="p">,</span>                   <span class="mh">0x08703000</span><span class="p">,</span> <span class="mh">0x08722FFF</span><span class="p">},</span> <span class="o">//</span><span class="n">VFS</span> <span class="n">region</span> <span class="mi">1</span> <span class="p">(</span><span class="mi">128</span><span class="n">K</span><span class="p">)</span>
<span class="p">{</span><span class="n">VFS2</span><span class="p">,</span>                   <span class="mh">0xFFFFFFFF</span><span class="p">,</span> <span class="mh">0xFFFFFFFF</span><span class="p">},</span> <span class="o">//</span><span class="n">VFS</span> <span class="n">region</span> <span class="mi">2</span>
<span class="p">{</span><span class="n">USER</span><span class="p">,</span>                   <span class="mh">0xFFFFFFFF</span><span class="p">,</span> <span class="mh">0xFFFFFFFF</span><span class="p">},</span> <span class="o">//</span><span class="n">reserve</span> <span class="k">for</span> <span class="n">user</span>

<span class="o">/*</span> <span class="n">End</span> <span class="o">*/</span>
<span class="p">{</span><span class="mh">0xFF</span><span class="p">,</span>                   <span class="mh">0xFFFFFFFF</span><span class="p">,</span> <span class="mh">0xFFFFFFFF</span><span class="p">},</span>
<span class="p">};</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>Click <span class="guilabel">Generate</span> button in Image Tool, and save the combined image named <code class="file docutils literal notranslate"><span class="pre">Image_All.bin</span></code>.</p>
<blockquote>
<div><figure class="align-center">
<a class="reference internal image-reference" href="../../_images/mp_generate_image_lite_26E.svg"><img alt="../../_images/mp_generate_image_lite_26E.svg" height="517" src="../../_images/mp_generate_image_lite_26E.svg" width="893" /></a>
</figure>
</div></blockquote>
</li>
</ol>
</div></blockquote>
</li>
<li><p>Download the <code class="file docutils literal notranslate"><span class="pre">Image_All.bin</span></code> into the device after the combination is finished.</p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The normal image <code class="file docutils literal notranslate"><span class="pre">kr4_km4_dsp_app.bin</span></code> is built with MP disabled. Check the normal image in <code class="docutils literal notranslate"><span class="pre">{SDK}\amebalite_gcc_project</span></code>. All the images related to normal image can be found in paths below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="n">SDK</span><span class="p">}</span>\<span class="n">amebalite_gcc_project</span>\<span class="n">project_km4</span>\<span class="n">asdk</span>\<span class="n">image</span><span class="o">.</span>
<span class="p">{</span><span class="n">SDK</span><span class="p">}</span>\<span class="n">amebalite_gcc_project</span>\<span class="n">project_kr4</span>\<span class="n">asdk</span>\<span class="n">image</span><span class="o">.</span>
</pre></div>
</div>
</div>
</div><div aria-labelledby="tab-1-1-3" class="sphinx-tabs-panel" hidden="true" id="panel-1-1-3" name="1-3" role="tabpanel" tabindex="0"><ol class="arabic">
<li><p>Check if both the normal image and MP image are valid.</p></li>
<li><p>Use <code class="docutils literal notranslate"><span class="pre">Ameba_1-10_MP_ImageTool_Linux</span></code> to combine all the images, including <code class="docutils literal notranslate"><span class="pre">km4_boot_all.bin</span></code>, <code class="docutils literal notranslate"><span class="pre">km0_km4_ca32_app_mp.bin</span></code>, and <code class="docutils literal notranslate"><span class="pre">km0_km4_ca32_app.bin</span></code>, which are generated in <code class="docutils literal notranslate"><span class="pre">{SDK}\amebasmart_gcc_project</span></code>.</p>
<blockquote>
<div><ol class="loweralpha">
<li><p>Set the highlight image offset according to the Flash layout, which can be found in <code class="docutils literal notranslate"><span class="pre">{SDK}\component\soc\amebasmart\usrcfg\ameba_flashcfg.c</span></code>.</p>
<blockquote>
<div><ul class="simple">
<li><p>Set <code class="docutils literal notranslate"><span class="pre">km0_km4_ca32_app_mp.bin</span></code> in <code class="docutils literal notranslate"><span class="pre">IMG_APP_OTA1</span></code> section</p></li>
<li><p>Set <code class="docutils literal notranslate"><span class="pre">km0_km4_ca32_app.bin</span></code> in <code class="docutils literal notranslate"><span class="pre">IMG_APP_OTA2</span></code> section</p></li>
</ul>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="w"> </span><span class="cm">/*</span>

<span class="cm"> * @brif Nor Flash layout is set according to Nor Flash Layout in User Manual</span>
<span class="cm"> *  In each entry, the first item is flash regoin type, the second item is start address, the second item is end address */</span>

<span class="hll"><span class="w"> </span><span class="n">FlashLayoutInfo_TypeDef</span><span class="w"> </span><span class="n">Flash_Layout_Nor</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span class="w">     </span><span class="cm">/*Region_Type,              [StartAddr,     EndAddr]                */</span>
<span class="hll"><span class="w">     </span><span class="p">{</span><span class="n">IMG_BOOT</span><span class="p">,</span><span class="w">                  </span><span class="mh">0x08000000</span><span class="p">,</span><span class="w"> </span><span class="mh">0x0801FFFF</span><span class="p">},</span><span class="w"> </span><span class="c1">//Boot Manifest(4K) + KM4 Bootloader(124K)</span>
</span><span class="w">     </span><span class="c1">//Users should modify below according to their own memory</span>
<span class="w">     </span><span class="p">{</span><span class="n">IMG_APP_OTA1</span><span class="p">,</span><span class="w">              </span><span class="mh">0x08020000</span><span class="p">,</span><span class="w"> </span><span class="mh">0x082FFFFF</span><span class="p">},</span><span class="w"> </span><span class="c1">//Certificate(4K) + Manifest(4K) + KR4 &amp; KM4 Application OTA1 + Manifest(4K) + RDP IMG OTA1</span>
<span class="hll"><span class="w">     </span><span class="c1">// + AP IMG OTA1</span>
</span><span class="w">     </span><span class="p">{</span><span class="n">IMG_BOOT_OTA2</span><span class="p">,</span><span class="w">     </span><span class="mh">0x08300000</span><span class="p">,</span><span class="w"> </span><span class="mh">0x0833FFFF</span><span class="p">},</span><span class="w"> </span><span class="c1">//Boot Manifest(4K) + KM4 Bootloader(252K) OTA</span>
<span class="w">     </span><span class="p">{</span><span class="n">IMG_APP_OTA2</span><span class="p">,</span><span class="w">              </span><span class="mh">0x08340000</span><span class="p">,</span><span class="w"> </span><span class="mh">0x0861FFFF</span><span class="p">},</span><span class="w"> </span><span class="c1">//Certificate(4K) + Manifest(4K) + KR4 &amp; KM4 Application OTA2 + Manifest(4K) + RDP IMG OTA2</span>
<span class="w">     </span><span class="c1">// + AP IMG OTA2</span>
<span class="w">     </span><span class="p">{</span><span class="n">FTL</span><span class="p">,</span><span class="w">                               </span><span class="mh">0x08620000</span><span class="p">,</span><span class="w"> </span><span class="mh">0x08622FFF</span><span class="p">},</span><span class="w"> </span><span class="c1">//FTL for BT(&gt;=12K), The start offset of flash pages which is allocated to FTL physical map.</span>
<span class="w">     </span><span class="p">{</span><span class="n">VFS1</span><span class="p">,</span><span class="w">                              </span><span class="mh">0x08623000</span><span class="p">,</span><span class="w"> </span><span class="mh">0x08642FFF</span><span class="p">},</span><span class="w"> </span><span class="c1">//VFS region 1 (128K)</span>
<span class="w">     </span><span class="p">{</span><span class="n">VFS2</span><span class="p">,</span><span class="w">                              </span><span class="mh">0xFFFFFFFF</span><span class="p">,</span><span class="w"> </span><span class="mh">0xFFFFFFFF</span><span class="p">},</span><span class="w"> </span><span class="c1">//VFS region 2</span>
<span class="w">     </span><span class="p">{</span><span class="n">USER</span><span class="p">,</span><span class="w">                              </span><span class="mh">0xFFFFFFFF</span><span class="p">,</span><span class="w"> </span><span class="mh">0xFFFFFFFF</span><span class="p">},</span><span class="w"> </span><span class="c1">//reserve for user</span>
<span class="w">     </span><span class="cm">/* End */</span>
<span class="w">     </span><span class="p">{</span><span class="mh">0xFF</span><span class="p">,</span><span class="w">                              </span><span class="mh">0xFFFFFFFF</span><span class="p">,</span><span class="w"> </span><span class="mh">0xFFFFFFFF</span><span class="p">},</span>
<span class="w"> </span><span class="p">};</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>Execute the command and save the combined image named <code class="docutils literal notranslate"><span class="pre">Image_All.bin</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="o">./</span><span class="n">Ameba_1</span><span class="o">-</span><span class="mi">10</span><span class="n">_MP_ImageTool_Linux</span> <span class="o">-</span><span class="n">combine</span> <span class="n">km4_boot_all</span><span class="o">.</span><span class="n">bin</span> <span class="mh">0x0000</span> <span class="n">km0_km4_ca32_app_mp</span><span class="o">.</span><span class="n">bin</span> <span class="mh">0x20000</span> <span class="n">km0_km4_ca32_app</span><span class="o">.</span><span class="n">bin</span> <span class="mh">0x340000</span>
</pre></div>
</div>
</li>
</ol>
</div></blockquote>
</li>
<li><p>Download the <code class="docutils literal notranslate"><span class="pre">Image_All.bin</span></code> into the device after the combination is finished.</p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The normal image <code class="docutils literal notranslate"><span class="pre">km0_km4_ca32_app.bin</span></code> is built with MP disabled. Check the normal image in <code class="docutils literal notranslate"><span class="pre">{SDK}\amebasmart_gcc_project</span></code>.
All the images related to normal image can be found in paths below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="n">SDK</span><span class="p">}</span>\<span class="n">amebasmart_gcc_project</span>\<span class="n">project_lp</span>\<span class="n">asdk</span>\<span class="n">image</span>
<span class="p">{</span><span class="n">SDK</span><span class="p">}</span>\<span class="n">amebasmart_gcc_project</span>\<span class="n">project_hp</span>\<span class="n">asdk</span>\<span class="n">image</span>
<span class="p">{</span><span class="n">SDK</span><span class="p">}</span>\<span class="n">amebasmart_gcc_project</span>\<span class="n">project_ap</span>\<span class="n">asdk</span>\<span class="n">image</span>
</pre></div>
</div>
</div>
</div></div>
</section>
<section id="boot-flow">
<h1>Boot Flow<a class="headerlink" href="#boot-flow" title="Link to this heading"></a></h1>
<ol class="arabic">
<li><p>Reset the device after downloading image is finished.</p></li>
<li><p>Check if the device boots from MP image successfully.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">BOOT</span><span class="o">-</span><span class="n">I</span><span class="p">]</span> <span class="n">IMG2</span><span class="p">(</span><span class="n">OTA1</span><span class="p">)</span> <span class="n">VALID</span><span class="p">,</span> <span class="n">ret</span><span class="p">:</span> <span class="mi">1</span>
<span class="p">[</span><span class="n">BOOT</span><span class="o">-</span><span class="n">I</span><span class="p">]</span> <span class="n">IMG2</span> <span class="n">BOOT</span> <span class="kn">from</span> <span class="nn">OTA</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Version</span><span class="p">:</span> <span class="mf">1.1</span>
<span class="hll"><span class="p">[</span><span class="n">BOOT</span><span class="o">-</span><span class="n">I</span><span class="p">]</span> <span class="n">IMG2</span> <span class="n">BOOT</span> <span class="kn">from</span> <span class="nn">OTA</span> <span class="mi">1</span>
</span><span class="p">[</span><span class="n">BOOT</span><span class="o">-</span><span class="n">I</span><span class="p">]</span> <span class="n">Start</span> <span class="n">NonSecure</span> <span class="o">@</span> <span class="mh">0x60002049</span> <span class="o">...</span>
<span class="p">[</span><span class="n">APP</span><span class="o">-</span><span class="n">I</span><span class="p">]</span> <span class="n">KM4</span> <span class="n">APP_START</span>
<span class="o">...</span>
<span class="n">interface</span> <span class="mi">0</span> <span class="ow">is</span> <span class="n">initialized</span>
<span class="n">interface</span> <span class="mi">1</span> <span class="ow">is</span> <span class="n">initialized</span>
<span class="p">[</span><span class="n">WLAN</span><span class="o">-</span><span class="n">A</span><span class="p">]</span> <span class="n">Init</span> <span class="n">WIFI</span>
<span class="p">[</span><span class="n">WLAN</span><span class="o">-</span><span class="n">A</span><span class="p">]</span> <span class="n">Band</span><span class="o">=</span><span class="mf">2.4</span><span class="n">G</span><span class="o">&amp;</span><span class="mi">5</span><span class="n">G</span>
<span class="hll"><span class="p">[</span><span class="n">WLAN</span><span class="o">-</span><span class="n">A</span><span class="p">]</span> <span class="n">MP</span> <span class="n">driver</span>
</span><span class="p">[</span><span class="n">WLAN</span><span class="o">-</span><span class="n">A</span><span class="p">]</span> <span class="n">NP</span> <span class="n">consume</span> <span class="n">heap</span> <span class="mi">48888</span>
<span class="p">[</span><span class="n">WLAN</span><span class="o">-</span><span class="n">I</span><span class="p">]</span> <span class="n">AP</span> <span class="n">consume</span> <span class="n">heap</span> <span class="mi">27192</span>
<span class="p">[</span><span class="n">WLAN</span><span class="o">-</span><span class="n">I</span><span class="p">]</span> <span class="n">_init_thread</span><span class="p">(</span><span class="mi">74</span><span class="p">),</span> <span class="n">Available</span> <span class="n">heap</span> <span class="mi">3493056</span>
<span class="p">[</span><span class="n">WLAN</span><span class="o">-</span><span class="n">A</span><span class="p">]</span> <span class="n">IPS</span> <span class="ow">in</span>
</pre></div>
</div>
</li>
<li><p>Start the massive production flow if the device boots from MP image successfully.</p></li>
</ol>
</section>
<section id="how-to-switch-image">
<span id="id3"></span><h1>How to Switch Image<a class="headerlink" href="#how-to-switch-image" title="Link to this heading"></a></h1>
<p>When MP is finished, you need to switch the image from MP image to the normal image to verify the application.</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-2-2-0" aria-selected="true" class="sphinx-tabs-tab" id="tab-2-2-0" name="2-0" role="tab" tabindex="0">RTL8721Dx</button><button aria-controls="panel-2-2-1" aria-selected="false" class="sphinx-tabs-tab" id="tab-2-2-1" name="2-1" role="tab" tabindex="-1">RTL8720E</button><button aria-controls="panel-2-2-2" aria-selected="false" class="sphinx-tabs-tab" id="tab-2-2-2" name="2-2" role="tab" tabindex="-1">RTL8726E</button><button aria-controls="panel-2-2-3" aria-selected="false" class="sphinx-tabs-tab" id="tab-2-2-3" name="2-3" role="tab" tabindex="-1">RTL8730E</button></div><div aria-labelledby="tab-2-2-0" class="sphinx-tabs-panel" id="panel-2-2-0" name="2-0" role="tabpanel" tabindex="0"><ol class="arabic">
<li><p>Use command <code class="docutils literal notranslate"><span class="pre">AT+OTACLEAR</span></code> from serial terminal to clear the signature of MP image in order to assign the MP image invalid.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="mi">16</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">35</span><span class="p">:</span><span class="mi">731</span><span class="p">]</span><span class="n">AT</span><span class="o">+</span><span class="n">OTACLEAR</span>
<span class="p">[</span><span class="mi">16</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">35</span><span class="p">:</span><span class="mi">731</span><span class="p">][</span><span class="n">SYS</span><span class="o">-</span><span class="n">A</span><span class="p">]</span> <span class="p">[</span><span class="n">sys_clear_ota_signature</span><span class="p">]</span> <span class="n">IMGID</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="n">current</span> <span class="n">OTA1</span> <span class="n">Address</span><span class="p">:</span> <span class="mh">0x00014000</span><span class="p">,</span> <span class="n">target</span> <span class="n">OTA2</span> <span class="n">Address</span><span class="p">:</span> <span class="mh">0x00214000</span>
<span class="p">[</span><span class="mi">16</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">35</span><span class="p">:</span><span class="mi">731</span><span class="p">]</span>
<span class="p">[</span><span class="mi">16</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">35</span><span class="p">:</span><span class="mi">731</span><span class="p">]</span><span class="o">+</span><span class="n">OTACLEAR</span><span class="p">:</span><span class="n">OK</span>
<span class="p">[</span><span class="mi">16</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">35</span><span class="p">:</span><span class="mi">731</span><span class="p">]</span>
<span class="p">[</span><span class="mi">16</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">35</span><span class="p">:</span><span class="mi">732</span><span class="p">][</span><span class="n">MEM</span><span class="p">]</span> <span class="n">After</span> <span class="n">do</span> <span class="n">cmd</span><span class="p">,</span> <span class="n">available</span> <span class="n">heap</span> <span class="mi">318976</span>
</pre></div>
</div>
</li>
<li><p>Reset the device, then the device will boot from the normal image located in OTA2 field.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">MODULE_BOOT</span><span class="o">-</span><span class="n">LEVEL_INFO</span><span class="p">]:</span> <span class="n">KM0</span> <span class="n">XIP</span> <span class="n">IMG</span><span class="p">[</span><span class="mi">0</span><span class="n">c000000</span><span class="p">:</span><span class="mi">4</span><span class="n">c020</span><span class="p">]</span>
<span class="p">[</span><span class="n">MODULE_BOOT</span><span class="o">-</span><span class="n">LEVEL_INFO</span><span class="p">]:</span> <span class="n">KM0</span> <span class="n">SRAM</span><span class="p">[</span><span class="mi">20040000</span><span class="p">:</span><span class="mi">3960</span><span class="p">]</span>
<span class="p">[</span><span class="n">MODULE_BOOT</span><span class="o">-</span><span class="n">LEVEL_INFO</span><span class="p">]:</span> <span class="n">KM0</span> <span class="n">PSRAM</span><span class="p">[</span><span class="mi">0</span><span class="n">c04f980</span><span class="p">:</span><span class="mi">20</span><span class="p">]</span>
<span class="p">[</span><span class="n">MODULE_BOOT</span><span class="o">-</span><span class="n">LEVEL_INFO</span><span class="p">]:</span> <span class="n">KM0</span> <span class="n">B00T</span><span class="p">[</span><span class="mi">20004</span><span class="n">d00</span><span class="p">:</span><span class="mi">40</span><span class="p">]</span>
<span class="p">[</span><span class="n">MODULE_BOOT</span><span class="o">-</span><span class="n">LEVEL_INFO</span><span class="p">]:</span> <span class="n">KM4</span> <span class="n">XIP</span> <span class="n">IMG</span><span class="p">[</span><span class="mf">0e000000</span><span class="p">:</span><span class="mi">43200</span><span class="p">]</span>
<span class="p">[</span><span class="n">MODULE_BOOT</span><span class="o">-</span><span class="n">LEVEL_INFO</span><span class="p">]:</span> <span class="n">KM4</span> <span class="n">SRAM</span><span class="p">[</span><span class="mf">0e0443</span><span class="n">e0</span><span class="p">:</span><span class="mi">20</span><span class="p">]</span>
<span class="hll"><span class="p">[</span><span class="n">MODULE_BOOT</span><span class="o">-</span><span class="n">LEVEL_INFO</span><span class="p">]:</span> <span class="n">IMG2</span> <span class="n">BOOT</span> <span class="kn">from</span> <span class="nn">OTA</span> <span class="mi">2</span>
</span><span class="p">[</span><span class="n">MODULE_BOOT</span><span class="o">-</span><span class="n">LEVEL_INFO</span><span class="p">]:</span> <span class="n">Start</span> <span class="n">NonSecure</span> <span class="o">@</span> <span class="mh">0xe000115</span> <span class="o">...</span>
<span class="p">[</span><span class="n">MODULE_BOOT</span><span class="o">-</span><span class="n">LEVEL_INFO</span><span class="p">]:</span> <span class="n">VTOR</span><span class="p">:</span> <span class="mi">20005000</span><span class="p">,</span> <span class="n">VTOR_NS</span><span class="p">:</span> <span class="mi">0</span>
<span class="p">[</span><span class="n">MODULE_BOOT</span><span class="o">-</span><span class="n">LEVEL_INFO</span><span class="p">]:</span> <span class="o">...</span>
</pre></div>
</div>
</li>
</ol>
</div><div aria-labelledby="tab-2-2-1" class="sphinx-tabs-panel" hidden="true" id="panel-2-2-1" name="2-1" role="tabpanel" tabindex="0"><ol class="arabic">
<li><p>Use command <code class="docutils literal notranslate"><span class="pre">AT+OTACLEAR</span></code> from serial terminal to clear the signature of MP image in order to assign the MP image invalid.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="mi">16</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">35</span><span class="p">:</span><span class="mi">731</span><span class="p">]</span><span class="n">AT</span><span class="o">+</span><span class="n">OTACLEAR</span>
<span class="p">[</span><span class="mi">16</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">35</span><span class="p">:</span><span class="mi">731</span><span class="p">][</span><span class="n">SYS</span><span class="o">-</span><span class="n">A</span><span class="p">][</span><span class="n">sys_clear_ota_signature</span><span class="p">]</span> <span class="n">IMGID</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="n">current</span> <span class="n">OTA1</span> <span class="n">Address</span><span class="p">:</span> <span class="mh">0x00014000</span><span class="p">,</span> <span class="n">target</span> <span class="n">OTA2</span> <span class="n">Address</span><span class="p">:</span> <span class="mh">0x00214000</span>
<span class="p">[</span><span class="mi">16</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">35</span><span class="p">:</span><span class="mi">731</span><span class="p">]</span>
<span class="p">[</span><span class="mi">16</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">35</span><span class="p">:</span><span class="mi">731</span><span class="p">]</span><span class="o">+</span><span class="n">OTACLEAR</span><span class="p">:</span><span class="n">OK</span>
<span class="p">[</span><span class="mi">16</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">35</span><span class="p">:</span><span class="mi">731</span><span class="p">]</span>
<span class="p">[</span><span class="mi">16</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">35</span><span class="p">:</span><span class="mi">732</span><span class="p">][</span><span class="n">MEM</span><span class="p">]</span> <span class="n">After</span> <span class="n">do</span> <span class="n">cmd</span><span class="p">,</span> <span class="n">available</span> <span class="n">heap</span> <span class="mi">318976</span>
</pre></div>
</div>
</li>
<li><p>Reset the device, the device will boot from the normal image located in OTA2 field.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">BOOT</span><span class="o">-</span><span class="n">I</span><span class="p">]</span> <span class="n">KM4</span> <span class="n">XIP</span> <span class="n">IMG</span><span class="p">[</span><span class="mf">0e000000</span><span class="p">:</span><span class="mf">725e0</span><span class="p">]</span>
<span class="p">[</span><span class="n">BOOT</span><span class="o">-</span><span class="n">I</span><span class="p">]</span> <span class="n">KM4</span> <span class="n">PSRAM</span><span class="p">[</span><span class="mf">0e000000</span><span class="p">:</span><span class="mf">725e0</span><span class="p">]</span>
<span class="p">[</span><span class="n">BOOT</span><span class="o">-</span><span class="n">I</span><span class="p">]</span> <span class="n">KM4</span> <span class="n">SRAM</span><span class="p">[</span><span class="mi">2000</span><span class="n">b000</span><span class="p">:</span><span class="mi">11</span><span class="n">c0</span><span class="p">]</span>
<span class="p">[</span><span class="n">BOOT</span><span class="o">-</span><span class="n">I</span><span class="p">]</span> <span class="n">KM4</span> <span class="n">BOOT</span><span class="p">[</span><span class="mi">20005</span><span class="n">fc0</span><span class="p">:</span><span class="mi">40</span><span class="p">]</span>
<span class="p">[</span><span class="n">BOOT</span><span class="o">-</span><span class="n">I</span><span class="p">]</span> <span class="n">KM4</span> <span class="n">PMC</span><span class="p">[</span><span class="mi">20005900</span><span class="p">:</span><span class="mf">3e0</span><span class="p">]</span>
<span class="hll"><span class="p">[</span><span class="n">BOOT</span><span class="o">-</span><span class="n">I</span><span class="p">]</span> <span class="n">IMG2</span> <span class="n">BOOT</span> <span class="kn">from</span> <span class="nn">OTA</span> <span class="mi">2</span><span class="p">,</span> <span class="n">Version</span><span class="p">:</span> <span class="mf">1.1</span>
</span><span class="p">[</span><span class="n">BOOT</span><span class="o">-</span><span class="n">I</span><span class="p">]</span> <span class="n">Start</span> <span class="n">IMG2</span> <span class="o">@</span> <span class="mh">0xe00277d</span> <span class="o">...</span>
<span class="p">[</span><span class="n">APP</span><span class="o">-</span><span class="n">I</span><span class="p">]</span> <span class="n">kM4</span> <span class="n">APP</span> <span class="n">START</span>
<span class="p">[</span><span class="n">APP</span><span class="o">-</span><span class="n">I</span><span class="p">]</span> <span class="n">VTOR</span><span class="p">:</span> <span class="mi">30007000</span><span class="p">,</span> <span class="n">VTOR_NS</span><span class="p">:</span><span class="mi">30007000</span>
<span class="p">[</span><span class="n">APP</span><span class="o">-</span><span class="n">I</span><span class="p">]</span> <span class="n">IMG2</span> <span class="n">SECURE</span> <span class="n">STATE</span><span class="p">:</span> <span class="mi">1</span>
<span class="p">[</span><span class="n">MAIN</span><span class="o">-</span><span class="n">I</span><span class="p">]</span> <span class="n">KR4</span> <span class="n">OS</span> <span class="n">START</span>
<span class="p">[</span><span class="n">CLK</span><span class="o">-</span><span class="n">I</span><span class="p">]</span> <span class="p">[</span><span class="n">CAL131K</span><span class="p">]:</span> <span class="n">delta</span><span class="p">:</span><span class="mi">8</span> <span class="n">target</span><span class="p">:</span><span class="mi">2441</span> <span class="n">PPM</span><span class="p">:</span> <span class="mi">3277</span> <span class="n">PPM_Limit</span><span class="p">:</span><span class="mi">30000</span>
</pre></div>
</div>
</li>
</ol>
</div><div aria-labelledby="tab-2-2-2" class="sphinx-tabs-panel" hidden="true" id="panel-2-2-2" name="2-2" role="tabpanel" tabindex="0"><ol class="arabic">
<li><p>Use command <code class="docutils literal notranslate"><span class="pre">AT+OTACLEAR</span></code> from serial terminal to clear the signature of MP image in order to assign the MP image invalid.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="mi">16</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">35</span><span class="p">:</span><span class="mi">731</span><span class="p">]</span><span class="n">AT</span><span class="o">+</span><span class="n">OTACLEAR</span>
<span class="p">[</span><span class="mi">16</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">35</span><span class="p">:</span><span class="mi">731</span><span class="p">][</span><span class="n">SYS</span><span class="o">-</span><span class="n">A</span><span class="p">][</span><span class="n">sys_clear_ota_signature</span><span class="p">]</span> <span class="n">IMGID</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="n">current</span> <span class="n">OTA1</span> <span class="n">Address</span><span class="p">:</span> <span class="mh">0x00014000</span><span class="p">,</span> <span class="n">target</span> <span class="n">OTA2</span> <span class="n">Address</span><span class="p">:</span> <span class="mh">0x00214000</span>
<span class="p">[</span><span class="mi">16</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">35</span><span class="p">:</span><span class="mi">731</span><span class="p">]</span>
<span class="p">[</span><span class="mi">16</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">35</span><span class="p">:</span><span class="mi">731</span><span class="p">]</span><span class="o">+</span><span class="n">OTACLEAR</span><span class="p">:</span><span class="n">OK</span>
<span class="p">[</span><span class="mi">16</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">35</span><span class="p">:</span><span class="mi">731</span><span class="p">]</span>
<span class="p">[</span><span class="mi">16</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">35</span><span class="p">:</span><span class="mi">732</span><span class="p">][</span><span class="n">MEM</span><span class="p">]</span> <span class="n">After</span> <span class="n">do</span> <span class="n">cmd</span><span class="p">,</span> <span class="n">available</span> <span class="n">heap</span> <span class="mi">318976</span>
</pre></div>
</div>
</li>
<li><p>Reset the device, the device will boot from the normal image located in OTA2 field.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">BOOT</span><span class="o">-</span><span class="n">I</span><span class="p">]</span> <span class="n">KM4</span> <span class="n">XIP</span> <span class="n">IMG</span><span class="p">[</span><span class="mf">0e000000</span><span class="p">:</span><span class="mf">725e0</span><span class="p">]</span>
<span class="p">[</span><span class="n">BOOT</span><span class="o">-</span><span class="n">I</span><span class="p">]</span> <span class="n">KM4</span> <span class="n">PSRAM</span><span class="p">[</span><span class="mf">0e000000</span><span class="p">:</span><span class="mf">725e0</span><span class="p">]</span>
<span class="p">[</span><span class="n">BOOT</span><span class="o">-</span><span class="n">I</span><span class="p">]</span> <span class="n">KM4</span> <span class="n">SRAM</span><span class="p">[</span><span class="mi">2000</span><span class="n">b000</span><span class="p">:</span><span class="mi">11</span><span class="n">c0</span><span class="p">]</span>
<span class="p">[</span><span class="n">BOOT</span><span class="o">-</span><span class="n">I</span><span class="p">]</span> <span class="n">KM4</span> <span class="n">BOOT</span><span class="p">[</span><span class="mi">20005</span><span class="n">fc0</span><span class="p">:</span><span class="mi">40</span><span class="p">]</span>
<span class="p">[</span><span class="n">BOOT</span><span class="o">-</span><span class="n">I</span><span class="p">]</span> <span class="n">KM4</span> <span class="n">PMC</span><span class="p">[</span><span class="mi">20005900</span><span class="p">:</span><span class="mf">3e0</span><span class="p">]</span>
<span class="hll"><span class="p">[</span><span class="n">BOOT</span><span class="o">-</span><span class="n">I</span><span class="p">]</span> <span class="n">IMG2</span> <span class="n">BOOT</span> <span class="kn">from</span> <span class="nn">OTA</span> <span class="mi">2</span><span class="p">,</span> <span class="n">Version</span><span class="p">:</span> <span class="mf">1.1</span>
</span><span class="p">[</span><span class="n">BOOT</span><span class="o">-</span><span class="n">I</span><span class="p">]</span> <span class="n">Start</span> <span class="n">IMG2</span> <span class="o">@</span> <span class="mh">0xe00277d</span> <span class="o">...</span>
<span class="p">[</span><span class="n">APP</span><span class="o">-</span><span class="n">I</span><span class="p">]</span> <span class="n">kM4</span> <span class="n">APP</span> <span class="n">START</span>
<span class="p">[</span><span class="n">APP</span><span class="o">-</span><span class="n">I</span><span class="p">]</span> <span class="n">VTOR</span><span class="p">:</span> <span class="mi">30007000</span><span class="p">,</span> <span class="n">VTOR_NS</span><span class="p">:</span><span class="mi">30007000</span>
<span class="p">[</span><span class="n">APP</span><span class="o">-</span><span class="n">I</span><span class="p">]</span> <span class="n">IMG2</span> <span class="n">SECURE</span> <span class="n">STATE</span><span class="p">:</span> <span class="mi">1</span>
<span class="p">[</span><span class="n">MAIN</span><span class="o">-</span><span class="n">I</span><span class="p">]</span> <span class="n">KR4</span> <span class="n">OS</span> <span class="n">START</span>
<span class="p">[</span><span class="n">CLK</span><span class="o">-</span><span class="n">I</span><span class="p">]</span> <span class="p">[</span><span class="n">CAL131K</span><span class="p">]:</span> <span class="n">delta</span><span class="p">:</span><span class="mi">8</span> <span class="n">target</span><span class="p">:</span><span class="mi">2441</span> <span class="n">PPM</span><span class="p">:</span> <span class="mi">3277</span> <span class="n">PPM_Limit</span><span class="p">:</span><span class="mi">30000</span>
</pre></div>
</div>
</li>
</ol>
</div><div aria-labelledby="tab-2-2-3" class="sphinx-tabs-panel" hidden="true" id="panel-2-2-3" name="2-3" role="tabpanel" tabindex="0"><ol class="arabic">
<li><p>Type command <code class="docutils literal notranslate"><span class="pre">AT+OTACLEAR</span></code> from serial terminal to clear the signature of MP image in order to assign the MP image invalid.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="mi">16</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">35</span><span class="p">:</span><span class="mi">731</span><span class="p">]</span><span class="n">AT</span><span class="o">+</span><span class="n">OTACLEAR</span>
<span class="p">[</span><span class="mi">16</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">35</span><span class="p">:</span><span class="mi">731</span><span class="p">][</span><span class="n">SYS</span><span class="o">-</span><span class="n">A</span><span class="p">]</span> <span class="p">[</span><span class="n">sys_clear_ota_signature</span><span class="p">]</span> <span class="n">IMGID</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="n">current</span> <span class="n">OTA1</span> <span class="n">Address</span><span class="p">:</span> <span class="mh">0x00020000</span><span class="p">,</span> <span class="n">target</span> <span class="n">OTA2</span> <span class="n">Address</span><span class="p">:</span> <span class="mh">0x00340000</span>
<span class="p">[</span><span class="mi">16</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">35</span><span class="p">:</span><span class="mi">731</span><span class="p">]</span>
<span class="p">[</span><span class="mi">16</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">35</span><span class="p">:</span><span class="mi">731</span><span class="p">]</span><span class="o">+</span><span class="n">OTACLEAR</span><span class="p">:</span><span class="n">OK</span>
<span class="p">[</span><span class="mi">16</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">35</span><span class="p">:</span><span class="mi">731</span><span class="p">]</span>
<span class="p">[</span><span class="mi">16</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">35</span><span class="p">:</span><span class="mi">732</span><span class="p">][</span><span class="n">MEM</span><span class="p">]</span> <span class="n">After</span> <span class="n">do</span> <span class="n">cmd</span><span class="p">,</span> <span class="n">available</span> <span class="n">heap</span> <span class="mi">318976</span>
</pre></div>
</div>
</li>
<li><p>Reset the device, the device will boot from the normal image located in OTA2 field.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="hll"> <span class="p">[</span><span class="n">BOOT</span><span class="o">-</span><span class="n">I</span><span class="p">]</span> <span class="n">IMG2</span><span class="p">(</span><span class="n">OTA2</span><span class="p">)</span> <span class="n">VALID</span><span class="p">,</span> <span class="n">ret</span><span class="p">:</span> <span class="mi">1</span>
</span><span class="hll"> <span class="p">[</span><span class="n">BOOT</span><span class="o">-</span><span class="n">I</span><span class="p">]</span> <span class="n">IMG2</span> <span class="n">BOOT</span> <span class="kn">from</span> <span class="nn">OTA</span> <span class="mi">2</span><span class="p">,</span> <span class="n">Version</span><span class="p">:</span> <span class="mf">1.1</span>
</span><span class="hll"> <span class="p">[</span><span class="n">BOOT</span><span class="o">-</span><span class="n">I</span><span class="p">]</span> <span class="n">IMG2</span> <span class="n">BOOT</span> <span class="kn">from</span> <span class="nn">OTA</span> <span class="mi">2</span>
</span> <span class="p">[</span><span class="n">BOOT</span><span class="o">-</span><span class="n">I</span><span class="p">]</span> <span class="n">Start</span> <span class="n">NonSecure</span> <span class="o">@</span> <span class="mh">0x60002049</span> <span class="o">...</span>
 <span class="p">[</span><span class="n">APP</span><span class="o">-</span><span class="n">I</span><span class="p">]</span> <span class="n">KM4</span> <span class="n">APP_START</span>
 <span class="o">...</span>
</pre></div>
</div>
</li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Only NOR Flash is supported now.</p>
</div>
</div></div>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="0_mp_image_index.html" class="btn btn-neutral float-left" title="MP Image" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../6_mptools/0_mptools_index.html" class="btn btn-neutral float-right" title="1-N MP Tool" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Realsil.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>

      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 



</body>
</html>