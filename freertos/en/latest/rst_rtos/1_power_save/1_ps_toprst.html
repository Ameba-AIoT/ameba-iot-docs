

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Power Architecture &mdash; Ameba IoT Docs  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
      <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=b947ea82" />
      <link rel="stylesheet" type="text/css" href="../../_static/tabs.css?v=a5c4661c" />
      <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=b947ea82" />

  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../../_static/toggleprompt.js?v=d7ede5d2"></script>
        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
        <script src="../../_static/tabs.js?v=3030b3cb"></script>
        <script>let toggleHintShow = 'Click to show';</script>
        <script>let toggleHintHide = 'Click to hide';</script>
        <script>let toggleOpenOnPrint = 'true';</script>
        <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="WHC Bridge" href="../2_whc_wifi_bridge/0_wifi_bridge_index.html" />
    <link rel="prev" title="Power Saving" href="0_ps_index.html" />
     

    

    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" rel="stylesheet" />

    <!-- NDA文档输入密码的框 -->
    
<script>
// ▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼ 多语言配置 ▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼
const lang = 'en';  // 使用 Python 字符串切片
const i18n = {
    zh: {
        title: '访问授权',
        username: '用户名',
        password: '密码',
        confirm: '确认',
        cancel: '取消',
        usernameError: '用户名错误',
        userNotExist: '该用户不存在',
        passwordError: '密码错误',
        wrongPassword: '请输入正确的密码',
        accessDenied: '无访问权限',
        noPermission: '您无权查看此内容',
        expiredTitle: '访问已过期',
        expiredMsg: '您的权限已失效<br>有效期：%s 至 %s',
        deniedTitle: '⚠️ 无访问权限',
        contact: '请联系 claire_wang@realsil.com.cn 获取权限'
    },
    en: {
        title: 'Access Required',
        username: 'Username',
        password: 'Password',
        confirm: 'Confirm',
        cancel: 'Cancel',
        usernameError: 'Invalid Username',
        userNotExist: 'User does not exist',
        passwordError: 'Wrong Password',
        wrongPassword: 'Please enter correct password',
        accessDenied: 'Access Denied',
        noPermission: 'You have no permission to view this content',
        expiredTitle: 'Authorization Expired',
        expiredMsg: 'Your access has expired<br>Valid period: %s to %s',
        deniedTitle: '⚠️ Access Denied',
        contact: 'Please contact claire_wang@realsil.com.cn for access'
    }
};
// ▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲ 多语言配置结束 ▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲
</script>

    <!-- 样式模板 -->
    

<style>
    .wy-nav-content {
        max-width: 1100px;
         
    }
    
    .auth-denied {
        padding: 20px;
        background: #f8f9fa;
        border-radius: 4px;
        border: 1px solid #dee2e6;
        text-align: center;
        color: #721c24;
        margin-top: 20px;
    }
    .auth-denied h3 {
        margin-bottom: 10px;
        color: #dc3545;
    }
    
    #report-button {
        position: fixed;
        top: 10px;
        left: 1270px;
        padding: 1px 15px; /* 调整内边距：1px 为上下，5px 为左右 */
        height: 30px; /* 设置固定高度 */
        background-color: #2ecc71;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        z-index: 1000;
    }
    #report-button:hover {
        background-color: #2ecc71;
    }
    
    .feedback-dialog {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        z-index: 1001;
        width: 600px;
    }
    .feedback-dialog textarea {
        width: 100%;
        height: 150px;
        margin-top: 10px;
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 4px;
        resize: vertical;
    }
    .feedback-dialog button {
        margin-top: 10px;
        padding: 8px 16px;
        background-color: #007bff;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
    }
    .feedback-dialog button:hover {
        background-color: #0056b3;
    }

    
    
</style>



    <!-- 注入 TOC 映射和当前页面信息 -->
    

<!-- TOC 映射和当前文档信息 -->
<script>
// 将 Python 字典转换为 JS 对象
const TOC_TITLE_MAP = {"rst_rtos/0_ameba_product": "Products Center", "rst_rtos/0_ameba_product/0_ameba_product_center_index": "Products Center", "rst_rtos/0_ameba_sdk": "Ameba SDK", "rst_rtos/0_ameba_sdk/0_ameba_sdks_index": "Ameba SDK", "rst_rtos/0_ameba_solutions": "Ameba Solutions", "rst_rtos/0_ameba_solutions/0_ameba_solutions_index": "Ameba Solutions", "rst_rtos/0_at_command": "0.8 AT Commands", "rst_rtos/0_at_command/0_at_command_index": "0.8 AT Commands", "rst_rtos/0_file_system": "0.9 Virtual File System", "rst_rtos/0_file_system/0_vfs_index": "0.9 Virtual File System", "rst_rtos/0_ftl": "0.a Flash Translation Layer", "rst_rtos/0_ftl/0_ftl_index": "0.a Flash Translation Layer", "rst_rtos/0_gcc_build_environment": "0.1 GCC Build Environment", "rst_rtos/0_gcc_build_environment/0_gcc_build_index": "0.1 GCC Build Environment", "rst_rtos/0_gcc_build_library": "0.3 GCC Build Library", "rst_rtos/0_gcc_build_library/0_gcc_build_library_index": "0.3 GCC Build Library", "rst_rtos/0_gdb_debug": "0.2 GDB Debug", "rst_rtos/0_gdb_debug/0_gdb_debug_index": "0.2 GDB Debug", "rst_rtos/0_memory_layout": "0.5 Flash \u0026 RAM Layout", "rst_rtos/0_memory_layout/0_layout_index": "0.5 Flash \u0026 RAM Layout", "rst_rtos/0_sdk_example": "0.4 SDK Example", "rst_rtos/0_sdk_example/0_sdk_example_index": "0.4 SDK Example", "rst_rtos/0_tools": "0.7 Tools", "rst_rtos/0_tools/0_tools_index": "0.7 Tools", "rst_rtos/0_user_config": "0.6 User Config", "rst_rtos/0_user_config/0_usrcfg_index": "0.6 User Config", "rst_rtos/10_api_docs": "10.0 API Reference", "rst_rtos/10_api_docs/0_api_index": "10.0 API Reference", "rst_rtos/1_boot_process": "1.1 BOOT Process", "rst_rtos/1_boot_process/0_boot_index": "1.1 BOOT Process", "rst_rtos/1_chipen": "1.4 Chip Enable", "rst_rtos/1_chipen/0_chipen_index": "1.4 Chip Enable", "rst_rtos/1_gpio": "1.7 GPIO \u0026 Pin Control", "rst_rtos/1_gpio/0_gpio_index": "1.7 GPIO \u0026 Pin Control", "rst_rtos/1_ipc": "1.5 Inter Processor Communication", "rst_rtos/1_ipc/0_ipc_index": "1.5 Inter Processor Communication", "rst_rtos/1_mpu_cache": "1.0 MPU and Cache", "rst_rtos/1_mpu_cache/0_mpu_cache_index": "1.0 MPU and Cache", "rst_rtos/1_ota": "1.2 OTA", "rst_rtos/1_ota/0_ota_index": "1.2 OTA", "rst_rtos/1_otpc": "1.3 OTPC", "rst_rtos/1_otpc/0_otpc_index": "1.3 OTPC", "rst_rtos/1_pinmux": "1.6 Pin Multiplexing", "rst_rtos/1_pinmux/0_pinmux_index": "1.6 Pin Multiplexing", "rst_rtos/1_power_save": "1.9 Power Save", "rst_rtos/1_power_save/0_ps_index": "1.9 Power Save", "rst_rtos/2_whc_fullmac": "2.1 WHC FullMAC", "rst_rtos/2_whc_fullmac/0_fullmac_index": "2.1 WHC FullMAC", "rst_rtos/2_whc_wifi_bridge": "2.0 WHC Bridge", "rst_rtos/2_whc_wifi_bridge/0_wifi_bridge_index": "2.0 WHC Bridge", "rst_rtos/2_wifi_adaptivity_test": "2.4 Wi-Fi Adaptivity Test", "rst_rtos/2_wifi_adaptivity_test/0_wifi_adaptivity_index": "2.4 Wi-Fi Adaptivity Test", "rst_rtos/2_wifi_csi": "2.3 Wi-Fi CSI", "rst_rtos/2_wifi_csi/0_wifi_csi_index": "2.3 Wi-Fi CSI", "rst_rtos/2_wifi_tunnel": "2.2 Wi-Fi R-Mesh", "rst_rtos/2_wifi_tunnel/0_wifi_tunnel_index": "2.2 Wi-Fi R-Mesh", "rst_rtos/3_ap_trustzone": "3.d AP Secure Service", "rst_rtos/3_ap_trustzone/0_ap_tz_index": "3.d AP Secure Service", "rst_rtos/3_crypto_engine": "3.9 Crypto Engine", "rst_rtos/3_crypto_engine/0_crypto_engine_index": "3.9 Crypto Engine", "rst_rtos/3_ecdsa_engine": "3.a ECDSA Engine", "rst_rtos/3_ecdsa_engine/0_ecdsa_index": "3.a ECDSA Engine", "rst_rtos/3_eddsa_engine": "3.b EDDSA Engine", "rst_rtos/3_eddsa_engine/0_eddsa_index": "3.b EDDSA Engine", "rst_rtos/3_rsa_engine": "3.c RSA Engine", "rst_rtos/3_rsa_engine/0_rsa_index": "3.c RSA Engine", "rst_rtos/3_security": "3.1 Security \u0026 Encryption", "rst_rtos/3_security/0_security_index": "3.1 Security \u0026 Encryption", "rst_rtos/3_trng": "3.2 True Random Number Generator", "rst_rtos/3_trng/0_trng_index": "3.2 True Random Number Generator", "rst_rtos/4_ai": "4.1 AI", "rst_rtos/4_ai/0_ai_index": "4.1 AI", "rst_rtos/4_ai_voice": "4.2 AIVoice", "rst_rtos/4_ai_voice/0_ai_voice_index": "4.2 AIVoice", "rst_rtos/4_dsp": "4.4 DSP", "rst_rtos/4_dsp/0_dsp_index": "4.4 DSP", "rst_rtos/4_multimedia": "4.3 Multimedia", "rst_rtos/4_multimedia/0_multimedia_index": "4.3 Multimedia", "rst_rtos/6_mass_production": "6.1 Mass Production", "rst_rtos/6_mass_production/0_mp_index": "6.1 Mass Production", "rst_rtos/6_mptools": "6.2 MP Tools", "rst_rtos/6_mptools/0_mptools_index": "6.2 MP Tools", "rst_rtos/7_usb": "7.1 USB Host \u0026 Device", "rst_rtos/7_usb/0_usb_index": "7.1 USB Host \u0026 Device", "rst_rtos/8_adc": "8.4 ADC", "rst_rtos/8_adc/0_adc_index": "8.4 ADC", "rst_rtos/8_cap_touch": "8.7 Cap-Touch", "rst_rtos/8_cap_touch/0_cap_touch_index": "8.7 Cap-Touch", "rst_rtos/8_dmac": "8.1 DMA Controller", "rst_rtos/8_dmac/0_dmac_index": "8.1 DMA Controller", "rst_rtos/8_ir": "8.5 IR", "rst_rtos/8_ir/0_ir_index": "8.5 IR", "rst_rtos/8_key_scan": "8.8 Key-Scan", "rst_rtos/8_key_scan/0_key_scan_index": "8.8 Key-Scan", "rst_rtos/8_lcdc": "8.a LCD Controller", "rst_rtos/8_lcdc/0_lcdc_index": "8.a LCD Controller", "rst_rtos/8_ledc": "8.6 LED Controller", "rst_rtos/8_ledc/0_ledc_index": "8.6 LED Controller", "rst_rtos/8_psram": "8.2 PSRAM", "rst_rtos/8_psram/0_psram_index": "8.2 PSRAM", "rst_rtos/8_rtc_io": "8.9 RTC-IO", "rst_rtos/8_rtc_io/0_rtc_io_index": "8.9 RTC-IO", "rst_rtos/8_thermal": "8.3 Thermal Meter", "rst_rtos/8_thermal/0_thermal_index": "8.3 Thermal Meter"};
console.log("TOC_TITLE_MAP:", TOC_TITLE_MAP);

// 获取当前页面的文档名 (例如 'rst_rtos/3_nda_secure_boot/0_secure_boot_index_nda')
const CURRENT_DOCNAME = 'rst_rtos/1_power_save/1_ps_toprst';

// 动态查找顶级分类函数（定义为全局函数）
window.findTopLevelChapter = function(docname) {
    console.log("Attempting to find top-level chapter for:", docname);
    let bestMatch = "";
    let bestTitle = "Unknown Chapter";

    // 按路径长度降序排序以确保最长匹配
    const sortedPaths = Object.keys(TOC_TITLE_MAP).sort((a, b) => b.length - a.length);

    for (const path of sortedPaths) {
        console.log("Checking path:", path);
        if (docname === path || docname.startsWith(path + '/')) { // 子页面
            bestMatch = path;
            bestTitle = TOC_TITLE_MAP[path];
            console.log("Matched path:", path, "with title:", bestTitle);
            break;
        }
    }

    // 如果没有找到任何匹配项，则尝试更短的路径
    if (bestMatch === "") {
        const pathSegments = docname.split('/');
        while (pathSegments.length > 1) { // 至少保留根路径
            const candidate = pathSegments.join('/');
            console.log("Checking shorter path:", candidate);
            if (TOC_TITLE_MAP[candidate]) {
                bestTitle = TOC_TITLE_MAP[candidate];
                console.log("Matched shorter path:", candidate, "with title:", bestTitle);
                break;
            }
            pathSegments.pop();
        }
    }

    console.log("Final top-level chapter:", bestTitle);
    return bestTitle;
}

// 初始化时调用
document.addEventListener('DOMContentLoaded', function() {
    const topLevelChapter = findTopLevelChapter(CURRENT_DOCNAME);
    console.log("Top Level Chapter:", topLevelChapter);

    // 将顶级分类插入到DOM中（根据需要）
    const chapterElement = document.createElement('div');
    chapterElement.className = 'top-level-chapter';
    chapterElement.innerHTML = `<strong>Top Level Chapter: </strong>${topLevelChapter}`;
    document.body.appendChild(chapterElement);
});
</script>
    <style>
        /* ====================== 选择器样式 ====================== */
        /* 选择器容器 */
        .selector-container {
            margin: 8px 0;
            display: flex;
            justify-content: flex-start;
            align-items: center;
        }
        
        /* 版本选择器特殊边距 */
        .version-selector-container {
            margin-bottom: 8px !important;
        }
        
        /* 选择器标签 */
        .selector-label {
            color: white;
            margin-right: 10px;
            width: 80px;
            text-align: right;
            font-size: 0.9em;
        }
        
        /* 下拉选择框 */
        .selector-dropdown {
            width: 120px;
            border-radius: 2px;
            padding: 4px 8px;
            border: 1px solid #405261;
            background: #2c3e50;
            color: white;
            font-size: 0.9em;
        }
        
        /* 下拉选择框悬停效果 */
        .selector-dropdown:hover {
            border-color: #3498db;
            transition: border-color 0.3s;
        }
        
        /* 选择器响应式布局 */
        @media (max-width: 768px) {
            .selector-container {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .selector-label {
                width: 100%;
                text-align: left;
                margin-bottom: 4px;
            }
            
            .selector-dropdown {
                width: 100%;
            }
        }
    </style>
    
    <style>
        /* ====================== 注销按钮样式 ====================== */
        .logout-btn {
            background: #e74c3c;
            color: white;
            padding: 4px 10px;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            transition: background 0.3s ease;
            font-size: 0.85em;
            margin-left: 10px;
        }
    
        .logout-btn:hover {
            background: #c0392b;
        }
    
        .username {
            font-weight: 600;
            color: #ecf0f1;
        }
    
        @media (max-width: 768px) {
            .logout-btn {
                margin-left: 0;
                margin-top: 5px;
                width: 100%;
            }
            
            #user-info {
                display: flex !important;
                flex-direction: column;
                align-items: flex-start;
            }
        }
    </style>
    <style>
        /* =============== 左上角登录区域  =============== */
        /* ================= 用户面板 ================= */
        .user-panel {
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            padding: 4px 6px; /* 上下间距减少 */
            margin: 4px 0;     /* 外间距减小 */
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
    
        .username {
            font-size: 1.1em;
            color: #ecf0f1;
            font-weight: 500;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            text-align: center;      /* 确保文本居中 */
            max-width: 100%;         /* 允许完全展开 */
            display: block;          /* 确保居中效果 */
        }
    
        .user-info-top {
            display: flex;
            justify-content: center; /* 新增居中属性 */
            margin-bottom: 4px;      /* 减少下边距 */
            width: 100%;
        }
    
        .user-icon {
            font-size: 1.2em;
            margin-right: 10px;
        }
    
        /* ================= 按钮容器 ================= */
        .button-row {
            display: flex;
            gap: 8px;
            width: 100%;
            margin: 10px 0;
        }
    
        /* 通用按钮样式 */
        .auth-btn {
            flex: 1;
            margin: 3px;             /* 减少按钮间距 */
            padding: 4px 6px;       /* 减少按钮内边距 */
            border-radius: 6px;
            border: none;
            background: #3498db;
            color: white;
            transition: all 0.3s ease;
            font-size: 0.95em;
        }
    
        .auth-btn:hover {
            background: #2980b9;
            transform: translateY(-1px);
        }
    
        /* 外链按钮 */
        .link-btn {
            width: 100%;
            margin: 3px 0;           /* 减少外链按钮间距 */
            padding: 4px 6px;       /* 减少内边距 */
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 6px;
            color: white;
            display: flex;
            align-items: center;
            transition: all 0.3s ease;
        }
    
        .link-btn:hover {
            background: rgba(255,255,255,0.1);
            transform: translateY(-1px);
        }
    
        .link-icon {
            margin-right: 10px;
            font-size: 1.2em;
        }
    
        .link-text {
            font-size: 0.95em;
        }
    
        .panel-divider {
            height: 1px;
            background: rgba(255,255,255,0.1);
            margin: 6px 0;          /* 减少分隔线间距 */
        }
    
        /* 响应式调整 */
        @media (max-width: 768px) {
            .user-panel {
                padding: 4px 6px;
            }
            
            .auth-btn {
                padding: 4px 68px;
                font-size: 0.9em;
            }
            
            .link-text {
                font-size: 0.9em;
            }
        }
    /* =============== 左上角登录区域  =============== */
    </style>
    
    <style>
        /* ====================== logout用户面板样式 ====================== */
        .logout-container {
            border-top: 1px solid rgba(255,255,255,0.2);
            padding-top: 12px;
        }
    
        .logout-btn {
            width: 100%;
            margin: 3px 0;           /* 减少外链按钮间距 */
            padding: 4px 6px;       /* 减少内边距 */
            background: linear-gradient(145deg, #e74c3c, #c0392b);
            border-radius: 6px;
            font-size: 0.95em;
            transition: all 0.3s ease;
            display: flex;
            justify-content: center;
            align-items: center;
            padding-top: 3px;        /* 减少顶部间距 */
        }
    
        .logout-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 3px 8px rgba(231, 76, 60, 0.3);
        }
    
    </style>

    <!-- 问题回报 -->
    

    <style>
        /* 隐藏整个搜索栏容器 */
        .wy-side-nav-search > div[role="search"] {
            display: none !important;
        }

        /* 或者更精确地隐藏表单 */
        form#rtd-search-form {
            display: none !important;
        }
    </style>

    <style>
        .extension-container {
            position: fixed;
            left: 10px;
            bottom: 10px;
            z-index: 1000;
        }

        .extension-button {
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 5px;
            padding: 8px 15px;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .extension-button:hover {
            background-color: #2980b9;
        }
    </style>

    <style>
        /* 保持settings-panel原有样式不变 */
        .settings-panel {
            position: fixed;
            left: 0;
            bottom: 0;
            width: 300px;
            height: 60px;
            background: #2d2d2d;
            border-top: 1px solid #404040;
            box-shadow: 0 -2px 12px rgba(0,0,0,0.2);
            z-index: 1001;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        /* 新增settings-container的flex定义 */
        .settings-container {
            display: flex;
            width: 100%;
            height: 100%;
            align-items: center;
            justify-content: center;
        }

        .settings-icon {
            font-size: 32px !important; /* 控制图标大小 */
            color: #888 !important; /* 默认颜色 */
            transition: all 0.3s ease !important;
        }

        .settings-icon:hover {
            color: #fff !important; /* 悬停颜色 */
            transform: rotate(90deg) !important;
        }
        /* 增加字体配置 */
        .material-symbols-outlined {
            font-family: 'Material Symbols Outlined' !important;
            font-weight: 400 !important;
            font-style: normal !important;
            line-height: 1 !important;
            letter-spacing: normal !important;
            text-transform: none !important;
        }

    </style>

    <style>
        /* 新增下拉菜单样式 */
        .settings-dropdown {
            position: absolute;
            right: -10px; /* 根据图标位置微调 */
            top: 50%;
            transform: translateY(-50%);
            background: #3a3a3a;
            border-radius: 6px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.25);
            display: none;
            min-width: 180px;
            z-index: 2000;
            overflow: hidden;
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        .settings-dropdown::before {
            content: '';
            position: absolute;
            right: 14px;
            top: -8px;
            border-left: 8px solid transparent;
            border-right: 8px solid transparent;
            border-bottom: 8px solid #3a3a3a;
        }

        .settings-dropdown.show {
            display: block;
            opacity: 1;
        }

        .settings-dropdown-item {
            padding: 12px 20px;
            color: #ddd;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
            display: block;
            text-decoration: none;
        }

        .settings-dropdown-item:hover {
            background: #444;
            color: #fff;
            padding-left: 25px;
        }

        .settings-dropdown-item:not(:last-child) {
            border-bottom: 1px solid #4a4a4a;
        }

        /* 调整父容器定位方式 */
        .settings-container {
            position: relative; /* 新增定位上下文 */
        }
    </style>

    <!-- 引入功能模块 -->
    
<script>
    /* ====================== 嵌入式配置开始 ====================== */
    const embeddedConfig = {
        "freertos": {
            "name": "FreeRTOS",
            "languages": {
                "en": ["latest"],
                "cn": ["latest"]
            }
        },
        "linux": {
            "name": "Linux",
            "languages": {
                "en": ["latest"],
                "cn": ["latest"]
            }
        }
    };
    /* ====================== 嵌入式配置结束 ====================== */
</script>
    
<script>
    // 获取基础URL路径
    function getBaseURL() {
        const url = new URL(window.location.href);
        if (url.protocol === 'file:') {
            // 本地路径处理
            const pathParts = url.pathname.split('/').filter(part => part !== '');
            const index = pathParts.indexOf('build');
            return `file://${pathParts.slice(0, index + 1).join('/')}/`;
        } else {
            // 网络路径处理
            return `${url.origin}/${url.pathname.split('/').slice(1, 3).join('/')}/`;
        }
    }

    // 获取当前URL路径分段
    function getCurrentSegments() {
        const url = new URL(window.location.href);
        let segments = url.pathname.split('/').filter(segment => segment);

        if (url.protocol === 'file:') {
            // 本地路径处理
            const index = segments.indexOf('build');
            segments = segments.slice(index + 1); // 去掉 build 及之前的路径
        } else {
            // 网络路径处理
            segments = segments.slice(3); // 去掉 ameba-iot-docs/
        }

        return {
            osKey: segments[0] || 'freertos', // 默认为 freertos
            language: segments[1] || 'en',   // 默认为 en
            version: segments[2] || 'latest' // 默认为 latest
        };
    }
</script>
    
<script>
    // 获取OS显示名称列表
    function getOSNames(data) {
        return Object.keys(data).map(key => data[key].name);
    }

    // 获取指定OS的语言列表
    function getLanguages(data, osKey) {
        return Object.keys(data[osKey]?.languages || {});
    }

    // 获取指定OS和语言的版本列表
    function getVersions(data, osKey, language) {
        return data[osKey]?.languages?.[language] || ['latest'];
    }

    // 根据显示名称查找OS键
    function findOSKey(data, displayName) {
        return Object.keys(data).find(key => data[key].name === displayName);
    }
</script>
    
<script>
    // 验证并修正路径参数
    function validateSegments(segments) {
        const currentOSName = embeddedConfig[segments.osKey]?.name;

        // 如果 OS 无效，默认设置为 FreeRTOS
        if (!currentOSName) {
            console.warn("Invalid OS key, defaulting to FreeRTOS");
            segments.osKey = 'freertos';
        }

        // 如果语言无效，默认设置为 en
        if (!getLanguages(embeddedConfig, segments.osKey).includes(segments.language)) {
            console.warn("Invalid language, defaulting to en");
            segments.language = 'en';
        }

        return segments;
    }

    // 生成选择器HTML
    function generateSelectorsHTML(segments) {
        return `
            <div id="custom-selectors" style="padding: 0; background: none; border: none;">
                <!-- 系统选择器 -->
                <div class="selector-container">
                    <label class="selector-label">
                        ${segments.language === 'cn' ? '系统' : 'OS'}:
                    </label>
                    <select id="os-selector" class="selector-dropdown">
                        ${Object.keys(embeddedConfig).map(key => `
                            <option value="${key}">${embeddedConfig[key].name}</option>
                        `).join('')}
                    </select>
                </div>

                <!-- 语言选择器 -->
                <div class="selector-container">
                    <label class="selector-label">
                        ${segments.language === 'cn' ? '语言' : 'Language'}:
                    </label>
                    <select id="language-selector" class="selector-dropdown">
                        ${getLanguages(embeddedConfig, segments.osKey).map(lang => `
                            <option value="${lang}">${lang}</option>
                        `).join('')}
                    </select>
                </div>

                <!-- 版本选择器 -->
                <div class="selector-container version-selector-container">
                    <label class="selector-label">
                        ${segments.language === 'cn' ? '版本' : 'Version'}:
                    </label>
                    <select id="version-selector" class="selector-dropdown">
                        ${getVersions(embeddedConfig, segments.osKey, segments.language).map(ver => `
                            <option value="${ver}">${ver}</option>
                        `).join('')}
                    </select>
                </div>

                ${generateUserPanelHTML(segments)}
            </div>`;
    }

    // 生成用户面板HTML
    function generateUserPanelHTML(segments) {
        return ``;
    }

    // 设置初始选中值
    function setInitialValues(segments) {
        document.getElementById('os-selector').value = segments.osKey;
        document.getElementById('language-selector').value = segments.language;

        const versionSelector = document.getElementById('version-selector');
        const availableVersions = getVersions(embeddedConfig, segments.osKey, segments.language);
        versionSelector.value = availableVersions.includes(segments.version) ? segments.version : availableVersions[0] || 'latest';
    }
</script>
    
<script>
    // 绑定事件监听
    function bindEvents(baseURL, segments) {
        document.getElementById('os-selector').addEventListener('change', () => {
            const newOSKey = document.getElementById('os-selector').value;
            const availableLangs = getLanguages(embeddedConfig, newOSKey);
            const defaultLang = availableLangs[0] || 'en';
            const defaultVersion = getVersions(embeddedConfig, newOSKey, defaultLang)[0] || 'latest';
            redirectTo(`${baseURL}${newOSKey}/${defaultLang}/${defaultVersion}/`);
        });

        document.getElementById('language-selector').addEventListener('change', () => {
            const newLang = document.getElementById('language-selector').value;
            const defaultVersion = getVersions(embeddedConfig, segments.osKey, newLang)[0] || 'latest';
            redirectTo(`${baseURL}${segments.osKey}/${newLang}/${defaultVersion}/`);
        });

        document.getElementById('version-selector').addEventListener('change', () => {
            const newVer = document.getElementById('version-selector').value;
            redirectTo(`${baseURL}${segments.osKey}/${segments.language}/${newVer}/`);
        });
    }

    // 跳转函数
    function redirectTo(path) {
        const url = new URL(path, window.location.href);
        if (url.protocol === 'file:') {
            url.pathname += 'index.html';
        }
        window.location.href = url.href;
    }
</script>
    

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
    

          
          
          <a href="../../index.html" class="icon icon-home">
            Ameba IoT Docs
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

    
    <div id="custom-selectors" style="display: block !important; padding: 0; background: none; border: none;"></div>

    

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        try {
            const segments = validateSegments(getCurrentSegments());
            const baseURL = getBaseURL();

            // 渲染HTML
            document.getElementById('custom-selectors').innerHTML = generateSelectorsHTML(segments);

            // 设置初始值
            setInitialValues(segments);

            // 绑定事件
            bindEvents(baseURL, segments);

            // 初始化认证逻辑

            
        } catch (error) {
            console.error("Error initializing selectors:", error);
        }
    });
</script>

        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../0_ameba_product/0_ameba_product_center_index.html">Products Center</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_ameba_sdk/0_ameba_sdks_index.html">Ameba SDK</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_ameba_solutions/0_ameba_solutions_index.html">Ameba Solutions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_gcc_build_environment/0_gcc_build_index.html">0.1 GCC Build Environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_gdb_debug/0_gdb_debug_index.html">0.2 GDB Debug</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_gcc_build_library/0_gcc_build_library_index.html">0.3 GCC Build Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_sdk_example/0_sdk_example_index.html">0.4 SDK Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_memory_layout/0_layout_index.html">0.5 Flash &amp; RAM Layout</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_user_config/0_usrcfg_index.html">0.6 User Config</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_tools/0_tools_index.html">0.7 Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_at_command/0_at_command_index.html">0.8 AT Commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_file_system/0_vfs_index.html">0.9 Virtual File System</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_ftl/0_ftl_index.html">0.a Flash Translation Layer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1_mpu_cache/0_mpu_cache_index.html">1.0 MPU and Cache</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1_boot_process/0_boot_index.html">1.1 BOOT Process</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1_ota/0_ota_index.html">1.2 OTA</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1_otpc/0_otpc_index.html">1.3 OTPC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1_chipen/0_chipen_index.html">1.4 Chip Enable</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1_ipc/0_ipc_index.html">1.5 Inter Processor Communication</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1_pinmux/0_pinmux_index.html">1.6 Pin Multiplexing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1_gpio/0_gpio_index.html">1.7 GPIO &amp; Pin Control</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="0_ps_index.html">1.9 Power Save</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Power Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="#power-saving-mode">Power-Saving Mode</a></li>
<li class="toctree-l2"><a class="reference internal" href="#tickless-for-freertos">Tickless for FreeRTOS</a></li>
<li class="toctree-l2"><a class="reference internal" href="#wi-fi-power-saving">Wi-Fi Power Saving</a></li>
<li class="toctree-l2"><a class="reference internal" href="#wakeup-source">Wakeup Source</a></li>
<li class="toctree-l2"><a class="reference internal" href="#entering-sleep-mode">Entering Sleep Mode</a></li>
<li class="toctree-l2"><a class="reference internal" href="#entering-deep-sleep-mode">Entering Deep-Sleep Mode</a></li>
<li class="toctree-l2"><a class="reference internal" href="#power-saving-configuration">Power-Saving Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="#power-saving-related-apis">Power-Saving Related APIs</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#wakelock-apis">Wakelock APIs</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#pmu-acquire-wakelock">pmu_acquire_wakelock</a></li>
<li class="toctree-l4"><a class="reference internal" href="#pmu-release-wakelock">pmu_release_wakelock</a></li>
<li class="toctree-l4"><a class="reference internal" href="#pmu-acquire-deepwakelock">pmu_acquire_deepwakelock</a></li>
<li class="toctree-l4"><a class="reference internal" href="#pmu-release-deepwakelock">pmu_release_deepwakelock</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#pmu-set-sysactive-time">pmu_set_sysactive_time</a></li>
<li class="toctree-l3"><a class="reference internal" href="#sleep-wake-callback-apis">Sleep/Wake Callback APIs</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#pmu-register-sleep-callback">pmu_register_sleep_callback</a></li>
<li class="toctree-l4"><a class="reference internal" href="#pmu-unregister-sleep-callback">pmu_unregister_sleep_callback</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#pmu-set-max-sleep-time">pmu_set_max_sleep_time</a></li>
<li class="toctree-l3"><a class="reference internal" href="#wakeup-reason-apis">Wakeup Reason APIs</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#wakeup-time">Wakeup time</a></li>
<li class="toctree-l2"><a class="reference internal" href="#uart-and-loguart">UART and LOGUART</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../2_whc_wifi_bridge/0_wifi_bridge_index.html">2.0 WHC Bridge</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2_whc_fullmac/0_fullmac_index.html">2.1 WHC FullMAC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2_wifi_tunnel/0_wifi_tunnel_index.html">2.2 Wi-Fi R-Mesh</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2_wifi_csi/0_wifi_csi_index.html">2.3 Wi-Fi CSI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2_wifi_adaptivity_test/0_wifi_adaptivity_index.html">2.4 Wi-Fi Adaptivity Test</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_security/0_security_index.html">3.1 Security &amp; Encryption</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_trng/0_trng_index.html">3.2 True Random Number Generator</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_crypto_engine/0_crypto_engine_index.html">3.9 Crypto Engine</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_ecdsa_engine/0_ecdsa_index.html">3.a ECDSA Engine</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_eddsa_engine/0_eddsa_index.html">3.b EDDSA Engine</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_rsa_engine/0_rsa_index.html">3.c RSA Engine</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_ap_trustzone/0_ap_tz_index.html">3.d AP Secure Service</a></li>
<li class="toctree-l1"><a class="reference internal" href="../4_ai/0_ai_index.html">4.1 AI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../4_ai_voice/0_ai_voice_index.html">4.2 AIVoice</a></li>
<li class="toctree-l1"><a class="reference internal" href="../4_multimedia/0_multimedia_index.html">4.3 Multimedia</a></li>
<li class="toctree-l1"><a class="reference internal" href="../4_dsp/0_dsp_index.html">4.4 DSP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../6_mass_production/0_mp_index.html">6.1 Mass Production</a></li>
<li class="toctree-l1"><a class="reference internal" href="../6_mptools/0_mptools_index.html">6.2 MP Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../7_usb/0_usb_index.html">7.1 USB Host &amp; Device</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_dmac/0_dmac_index.html">8.1 DMA Controller</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_psram/0_psram_index.html">8.2 PSRAM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_thermal/0_thermal_index.html">8.3 Thermal Meter</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_adc/0_adc_index.html">8.4 ADC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_ir/0_ir_index.html">8.5 IR</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_ledc/0_ledc_index.html">8.6 LED Controller</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_cap_touch/0_cap_touch_index.html">8.7 Cap-Touch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_key_scan/0_key_scan_index.html">8.8 Key-Scan</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_rtc_io/0_rtc_io_index.html">8.9 RTC-IO</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_lcdc/0_lcdc_index.html">8.a LCD Controller</a></li>
<li class="toctree-l1"><a class="reference internal" href="../10_api_docs/0_api_index.html">10.0 API Reference</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Ameba IoT Docs</a>
      </nav>

      <div class="wy-nav-content">
    
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="0_ps_index.html">Power Saving</a></li>
      <li class="breadcrumb-item active">Power Architecture</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <span class="target" id="power-saving"></span><!-- 下拉菜单 -->
<div style="margin: 20px 0; text-align: left;">
    <div style="display: flex; align-items: center; gap: 10px;">
        <span style="font-size: 14px;">IC: </span>
        <select class="tab-selector" style="height: 22px; padding: 2px 8px; font-size: 13px;">
            <option value="RTL8721Dx">RTL8721Dx</option>
            <option value="RTL8720E">RTL8720E</option>
            <option value="RTL8726E">RTL8726E</option>
            <option value="RTL8730E">RTL8730E</option>
        </select>
    </div>
</div>

<!-- 修复后的 JavaScript -->
<script>
document.addEventListener("DOMContentLoaded", function() {
    const selector = document.querySelector('.tab-selector');

    selector.addEventListener('change', function() {
        const targetTab = this.value;
        const tabs = document.querySelectorAll('.sphinx-tabs-tab');
        let found = false;

        tabs.forEach(tab => {
            const tabText = tab.textContent.trim();
            if (tabText === targetTab) {
                tab.click();
                window.dispatchEvent(new Event('resize')); // 触发插件更新
                found = true;
            }
        });

        if (!found) {
            console.error("未找到选项卡:", targetTab);
        }
    });
});
</script><section id="power-architecture">
<h1>Power Architecture<a class="headerlink" href="#power-architecture" title="Link to this heading"></a></h1>
<p>SoC has an advanced Power Management Controller (PMC), which can flexibly power up different power domains of the chip, to achieve the best balance between chip performance and power consumption. AON, SYSON, SOC are three main power domains in digital system. Functions in different power domains will be turned off differently in different power-saving modes.</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-0-0-0" aria-selected="true" class="sphinx-tabs-tab" id="tab-0-0-0" name="0-0" role="tab" tabindex="0">RTL8721Dx</button><button aria-controls="panel-0-0-1" aria-selected="false" class="sphinx-tabs-tab" id="tab-0-0-1" name="0-1" role="tab" tabindex="-1">RTL8726E</button><button aria-controls="panel-0-0-2" aria-selected="false" class="sphinx-tabs-tab" id="tab-0-0-2" name="0-2" role="tab" tabindex="-1">RTL8720E</button><button aria-controls="panel-0-0-3" aria-selected="false" class="sphinx-tabs-tab" id="tab-0-0-3" name="0-3" role="tab" tabindex="-1">RTL8730E</button></div><div aria-labelledby="tab-0-0-0" class="sphinx-tabs-panel" id="panel-0-0-0" name="0-0" role="tabpanel" tabindex="0"><figure class="align-center" id="id2">
<a class="reference internal image-reference" href="../../_images/power_domains_and_wakeup_sources.svg"><img alt="../../_images/power_domains_and_wakeup_sources.svg" height="283" src="../../_images/power_domains_and_wakeup_sources.svg" width="838" /></a>
<figcaption>
<p><span class="caption-text">Power domains and wakeup sources</span><a class="headerlink" href="#id2" title="Link to this image"></a></p>
</figcaption>
</figure>
</div><div aria-labelledby="tab-0-0-1" class="sphinx-tabs-panel" hidden="true" id="panel-0-0-1" name="0-1" role="tabpanel" tabindex="0"><figure class="align-center" id="id3">
<a class="reference internal image-reference" href="../../_images/lite_power_domains_and_wakeup_sources_dsp.svg"><img alt="../../_images/lite_power_domains_and_wakeup_sources_dsp.svg" height="252" src="../../_images/lite_power_domains_and_wakeup_sources_dsp.svg" width="860" /></a>
<figcaption>
<p><span class="caption-text">Power domains and wakeup sources</span><a class="headerlink" href="#id3" title="Link to this image"></a></p>
</figcaption>
</figure>
</div><div aria-labelledby="tab-0-0-2" class="sphinx-tabs-panel" hidden="true" id="panel-0-0-2" name="0-2" role="tabpanel" tabindex="0"><figure class="align-center" id="id4">
<a class="reference internal image-reference" href="../../_images/lite_power_domains_and_wakeup_sources.svg"><img alt="../../_images/lite_power_domains_and_wakeup_sources.svg" height="252" src="../../_images/lite_power_domains_and_wakeup_sources.svg" width="860" /></a>
<figcaption>
<p><span class="caption-text">Power domains and wakeup sources</span><a class="headerlink" href="#id4" title="Link to this image"></a></p>
</figcaption>
</figure>
</div><div aria-labelledby="tab-0-0-3" class="sphinx-tabs-panel" hidden="true" id="panel-0-0-3" name="0-3" role="tabpanel" tabindex="0"><figure class="align-center" id="id5">
<a class="reference internal image-reference" href="../../_images/smart_power_domains_and_wakeup_sources.svg"><img alt="../../_images/smart_power_domains_and_wakeup_sources.svg" height="283" src="../../_images/smart_power_domains_and_wakeup_sources.svg" width="838" /></a>
<figcaption>
<p><span class="caption-text">Power domains and wakeup sources</span><a class="headerlink" href="#id5" title="Link to this image"></a></p>
</figcaption>
</figure>
</div></div>
</section>
<section id="power-saving-mode">
<h1>Power-Saving Mode<a class="headerlink" href="#power-saving-mode" title="Link to this heading"></a></h1>
<p>We supports two low-power modes, which are sleep mode and deep-sleep mode.
The deep-sleep mode turns off more power domains than the sleep mode, so it has lower power consumption.</p>
<p>Tickless is a FreeRTOS low power feature, which just gates the CPU (no clock or power be turned off) when it has nothing to do.
Sleep mode flow and deep-sleep mode flow are based on Tickless.
The following table explains power-saving related terms.</p>
<table class="docutils align-default" id="id6" style="width: 100%">
<caption><span class="caption-text">Power-saving mode</span><a class="headerlink" href="#id6" title="Link to this table"></a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>Mode</p></th>
<th class="head"><p>AON domain</p></th>
<th class="head"><p>SYSON domain</p></th>
<th class="head"><p>SOC domain</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Tickless</p></td>
<td><p>ON</p></td>
<td><p>ON</p></td>
<td><p>ON</p></td>
<td><ul class="simple">
<li><p>FreeRTOS low power feature</p></li>
<li><p>CPU periodically enters WFI, and exits WFI when interrupts happen.</p></li>
<li><p>Radio status can be configured off/periodically on/always on, which depends on the application.</p></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><p>Sleep</p></td>
<td><p>ON</p></td>
<td><p>ON</p></td>
<td><p>Clock-gated or power-gated</p></td>
<td><ul class="simple">
<li><p>A power saving mode on chip level, including clock-gating mode and power-gating mode.</p></li>
<li><p>CPU can restore stack status when the system exits from sleep mode.</p></li>
<li><p>The system RAM will be retained, and the data in system RAM will not be lost.</p></li>
</ul>
</td>
</tr>
<tr class="row-even"><td><p>Deep-sleep</p></td>
<td><p>ON</p></td>
<td><p>OFF</p></td>
<td><p>OFF</p></td>
<td><ul class="simple">
<li><p>A more power-saving mode on chip-level.</p></li>
<li><p>CPU cannot restore stack status. When the system exits from deep-sleep mode, the CPU follows the reboot process.</p></li>
<li><p>The system RAM will not be retained.</p></li>
<li><p>The retention SRAM will not be power off.</p></li>
</ul>
</td>
</tr>
</tbody>
</table>
</section>
<section id="tickless-for-freertos">
<h1>Tickless for FreeRTOS<a class="headerlink" href="#tickless-for-freertos" title="Link to this heading"></a></h1>
<p>The FreeRTOS supports a low-power feature called tickless. It is implemented in an idle task which has the lowest priority.
That is, it is invoked when there is no other task under running. Note that unlike the original FreeRTOS,
We don’t wake up based on the <cite>xEpectedIdleTime</cite>.</p>
<figure class="align-center" id="id7">
<a class="reference internal image-reference" href="../../_images/freertos_tickless_in_an_idle_task.svg"><img alt="../../_images/freertos_tickless_in_an_idle_task.svg" height="289" src="../../_images/freertos_tickless_in_an_idle_task.svg" width="734" /></a>
<figcaption>
<p><span class="caption-text">FreeRTOS tickless in an idle task</span><a class="headerlink" href="#id7" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>The  figure above shows idle task code flow. In idle task, it will check sleep conditions (wakelock, sysactive_time, details in Section <a class="reference internal" href="#power-saving-wakelock-apis"><span class="std std-ref">Wakelock APIs</span></a> and <a class="reference internal" href="#pmu-set-sysactive-time"><span class="std std-ref">pmu_set_sysactive_time</span></a>) to determine whether needs to enter sleep mode or not.</p>
<ul class="simple">
<li><p>If not, the CPU will execute an ARM instruction <strong>WFI</strong> (wait for interrupt) which makes the CPU suspend until the interrupt happens. Normally systick interrupt resumes it. This is the software tickless.</p></li>
<li><p>If yes, it will execute the function <code class="xref py py-func docutils literal notranslate"><span class="pre">freertos_pre_sleep_processing()</span></code> to enter sleep mode or deep-sleep mode.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>Even FreeRTOS time control like software timer or <cite>vTaskDelay</cite> is set, it still enters the sleep mode if meeting the requirement as long as the idle task is executed.</p></li>
<li><p><cite>configUSE_TICKLESS_IDLE</cite> must be enabled for power-saving application because sleep mode flow is based on tickless.</p></li>
</ul>
</div>
</section>
<section id="wi-fi-power-saving">
<h1>Wi-Fi Power Saving<a class="headerlink" href="#wi-fi-power-saving" title="Link to this heading"></a></h1>
<p>IEEE 802.11 power save management allows the station to enter its own sleep state.
It defines that the station needs to keep awake at a certain timestamp and enter a sleep state otherwise.</p>
<p>WLAN driver acquires the wakelock to avoid the system entering sleep mode when WLAN needs to keep awake.
And it releases the wakelock when it is permitted to enter the sleep state.</p>
<p>IEEE 802.11 power management allows the station to enter power-saving mode.
The station cannot receive any frame during power saving. Thus AP needs to buffer these frames and requires the station to periodically wake up to
check the beacon which has the information of buffered frames.</p>
<figure class="align-center" id="id8">
<a class="reference internal image-reference" href="../../_images/timeline_of_power_saving.png"><img alt="../../_images/timeline_of_power_saving.png" src="../../_images/timeline_of_power_saving.png" style="width: 741.0px; height: 256.0px;" /></a>
<figcaption>
<p><span class="caption-text">Timeline of power saving</span><a class="headerlink" href="#id8" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>In SDK IEEE 802.11 power management is called LPS, and if NP enters sleep mode when Wi-Fi is in LPS mode, we call it WoWLAN mode.</p>
<p>In WoWLAN mode, a timer with a period of about 102ms will be set in the suspend function.
And LP will wake up every 102ms to receive the beacon to maintain the connection.</p>
<p>Except for LPS and WoWLAN, we also have IPS, which can be used when Wi-Fi is not connected.
The following tables list all three power-saving modes for Wi-Fi and the relationship between the system power mode and Wi-Fi power mode.</p>
<table class="docutils align-default" id="id9" style="width: 100%">
<caption><span class="caption-text"><strong>WiFi power saving mode</strong></span><a class="headerlink" href="#id9" title="Link to this table"></a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>Mode</p></th>
<th class="head"><p>Wi-Fi status</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>SDK</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>IPS</p></td>
<td><p>Not associated:</p>
<ul class="simple">
<li><p>RF/BB/MAC OFF</p></li>
</ul>
</td>
<td><p>Wi-Fi driver automatically turns Wi-Fi off to save power.</p></td>
<td><p>IPS mode is enabled in SDK by default and is not</p>
<p>recommended to be disabled.</p>
</td>
</tr>
<tr class="row-odd"><td><p>LPS</p></td>
<td><p>Associated:</p>
<ul class="simple">
<li><p>RF periodically ON/OFF</p></li>
<li><p>MAC/BB always ON</p></li>
</ul>
</td>
<td><p>LPS mode is used to implement IEEE 802.11 power management.</p>
<p>NP will control RF ON/OFF based on TSF and TIM IE in the beacon.</p>
</td>
<td><p>LPS mode is enabled in SDK by default but can be</p>
<p>disabled through API <code class="xref py py-func docutils literal notranslate"><span class="pre">wifi_set_lps_enable()</span></code>.</p>
</td>
</tr>
<tr class="row-even"><td><p>WoWLAN</p></td>
<td><p>Associated:</p>
<ul class="simple">
<li><p>RF and BB periodically ON/OFF</p></li>
<li><p>MAC periodically enters/ exits CG/PG</p></li>
</ul>
</td>
<td><p>NP is waked up at each beacon early interrupt to receive a beacon</p>
<p>from the associated AP.</p>
<p>NP will wake up AP when receiving a data packet.</p>
</td>
<td><p>WoWLAN mode is enabled in SDK by default.</p></td>
</tr>
</tbody>
</table>
<table class="docutils align-default" id="id10" style="width: 100%">
<caption><span class="caption-text"><strong>Relationship between system and Wi-Fi power mode</strong></span><a class="headerlink" href="#id10" title="Link to this table"></a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>System power mode</p></th>
<th class="head"><p>Wi-Fi power mode</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Active</p></td>
<td><p>IPS</p></td>
<td><p>Wi-Fi is on, but not connected</p></td>
</tr>
<tr class="row-odd"><td><p>Active</p></td>
<td><p>LPS</p></td>
<td><p>Wi-Fi is connected and enters IEEE 802.11 power management mechanism</p></td>
</tr>
<tr class="row-even"><td><p>Sleep</p></td>
<td><p>Wi-Fi OFF/IPS</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>Sleep</p></td>
<td><p>WoWLAN</p></td>
<td><p>Wi-Fi keeps associating.</p></td>
</tr>
<tr class="row-even"><td><p>Deep-sleep</p></td>
<td><p>Wi-Fi OFF</p></td>
<td><p>Deep-sleep is not recommended if Wi-Fi needs to keep on or associated.</p></td>
</tr>
</tbody>
</table>
<table class="docutils align-default" id="id11" style="width: 100%">
<caption><span class="caption-text"><strong>API to enable/disable LPS</strong></span><a class="headerlink" href="#id11" title="Link to this table"></a></caption>
<colgroup>
<col style="width: 40.0%" />
<col style="width: 60.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>API</p></th>
<th class="head"><p>Parameters</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>int wifi_set_lps_enable(u8 enable)</p></td>
<td><p>Parameter: enable</p>
<ul class="simple">
<li><p>TRUE: enable LPS</p></li>
<li><p>FALSE: disable LPS</p></li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>When Wi-Fi is connected and the system enters sleep mode, WoWLAN mode will be entered automatically.
And KM0 will periodically wake up to receive the beacon to maintain the connection, this will consume some power.
If you are more concerned about the system power consumption during sleep mode, and Wi-Fi is not a necessary function in your application,
it is recommended to set Wi-Fi off or choose Wi-Fi IPS mode.</p>
</section>
<section id="wakeup-source">
<h1>Wakeup Source<a class="headerlink" href="#wakeup-source" title="Link to this heading"></a></h1>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-1-1-0" aria-selected="true" class="sphinx-tabs-tab" id="tab-1-1-0" name="1-0" role="tab" tabindex="0">RTL8721Dx</button><button aria-controls="panel-1-1-1" aria-selected="false" class="sphinx-tabs-tab" id="tab-1-1-1" name="1-1" role="tab" tabindex="-1">RTL8726E</button><button aria-controls="panel-1-1-2" aria-selected="false" class="sphinx-tabs-tab" id="tab-1-1-2" name="1-2" role="tab" tabindex="-1">RTL8720E</button><button aria-controls="panel-1-1-3" aria-selected="false" class="sphinx-tabs-tab" id="tab-1-1-3" name="1-3" role="tab" tabindex="-1">RTL8730E</button></div><div aria-labelledby="tab-1-1-0" class="sphinx-tabs-panel" id="panel-1-1-0" name="1-0" role="tabpanel" tabindex="0"><p>The following table lists the wakeup sources that can be used to wake up the system under different power modes.</p>
<table class="docutils align-default" id="id12" style="width: 100%">
<caption><span class="caption-text">Wakeup sources</span><a class="headerlink" href="#id12" title="Link to this table"></a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>Wakeup source</p></th>
<th class="head"><p>Sleep CG</p></th>
<th class="head"><p>Sleep PG</p></th>
<th class="head"><p>Deep-sleep</p></th>
<th class="head"><p>Restriction</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>WLAN</p></td>
<td><p>√</p></td>
<td><p>√</p></td>
<td><p>X</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>BT</p></td>
<td><p>√</p></td>
<td><p>√</p></td>
<td><p>X</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>IPC</p></td>
<td><p>√</p></td>
<td><p>√</p></td>
<td><p>X</p></td>
<td><p>Only KM0 can use the IPC to wake up KM4.</p></td>
</tr>
<tr class="row-odd"><td><p>Basic Timer4~7</p></td>
<td><p>√</p></td>
<td><p>√</p></td>
<td><p>X</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>PMC Timer</p></td>
<td><p>√</p></td>
<td><p>√</p></td>
<td><p>X</p></td>
<td><p>For internal usage</p></td>
</tr>
<tr class="row-odd"><td><p>UART0~2</p></td>
<td><p>√</p></td>
<td><p>√</p></td>
<td><p>X</p></td>
<td><ul class="simple">
<li><p>When using UART as a wakeup source, the Rx clock source can only be OSC2M, and do not turn off OSC4M during sleep.</p></li>
<li><p>When the baudrate is larger than 115200, it is not recommended to use UART as a wakeup source.</p></li>
<li><p>The portion of the command used to wake up that exceeds the FIFO depth (64B) will be lost.</p></li>
</ul>
</td>
</tr>
<tr class="row-even"><td><p>LOGUART</p></td>
<td><p>√</p></td>
<td><p>√</p></td>
<td><p>X</p></td>
<td><p>When using LOGUART as a wakeup source:</p>
<ul class="simple">
<li><p>If the Rx clock source is XTAL40M, do not turn off XTAL or OSC4M during sleep.</p></li>
<li><p>If the Rx clock source is OSC2M, do not turn off OSC4M during sleep.</p></li>
<li><p>The portion of the command used to wake up that exceeds the FIFO depth (16B) will be lost.</p></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><p>GPIO</p></td>
<td><p>√</p></td>
<td><p>√</p></td>
<td><p>X</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>I2C</p></td>
<td><p>√</p></td>
<td><p>√</p></td>
<td><p>X</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>CAP_TOUCH</p></td>
<td><p>√</p></td>
<td><p>√</p></td>
<td><p>X</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>ADC</p></td>
<td><p>√</p></td>
<td><p>√</p></td>
<td><p>X</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>SDIO</p></td>
<td><p>√</p></td>
<td><p>√</p></td>
<td><p>X</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>Key-Scan</p></td>
<td><p>√</p></td>
<td><p>√</p></td>
<td><p>X</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>BOR</p></td>
<td><p>√</p></td>
<td><p>√</p></td>
<td><p>√</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>PWR_DOWN</p></td>
<td><p>√</p></td>
<td><p>√</p></td>
<td><p>√</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>AON_TIMER</p></td>
<td><p>√</p></td>
<td><p>√</p></td>
<td><p>√</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>AON_WAKEPIN</p></td>
<td><p>√</p></td>
<td><p>√</p></td>
<td><p>√</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>RTC</p></td>
<td><p>√</p></td>
<td><p>√</p></td>
<td><p>√</p></td>
<td></td>
</tr>
</tbody>
</table>
</div><div aria-labelledby="tab-1-1-1" class="sphinx-tabs-panel" hidden="true" id="panel-1-1-1" name="1-1" role="tabpanel" tabindex="0"><p>A hardware SYSON power management control module (SYSON PMC) is designed to control the clock and power of NP, and then NP controls the clock and power of AP.
When the system enters sleep mode, CPUs can select to enter clock-gating (CG) or power-gating (PG) mode, while SYSON PMC maintained active to wake up NP when wakeup sources are triggered.</p>
<p>Sleep and wakeup flow of sleep mode can be described as:</p>
<ul class="simple">
<li><p>In terms of sleep flow, NP helps close the clock or power of AP and DSP, and SYSON PMC helps close the clock or power of NP.</p></li>
<li><p>In terms of wakeup flow, SYSON PMC helps open the clock or power of NP, and NP helps open the power or clock of AP and DSP.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>Both KM4 and KR4 can be configured as NP. If KR4 is configured as NP, KM4 is considered as AP.</p></li>
<li><p>The mode of memory is configurable when the system enters sleep mode. The retention mode is recommended for the balance between power saving and data retention.</p></li>
</ul>
</div>
<p>In deep-sleep mode, only the memory in AON domain can be maintained, while memory in other domains will be shut down. So CPU cannot restore the stack status.</p>
<p>Various wakeup sources are provided and every wakeup source can be configured to wake up NP or AP according to user’s requirement.
AON is special because it is mater switch that manages all the wake-up sources in AON domain. Only wakeup sources in AON domain can wake up the system from deep-sleep mode.</p>
<p>The following table lists the wakeup sources that can be used to wake up the system under different power modes.</p>
<table class="docutils align-default" id="id13" style="width: 100%">
<caption><span class="caption-text">Wakeup sources</span><a class="headerlink" href="#id13" title="Link to this table"></a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>Wakeup source</p></th>
<th class="head"><p>Sleep CG</p></th>
<th class="head"><p>Sleep PG</p></th>
<th class="head"><p>Deep-sleep</p></th>
<th class="head"><p>Restriction</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>WLAN</p></td>
<td><p>√</p></td>
<td><p>√</p></td>
<td><p>X</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>BT</p></td>
<td><p>√</p></td>
<td><p>√</p></td>
<td><p>X</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>IWDG</p></td>
<td><p>√</p></td>
<td><p>√</p></td>
<td><p>X</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>IPC</p></td>
<td><p>√</p></td>
<td><p>√</p></td>
<td><p>X</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>Basic Timer</p></td>
<td><p>√</p></td>
<td><p>√</p></td>
<td><p>X</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>UART</p></td>
<td><p>√</p></td>
<td><p>√</p></td>
<td><p>X</p></td>
<td><ul class="simple">
<li><p>When using UART as a wakeup source, if the Rx clock source is XTAL40M, do not turn off XTAL during sleep.</p></li>
<li><p>The portion of the command used to wake up that exceeds the FIFO depth (64B) will be lost.</p></li>
</ul>
</td>
</tr>
<tr class="row-even"><td><p>LOGUART</p></td>
<td><p>√</p></td>
<td><p>√</p></td>
<td><p>X</p></td>
<td><ul class="simple">
<li><p>When using LOGUART as a wakeup source, if the Rx clock source is XTAL40M, do not turn off XTAL during sleep.</p></li>
<li><p>The portion of the command used to wake up that exceeds the FIFO depth (16B) will be lost.</p></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><p>GPIO</p></td>
<td><p>√</p></td>
<td><p>√</p></td>
<td><p>X</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>SPI</p></td>
<td><p>√</p></td>
<td><p>√</p></td>
<td><p>X</p></td>
<td><ul class="simple">
<li><p>When using SPI as a wakeup source, do not turn off the power and clock of SOC domain.</p></li>
<li><p>Only when the NP core is active and AP core is sleep, NP can use the SPI to wake up AP.</p></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><p>CAP_TOUCH</p></td>
<td><p>√</p></td>
<td><p>√</p></td>
<td><p>X</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>ADC</p></td>
<td><p>√</p></td>
<td><p>√</p></td>
<td><p>X</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>VAD</p></td>
<td><p>√</p></td>
<td><p>√</p></td>
<td><p>X</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>BOR</p></td>
<td><p>√</p></td>
<td><p>√</p></td>
<td><p>√</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>PWR_DOWN</p></td>
<td><p>√</p></td>
<td><p>√</p></td>
<td><p>√</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>AON_TIMER</p></td>
<td><p>√</p></td>
<td><p>√</p></td>
<td><p>√</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>AON_WAKEPIN</p></td>
<td><p>√</p></td>
<td><p>√</p></td>
<td><p>√</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>RTC</p></td>
<td><p>√</p></td>
<td><p>√</p></td>
<td><p>√</p></td>
<td></td>
</tr>
</tbody>
</table>
</div><div aria-labelledby="tab-1-1-2" class="sphinx-tabs-panel" hidden="true" id="panel-1-1-2" name="1-2" role="tabpanel" tabindex="0"><p>A hardware SYSON power management control module (SYSON PMC) is designed to control the clock and power of NP, and then NP controls the clock and power of AP.
When the system enters sleep mode, CPUs can select to enter clock-gating (CG) or power-gating (PG) mode, while SYSON PMC maintained active to wake up NP when wakeup sources are triggered.</p>
<p>Sleep and wakeup flow of sleep mode can be described as:</p>
<ul class="simple">
<li><p>In terms of sleep flow, NP helps close the clock or power of AP, and SYSON PMC helps close the clock or power of NP.</p></li>
<li><p>In terms of wakeup flow, SYSON PMC helps open the clock or power of NP, and NP helps open the power or clock of AP.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>Both KM4 and KR4 can be configured as NP. If KR4 is configured as NP, KM4 is considered as AP.</p></li>
<li><p>The mode of memory is configurable when the system enters sleep mode. The retention mode is recommended for the balance between power saving and data retention.</p></li>
</ul>
</div>
<p>In deep-sleep mode, only the memory in AON domain can be maintained, while memory in other domains will be shut down. So CPU cannot restore the stack status.</p>
<p>Various wakeup sources are provided and every wakeup source can be configured to wake up NP or AP according to user’s requirement.
AON is special because it is mater switch that manages all the wake-up sources in AON domain. Only wakeup sources in AON domain can wake up the system from deep-sleep mode.</p>
<p>The following table lists the wakeup sources that can be used to wake up the system under different power modes.</p>
<table class="docutils align-default" id="id14" style="width: 100%">
<caption><span class="caption-text">Wakeup sources</span><a class="headerlink" href="#id14" title="Link to this table"></a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>Wakeup source</p></th>
<th class="head"><p>Sleep CG</p></th>
<th class="head"><p>Sleep PG</p></th>
<th class="head"><p>Deep-sleep</p></th>
<th class="head"><p>Restriction</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>WLAN</p></td>
<td><p>√</p></td>
<td><p>√</p></td>
<td><p>X</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>BT</p></td>
<td><p>√</p></td>
<td><p>√</p></td>
<td><p>X</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>IWDG</p></td>
<td><p>√</p></td>
<td><p>√</p></td>
<td><p>X</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>IPC</p></td>
<td><p>√</p></td>
<td><p>√</p></td>
<td><p>X</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>Basic Timer</p></td>
<td><p>√</p></td>
<td><p>√</p></td>
<td><p>X</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>UART</p></td>
<td><p>√</p></td>
<td><p>√</p></td>
<td><p>X</p></td>
<td><ul class="simple">
<li><p>When using UART as a wakeup source, if the Rx clock source is XTAL40M, do not turn off XTAL during sleep.</p></li>
<li><p>The portion of the command used to wake up that exceeds the FIFO depth (64B) will be lost.</p></li>
</ul>
</td>
</tr>
<tr class="row-even"><td><p>LOGUART</p></td>
<td><p>√</p></td>
<td><p>√</p></td>
<td><p>X</p></td>
<td><ul class="simple">
<li><p>When using LOGUART as a wakeup source, if the Rx clock source is XTAL40M, do not turn off XTAL during sleep.</p></li>
<li><p>The portion of the command used to wake up that exceeds the FIFO depth (16B) will be lost.</p></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><p>GPIO</p></td>
<td><p>√</p></td>
<td><p>√</p></td>
<td><p>X</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>SPI</p></td>
<td><p>√</p></td>
<td><p>√</p></td>
<td><p>X</p></td>
<td><ul class="simple">
<li><p>When using SPI as a wakeup source, do not turn off the power and clock of SOC domain.</p></li>
<li><p>Only when the NP core is active and AP core is sleep, NP can use the SPI to wake up AP.</p></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><p>CAP_TOUCH</p></td>
<td><p>√</p></td>
<td><p>√</p></td>
<td><p>X</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>ADC</p></td>
<td><p>√</p></td>
<td><p>√</p></td>
<td><p>X</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>VAD</p></td>
<td><p>√</p></td>
<td><p>√</p></td>
<td><p>X</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>BOR</p></td>
<td><p>√</p></td>
<td><p>√</p></td>
<td><p>√</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>PWR_DOWN</p></td>
<td><p>√</p></td>
<td><p>√</p></td>
<td><p>√</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>AON_TIMER</p></td>
<td><p>√</p></td>
<td><p>√</p></td>
<td><p>√</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>AON_WAKEPIN</p></td>
<td><p>√</p></td>
<td><p>√</p></td>
<td><p>√</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>RTC</p></td>
<td><p>√</p></td>
<td><p>√</p></td>
<td><p>√</p></td>
<td></td>
</tr>
</tbody>
</table>
</div><div aria-labelledby="tab-1-1-3" class="sphinx-tabs-panel" hidden="true" id="panel-1-1-3" name="1-3" role="tabpanel" tabindex="0"><p>The following table lists the wakeup sources that can be used to wake up the system under different power modes.</p>
<table class="docutils align-default" id="id15" style="width: 100%">
<caption><span class="caption-text">Wakeup sources</span><a class="headerlink" href="#id15" title="Link to this table"></a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>Wakeup source</p></th>
<th class="head"><p>Sleep CG</p></th>
<th class="head"><p>Sleep PG</p></th>
<th class="head"><p>Deep-sleep</p></th>
<th class="head"><p>Restriction</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>WLAN</p></td>
<td><p>√</p></td>
<td><p>√</p></td>
<td><p>X</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>BT</p></td>
<td><p>√</p></td>
<td><p>√</p></td>
<td><p>X</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>AON_WAKEPIN</p></td>
<td><p>√</p></td>
<td><p>√</p></td>
<td><p>√</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>UART</p></td>
<td><p>√</p></td>
<td><p>√</p></td>
<td><p>X</p></td>
<td><ul class="simple">
<li><p>When using UART as a wakeup source:</p>
<ul>
<li><p>If the Rx clock source is XTAL40M, do not turn off XTAL during sleep.</p></li>
<li><p>If the Rx clock source is OSC2M, do not turn off OSC4M during sleep.</p></li>
</ul>
</li>
<li><p>The portion of the command used to wake up that exceeds the FIFO depth (64B) will be lost.</p></li>
</ul>
</td>
</tr>
<tr class="row-even"><td><p>IPC</p></td>
<td><p>√</p></td>
<td><p>√</p></td>
<td><p>X</p></td>
<td><p>The IPC can only wake up CA32 and KM4, but not KM0.</p></td>
</tr>
<tr class="row-odd"><td><p>SPI</p></td>
<td><p>√</p></td>
<td><p>X</p></td>
<td><p>X</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>VAD</p></td>
<td><p>√</p></td>
<td><p>X</p></td>
<td><p>X</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>BOR</p></td>
<td><p>√</p></td>
<td><p>√</p></td>
<td><p>√</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>PWR_DOWN</p></td>
<td><p>√</p></td>
<td><p>√</p></td>
<td><p>√</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>CAP_TOUCH</p></td>
<td><p>√</p></td>
<td><p>√</p></td>
<td><p>X</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>ADC</p></td>
<td><p>√</p></td>
<td><p>√</p></td>
<td><p>X</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>RTC</p></td>
<td><p>√</p></td>
<td><p>√</p></td>
<td><p>√</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>GPIO</p></td>
<td><p>√</p></td>
<td><p>√</p></td>
<td><p>X</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>LOGUART</p></td>
<td><p>√</p></td>
<td><p>√</p></td>
<td><p>X</p></td>
<td><ul class="simple">
<li><p>When using LOGUART as a wakeup source:</p>
<ul>
<li><p>If the Rx clock source is XTAL40M, do not turn off XTAL during sleep.</p></li>
<li><p>If the Rx clock source is OSC2M, do not turn off OSC4M during sleep.</p></li>
</ul>
</li>
<li><p>The portion of the command used to wake up that exceeds the FIFO depth (16B) will be lost.</p></li>
</ul>
</td>
</tr>
<tr class="row-even"><td><p>Basic Timer</p></td>
<td><p>√</p></td>
<td><p>√</p></td>
<td><p>X</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>IWDG</p></td>
<td><p>√</p></td>
<td><p>√</p></td>
<td><p>X</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>AON_TIMER</p></td>
<td><p>√</p></td>
<td><p>√</p></td>
<td><p>√</p></td>
<td></td>
</tr>
</tbody>
</table>
<p>A hardware SYSON power management control module (SYSON PMC) is designed to control the clock and power of LP,
and then LP controls the clock and power of NP and AP. When the system enters sleep mode,
CPUs can select to enter clock-gating (CG) or power-gating (PG) mode,
while SYSON PMC maintained active to wake up LP when wakeup sources are triggered.</p>
</div></div>
</section>
<section id="entering-sleep-mode">
<h1>Entering Sleep Mode<a class="headerlink" href="#entering-sleep-mode" title="Link to this heading"></a></h1>
<p>Sleep mode is based on FreeRTOS tickless, thus it is recommended to enter sleep mode by releasing the wakelock.</p>
<ol class="arabic simple">
<li><p>Initialize the specific peripheral.</p></li>
<li><p>Enable and register the peripheral’s interrupt.</p></li>
<li><p>Set <code class="docutils literal notranslate"><span class="pre">sleep_wevent_config[]</span></code> in <code class="file docutils literal notranslate"><span class="pre">ambea_sleepcfg.c</span></code>, and the interrupt should be registered on the same CPU selected by <code class="docutils literal notranslate"><span class="pre">sleep_wevent_config[]</span></code>.</p></li>
<li><p>For peripherals that need special clock settings, set <code class="docutils literal notranslate"><span class="pre">ps_config[]</span></code> in <code class="file docutils literal notranslate"><span class="pre">ameba_sleepcfg.c</span></code> if needed.</p></li>
<li><p>Register sleep/wakeup callback if needed.</p></li>
<li><p>Enter sleep mode by releasing the wakelock in application core(AP) (<cite>PMU_OS</cite> needs to be released since it is acquired by default when boot).</p></li>
<li><p>Clear the peripheral’s interrupt when wakeup.</p></li>
</ol>
</section>
<section id="entering-deep-sleep-mode">
<h1>Entering Deep-Sleep Mode<a class="headerlink" href="#entering-deep-sleep-mode" title="Link to this heading"></a></h1>
<p>Deep-sleep can also be entered from FreeRTOS tickless flow.</p>
<p>When the system boots, AP holds the deepwakelock <cite>PMU_OS</cite>,
thus <code class="xref py py-func docutils literal notranslate"><span class="pre">freertos_ready_to_dsleep()</span></code> will be checked fail and the system does not enter deep-sleep mode in idle task by default.
Since <code class="xref py py-func docutils literal notranslate"><span class="pre">freertos_ready_to_dsleep()</span></code> will be checked only after <code class="xref py py-func docutils literal notranslate"><span class="pre">freertos_ready_to_sleep()</span></code> is checked pass,
both the wakelock and deepwakelock need to be released for entering deep-sleep mode.</p>
<p><strong>Configuration:</strong></p>
<ol class="arabic simple">
<li><p>Initialize the related peripheral and enable its interrupt.</p></li>
<li><p>Set <code class="docutils literal notranslate"><span class="pre">sleep_wakepin_config[]</span></code> in <code class="file docutils literal notranslate"><span class="pre">ameba_sleepcfg.c</span></code> when using AON wakepin as a wakeup source.</p></li>
<li><p>Enter deep-sleep mode by releasing the deepwakelock and wakelock in AP.</p></li>
</ol>
</section>
<section id="power-saving-configuration">
<h1>Power-Saving Configuration<a class="headerlink" href="#power-saving-configuration" title="Link to this heading"></a></h1>
<p>Please reference User Config chapter for detail information.</p>
</section>
<section id="power-saving-related-apis">
<h1>Power-Saving Related APIs<a class="headerlink" href="#power-saving-related-apis" title="Link to this heading"></a></h1>
<section id="wakelock-apis">
<span id="power-saving-wakelock-apis"></span><h2>Wakelock APIs<a class="headerlink" href="#wakelock-apis" title="Link to this heading"></a></h2>
<p>In some situations, the system needs to keep awake to receive certain events; otherwise, events may be missed when the system is in sleep mode.
An idea of wakelock is introduced in that the system cannot enter sleep mode if some module is holding the wakelock.</p>
<p>The Wakelock is a 32-bit map. Each module has its own bit in the wakelock bit map (see enum <cite>PMU_DEVICE</cite>). Users can also add the wakelock in the enum.</p>
<ul class="simple">
<li><p>If the wakelock bit map equals zero, it means that there is no module holding the wakelock.</p></li>
<li><p>If the wakelock bit map is larger than zero, it means that some modules are holding the wakelock, and the system is not allowed to enter sleep mode.</p></li>
</ul>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-2-2-0" aria-selected="true" class="sphinx-tabs-tab" id="tab-2-2-0" name="2-0" role="tab" tabindex="0">RTL8721Dx</button><button aria-controls="panel-2-2-1" aria-selected="false" class="sphinx-tabs-tab" id="tab-2-2-1" name="2-1" role="tab" tabindex="-1">RTL8720E</button><button aria-controls="panel-2-2-2" aria-selected="false" class="sphinx-tabs-tab" id="tab-2-2-2" name="2-2" role="tab" tabindex="-1">RTL8726E</button><button aria-controls="panel-2-2-3" aria-selected="false" class="sphinx-tabs-tab" id="tab-2-2-3" name="2-3" role="tab" tabindex="-1">RTL8730E</button></div><div aria-labelledby="tab-2-2-0" class="sphinx-tabs-panel" id="panel-2-2-0" name="2-0" role="tabpanel" tabindex="0"><p>Wakelock is a judging condition in the function <code class="xref py py-func docutils literal notranslate"><span class="pre">freertos_ready_to_sleep()</span></code>.
When the system boots, application core(AP) holds the wakelock <cite>PMU_OS</cite>, and network core(NP) holds the wakelock <cite>PMU_OS</cite> and <cite>PMU_KM4_RUN</cite> or <cite>PMU_AP_RUN</cite>.
Only if all wakelocks are released, AP or NP is permitted to enter sleep mode. The function <code class="xref py py-func docutils literal notranslate"><span class="pre">freertos_ready_to_sleep()</span></code> will judge the value of wakelock.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">enum</span><span class="w"> </span><span class="n">PMU_DEVICE</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="n">PMU_OS</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">   </span><span class="n">PMU_WLAN_DEVICE</span><span class="p">,</span>
<span class="w">   </span><span class="n">PMU_KM4_RUN</span><span class="p">,</span>
<span class="w">   </span><span class="n">PMU_WLAN_FW_DEVICE</span><span class="p">,</span>
<span class="w">   </span><span class="n">PMU_BT_DEVICE</span><span class="p">,</span>
<span class="w">   </span><span class="n">PMU_DEV_USER_BASE</span><span class="p">,</span>
<span class="w">   </span><span class="n">PMU_MAX</span>
<span class="p">};</span>
</pre></div>
</div>
<p>It is recommended to enter sleep mode by releasing the wakelock.
After the wakelock <cite>PMU_OS</cite> of AP is released, AP will enter sleep mode in idle task and send IPC to NP.
NP will power-gate or clock-gate AP and then release <cite>PMU_OS</cite> and <cite>PMU_KM4_RUN</cite> or <cite>PMU_AP_RUN</cite>.</p>
<p>When the system wakes, it will enter sleep mode again quickly unless it acquires the wakelock.</p>
<p>Similar to the wakelock for sleep mode, there is a 32-bit deepwakelock map for deep-sleep mode.
If the deepwakelock bit map is larger than zero, it means that some modules are holding the deepwakelock, and the system is not allowed to enter deep-sleep mode.
When the system boots, application core holds the deepwakelock <cite>PMU_OS</cite>.</p>
<p>Deepwakelock is a judging condition in the function <code class="xref py py-func docutils literal notranslate"><span class="pre">freertos_ready_to_dsleep()</span></code>.
After the deepwakelock <cite>PMU_OS</cite> of AP is released, and all wakelocks of AP are released, AP will be allowed to enter deep-sleep mode and send IPC to NP in idle task.
NP will send a deep-sleep request and let the chip finally enter deep-sleep mode.</p>
</div><div aria-labelledby="tab-2-2-1" class="sphinx-tabs-panel" hidden="true" id="panel-2-2-1" name="2-1" role="tabpanel" tabindex="0"><p>Wakelock is a judging condition in the function <code class="xref py py-func docutils literal notranslate"><span class="pre">freertos_ready_to_sleep()</span></code>.
When the system boots, application core(AP) holds the wakelock <cite>PMU_OS</cite>, and network core(NP) holds the wakelock <cite>PMU_OS</cite> and <cite>PMU_KM4_RUN</cite> or <cite>PMU_AP_RUN</cite>.
Only if all wakelocks are released, AP or NP is permitted to enter sleep mode. The function <code class="xref py py-func docutils literal notranslate"><span class="pre">freertos_ready_to_sleep()</span></code> will judge the value of wakelock.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">enum</span><span class="w"> </span><span class="n">PMU_DEVICE</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="n">PMU_OS</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">   </span><span class="n">PMU_WLAN_DEVICE</span><span class="p">,</span>
<span class="w">   </span><span class="n">PMU_KM4_RUN</span><span class="p">,</span>
<span class="w">   </span><span class="n">PMU_KR4_RUN</span><span class="p">,</span>
<span class="w">   </span><span class="n">PMU_DSP_RUN</span><span class="p">,</span>
<span class="w">   </span><span class="n">PMU_WLAN_FW_DEVICE</span><span class="p">,</span>
<span class="w">   </span><span class="n">PMU_BT_DEVICE</span><span class="p">,</span>
<span class="w">   </span><span class="n">PMU_DEV_USER_BASE</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="cm">/*number 7 ~ 31 is reserved for customer use*/</span>
<span class="w">   </span><span class="n">PMU_MAX</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="mi">31</span><span class="p">,</span>
<span class="p">};</span>
</pre></div>
</div>
<p>It is recommended to enter sleep mode by releasing the wakelock.
After the wakelock <cite>PMU_OS</cite> of AP is released, AP will enter sleep mode in idle task and send IPC to NP.
NP will power-gate or clock-gate AP and then release <cite>PMU_OS</cite> and <cite>PMU_KM4_RUN</cite> or <cite>PMU_AP_RUN</cite>.</p>
<p>When the system wakes, it will enter sleep mode again quickly unless it acquires the wakelock.</p>
<p>Similar to the wakelock for sleep mode, there is a 32-bit deepwakelock map for deep-sleep mode.
If the deepwakelock bit map is larger than zero, it means that some modules are holding the deepwakelock, and the system is not allowed to enter deep-sleep mode.
When the system boots, application core holds the deepwakelock <cite>PMU_OS</cite>.</p>
<p>Deepwakelock is a judging condition in the function <code class="xref py py-func docutils literal notranslate"><span class="pre">freertos_ready_to_dsleep()</span></code>.
After the deepwakelock <cite>PMU_OS</cite> of AP is released, and all wakelocks of AP are released, AP will be allowed to enter deep-sleep mode and send IPC to NP in idle task.
NP will send a deep-sleep request and let the chip finally enter deep-sleep mode.</p>
</div><div aria-labelledby="tab-2-2-2" class="sphinx-tabs-panel" hidden="true" id="panel-2-2-2" name="2-2" role="tabpanel" tabindex="0"><p>Wakelock is a judging condition in the function <code class="xref py py-func docutils literal notranslate"><span class="pre">freertos_ready_to_sleep()</span></code>.
When the system boots, application core(AP) holds the wakelock <cite>PMU_OS</cite>, and network core(NP) holds the wakelock <cite>PMU_OS</cite> and <cite>PMU_KM4_RUN</cite> or <cite>PMU_AP_RUN</cite>.
Only if all wakelocks are released, AP or NP is permitted to enter sleep mode. The function <code class="xref py py-func docutils literal notranslate"><span class="pre">freertos_ready_to_sleep()</span></code> will judge the value of wakelock.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">enum</span><span class="w"> </span><span class="n">PMU_DEVICE</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="n">PMU_OS</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">   </span><span class="n">PMU_WLAN_DEVICE</span><span class="p">,</span>
<span class="w">   </span><span class="n">PMU_KM4_RUN</span><span class="p">,</span>
<span class="w">   </span><span class="n">PMU_KR4_RUN</span><span class="p">,</span>
<span class="w">   </span><span class="n">PMU_DSP_RUN</span><span class="p">,</span>
<span class="w">   </span><span class="n">PMU_WLAN_FW_DEVICE</span><span class="p">,</span>
<span class="w">   </span><span class="n">PMU_BT_DEVICE</span><span class="p">,</span>
<span class="w">   </span><span class="n">PMU_DEV_USER_BASE</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="cm">/*number 7 ~ 31 is reserved for customer use*/</span>
<span class="w">   </span><span class="n">PMU_MAX</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="mi">31</span><span class="p">,</span>
<span class="p">};</span>
</pre></div>
</div>
<p>It is recommended to enter sleep mode by releasing the wakelock.
After the wakelock <cite>PMU_OS</cite> of AP is released, AP will enter sleep mode in idle task and send IPC to NP.
NP will power-gate or clock-gate AP and then release <cite>PMU_OS</cite> and <cite>PMU_KM4_RUN</cite> or <cite>PMU_AP_RUN</cite>.</p>
<p>When the system wakes, it will enter sleep mode again quickly unless it acquires the wakelock.</p>
<p>Similar to the wakelock for sleep mode, there is a 32-bit deepwakelock map for deep-sleep mode.
If the deepwakelock bit map is larger than zero, it means that some modules are holding the deepwakelock, and the system is not allowed to enter deep-sleep mode.
When the system boots, application core holds the deepwakelock <cite>PMU_OS</cite>.</p>
<p>Deepwakelock is a judging condition in the function <code class="xref py py-func docutils literal notranslate"><span class="pre">freertos_ready_to_dsleep()</span></code>.
After the deepwakelock <cite>PMU_OS</cite> of AP is released, and all wakelocks of AP are released, AP will be allowed to enter deep-sleep mode and send IPC to NP in idle task.
NP will send a deep-sleep request and let the chip finally enter deep-sleep mode.</p>
</div><div aria-labelledby="tab-2-2-3" class="sphinx-tabs-panel" hidden="true" id="panel-2-2-3" name="2-3" role="tabpanel" tabindex="0"><p>Wakelock is a judging condition in the function <code class="xref py py-func docutils literal notranslate"><span class="pre">freertos_ready_to_sleep()</span></code>.
When the system boots, CA32/KM4 holds the wakelock PMU_OS, and KM0 holds the wakelock <cite>PMU_OS</cite>, <cite>PMU_KM4_RUN</cite> and <cite>PMU_AP_RUN</cite>.
Only if all wakelocks are released, CPU is permitted to enter sleep mode. The function <code class="xref py py-func docutils literal notranslate"><span class="pre">freertos_ready_to_sleep()</span></code> will judge the value of wakelock.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">typedef</span><span class="w"> </span><span class="k">enum</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="n">PMU_OS</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">   </span><span class="n">PMU_WLAN_DEVICE</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">   </span><span class="n">PMU_LOGUART_DEVICE</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span>
<span class="w">   </span><span class="n">PMU_KM4_RUN</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span>
<span class="w">   </span><span class="n">PMU_UART0_DEVICE</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span>
<span class="w">   </span><span class="n">PMU_UART1_DEVICE</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span>
<span class="w">   </span><span class="n">PMU_I2C0_DEVICE</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span>
<span class="w">   </span><span class="n">PMU_TOUCH_DEVICE</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span>
<span class="w">   </span><span class="n">PMU_USOC_DEVICE</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span>
<span class="w">   </span><span class="n">PMU_DONGLE_DEVICE</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="mi">9</span><span class="p">,</span>
<span class="w">   </span><span class="n">PMU_RTC_DEVICE</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span>
<span class="w">   </span><span class="n">PMU_CONSOL_DEVICE</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="mi">11</span><span class="p">,</span>
<span class="w">   </span><span class="n">PMU_ADC_DEVICE</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="mi">12</span><span class="p">,</span>
<span class="w">   </span><span class="n">PMU_WAKWLOCK_TIMEOUT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">13</span><span class="p">,</span>
<span class="w">   </span><span class="n">PMU_AP_RUN</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="mi">14</span><span class="p">,</span>
<span class="w">   </span><span class="n">PMU_PSRAM_DEVICE</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="mi">15</span><span class="p">,</span>
<span class="w">   </span><span class="n">PMU_DEV_USER_BASE</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="mi">16</span><span class="p">,</span><span class="w"> </span><span class="cm">/*number 16 ~ 31 is reserved for customer use*/</span>
<span class="w">   </span><span class="n">PMU_BT_DEVICE</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="mi">17</span><span class="p">,</span>
<span class="w">   </span><span class="n">PMU_VAD_DEVICE</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="mi">18</span><span class="p">,</span>
<span class="w">   </span><span class="n">PMU_MAX</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="mi">31</span>
<span class="p">}</span><span class="w"> </span><span class="n">PMU_DEVICE</span><span class="p">;</span>
</pre></div>
</div>
<p>It is recommended to enter sleep mode by releasing the wakelock.
After the wakelock <cite>PMU_OS</cite> of CA32 is released, CA32 will enter sleep mode in idle task and send IPC to KM0.
KM0 will gate CA32 clock/power first and then release <cite>PMU_AP_RUN</cite>, and then KM4 will release <cite>PMU_OS</cite> in idle task if found CA32 entered sleep mode already,
and send IPC to KM0, KM0 will gate KM4 clock/power first and then release <cite>PMU_OS</cite> and <cite>PMU_KM4_RUN</cite>.</p>
<p>When the system wakes, it will enter sleep mode again quickly unless it acquires the wakelock.</p>
<p>Similar to the wakelock for sleep mode, there is a 32-bit deepwakelock map for deep-sleep mode.
If the deepwakelock bit map is larger than zero, it means that some modules are holding the deepwakelock, and the system is not allowed to enter deep-sleep mode.
When the system boots, CA32 holds the deepwakelock <cite>PMU_OS</cite>.</p>
<p>Deepwakelock is a judging condition in the function <code class="xref py py-func docutils literal notranslate"><span class="pre">freertos_ready_to_dsleep()</span></code>.
After the deepwakelock <cite>PMU_OS</cite> of CA32 is released, and all wakelocks of CA32 are released, CA32 will be allowed to enter deep-sleep mode and send IPC to KM0 in idle task.
KM0 will send a deep-sleep request and let the chip finally enter deep-sleep mode.</p>
</div></div>
<p>APIs in the following sections are provided to control the wakelock or deepwakelock.</p>
<section id="pmu-acquire-wakelock">
<h3>pmu_acquire_wakelock<a class="headerlink" href="#pmu-acquire-wakelock" title="Link to this heading"></a></h3>
<table class="docutils align-default" style="width: 100%">
<thead>
<tr class="row-odd"><th class="head"><p>Items</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Introduction</p></td>
<td><p>Acquire the wakelock for one module</p></td>
</tr>
<tr class="row-odd"><td><p>Parameter</p></td>
<td><p>nDeviceId: Device ID of the corresponding module</p></td>
</tr>
<tr class="row-even"><td><p>Return</p></td>
<td><p>None</p></td>
</tr>
</tbody>
</table>
</section>
<section id="pmu-release-wakelock">
<h3>pmu_release_wakelock<a class="headerlink" href="#pmu-release-wakelock" title="Link to this heading"></a></h3>
<table class="docutils align-center" style="width: 100%">
<thead>
<tr class="row-odd"><th class="head"><p>Items</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Introduction</p></td>
<td><p>Release the wakelock for one module</p></td>
</tr>
<tr class="row-odd"><td><p>Parameter</p></td>
<td><p>nDeviceId: Device ID of the corresponding module</p></td>
</tr>
<tr class="row-even"><td><p>Return</p></td>
<td><p>None</p></td>
</tr>
</tbody>
</table>
</section>
<section id="pmu-acquire-deepwakelock">
<h3>pmu_acquire_deepwakelock<a class="headerlink" href="#pmu-acquire-deepwakelock" title="Link to this heading"></a></h3>
<table class="docutils align-default" style="width: 100%">
<thead>
<tr class="row-odd"><th class="head"><p>Items</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Introduction</p></td>
<td><p>Acquire the deepwakelock for one module</p></td>
</tr>
<tr class="row-odd"><td><p>Parameter</p></td>
<td><p>nDeviceId: Device ID of the corresponding module</p></td>
</tr>
<tr class="row-even"><td><p>Return</p></td>
<td><p>None</p></td>
</tr>
</tbody>
</table>
</section>
<section id="pmu-release-deepwakelock">
<h3>pmu_release_deepwakelock<a class="headerlink" href="#pmu-release-deepwakelock" title="Link to this heading"></a></h3>
<table class="docutils align-default" style="width: 100%">
<thead>
<tr class="row-odd"><th class="head"><p>Items</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Introduction</p></td>
<td><p>Release the deepwakelock for one module</p></td>
</tr>
<tr class="row-odd"><td><p>Parameter</p></td>
<td><p>nDeviceId: Device ID of the corresponding module</p></td>
</tr>
<tr class="row-even"><td><p>Return</p></td>
<td><p>None</p></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="pmu-set-sysactive-time">
<span id="id1"></span><h2>pmu_set_sysactive_time<a class="headerlink" href="#pmu-set-sysactive-time" title="Link to this heading"></a></h2>
<p>In some situations, the system needs to keep awake for a period of time to complete a certain process while the system is active.</p>
<table class="docutils align-default" style="width: 100%">
<thead>
<tr class="row-odd"><th class="head"><p>Items</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Introduction</p></td>
<td><p>Set a period of time that the system will keep active</p></td>
</tr>
<tr class="row-odd"><td><p>Parameter</p></td>
<td><p>timeout: time value, unit is ms.</p>
<p>The system will keep active for this time value from now on.</p>
</td>
</tr>
<tr class="row-even"><td><p>Return</p></td>
<td><p>0</p></td>
</tr>
</tbody>
</table>
</section>
<section id="sleep-wake-callback-apis">
<h2>Sleep/Wake Callback APIs<a class="headerlink" href="#sleep-wake-callback-apis" title="Link to this heading"></a></h2>
<p>These APIs are used to register suspend/resume callback function for <em>&lt;nDeviceId&gt;</em>.
The suspend callback function will be called in idle task before the system enters sleep mode, and the resume callback function will be called after the system resumes.</p>
<p>It is a good way to use the suspend and resume function if there is something to do before the chip sleeps or after the chip wakes.
A typical application of the resume function is to acquire the wakelock to prevent the chip from sleeping again.
Also, if the CPU chooses PG, some peripherals will lose power so they need to be reinitialized. This can be implemented in the resume function.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>Yield OS is not permitted in the suspend/resume callback functions, thus RTOS APIs which may cause OS yield such as <em>rtos_task_yield</em>, <em>rtos_time_delay_ms</em>, or mutex, semaphore related APIs are not recommended to use.</p></li>
<li><p><em>pmu_set_sysactive_time</em> is not permitted in the suspend callback function, but permitted in the resume callback function.</p></li>
</ul>
</div>
<section id="pmu-register-sleep-callback">
<h3>pmu_register_sleep_callback<a class="headerlink" href="#pmu-register-sleep-callback" title="Link to this heading"></a></h3>
<table class="docutils align-default" style="width: 100%">
<thead>
<tr class="row-odd"><th class="head"><p>Items</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Introduction</p></td>
<td><p>Register the suspend/resume callback function for one module</p></td>
</tr>
<tr class="row-odd"><td><p>Parameter</p></td>
<td><ul class="simple">
<li><p>nDeviceId: Device ID needs suspend/resume callback</p></li>
<li><p>sleep_hook_fun: Suspend callback function</p></li>
<li><p>sleep_param_ptr: Suspend callback function parameter</p></li>
<li><p>wakeup_hook_fun: Resume callback function</p></li>
<li><p>wakeup_param_ptr: Resume callback function parameter</p></li>
</ul>
</td>
</tr>
<tr class="row-even"><td><p>Return</p></td>
<td><p>None</p></td>
</tr>
</tbody>
</table>
</section>
<section id="pmu-unregister-sleep-callback">
<h3>pmu_unregister_sleep_callback<a class="headerlink" href="#pmu-unregister-sleep-callback" title="Link to this heading"></a></h3>
<table class="docutils align-default" style="width: 100%">
<thead>
<tr class="row-odd"><th class="head"><p>Items</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Introduction</p></td>
<td><p>Register the suspend/resume callback function for one module</p></td>
</tr>
<tr class="row-odd"><td><p>Parameter</p></td>
<td><ul class="simple">
<li><p>nDeviceId: Device ID needs suspend/resume callback</p></li>
<li><p>sleep_hook_fun: Suspend callback function</p></li>
<li><p>sleep_param_ptr: Suspend callback function parameter</p></li>
<li><p>wakeup_hook_fun: Resume callback function</p></li>
<li><p>wakeup_param_ptr: Resume callback function parameter</p></li>
</ul>
</td>
</tr>
<tr class="row-even"><td><p>Return</p></td>
<td><p>None</p></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="pmu-set-max-sleep-time">
<h2>pmu_set_max_sleep_time<a class="headerlink" href="#pmu-set-max-sleep-time" title="Link to this heading"></a></h2>
<table class="docutils align-default" style="width: 100%">
<thead>
<tr class="row-odd"><th class="head"><p>Items</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Introduction</p></td>
<td><p>Set the maximum sleep time</p></td>
</tr>
<tr class="row-odd"><td><p>Parameter</p></td>
<td><p>timer_ms: system maximum sleep timeout, unit is ms.</p></td>
</tr>
<tr class="row-even"><td><p>Return</p></td>
<td><p>None</p></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>The system will be woken up after the timeout.</p></li>
<li><p>The system may be woken up by other wake events before the timeout.</p></li>
<li><p>This setting only works once. The timer will be cleared after the system wakes up.</p></li>
</ul>
</div>
</section>
<section id="wakeup-reason-apis">
<h2>Wakeup Reason APIs<a class="headerlink" href="#wakeup-reason-apis" title="Link to this heading"></a></h2>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-3-3-0" aria-selected="true" class="sphinx-tabs-tab" id="tab-3-3-0" name="3-0" role="tab" tabindex="0">RTL8721Dx</button><button aria-controls="panel-3-3-1" aria-selected="false" class="sphinx-tabs-tab" id="tab-3-3-1" name="3-1" role="tab" tabindex="-1">RTL8720E</button><button aria-controls="panel-3-3-2" aria-selected="false" class="sphinx-tabs-tab" id="tab-3-3-2" name="3-2" role="tab" tabindex="-1">RTL8726E</button><button aria-controls="panel-3-3-3" aria-selected="false" class="sphinx-tabs-tab" id="tab-3-3-3" name="3-3" role="tab" tabindex="-1">RTL8730E</button></div><div aria-labelledby="tab-3-3-0" class="sphinx-tabs-panel" id="panel-3-3-0" name="3-0" role="tabpanel" tabindex="0"><p><strong>SOCPS_AONWakeReason</strong></p>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 30.0%" />
<col style="width: 70.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Items</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Introduction</p></td>
<td><p>Get the deep-sleep wakeup reason</p></td>
</tr>
<tr class="row-odd"><td><p>Parameter</p></td>
<td><p>None</p></td>
</tr>
<tr class="row-even"><td><p>Return</p></td>
<td><ul class="simple">
<li><p>Bit[0]: CHIP_EN short press</p></li>
<li><p>Bit[1]: CHIP_EN long press</p></li>
<li><p>Bit[2]: BOR</p></li>
<li><p>Bit[3]: AON Timer</p></li>
<li><p>Bit[5:4]: AON GPIO</p></li>
<li><p>Bit[8]: RTC</p></li>
</ul>
</td>
</tr>
</tbody>
</table>
<p><strong>WAK_STATUS0</strong></p>
<p>The following register can be used to get the sleep wakeup reason.</p>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 30.0%" />
<col style="width: 70.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Register</p></th>
<th class="head"><p>Parameters</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>WAK_STATUS0</p></td>
<td><ul class="simple">
<li><p>Bit[1:0]: WLAN</p></li>
<li><p>Bit[2]: KM4_WAKE</p></li>
<li><p>Bit[3]: BT_WAKE_HOST</p></li>
<li><p>Bit[4]: IPC_KM4</p></li>
<li><p>Bit[9:6]: BASIC TIMER4~7</p></li>
<li><p>Bit[11:10]: PMC TIMER0~1</p></li>
<li><p>Bit[14:12]: UART0~2</p></li>
<li><p>Bit[15]: UART_LOG</p></li>
<li><p>Bit[16]: GPIOA</p></li>
<li><p>Bit[17]: GPIOB</p></li>
<li><p>Bit[19:18]:I2C0~1</p></li>
<li><p>Bit[20]: Cap-Touch</p></li>
<li><p>Bit[21]: RTC</p></li>
<li><p>Bit[22]: ADC</p></li>
<li><p>Bit[24]: BOR</p></li>
<li><p>Bit[25]: PWR_DOWN</p></li>
<li><p>Bit[26]: Key-Scan</p></li>
<li><p>Bit[27]: AON_Timer</p></li>
<li><p>Bit[28]: AON_Wakepin</p></li>
</ul>
<blockquote>
<div><p>-Bit[29]: SDIO</p>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
<p>Note that when wakeup, the corresponding peripheral interrupt will be raised; when clearing the interrupt, the corresponding bit in wakeup reason will also be cleared.
Thus it is not possible to get the wakeup reason after the interrupt is cleared.</p>
</div><div aria-labelledby="tab-3-3-1" class="sphinx-tabs-panel" hidden="true" id="panel-3-3-1" name="3-1" role="tabpanel" tabindex="0"><p><strong>SOCPS_AONWakeReason</strong></p>
<table class="docutils align-default" style="width: 100%">
<thead>
<tr class="row-odd"><th class="head"><p>Items</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Introduction</p></td>
<td><p>Get the deep-sleep wakeup reason</p></td>
</tr>
<tr class="row-odd"><td><p>Parameter</p></td>
<td><p>None</p></td>
</tr>
<tr class="row-even"><td><p>Return</p></td>
<td><ul class="simple">
<li><p>Bit[0]:</p></li>
</ul>
</td>
</tr>
</tbody>
</table>
<p><strong>WAK_STATUS0</strong></p>
<p>The following register can be used to get the sleep wakeup reason.</p>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 30.0%" />
<col style="width: 70.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Register</p></th>
<th class="head"><p>Parameters</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>WAK_STATUS0</p></td>
<td><ul class="simple">
<li><p>Bit[1:0]:</p></li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Note that when wakeup, the corresponding peripheral interrupt will be raised; when clearing the interrupt, the corresponding bit in wakeup reason will also be cleared.
Thus it is not possible to get the wakeup reason after the interrupt is cleared.</p>
</div><div aria-labelledby="tab-3-3-2" class="sphinx-tabs-panel" hidden="true" id="panel-3-3-2" name="3-2" role="tabpanel" tabindex="0"><p><strong>SOCPS_AONWakeReason</strong></p>
<table class="docutils align-default" style="width: 100%">
<thead>
<tr class="row-odd"><th class="head"><p>Items</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Introduction</p></td>
<td><p>Get the deep-sleep wakeup reason</p></td>
</tr>
<tr class="row-odd"><td><p>Parameter</p></td>
<td><p>None</p></td>
</tr>
<tr class="row-even"><td><p>Return</p></td>
<td><ul class="simple">
<li><p>Bit[0]:</p></li>
</ul>
</td>
</tr>
</tbody>
</table>
<p><strong>WAK_STATUS0</strong></p>
<p>The following register can be used to get the sleep wakeup reason.</p>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 30.0%" />
<col style="width: 70.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Register</p></th>
<th class="head"><p>Parameters</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>WAK_STATUS0</p></td>
<td><ul class="simple">
<li><p>Bit[1:0]:</p></li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Note that when wakeup, the corresponding peripheral interrupt will be raised; when clearing the interrupt, the corresponding bit in wakeup reason will also be cleared.
Thus it is not possible to get the wakeup reason after the interrupt is cleared.</p>
</div><div aria-labelledby="tab-3-3-3" class="sphinx-tabs-panel" hidden="true" id="panel-3-3-3" name="3-3" role="tabpanel" tabindex="0"><p><strong>SOCPS_AONWakeReason</strong></p>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 30.0%" />
<col style="width: 70.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Items</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Introduction</p></td>
<td><p>Get the deep-sleep wakeup reason</p></td>
</tr>
<tr class="row-odd"><td><p>Parameter</p></td>
<td><p>None</p></td>
</tr>
<tr class="row-even"><td><p>Return</p></td>
<td><p>Bit[0]: CHIP_EN short press</p>
<p>Bit[1]: CHIP_EN long press</p>
<p>Bit[2]: BOR</p>
<p>Bit[3]: AON Timer</p>
<p>Bit[7:4]: AON GPIO</p>
<p>Bit[8]: RTC</p>
</td>
</tr>
</tbody>
</table>
<p><strong>WAK_STATUS0</strong></p>
<p>The following register can be used to get the sleep wakeup reason.</p>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 30.0%" />
<col style="width: 70.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Register</p></th>
<th class="head"><p>Parameters</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>WAK_STATUS0</p></td>
<td><ul class="simple">
<li><p>Bit[1:0]: WLAN</p></li>
<li><p>Bit[2]: AON_TIMER</p></li>
<li><p>Bit[3]: NP_WAKE</p></li>
<li><p>Bit[4]: AP_WAKE</p></li>
<li><p>Bit[5]: IWDG0</p></li>
<li><p>Bit[13:6]: BASIC TIMER0~7</p></li>
<li><p>Bit[14]: UART_LOG</p></li>
<li><p>Bit[17:15]: GPIO</p></li>
<li><p>Bit[18]: RTC</p></li>
<li><p>Bit[19]: Cap-Touch</p></li>
<li><p>Bit[20]: ADC</p></li>
<li><p>Bit[22]: BOR</p></li>
<li><p>Bit[23]: PWR_DOWN</p></li>
<li><p>Bit[24]: VAD</p></li>
<li><p>Bit[25]: IPC_NP</p></li>
<li><p>Bit[26]: IPC_AP</p></li>
<li><p>Bit[29:28]: SPI0~1</p></li>
<li><p>Bit[31:30]: UART0~1</p></li>
</ul>
</td>
</tr>
</tbody>
</table>
<p><strong>WAK_STATUS1</strong></p>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 30.0%" />
<col style="width: 70.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Register</p></th>
<th class="head"><p>Parameters</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>WAK_STATUS1</p></td>
<td><p>Bit[0]: UART2</p>
<p>Bit[5]: AON_WAPEPIN</p>
<p>Bit[6]: BT_WAKE_HOST</p>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When wakeup, the corresponding peripheral interrupt will be raised; when clearing the interrupt, the corresponding bit in wakeup reason will also be cleared.
Thus it is not possible to get the wakeup reason after the interrupt is cleared</p>
</div>
</div></div>
</section>
</section>
<section id="wakeup-time">
<h1>Wakeup time<a class="headerlink" href="#wakeup-time" title="Link to this heading"></a></h1>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-4-4-0" aria-selected="true" class="sphinx-tabs-tab" id="tab-4-4-0" name="4-0" role="tab" tabindex="0">RTL8721Dx</button><button aria-controls="panel-4-4-1" aria-selected="false" class="sphinx-tabs-tab" id="tab-4-4-1" name="4-1" role="tab" tabindex="-1">RTL8720E</button><button aria-controls="panel-4-4-2" aria-selected="false" class="sphinx-tabs-tab" id="tab-4-4-2" name="4-2" role="tab" tabindex="-1">RTL8726E</button><button aria-controls="panel-4-4-3" aria-selected="false" class="sphinx-tabs-tab" id="tab-4-4-3" name="4-3" role="tab" tabindex="-1">RTL8730E</button></div><div aria-labelledby="tab-4-4-0" class="sphinx-tabs-panel" id="panel-4-4-0" name="4-0" role="tabpanel" tabindex="0"></div><div aria-labelledby="tab-4-4-1" class="sphinx-tabs-panel" hidden="true" id="panel-4-4-1" name="4-1" role="tabpanel" tabindex="0"></div><div aria-labelledby="tab-4-4-2" class="sphinx-tabs-panel" hidden="true" id="panel-4-4-2" name="4-2" role="tabpanel" tabindex="0"></div><div aria-labelledby="tab-4-4-3" class="sphinx-tabs-panel" hidden="true" id="panel-4-4-3" name="4-3" role="tabpanel" tabindex="0"><p>CPU can execute IRQ handler when the system is wakeup. The time between the wakeup event generating and CPU executing IRQ handler was defined as wakeup time.</p>
<p>Take LP CG + NP PG + AP PG for example:</p>
<table class="docutils align-default" style="width: 100%">
<thead>
<tr class="row-odd"><th class="head"><p>CPU to wakeup</p></th>
<th class="head"><p>LP</p></th>
<th class="head"><p>LP + NP</p></th>
<th class="head"><p>LP + NP + AP</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Wakeup time</p></td>
<td><p>2.8ms</p></td>
<td><p>3.5ms</p></td>
<td></td>
</tr>
</tbody>
</table>
<p>It takes about 2.8ms to wake LP only and 3.5ms to wake both LP and NP in LP CG + NP PG mode.</p>
<p>For LP, 1.6ms to initialize hardware (mainly XTAL), 1.1ms to execute critical code, and 200-300us to enter IRQ handler.</p>
</div></div>
</section>
<section id="uart-and-loguart">
<h1>UART and LOGUART<a class="headerlink" href="#uart-and-loguart" title="Link to this heading"></a></h1>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-5-5-0" aria-selected="true" class="sphinx-tabs-tab" id="tab-5-5-0" name="5-0" role="tab" tabindex="0">RTL8721Dx</button><button aria-controls="panel-5-5-1" aria-selected="false" class="sphinx-tabs-tab" id="tab-5-5-1" name="5-1" role="tab" tabindex="-1">RTL8720E</button><button aria-controls="panel-5-5-2" aria-selected="false" class="sphinx-tabs-tab" id="tab-5-5-2" name="5-2" role="tab" tabindex="-1">RTL8726E</button><button aria-controls="panel-5-5-3" aria-selected="false" class="sphinx-tabs-tab" id="tab-5-5-3" name="5-3" role="tab" tabindex="-1">RTL8730E</button></div><div aria-labelledby="tab-5-5-0" class="sphinx-tabs-panel" id="panel-5-5-0" name="5-0" role="tabpanel" tabindex="0"><p>For peripherals that need specific clock settings, such as UART and LOGUART, their setting flows are described in the following section.</p>
<p id="dx-power-saving-uart"><strong>UART</strong></p>
<ol class="arabic simple">
<li><p>Initialize UART and enable its interrupt.</p></li>
<li><p>Set the related wakeup source (<cite>WAKE_SRC_UART0</cite>/<cite>WAKE_SRC_UART1</cite>/<cite>WAKE_SRC_UART2_BT</cite>) in <code class="docutils literal notranslate"><span class="pre">sleep_wevent_config[]</span></code> to <cite>WAKEUP_KM4</cite> or <cite>WAKEUP_KM0</cite> (based on which CPU you want to wake). The interrupt should be registered on the same CPU selected by <cite>sleep_wevent_config[]</cite>.</p></li>
<li><p>Set <cite>keep_OSC4M_on</cite> in <code class="docutils literal notranslate"><span class="pre">ps_config[]</span></code> to <strong>TRUE</strong> to keep OSC4M enabled during sleep mode.</p></li>
<li><p>Switch clock to OSC2M with API <code class="docutils literal notranslate"><span class="pre">RCC_PeriphClockSource_UART(UARTx_DEV,</span> <span class="pre">UART_RX_CLK_OSC_LP)</span></code>.</p></li>
<li><p>Enter sleep mode by releasing the wakelock in KM4 (PMU_OS needs to be released since it is acquired by default when boot).</p></li>
<li><p>Clear the UART interrupt when wakeup.</p></li>
<li><p>If a higher baudrate is required after waking up, it is recommended to switch to XTAL40M Rx clock by API <code class="docutils literal notranslate"><span class="pre">RCC_PeriphClockSource_UART(UART0_DEV,</span> <span class="pre">UART_RX_CLK_XTAL_40M)</span></code>.</p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When using UART as a wakeup source, there are some restrictions:</p>
<ul class="simple">
<li><p>The Rx clock source can only be OSC2M, and do not turn off OSC4M during sleep.</p></li>
<li><p>When the baudrate is larger than 115200, it is not recommended to use UART as a wakeup source.</p></li>
<li><p>The portion of the command used to wake up that exceeds the FIFO depth (64B) will be lost.</p></li>
</ul>
</div>
<p id="dx-power-saving-loguart"><strong>LOGUART</strong></p>
<ol class="arabic simple">
<li><p>Initialize LOGUART and enable its interrupt.</p></li>
<li><p>Set <cite>WAKE_SRC_UART_LOG</cite> in <code class="docutils literal notranslate"><span class="pre">sleep_wevent_config[]</span></code> to <cite>WAKEUP_KM4</cite> or <cite>WAKEUP_KM0</cite> (based on which CPU you want to wake). The interrupt should be registered on the same CPU selected by <cite>sleep_wevent_config[]</cite>.</p></li>
<li><p>Set <cite>xtal_mode_in_sleep</cite> to <strong>XTAL_Normal</strong> in <code class="docutils literal notranslate"><span class="pre">ps_config[]</span></code>.</p></li>
<li><p>Enter sleep mode by releasing the wakelock in KM4 (PMU_OS needs to be released since it is acquired by default when boot).</p></li>
<li><p>Clear the LOGUART interrupt when wakeup.</p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When using LOGUART as a wakeup source, there are some restrictions:</p>
<ul class="simple">
<li><p>If the Rx clock source is XTAL40M, do not turn off XTAL or OSC4M during sleep; if the Rx clock source is OSC2M, do not turn off OSC4M during sleep.</p></li>
<li><p>The portion of the command used to wake up that exceeds the FIFO depth (16B) will be lost.</p></li>
</ul>
</div>
</div><div aria-labelledby="tab-5-5-1" class="sphinx-tabs-panel" hidden="true" id="panel-5-5-1" name="5-1" role="tabpanel" tabindex="0"><p>For peripherals that need specific clock settings, such as UART and LOGUART, their setting flows are described in following section.</p>
<p><strong>UART</strong></p>
<ol class="arabic simple">
<li><p>Initialize UART and enable its interrupt.</p></li>
<li><p>Set the related wakeup source (<code class="docutils literal notranslate"><span class="pre">WAKE_SRC_UART0/WAKE_SRC_UART1/WAKE_SRC_UART2_BT</span></code>) in <code class="docutils literal notranslate"><span class="pre">sleep_wevent_config[]</span></code> to <cite>WAKEUP_KM4</cite> or <cite>WAKEUP_KM0</cite> (based on which CPU you want to wake). The interrupt should be registered on the same CPU selected by <code class="docutils literal notranslate"><span class="pre">sleep_wevent_config[]</span></code>.</p></li>
<li><p>Set the corresponding entry of <code class="docutils literal notranslate"><span class="pre">uart_config[]</span></code> in <code class="file docutils literal notranslate"><span class="pre">ameba_sleepcfg.c</span></code> to <strong>ENABLE</strong>.</p></li>
<li><p>Set <cite>keep_OSC4M_on</cite> in <code class="docutils literal notranslate"><span class="pre">ps_config[]</span></code> to <strong>TRUE</strong> to keep OSC4M enabled during sleep mode.</p></li>
<li><p>Enter sleep mode by releasing the wakelock in KM4 (PMU_OS needs to be released since it is acquired by default when boot).</p></li>
<li><p>Clear the UART interrupt when wakeup.</p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When using UART as a wakeup source, there are some restrictions:</p>
<ul class="simple">
<li><p>If the Rx clock source is XTAL40M, do not turn off XTAL during sleep.</p></li>
<li><p>The portion of the command used to wake up that exceeds the FIFO depth (64B) will be lost.</p></li>
</ul>
</div>
<p><strong>LOGUART</strong></p>
<ol class="arabic simple">
<li><p>Initialize LOGUART and enable its interrupt.</p></li>
<li><p>Set <cite>WAKE_SRC_UART_LOG</cite> in <code class="docutils literal notranslate"><span class="pre">sleep_wevent_config[]</span></code> to <cite>WAKEUP_KM4</cite> or <cite>WAKEUP_KM0</cite> (based on which CPU you want to wake). The interrupt should be registered on the same CPU selected by <cite>sleep_wevent_config[]</cite>.</p></li>
<li><p>Set <cite>xtal_mode_in_sleep</cite> to <strong>XTAL_Normal</strong> in <code class="docutils literal notranslate"><span class="pre">ps_config[]</span></code>.</p></li>
<li><p>Enter sleep mode by releasing the wakelock in KM4 (PMU_OS needs to be released since it is acquired by default when boot).</p></li>
<li><p>Clear the LOGUART interrupt when wakeup.</p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When using LOGUART as a wakeup source, there are some restrictions:</p>
<ul class="simple">
<li><p>If the Rx clock source is XTAL40M, do not turn off XTAL during sleep.</p></li>
<li><p>The portion of the command used to wake up that exceeds the FIFO depth (16B) will be lost.</p></li>
</ul>
</div>
</div><div aria-labelledby="tab-5-5-2" class="sphinx-tabs-panel" hidden="true" id="panel-5-5-2" name="5-2" role="tabpanel" tabindex="0"><p>For peripherals that need specific clock settings, such as UART and LOGUART, their setting flows are described in following section.</p>
<p><strong>UART</strong></p>
<ol class="arabic simple">
<li><p>Initialize UART and enable its interrupt.</p></li>
<li><p>Set the related wakeup source (<code class="docutils literal notranslate"><span class="pre">WAKE_SRC_UART0/WAKE_SRC_UART1/WAKE_SRC_UART2_BT</span></code>) in <code class="docutils literal notranslate"><span class="pre">sleep_wevent_config[]</span></code> to <cite>WAKEUP_KM4</cite> or <cite>WAKEUP_KM0</cite> (based on which CPU you want to wake). The interrupt should be registered on the same CPU selected by <code class="docutils literal notranslate"><span class="pre">sleep_wevent_config[]</span></code>.</p></li>
<li><p>Set the corresponding entry of <code class="docutils literal notranslate"><span class="pre">uart_config[]</span></code> in <code class="file docutils literal notranslate"><span class="pre">ameba_sleepcfg.c</span></code> to <strong>ENABLE</strong>.</p></li>
<li><p>Set <cite>keep_OSC4M_on</cite> in <code class="docutils literal notranslate"><span class="pre">ps_config[]</span></code> to <strong>TRUE</strong> to keep OSC4M enabled during sleep mode.</p></li>
<li><p>Enter sleep mode by releasing the wakelock in KM4 (PMU_OS needs to be released since it is acquired by default when boot).</p></li>
<li><p>Clear the UART interrupt when wakeup.</p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When using UART as a wakeup source, there are some restrictions:</p>
<ul class="simple">
<li><p>If the Rx clock source is XTAL40M, do not turn off XTAL during sleep.</p></li>
<li><p>The portion of the command used to wake up that exceeds the FIFO depth (64B) will be lost.</p></li>
</ul>
</div>
<p><strong>LOGUART</strong></p>
<ol class="arabic simple">
<li><p>Initialize LOGUART and enable its interrupt.</p></li>
<li><p>Set <cite>WAKE_SRC_UART_LOG</cite> in <code class="docutils literal notranslate"><span class="pre">sleep_wevent_config[]</span></code> to <cite>WAKEUP_KM4</cite> or <cite>WAKEUP_KM0</cite> (based on which CPU you want to wake). The interrupt should be registered on the same CPU selected by <cite>sleep_wevent_config[]</cite>.</p></li>
<li><p>Set <cite>xtal_mode_in_sleep</cite> to <strong>XTAL_Normal</strong> in <code class="docutils literal notranslate"><span class="pre">ps_config[]</span></code>.</p></li>
<li><p>Enter sleep mode by releasing the wakelock in KM4 (PMU_OS needs to be released since it is acquired by default when boot).</p></li>
<li><p>Clear the LOGUART interrupt when wakeup.</p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When using LOGUART as a wakeup source, there are some restrictions:</p>
<ul class="simple">
<li><p>If the Rx clock source is XTAL40M, do not turn off XTAL during sleep.</p></li>
<li><p>The portion of the command used to wake up that exceeds the FIFO depth (16B) will be lost.</p></li>
</ul>
</div>
</div><div aria-labelledby="tab-5-5-3" class="sphinx-tabs-panel" hidden="true" id="panel-5-5-3" name="5-3" role="tabpanel" tabindex="0"><p>For peripherals that need specific clock settings, such as UART and LOGUART, their setting flows are described in following section.</p>
<p id="smart-power-saving-uart"><strong>UART</strong></p>
<ol class="arabic simple">
<li><p>Initialize UART and enable its interrupt.</p></li>
<li><p>Set the related wakeup source (<cite>WAKE_SRC_UART0/WAKE_SRC_UART1/WAKE_SRC_UART2_BT</cite>) in <code class="docutils literal notranslate"><span class="pre">sleep_wevent_config[]</span></code> to <cite>WAKEUP_KM4</cite> or <cite>WAKEUP_KM0</cite> (based on which CPU you want to wake). The interrupt should be registered on the same CPU selected by <code class="docutils literal notranslate"><span class="pre">sleep_wevent_config[]</span></code>.</p></li>
<li><p>Set the corresponding entry of <code class="docutils literal notranslate"><span class="pre">uart_config[]</span></code> in <code class="file docutils literal notranslate"><span class="pre">ameba_sleepcfg.c</span></code> to <strong>ENABLE</strong>.</p></li>
<li><p>Set <cite>keep_OSC4M_on</cite> in <code class="docutils literal notranslate"><span class="pre">ps_config[]</span></code> to <strong>TRUE</strong> to keep OSC4M enabled during sleep mode.</p></li>
<li><p>Enter sleep mode by releasing the wakelock in KM4 (<cite>PMU_OS</cite> needs to be released since it is acquired by default when boot).</p></li>
<li><p>Clear the UART interrupt when wakeup.</p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When using UART as a wakeup source, there are some restrictions:</p>
<ul class="simple">
<li><p>If the Rx clock source is XTAL40M, do not turn off XTAL during sleep; if the Rx clock source is OSC2M, do not turn off OSC4M during sleep.</p></li>
<li><p>The portion of the command used to wake up that exceeds the FIFO depth (64B) will be lost.</p></li>
</ul>
</div>
<p id="smart-power-saving-loguart"><strong>LOGUART</strong></p>
<ol class="arabic simple">
<li><p>Initialize LOGUART and enable its interrupt.</p></li>
<li><p>Set <cite>WAKE_SRC_UART_LOG</cite> in <code class="docutils literal notranslate"><span class="pre">sleep_wevent_config[]</span></code> to <cite>WAKEUP_KM4</cite> or <cite>WAKEUP_KM0</cite> (based on which CPU you want to wake). The interrupt should be registered on the same CPU selected by <cite>sleep_wevent_config[]</cite>.</p></li>
<li><p>Set <cite>xtal_mode_in_sleep</cite> to <strong>XTAL_Normal</strong> in <code class="docutils literal notranslate"><span class="pre">ps_config[]</span></code>.</p></li>
<li><p>Enter sleep mode by releasing the wakelock in KM4 (PMU_OS needs to be released since it is acquired by default when boot).</p></li>
<li><p>Clear the LOGUART interrupt when wakeup.</p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When using LOGUART as a wakeup source, there are some restrictions:</p>
<ul class="simple">
<li><p>If the Rx clock source is XTAL40M, do not turn off XTAL during sleep; if the Rx clock source is OSC2M, do not turn off OSC4M during sleep.</p></li>
<li><p>The portion of the command used to wake up that exceeds the FIFO depth (16B) will be lost.</p></li>
</ul>
</div>
</div></div>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="0_ps_index.html" class="btn btn-neutral float-left" title="Power Saving" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../2_whc_wifi_bridge/0_wifi_bridge_index.html" class="btn btn-neutral float-right" title="WHC Bridge" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Realsil.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
    <!-- 问题反馈按钮和对话框 -->
    
    <div id="feedback-dialog" class="feedback-dialog" style="display: none;">
        <div class="form-group">
            <label style="font-weight: bold;">Please select the related chapter:</label>
            <select id="chapter-select">
                <option value="">Select Chapter</option>
                <!-- 章节选项将通过JavaScript动态填充 -->
            </select>
        </div>

        <div class="form-group">
            <label style="font-weight: bold;">Post Type</label>
            <select id="post-type" class="form-control" required>
                <option value="">-- Select Type --</option>
                <option value="doc_correction">Document Correction</option>
                <option value="tech_consult">Technical Consult</option>
                <option value="tech_summary">Technical Summary</option>
                <option value="operation_flow">Operation Flow</option>
            </select>
        </div>

        <div class="form-group">
            <label style="font-weight: bold;">Related Paragraph:</label>
            <textarea
                id="paragraph-input"
                placeholder="{{ '你可以先选择有问题的段落或手动输入...' if language == 'zh_CN' else 'You can select text or type directly here...' }}"
                rows="4"
            ></textarea>
        </div>

        <div class="form-group">
            <label style="font-weight: bold;">Please describe your issue:</label>
            <textarea
                id="inquire_input"
                placeholder="Feature enhancement in progress, please stay tuned...">
            </textarea>
        </div>

        <button id="submit-feedback">Submit</button>
        <button id="cancel-feedback">Cancel</button>
    </div>

    <style>
        .form-group {
            margin: 5px 0;  /* 基础间距 */
        }

        /* 相邻表单项缩小上方间距 */
        .form-group + .form-group {
            margin-top: 10px;
        }

        /* 段落输入框底部微调 */
        #paragraph-input, #inquire_input {
            margin: 2px 0; /* 上下间距 */
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            resize: vertical;
            min-height: 100px;

            /* 占位符样式 */
            &::placeholder {
                color: #999;
                font-style: italic;
            }
        }
    </style>

      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
     

    

    


</body>
</html>