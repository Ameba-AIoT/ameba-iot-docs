

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>How to Use AT Command with SPI &mdash; Ameba IoT Docs  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
      <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=b0e775ca" />
      <link rel="stylesheet" type="text/css" href="../../_static/tabs.css?v=a5c4661c" />
      <link rel="stylesheet" type="text/css" href="../../_static/_static/custom.css" />

  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../../_static/toggleprompt.js?v=d7ede5d2"></script>
        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
        <script>let toggleHintShow = 'Click to show';</script>
        <script>let toggleHintHide = 'Click to hide';</script>
        <script>let toggleOpenOnPrint = 'true';</script>
        <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Virtual File System" href="../0_file_system/0_vfs_index.html" />
    <link rel="prev" title="File System AT Commands" href="at_command_file_system.html" />
   
  
  <script type="text/javascript" src="../../_static/js/selector.js"></script>

  <style>
    .wy-nav-content {max-width: 1000px;} /* 设置最大宽度 */
  </style>

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            Ameba IoT Docs
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../0_ameba_product/0_ameba_product_center_index.html">Products Center</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_ameba_sdk/0_ameba_sdks_index.html">Ameba SDK</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_ameba_solutions/0_ameba_solutions_index.html">Ameba Solutions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_gcc_build_environment/0_gcc_build_index.html">0.1 GCC Build Environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_gdb_debug/0_gdb_debug_index.html">0.2 GDB Debug</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_gcc_build_library/0_gcc_build_library_index.html">0.3 GCC Build Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_sdk_example/0_sdk_example_index.html">0.4 SDK Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_memory_layout/0_layout_index.html">0.5 Flash &amp; RAM Layout</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_user_config/0_usrcfg_index.html">0.6 User Config</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_tools/0_tools_index.html">0.7 Tools</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="0_at_command_index.html">0.8 AT Command</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="at_command_introduction.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="at_command_common.html">Common AT Commands</a></li>
<li class="toctree-l2"><a class="reference internal" href="at_command_wifi.html">Wi-Fi AT Commands</a></li>
<li class="toctree-l2"><a class="reference internal" href="at_command_mqtt.html">MQTT AT Commands</a></li>
<li class="toctree-l2"><a class="reference internal" href="at_command_http.html">HTTP AT Commands</a></li>
<li class="toctree-l2"><a class="reference internal" href="at_command_websocket.html">WebSocket AT Commands</a></li>
<li class="toctree-l2"><a class="reference internal" href="at_command_tcp_ip.html">Socket AT Commands</a></li>
<li class="toctree-l2"><a class="reference internal" href="at_command_bluetooth.html">Bluetooth AT Commands</a></li>
<li class="toctree-l2"><a class="reference internal" href="at_command_file_system.html">File System AT Commands</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">How to Use AT Command with SPI</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="#default-spi-pins">Default SPI Pins</a></li>
<li class="toctree-l3"><a class="reference internal" href="#using-at-command-with-spi">Using AT Command with SPI</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#communication-format">Communication Format</a></li>
<li class="toctree-l4"><a class="reference internal" href="#interaction-process">Interaction Process</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../0_file_system/0_vfs_index.html">0.9 Virtual File System</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1_mpu_cache/0_mpu_cache_index.html">1.0 MPU and Cache</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1_boot_process/0_boot_index.html">1.1 BOOT Process</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1_ota/0_ota_index.html">1.2 OTA</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1_otpc/0_otpc_index.html">1.3 OTPC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1_chipen/0_chipen_index.html">1.4 CHIPEN</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1_ipc/0_ipc_index.html">1.5 Inter Processor Communication</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1_pinmux/0_pinmux_index.html">1.6 PINMUX</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1_gpio/0_gpio_index.html">1.7 GPIO</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1_power_save/0_ps_index.html">1.9 Power Save</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2_whc_wifi_bridge/0_wifi_bridge_index.html">2.1 WHC Bridge</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2_whc_fullmac/0_fullmac_index.html">2.2 WHC FullMAC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2_wifi_tunnel/0_wifi_tunnel_index.html">2.3 Wi-Fi R-Mesh</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2_wifi_csi/0_wifi_csi_index.html">2.5 Wi-Fi CSI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2_wifi_adaptivity_test/0_wifi_adaptivity_index.html">2.6 Wi-Fi Adaptivity Test</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_security/0_security_index.html">3.1 Security &amp; Encryption</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_trng/0_trng_index.html">3.2 True Random Number Generator</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_nda_huk_derivation/0_huk_derivation_index_nda.html">3.3 HUK Derivation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_nda_rdp/0_rdp_index_nda.html">3.4 RDP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_nda_rsip/0_rsip_index_nda.html">3.5 RSIP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_nda_secure_boot/0_secure_boot_index_nda.html">3.6 Secure Boot</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_nda_swd_protection/0_swd_protection_index_nda.html">3.7 SWD Protection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_nda_tfm/0_tfm_index_nda.html">3.8 Trusted Firmware-M (TF-M)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_crypto_engine/0_crypto_engine_index.html">3.9 Crypto Engine</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_ecdsa_engine/0_ecdsa_index.html">3.a ECDSA Engine</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_eddsa_engine/0_eddsa_index.html">3.b EDDSA Engine</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_rsa_engine/0_rsa_index.html">3.c RSA Engine</a></li>
<li class="toctree-l1"><a class="reference internal" href="../4_ai/0_ai_index.html">4.1 AI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../4_ai_voice/0_ai_voice_index.html">4.2 AIVoice</a></li>
<li class="toctree-l1"><a class="reference internal" href="../4_multimedia/0_multimedia_index.html">4.3 Multimedia</a></li>
<li class="toctree-l1"><a class="reference internal" href="../4_dsp/0_dsp_index.html">4.4 DSP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../6_mass_production/0_mp_index.html">6.1 Mass Production</a></li>
<li class="toctree-l1"><a class="reference internal" href="../6_mp_image/0_mp_image_index.html">6.2 MP Image</a></li>
<li class="toctree-l1"><a class="reference internal" href="../6_mptools/0_mptools_index.html">6.3 MP Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../7_usb/0_usb_index.html">7.1 USB Host &amp; Device</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_dmac/0_dmac_index.html">8.1 DMA Controllor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_psram/0_psram_index.html">8.2 PSRAM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_thermal/0_thermal_index.html">8.3 Thermal Meter</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_adc/0_adc_index.html">8.4 ADC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_ir/0_ir_index.html">8.5 IR</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_ledc/0_ledc_index.html">8.6 LEDC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_cap_touch/0_cap_touch_index.html">8.7 Cap-Touch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_key_scan/0_key_scan_index.html">8.8 Key-Scan</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_rtc_io/0_rtc_io_index.html">8.9 RTC-IO</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_lcdc/0_lcdc_index.html">8.A LCDC</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Ameba IoT Docs</a>
      </nav>

      <div class="wy-nav-content">

        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="0_at_command_index.html">AT Command</a></li>
      <li class="breadcrumb-item active">How to Use AT Command with SPI</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="how-to-use-at-command-with-spi">
<h1>How to Use AT Command with SPI<a class="headerlink" href="#how-to-use-at-command-with-spi" title="Link to this heading"></a></h1>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Link to this heading"></a></h2>
<p>When utilizing AT Command modules via SPI interface, MCU devices act as SPI masters while AT Command devices function as SPI slaves. Data exchange follows SPI protocol with specific framing format, providing superior performance in high-speed data transfer scenarios compared to default UART interface.</p>
<p>Refer to <a class="reference internal" href="at_command_introduction.html#atcmd-mcu-control-mode-configuration"><span class="std std-ref">MCU Control Mode Configuration</span></a> to enable the SPI interface.</p>
</section>
<section id="default-spi-pins">
<h2>Default SPI Pins<a class="headerlink" href="#default-spi-pins" title="Link to this heading"></a></h2>
<p>If no pins are configured, the AT Command module will use the default pins, including SPI MOSI, MISO, CLK, CS, as well as two synchronization pins.</p>
<p>For different chips, the default SPI AT Command module pins are listed in the following table.</p>
<table class="docutils align-default" id="id1" style="width: 100%">
<caption><span class="caption-text">Default SPI AT Command module pins for different chips</span><a class="headerlink" href="#id1" title="Link to this table"></a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>Ameba SoC</p></th>
<th class="head"><p>SPI MOSI</p></th>
<th class="head"><p>SPI MISO</p></th>
<th class="head"><p>SPI CLK</p></th>
<th class="head"><p>SPI CS</p></th>
<th class="head"><p>MASTER SYNC</p></th>
<th class="head"><p>SLAVE SYNC</p></th>
<th class="head"><p>GND</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>RTL8721Dx/RTL8711Dx</p></td>
<td><p>PA_27</p></td>
<td><p>PA_28</p></td>
<td><p>PA_26</p></td>
<td><p>PA_12</p></td>
<td><p>PB_30</p></td>
<td><p>PB_31</p></td>
<td><p>GND</p></td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">RTL8726EA/RTL8713EC</div>
<div class="line">RTL8720EA/RTL8710EC</div>
</div>
</td>
<td><p>PA_29</p></td>
<td><p>PA_30</p></td>
<td><p>PA_28</p></td>
<td><p>PA_31</p></td>
<td><p>PB_2</p></td>
<td><p>PB_3</p></td>
<td><p>GND</p></td>
</tr>
<tr class="row-even"><td><p>RTL8730E</p></td>
<td><p>PA_13</p></td>
<td><p>PA_14</p></td>
<td><p>PA_15</p></td>
<td><p>PA_16</p></td>
<td><p>PA_20</p></td>
<td><p>PA_21</p></td>
<td><p>GND</p></td>
</tr>
</tbody>
</table>
</section>
<section id="using-at-command-with-spi">
<h2>Using AT Command with SPI<a class="headerlink" href="#using-at-command-with-spi" title="Link to this heading"></a></h2>
<p>For example code on using SPI master to communicate with an SPI slave, refer to <code class="docutils literal notranslate"><span class="pre">{SDK}component/example/atcmd_host/spi_master/example_spi_master.c</span></code>.
Before starting development on an MCU, it is highly recommended to run the example code to verify that the wiring and configuration are correct.
After this, you can refer to our host example to adapt it to the specific MCU platform application you intend to use.</p>
<p>In the example code, we added an UART task to receive AT commands and print the AT responses. The overall data flow diagram is as follows:</p>
<figure class="align-center" id="id2">
<a class="reference internal image-reference" href="../../_images/spi_at_data_flow.svg"><img alt="../../_images/spi_at_data_flow.svg" height="79" src="../../_images/spi_at_data_flow.svg" width="588" /></a>
<figcaption>
<p><span class="caption-text">SPI AT Command data flow</span><a class="headerlink" href="#id2" title="Link to this image"></a></p>
</figcaption>
</figure>
<section id="communication-format">
<h3>Communication Format<a class="headerlink" href="#communication-format" title="Link to this heading"></a></h3>
<p>When the SPI AT Command host sends AT commands or transparent data, or receives AT responses from the AT Command module, the following format must be used.</p>
<table class="docutils align-default" style="width: 100%">
<tbody>
<tr class="row-odd"><td><p>Magic Number(2 bytes)</p></td>
<td><p>Data Len(2 bytes)</p></td>
<td><p>Data(Data Len bytes)</p></td>
<td><p>Checksum(4 bytes)</p></td>
</tr>
</tbody>
</table>
<p>Where:</p>
<dl class="field-list simple">
<dt class="field-odd">Magic Number<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">AT</span></code> in ASCII code.</p>
</dd>
<dt class="field-even">Data Len<span class="colon">:</span></dt>
<dd class="field-even"><p>Data length in bytes.</p>
</dd>
<dt class="field-odd">Checksum<span class="colon">:</span></dt>
<dd class="field-odd"><p>CRC32 checksum of all except Checksum field.</p>
</dd>
</dl>
</section>
<section id="interaction-process">
<h3>Interaction Process<a class="headerlink" href="#interaction-process" title="Link to this heading"></a></h3>
<p>The SPI AT Command exchange process mainly consists of two aspects:</p>
<p><strong>SPI master sends AT command to slave:</strong></p>
<figure class="align-center">
<a class="reference internal image-reference" href="../../_images/spi_master_send_at_command_to_slave.svg"><img alt="../../_images/spi_master_send_at_command_to_slave.svg" height="231" src="../../_images/spi_master_send_at_command_to_slave.svg" width="397" /></a>
</figure>
<ol class="arabic simple">
<li><p>SPI master signals the SPI slave to prepare for data reception by pulling down the <code class="docutils literal notranslate"><span class="pre">Master</span> <span class="pre">Sync</span></code> Pin.</p></li>
<li><p>SPI slave receives the master’s request through a GPIO interrupt and, upon preparing to receive data, informs the master that it can transmit data by pulling up the <code class="docutils literal notranslate"><span class="pre">SLAVE</span> <span class="pre">SYNC</span></code> Pin.</p></li>
<li><p>SPI master begins data transmission, and after the transmission is complete, both the master and the slave reset their respective Sync Pins to their initial states.</p></li>
</ol>
<p><strong>SPI slave sends AT command response to master:</strong></p>
<figure class="align-center">
<a class="reference internal image-reference" href="../../_images/spi_slave_send_response_to_master.svg"><img alt="../../_images/spi_slave_send_response_to_master.svg" height="207" src="../../_images/spi_slave_send_response_to_master.svg" width="397" /></a>
</figure>
<ol class="arabic simple">
<li><p>SPI slave signals the master that it is ready to receive the AT command response by pulling up the Slave Sync Pin.</p></li>
<li><p>SPI master begins receiving data, and after the transmission is complete, the slave resets the <code class="docutils literal notranslate"><span class="pre">SLAVE</span> <span class="pre">SYNC</span></code> Pin to its initial state.</p></li>
</ol>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="at_command_file_system.html" class="btn btn-neutral float-left" title="File System AT Commands" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../0_file_system/0_vfs_index.html" class="btn btn-neutral float-right" title="Virtual File System" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Realsil.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>

      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 



</body>
</html>