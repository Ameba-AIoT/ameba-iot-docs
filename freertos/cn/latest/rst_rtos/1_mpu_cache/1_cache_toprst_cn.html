

<!DOCTYPE html>
<html class="writer-html5" lang="zh-CN" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>缓存 (Cache) &mdash; Ameba IoT Docs  文档</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
      <link rel="stylesheet" type="text/css" href="../../_static/custom_cn.css?v=0d22fac7" />
      <link rel="stylesheet" type="text/css" href="../../_static/tabs.css?v=a5c4661c" />
      <link rel="stylesheet" type="text/css" href="../../_static/_static/custom_cn.css" />

  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=7d86a446"></script>
        <script src="../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../../_static/toggleprompt.js?v=d7ede5d2"></script>
        <script src="../../_static/tabs.js?v=3030b3cb"></script>
        <script>let toggleHintShow = 'Click to show';</script>
        <script>let toggleHintHide = 'Click to hide';</script>
        <script>let toggleOpenOnPrint = 'true';</script>
        <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
        <script src="../../_static/translations.js?v=beaddf03"></script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="索引" href="../../genindex.html" />
    <link rel="search" title="搜索" href="../../search.html" />
    <link rel="next" title="启动过程" href="../1_boot_process/0_boot_index_cn.html" />
    <link rel="prev" title="内存保护单元 (MPU)" href="1_mpu_toprst_cn.html" />
   
  
  <script type="text/javascript" src="../../_static/js/selector.js"></script>

  <style>
    .wy-nav-content {max-width: 1000px;} /* 设置最大宽度 */
  </style>

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            Ameba IoT Docs
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="搜索文档" aria-label="搜索文档" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="导航菜单">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../0_ameba_product/0_ameba_product_center_index_cn.html">产品中心</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_ameba_sdk/0_ameba_sdks_index_cn.html">Ameba SDK</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_ameba_solutions/0_ameba_solutions_index_cn.html">解决方案</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_gcc_build_environment/0_gcc_build_index_cn.html">0.1 GCC 编译环境</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_gdb_debug/0_gdb_debug_index_cn.html">0.2 GDB调试</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_gcc_build_library/0_gcc_build_library_index_cn.html">0.3 GCC 库的生成和使用</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_sdk_example/0_sdk_example_index_cn.html">0.4 SDK 示例</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_memory_layout/0_layout_index_cn.html">0.5 Flash 和 RAM 布局</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_user_config/0_usrcfg_index_cn.html">0.6 开发者配置</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_tools/0_tools_index_cn.html">0.7 工具</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_at_command/0_at_command_index_cn.html">0.8 AT 命令</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_file_system/0_vfs_index_cn.html">0.9 虚拟文件系统</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_ftl/0_ftl_index_cn.html">0.A Flash 转换层</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="0_mpu_cache_index_cn.html">1.0 内存保护单元和缓存</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="1_mpu_toprst_cn.html">内存保护单元 (MPU)</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">缓存 (Cache)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="#cache-boot-status">Cache Boot Status</a></li>
<li class="toctree-l3"><a class="reference internal" href="#cache-apis">Cache APIs</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#icache-enable">ICache_Enable</a></li>
<li class="toctree-l4"><a class="reference internal" href="#icache-disable">ICache_Disable</a></li>
<li class="toctree-l4"><a class="reference internal" href="#icache-invalidate">ICache_Invalidate</a></li>
<li class="toctree-l4"><a class="reference internal" href="#dcache-isenabled">DCache_IsEnabled</a></li>
<li class="toctree-l4"><a class="reference internal" href="#dcache-enable">DCache_Enable</a></li>
<li class="toctree-l4"><a class="reference internal" href="#dcache-disable">DCache_Disable</a></li>
<li class="toctree-l4"><a class="reference internal" href="#dcache-invalidate">DCache_Invalidate</a></li>
<li class="toctree-l4"><a class="reference internal" href="#dcache-clean">DCache_Clean</a></li>
<li class="toctree-l4"><a class="reference internal" href="#dcache-cleaninvalidate">DCache_CleanInvalidate</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#how-to-define-a-non-cacheable-data-buffer">How to Define a Non-cacheable Data Buffer</a></li>
<li class="toctree-l3"><a class="reference internal" href="#cache-consistency-when-using-dma">Cache Consistency When Using DMA</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#dma-tx-flow">DMA Tx Flow</a></li>
<li class="toctree-l4"><a class="reference internal" href="#dma-rx-flow">DMA Rx Flow</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../1_boot_process/0_boot_index_cn.html">1.1 启动过程</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1_ota/0_ota_index_cn.html">1.2 固件在线升级(OTA)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1_otpc/0_otpc_index.html">1.3 OTP存储器</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1_chipen/0_chipen_index_cn.html">1.4 CHIP_EN</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1_ipc/0_ipc_index_cn.html">1.5 核间通信</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1_pinmux/0_pinmux_index_cn.html">1.6 PINMUX</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1_gpio/0_gpio_index_cn.html">1.7 GPIO</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1_power_save/0_ps_index_cn.html">1.9 低功耗开发</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2_whc_wifi_bridge/0_wifi_bridge_index_cn.html">2.1 WHC Bridge</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2_whc_fullmac/0_fullmac_index_cn.html">2.2 WHC FullMAC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2_wifi_tunnel/0_wifi_tunnel_index_cn.html">2.3 Wi-Fi R-Mesh</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2_wifi_csi/0_wifi_csi_index_cn.html">2.5 Wi-Fi CSI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2_wifi_adaptivity_test/0_wifi_adaptivity_index.html">2.6 Wi-Fi Adaptivity 测试指南</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_security/0_security_index_cn.html">3.1 安全与加密</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_trng/0_trng_index_cn.html">3.2 真随机数发生器</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_nda_huk_derivation/0_huk_derivation_index_nda.html">3.3 HUK Derivation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_nda_rdp/0_rdp_index_nda.html">3.4 RDP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_nda_rsip/0_rsip_index_nda.html">3.5 RSIP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_nda_secure_boot/0_secure_boot_index_nda.html">3.6 Secure Boot</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_nda_swd_protection/0_swd_protection_index_nda.html">3.7 SWD Protection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_nda_tfm/0_tfm_index_nda.html">3.8 Trusted Firmware-M (TF-M)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_crypto_engine/0_crypto_engine_index_cn.html">3.9 对称硬件加密引擎</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_ecdsa_engine/0_ecdsa_index_cn.html">3.a ECDSA 硬件加密引擎</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_eddsa_engine/0_eddsa_index_cn.html">3.b EDDSA 硬件加密引擎</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_rsa_engine/0_rsa_index_cn.html">3.c RSA 硬件加密引擎</a></li>
<li class="toctree-l1"><a class="reference internal" href="../4_ai/0_ai_index_cn.html">4.1 人工智能</a></li>
<li class="toctree-l1"><a class="reference internal" href="../4_ai_voice/0_ai_voice_index_cn.html">4.2 语音识别</a></li>
<li class="toctree-l1"><a class="reference internal" href="../4_multimedia/0_multimedia_index_cn.html">4.3 多媒体</a></li>
<li class="toctree-l1"><a class="reference internal" href="../4_dsp/0_dsp_index_cn.html">4.4 DSP 使用指南</a></li>
<li class="toctree-l1"><a class="reference internal" href="../6_mass_production/0_mp_index_cn.html">6.1 量产指导</a></li>
<li class="toctree-l1"><a class="reference internal" href="../6_mp_image/0_mp_image_index_cn.html">6.2 MP 固件</a></li>
<li class="toctree-l1"><a class="reference internal" href="../6_mptools/0_mptools_index_cn.html">6.3 产测工具</a></li>
<li class="toctree-l1"><a class="reference internal" href="../7_usb/0_usb_index_cn.html">7.1 USB 主机与从机</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_dmac/0_dmac_index_cn.html">8.1 DMA 控制器</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_psram/0_psram_index_cn.html">8.2 PSRAM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_thermal/0_thermal_index_cn.html">8.3 温度测量</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_adc/0_adc_index_cn.html">8.4 模数转换器</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_ir/0_ir_index_cn.html">8.5 红外收发器</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_ledc/0_ledc_index_cn.html">8.6 LED控制器</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_cap_touch/0_cap_touch_index_cn.html">8.7 Cap-Touch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_key_scan/0_key_scan_index_cn.html">8.8 Key-Scan</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_rtc_io/0_rtc_io_index_cn.html">8.9 RTC-IO</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_lcdc/0_lcdc_index_cn.html">8.A LCD控制器</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="移动版导航菜单" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Ameba IoT Docs</a>
      </nav>

      <div class="wy-nav-content">

        <div class="rst-content">
          <div role="navigation" aria-label="页面导航">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="0_mpu_cache_index_cn.html">内存保护单元与缓存</a></li>
      <li class="breadcrumb-item active">缓存 (Cache)</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="cache">
<h1>缓存 (Cache)<a class="headerlink" href="#cache" title="Link to this heading"></a></h1>
<!-- 下拉菜单 -->
<div style="margin: 20px 0; text-align: left;">
    <div style="display: flex; align-items: center; gap: 10px;">
        <span style="font-size: 14px;">IC: </span>
        <select class="tab-selector" style="height: 22px; padding: 2px 8px; font-size: 13px;">
            <option value="RTL8721Dx">RTL8721Dx</option>
            <option value="RTL8720E">RTL8720E</option>
            <option value="RTL8726E">RTL8726E</option>
            <option value="RTL8730E">RTL8730E</option>
        </select>
    </div>
</div>

<!-- 修复后的 JavaScript -->
<script>
document.addEventListener("DOMContentLoaded", function() {
    const selector = document.querySelector('.tab-selector');

    selector.addEventListener('change', function() {
        const targetTab = this.value;
        const tabs = document.querySelectorAll('.sphinx-tabs-tab');
        let found = false;

        tabs.forEach(tab => {
            const tabText = tab.textContent.trim();
            if (tabText === targetTab) {
                tab.click();
                window.dispatchEvent(new Event('resize')); // 触发插件更新
                found = true;
            }
        });

        if (!found) {
            console.error("未找到选项卡:", targetTab);
        }
    });
});
</script><section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Link to this heading"></a></h2>
<p>The Cache of Soc supports Enable/Disable, Flush and Clean operation, as following table lists.</p>
<table class="docutils align-default" id="id1" style="width: 100%">
<caption><span class="caption-text">Enable/Disable, Flush and Clean operation supported by Cache</span><a class="headerlink" href="#id1" title="Link to this table"></a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>Operation</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>I-Cache</p></th>
<th class="head"><p>D-Cache</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Enable/Disable</p></td>
<td><p>Enable or Disable Cache function</p></td>
<td><p>√</p></td>
<td><p>√</p></td>
</tr>
<tr class="row-odd"><td><p>Flush (Invalidate)</p></td>
<td><ul class="simple">
<li><p>Flush Cache</p></li>
<li><p>D-Cache can be flushed by address</p></li>
<li><p>Can be used after DMA Rx, and CPU reads DMA data from DMA buffer for D-Cache</p></li>
</ul>
</td>
<td><p>√</p></td>
<td><p>√</p></td>
</tr>
<tr class="row-even"><td><p>Clean</p></td>
<td><ul class="simple">
<li><p>Clean D-Cache</p></li>
<li><p>D-Cache will be write back to memory</p></li>
<li><p>D-Cache can be cleaned by address</p></li>
<li><p>Can be used before DMA Tx, after CPU writes data to DMA buffer for D-Cache</p></li>
</ul>
</td>
<td><p>x</p></td>
<td><p>√</p></td>
</tr>
</tbody>
</table>
</section>
<section id="cache-boot-status">
<h2>Cache Boot Status<a class="headerlink" href="#cache-boot-status" title="Link to this heading"></a></h2>
<p>In the ROM code, the default states of Cache are:</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-0-0-0" aria-selected="true" class="sphinx-tabs-tab" id="tab-0-0-0" name="0-0" role="tab" tabindex="0">RTL8721Dx</button><button aria-controls="panel-0-0-1" aria-selected="false" class="sphinx-tabs-tab" id="tab-0-0-1" name="0-1" role="tab" tabindex="-1">RTL8720E</button><button aria-controls="panel-0-0-2" aria-selected="false" class="sphinx-tabs-tab" id="tab-0-0-2" name="0-2" role="tab" tabindex="-1">RTL8726E</button><button aria-controls="panel-0-0-3" aria-selected="false" class="sphinx-tabs-tab" id="tab-0-0-3" name="0-3" role="tab" tabindex="-1">RTL8730E</button></div><div aria-labelledby="tab-0-0-0" class="sphinx-tabs-panel" id="panel-0-0-0" name="0-0" role="tabpanel" tabindex="0"><ul class="simple">
<li><p>KM4 Cache: enabled by default</p></li>
<li><p>KM0 Cache: disabled by default</p></li>
</ul>
</div><div aria-labelledby="tab-0-0-1" class="sphinx-tabs-panel" hidden="true" id="panel-0-0-1" name="0-1" role="tabpanel" tabindex="0"><ul class="simple">
<li><p>KM4 Cache: enabled by default</p></li>
<li><p>KM0 Cache: disabled by default</p></li>
</ul>
</div><div aria-labelledby="tab-0-0-2" class="sphinx-tabs-panel" hidden="true" id="panel-0-0-2" name="0-2" role="tabpanel" tabindex="0"><ul class="simple">
<li><p>KM4 Cache: enabled by default</p></li>
<li><p>KM0 Cache: disabled by default</p></li>
</ul>
</div><div aria-labelledby="tab-0-0-3" class="sphinx-tabs-panel" hidden="true" id="panel-0-0-3" name="0-3" role="tabpanel" tabindex="0"><ul class="simple">
<li><p>KM4 Cache: enabled by default</p></li>
<li><p>KM0 Cache: disabled by default</p></li>
</ul>
</div></div>
</section>
<section id="cache-apis">
<h2>Cache APIs<a class="headerlink" href="#cache-apis" title="Link to this heading"></a></h2>
<section id="icache-enable">
<h3>ICache_Enable<a class="headerlink" href="#icache-enable" title="Link to this heading"></a></h3>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 30.0%" />
<col style="width: 70.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Items</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Introduction</p></td>
<td><p>Enable I-Cache</p></td>
</tr>
<tr class="row-odd"><td><p>Parameters</p></td>
<td><p>None</p></td>
</tr>
<tr class="row-even"><td><p>Return</p></td>
<td><p>None</p></td>
</tr>
</tbody>
</table>
</section>
<section id="icache-disable">
<h3>ICache_Disable<a class="headerlink" href="#icache-disable" title="Link to this heading"></a></h3>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 30.0%" />
<col style="width: 70.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Items</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Introduction</p></td>
<td><p>Disable I-Cache</p></td>
</tr>
<tr class="row-odd"><td><p>Parameters</p></td>
<td><p>None</p></td>
</tr>
<tr class="row-even"><td><p>Return</p></td>
<td><p>None</p></td>
</tr>
</tbody>
</table>
</section>
<section id="icache-invalidate">
<h3>ICache_Invalidate<a class="headerlink" href="#icache-invalidate" title="Link to this heading"></a></h3>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 30.0%" />
<col style="width: 70.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Items</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Introduction</p></td>
<td><p>Invalidate I-Cache</p></td>
</tr>
<tr class="row-odd"><td><p>Parameters</p></td>
<td><p>None</p></td>
</tr>
<tr class="row-even"><td><p>Return</p></td>
<td><p>None</p></td>
</tr>
</tbody>
</table>
</section>
<section id="dcache-isenabled">
<h3>DCache_IsEnabled<a class="headerlink" href="#dcache-isenabled" title="Link to this heading"></a></h3>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 30.0%" />
<col style="width: 70.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Items</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Introduction</p></td>
<td><p>Check D-Cache enabled or not</p></td>
</tr>
<tr class="row-odd"><td><p>Parameters</p></td>
<td><p>None</p></td>
</tr>
<tr class="row-even"><td><p>Return</p></td>
<td><p>D-Cache enable status:</p>
<ul class="simple">
<li><p>1: Enable</p></li>
<li><p>0: Disable</p></li>
</ul>
</td>
</tr>
</tbody>
</table>
</section>
<section id="dcache-enable">
<h3>DCache_Enable<a class="headerlink" href="#dcache-enable" title="Link to this heading"></a></h3>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 30.0%" />
<col style="width: 70.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Items</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Introduction</p></td>
<td><p>Enable D-Cache</p></td>
</tr>
<tr class="row-odd"><td><p>Parameters</p></td>
<td><p>None</p></td>
</tr>
<tr class="row-even"><td><p>Return</p></td>
<td><p>None</p></td>
</tr>
</tbody>
</table>
</section>
<section id="dcache-disable">
<h3>DCache_Disable<a class="headerlink" href="#dcache-disable" title="Link to this heading"></a></h3>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 30.0%" />
<col style="width: 70.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Items</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Introduction</p></td>
<td><p>Disable D-Cache</p></td>
</tr>
<tr class="row-odd"><td><p>Parameters</p></td>
<td><p>None</p></td>
</tr>
<tr class="row-even"><td><p>Return</p></td>
<td><p>None</p></td>
</tr>
</tbody>
</table>
</section>
<section id="dcache-invalidate">
<h3>DCache_Invalidate<a class="headerlink" href="#dcache-invalidate" title="Link to this heading"></a></h3>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 30.0%" />
<col style="width: 70.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Items</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Introduction</p></td>
<td><p>Invalidate D-Cache by address</p></td>
</tr>
<tr class="row-odd"><td><p>Parameters</p></td>
<td><ul class="simple">
<li><p>Address: Invalidated address (aligned to 32-byte boundary)</p></li>
<li><p>Bytes: Size of memory block (in number of bytes)</p></li>
</ul>
</td>
</tr>
<tr class="row-even"><td><p>Return</p></td>
<td><p>None</p></td>
</tr>
</tbody>
</table>
</section>
<section id="dcache-clean">
<h3>DCache_Clean<a class="headerlink" href="#dcache-clean" title="Link to this heading"></a></h3>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 30.0%" />
<col style="width: 70.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Items</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Introduction</p></td>
<td><p>Clean D-Cache by address</p></td>
</tr>
<tr class="row-odd"><td><p>Parameters</p></td>
<td><ul class="simple">
<li><p>Address: Clean address (aligned to 32-byte boundary)</p></li>
<li><p>Bytes: size of memory block (in number of bytes)</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>Address set 0xFFFFFFFF is used to clean all D-Cache.</p>
</div>
</td>
</tr>
<tr class="row-even"><td><p>Return</p></td>
<td><p>None</p></td>
</tr>
</tbody>
</table>
</section>
<section id="dcache-cleaninvalidate">
<h3>DCache_CleanInvalidate<a class="headerlink" href="#dcache-cleaninvalidate" title="Link to this heading"></a></h3>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 30.0%" />
<col style="width: 70.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Items</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Introduction</p></td>
<td><p>Clean and invalidate D-Cache by address</p></td>
</tr>
<tr class="row-odd"><td><p>Parameters</p></td>
<td><ul class="simple">
<li><p>Address: Clean and invalidated address (aligned to 32-byte boundary)</p></li>
<li><p>Bytes: size of memory block (in number of bytes)</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>Address set 0xFFFFFFFF is used to clean and flush all D-Cache.</p>
</div>
</td>
</tr>
<tr class="row-even"><td><p>Return</p></td>
<td><p>None</p></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="how-to-define-a-non-cacheable-data-buffer">
<h2>How to Define a Non-cacheable Data Buffer<a class="headerlink" href="#how-to-define-a-non-cacheable-data-buffer" title="Link to this heading"></a></h2>
<p>Add <em>SRAM_NOCACHE_DATA_SECTION</em> before the buffer definition to define a data buffer with non-cacheable attribute.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">SRAM_NOCACHE_DATA_SECTION</span><span class="w"> </span><span class="n">u8</span><span class="w"> </span><span class="n">noncache_buffer</span><span class="p">[</span><span class="n">DATA_BUFFER_SIZE</span><span class="p">];</span>
</pre></div>
</div>
<div class="admonition caution">
<p class="admonition-title">小心</p>
<ul class="simple">
<li><p>For KR4: non-cacheable attributes can only be defined through MCCA registers, which means a data buffer cannot be defined with non-cacheable attribute.</p></li>
<li><p>For DSP: to operate the DSP Cache memories, refer to <em>Xtensa LX7 Microprocessor Data Book and Xtensa System Software Reference Manual</em> for more information.</p></li>
</ul>
</div>
</section>
<section id="cache-consistency-when-using-dma">
<span id="cache-consistency-using-dma"></span><h2>Cache Consistency When Using DMA<a class="headerlink" href="#cache-consistency-when-using-dma" title="Link to this heading"></a></h2>
<p>When DMA is used to migrate data from/to memory buffers, the start and end address of the buffer must be aligned with the cache line to avoid inconsistencies between cache data and memory data. For example, if the start address of a buffer is in the middle of the cache line and the first half is occupied by other programs, when other programs invalidate or clean the current cache line, this operation will affect the entire cache line, resulting in inconsistent cache and memory data of the current buffer.</p>
<div class="admonition caution">
<p class="admonition-title">小心</p>
<p>The DMA operation address requires exclusive ownership of a complete cache line. You can define the buffer using <code class="xref py py-func docutils literal notranslate"><span class="pre">malloc()</span></code> or <code class="xref py py-func docutils literal notranslate"><span class="pre">ALIGNMTO(CACHE_LINE_SIZE)</span> <span class="pre">u8</span> <span class="pre">op_buffer[CACHE_LINE_ALIGMENT(op_buffer_size)]()</span></code>.</p>
</div>
<section id="dma-tx-flow">
<h3>DMA Tx Flow<a class="headerlink" href="#dma-tx-flow" title="Link to this heading"></a></h3>
<ol class="arabic simple">
<li><p>CPU allocates Tx buffer</p></li>
<li><p>CPU writes Tx buffer</p></li>
<li><p>Realtek recommends: <code class="xref py py-func docutils literal notranslate"><span class="pre">DCache_Clean()</span></code></p></li>
<li><p>DMA Tx Config</p></li>
<li><p>DMA Tx Interrupt</p></li>
</ol>
</section>
<section id="dma-rx-flow">
<h3>DMA Rx Flow<a class="headerlink" href="#dma-rx-flow" title="Link to this heading"></a></h3>
<ol class="arabic">
<li><p>CPU allocates Rx buffer</p></li>
<li><p>DCache_Clean (if the Rx buffer is in a clean state, this step can be skipped)</p>
<div class="admonition caution">
<p class="admonition-title">小心</p>
<ul class="simple">
<li><p>For Cortex-A32, if the Rx buffer is in a dirty state in the cache, executing DCache_Invalidate on Cortex-A32 will perform both a clean and invalidate operation. The clean operation may lead to unexpected write behavior to memory.</p></li>
<li><p>If the Rx buffer is in a dirty state in the cache, the CPU may write the Rx buffer back to memory from the cache when CPU’s D-Cache becomes full, which could overwrite content that DMA Rx has already written.</p></li>
</ul>
</div>
</li>
<li><p>DMA Rx Config</p></li>
<li><p>DMA Rx interrupt</p></li>
<li><p>DCache_Invalidate (this step is mandatory)</p></li>
</ol>
<blockquote>
<div><div class="admonition caution">
<p class="admonition-title">小心</p>
<ul class="simple">
<li><p>For CPUs with automatic data prefetching and monitoring capabilities, such as Cortex-A32/DSP, e.g., Cortex-A32 reads the contents of adjacent addresses of the Rx buffer, Cortex-A32 starts line fills in the background to bring the old values of the Rx buffer back into the cache.</p></li>
<li><p>Prevents the CPU from reading old values into the cache during DMA processing.</p></li>
</ul>
</div>
</div></blockquote>
<ol class="arabic" start="6">
<li><p>CPU reads Rx buffer (the value returned by DMA Rx)</p>
<div class="admonition caution">
<p class="admonition-title">小心</p>
<p>For Cortex-A32/DSP, DCache_Clean/DCache_CleanInvalidate operations write entire cache lines to memory.
When two CPUs (with different cache line sizes) communicate using a shared memory region, this shared memory must be aligned with the larger of the two cache line sizes.
e.g., if the shared memory is only 32 bytes, CPU0 with a 32-byte cache line will only write 32 bytes each time it cleans, while CPU1 with a 64-byte cache line will write 64 bytes each time it cleans, potentially overwriting other data of CPU0.</p>
</div>
</li>
</ol>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="页脚">
        <a href="1_mpu_toprst_cn.html" class="btn btn-neutral float-left" title="内存保护单元 (MPU)" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> 上一页</a>
        <a href="../1_boot_process/0_boot_index_cn.html" class="btn btn-neutral float-right" title="启动过程" accesskey="n" rel="next">下一页 <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; 版权所有 2025, Realsil。</p>
  </div>

  利用 <a href="https://www.sphinx-doc.org/">Sphinx</a> 构建，使用的 
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">主题</a>
    由 <a href="https://readthedocs.org">Read the Docs</a> 开发.
   

</footer>
        </div>

      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 



</body>
</html>