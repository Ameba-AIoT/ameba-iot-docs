

<!DOCTYPE html>
<html class="writer-html5" lang="zh-CN" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>概述 &mdash; Ameba IoT Docs  文档</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
      <link rel="stylesheet" type="text/css" href="../../_static/custom_cn.css?v=0d22fac7" />
      <link rel="stylesheet" type="text/css" href="../../_static/tabs.css?v=a5c4661c" />
      <link rel="stylesheet" type="text/css" href="../../_static/_static/custom_cn.css" />

  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=7d86a446"></script>
        <script src="../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../../_static/toggleprompt.js?v=d7ede5d2"></script>
        <script src="../../_static/tabs.js?v=3030b3cb"></script>
        <script>let toggleHintShow = 'Click to show';</script>
        <script>let toggleHintHide = 'Click to hide';</script>
        <script>let toggleOpenOnPrint = 'true';</script>
        <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
        <script src="../../_static/translations.js?v=beaddf03"></script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="索引" href="../../genindex.html" />
    <link rel="search" title="搜索" href="../../search.html" />
    <link rel="next" title="Flash 转换层 (FTL)" href="../0_ftl/0_ftl_index_cn.html" />
    <link rel="prev" title="虚拟文件系统" href="0_vfs_index_cn.html" />
   
  
  <script type="text/javascript" src="../../_static/js/selector.js"></script>

  <style>
    .wy-nav-content {max-width: 1000px;} /* 设置最大宽度 */
  </style>

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            Ameba IoT Docs
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="搜索文档" aria-label="搜索文档" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="导航菜单">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../0_ameba_product/0_ameba_product_center_index_cn.html">产品中心</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_ameba_sdk/0_ameba_sdks_index_cn.html">Ameba SDK</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_ameba_solutions/0_ameba_solutions_index_cn.html">解决方案</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_gcc_build_environment/0_gcc_build_index_cn.html">0.1 GCC 编译环境</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_gdb_debug/0_gdb_debug_index_cn.html">0.2 GDB调试</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_gcc_build_library/0_gcc_build_library_index_cn.html">0.3 GCC 库的生成和使用</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_sdk_example/0_sdk_example_index_cn.html">0.4 SDK 示例</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_memory_layout/0_layout_index_cn.html">0.5 Flash 和 RAM 布局</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_user_config/0_usrcfg_index_cn.html">0.6 开发者配置</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_tools/0_tools_index_cn.html">0.7 工具</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0_at_command/0_at_command_index_cn.html">0.8 AT 命令</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="0_vfs_index_cn.html">0.9 虚拟文件系统</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">概述</a></li>
<li class="toctree-l2"><a class="reference internal" href="#vfs">VFS 初始化</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id2">VFS 用法</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#flashvfs">Flash中的VFS</a></li>
<li class="toctree-l3"><a class="reference internal" href="#sdvfs">SD卡中的VFS</a></li>
<li class="toctree-l3"><a class="reference internal" href="#appvfs">APP固件中的VFS</a></li>
<li class="toctree-l3"><a class="reference internal" href="#common-file-operation">通用文件操作</a></li>
<li class="toctree-l3"><a class="reference internal" href="#kv">KV 操作</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id4">代码转换</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id5">VFS 加密</a></li>
<li class="toctree-l3"><a class="reference internal" href="#vfs-bin-file-generation">VFS二进制文件生成</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#littlefs">LittleFS二进制文件</a></li>
<li class="toctree-l4"><a class="reference internal" href="#fatfs">FatFS二进制文件</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../0_ftl/0_ftl_index_cn.html">0.A Flash 转换层</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1_mpu_cache/0_mpu_cache_index_cn.html">1.0 内存保护单元和缓存</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1_boot_process/0_boot_index_cn.html">1.1 启动过程</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1_ota/0_ota_index_cn.html">1.2 固件在线升级(OTA)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1_otpc/0_otpc_index.html">1.3 OTP存储器</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1_chipen/0_chipen_index_cn.html">1.4 CHIP_EN</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1_ipc/0_ipc_index_cn.html">1.5 核间通信</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1_pinmux/0_pinmux_index_cn.html">1.6 PINMUX</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1_gpio/0_gpio_index_cn.html">1.7 GPIO</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1_power_save/0_ps_index_cn.html">1.9 低功耗开发</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2_whc_wifi_bridge/0_wifi_bridge_index_cn.html">2.1 WHC Bridge</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2_whc_fullmac/0_fullmac_index_cn.html">2.2 WHC FullMAC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2_wifi_tunnel/0_wifi_tunnel_index_cn.html">2.3 Wi-Fi R-Mesh</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2_wifi_csi/0_wifi_csi_index_cn.html">2.5 Wi-Fi CSI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2_wifi_adaptivity_test/0_wifi_adaptivity_index.html">2.6 Wi-Fi Adaptivity 测试指南</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_security/0_security_index_cn.html">3.1 安全与加密</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_trng/0_trng_index_cn.html">3.2 真随机数发生器</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_nda_huk_derivation/0_huk_derivation_index_nda.html">3.3 HUK Derivation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_nda_rdp/0_rdp_index_nda.html">3.4 RDP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_nda_rsip/0_rsip_index_nda.html">3.5 RSIP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_nda_secure_boot/0_secure_boot_index_nda.html">3.6 Secure Boot</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_nda_swd_protection/0_swd_protection_index_nda.html">3.7 SWD Protection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_nda_tfm/0_tfm_index_nda.html">3.8 Trusted Firmware-M (TF-M)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_crypto_engine/0_crypto_engine_index_cn.html">3.9 对称硬件加密引擎</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_ecdsa_engine/0_ecdsa_index_cn.html">3.a ECDSA 硬件加密引擎</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_eddsa_engine/0_eddsa_index_cn.html">3.b EDDSA 硬件加密引擎</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_rsa_engine/0_rsa_index_cn.html">3.c RSA 硬件加密引擎</a></li>
<li class="toctree-l1"><a class="reference internal" href="../4_ai/0_ai_index_cn.html">4.1 人工智能</a></li>
<li class="toctree-l1"><a class="reference internal" href="../4_ai_voice/0_ai_voice_index_cn.html">4.2 语音识别</a></li>
<li class="toctree-l1"><a class="reference internal" href="../4_multimedia/0_multimedia_index_cn.html">4.3 多媒体</a></li>
<li class="toctree-l1"><a class="reference internal" href="../4_dsp/0_dsp_index_cn.html">4.4 DSP 使用指南</a></li>
<li class="toctree-l1"><a class="reference internal" href="../6_mass_production/0_mp_index_cn.html">6.1 量产指导</a></li>
<li class="toctree-l1"><a class="reference internal" href="../6_mp_image/0_mp_image_index_cn.html">6.2 MP 固件</a></li>
<li class="toctree-l1"><a class="reference internal" href="../6_mptools/0_mptools_index_cn.html">6.3 产测工具</a></li>
<li class="toctree-l1"><a class="reference internal" href="../7_usb/0_usb_index_cn.html">7.1 USB 主机与从机</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_dmac/0_dmac_index_cn.html">8.1 DMA 控制器</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_psram/0_psram_index_cn.html">8.2 PSRAM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_thermal/0_thermal_index_cn.html">8.3 温度测量</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_adc/0_adc_index_cn.html">8.4 模数转换器</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_ir/0_ir_index_cn.html">8.5 红外收发器</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_ledc/0_ledc_index_cn.html">8.6 LED控制器</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_cap_touch/0_cap_touch_index_cn.html">8.7 Cap-Touch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_key_scan/0_key_scan_index_cn.html">8.8 Key-Scan</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_rtc_io/0_rtc_io_index_cn.html">8.9 RTC-IO</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_lcdc/0_lcdc_index_cn.html">8.A LCD控制器</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="移动版导航菜单" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Ameba IoT Docs</a>
      </nav>

      <div class="wy-nav-content">

        <div class="rst-content">
          <div role="navigation" aria-label="页面导航">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="0_vfs_index_cn.html">虚拟文件系统</a></li>
      <li class="breadcrumb-item active">概述</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <span class="target" id="virtual-file-system"></span><!-- 下拉菜单 -->
<div style="margin: 20px 0; text-align: left;">
    <div style="display: flex; align-items: center; gap: 10px;">
        <span style="font-size: 14px;">IC: </span>
        <select class="tab-selector" style="height: 22px; padding: 2px 8px; font-size: 13px;">
            <option value="RTL8721Dx">RTL8721Dx</option>
            <option value="RTL8720E">RTL8720E</option>
            <option value="RTL8726E">RTL8726E</option>
            <option value="RTL8730E">RTL8730E</option>
        </select>
    </div>
</div>

<!-- 修复后的 JavaScript -->
<script>
document.addEventListener("DOMContentLoaded", function() {
    const selector = document.querySelector('.tab-selector');

    selector.addEventListener('change', function() {
        const targetTab = this.value;
        const tabs = document.querySelectorAll('.sphinx-tabs-tab');
        let found = false;

        tabs.forEach(tab => {
            const tabText = tab.textContent.trim();
            if (tabText === targetTab) {
                tab.click();
                window.dispatchEvent(new Event('resize')); // 触发插件更新
                found = true;
            }
        });

        if (!found) {
            console.error("未找到选项卡:", targetTab);
        }
    });
});
</script><section id="id1">
<h1>概述<a class="headerlink" href="#id1" title="Link to this heading"></a></h1>
<p>本节介绍如何在Ameba SoC上运行虚拟文件系统（VFS），其底层实现包含FatFS与LittleFS。用户可通过使用VFS忽略不同文件系统之间的差异。VFS提供了fopen、fclose、fwrite、fread等通用文件操作接口，键值对（KV）接口基于这些通用文件操作编译。</p>
<p>VFS的架构如下图所示：</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-0-0-0" aria-selected="true" class="sphinx-tabs-tab" id="tab-0-0-0" name="0-0" role="tab" tabindex="0">RTL8721Dx</button><button aria-controls="panel-0-0-1" aria-selected="false" class="sphinx-tabs-tab" id="tab-0-0-1" name="0-1" role="tab" tabindex="-1">RTL8720E</button><button aria-controls="panel-0-0-2" aria-selected="false" class="sphinx-tabs-tab" id="tab-0-0-2" name="0-2" role="tab" tabindex="-1">RTL8726E</button><button aria-controls="panel-0-0-3" aria-selected="false" class="sphinx-tabs-tab" id="tab-0-0-3" name="0-3" role="tab" tabindex="-1">RTL8730E</button></div><div aria-labelledby="tab-0-0-0" class="sphinx-tabs-panel" id="panel-0-0-0" name="0-0" role="tabpanel" tabindex="0"><figure class="align-center" id="id7">
<a class="reference internal image-reference" href="../../_images/vfs_architecture_lite_dplus.svg"><img alt="../../_images/vfs_architecture_lite_dplus.svg" height="285" src="../../_images/vfs_architecture_lite_dplus.svg" width="403" /></a>
<figcaption>
<p><span class="caption-text">VFS架构</span><a class="headerlink" href="#id7" title="Link to this image"></a></p>
</figcaption>
</figure>
</div><div aria-labelledby="tab-0-0-1" class="sphinx-tabs-panel" hidden="true" id="panel-0-0-1" name="0-1" role="tabpanel" tabindex="0"><figure class="align-center" id="id8">
<a class="reference internal image-reference" href="../../_images/vfs_architecture_lite_dplus.svg"><img alt="../../_images/vfs_architecture_lite_dplus.svg" height="285" src="../../_images/vfs_architecture_lite_dplus.svg" width="403" /></a>
<figcaption>
<p><span class="caption-text">VFS架构</span><a class="headerlink" href="#id8" title="Link to this image"></a></p>
</figcaption>
</figure>
</div><div aria-labelledby="tab-0-0-2" class="sphinx-tabs-panel" hidden="true" id="panel-0-0-2" name="0-2" role="tabpanel" tabindex="0"><figure class="align-center" id="id9">
<a class="reference internal image-reference" href="../../_images/vfs_architecture_lite_dplus.svg"><img alt="../../_images/vfs_architecture_lite_dplus.svg" height="285" src="../../_images/vfs_architecture_lite_dplus.svg" width="403" /></a>
<figcaption>
<p><span class="caption-text">VFS架构</span><a class="headerlink" href="#id9" title="Link to this image"></a></p>
</figcaption>
</figure>
</div><div aria-labelledby="tab-0-0-3" class="sphinx-tabs-panel" hidden="true" id="panel-0-0-3" name="0-3" role="tabpanel" tabindex="0"><figure class="align-center" id="id10">
<a class="reference internal image-reference" href="../../_images/vfs_architecture_smart.svg"><img alt="../../_images/vfs_architecture_smart.svg" height="310" src="../../_images/vfs_architecture_smart.svg" width="403" /></a>
<figcaption>
<p><span class="caption-text">VFS架构</span><a class="headerlink" href="#id10" title="Link to this image"></a></p>
</figcaption>
</figure>
</div></div>
</section>
<section id="vfs">
<h1>VFS 初始化<a class="headerlink" href="#vfs" title="Link to this heading"></a></h1>
<p>VFS的初始化默认在 <code class="file docutils literal notranslate"><span class="pre">main.c</span></code> 文件中实现.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">void</span> <span class="n">app_filesystem_init</span><span class="p">(</span><span class="n">void</span><span class="p">)</span>
<span class="p">{</span>
  <span class="nb">int</span> <span class="n">ret</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">vfs_init</span><span class="p">();</span>

<span class="c1">#ifdef CONFIG_FATFS_WITHIN_APP_IMG</span>
  <span class="n">ret</span> <span class="o">=</span> <span class="n">vfs_user_register</span><span class="p">(</span><span class="s2">&quot;fat&quot;</span><span class="p">,</span> <span class="n">VFS_FATFS</span><span class="p">,</span> <span class="n">VFS_INF_FLASH</span><span class="p">,</span> <span class="n">VFS_REGION_2</span><span class="p">,</span> <span class="n">VFS_RO</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">RTK_LOGI</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span> <span class="s2">&quot;VFS-FAT Init Success </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
     <span class="n">RTK_LOGI</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span> <span class="s2">&quot;VFS-FAT Init Fail </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>
  <span class="p">}</span>
<span class="c1">#endif</span>

  <span class="n">ret</span> <span class="o">=</span> <span class="n">vfs_user_register</span><span class="p">(</span><span class="n">VFS_PREFIX</span><span class="p">,</span> <span class="n">VFS_LITTLEFS</span><span class="p">,</span> <span class="n">VFS_INF_FLASH</span><span class="p">,</span> <span class="n">VFS_REGION_1</span><span class="p">,</span> <span class="n">VFS_RW</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="n">rt_kv_init</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">RTK_LOGI</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span> <span class="s2">&quot;File System Init Success</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="n">RTK_LOGE</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span> <span class="s2">&quot;File System Init Fail </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>
  <span class="k">return</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>根据用户的配置， <code class="xref py py-func docutils literal notranslate"><span class="pre">vfs_user_register()</span></code> 接口将VFS挂载至Flash（或SD卡，需支持）。若挂载失败，该API会检测Flash是否处于空白状态（全0xFF）。当检测到Flash为空白状态时，将执行Flash编程操作以初始化VFS。</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">vfs_user_register</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">prefix</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">vfs_type</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">interface</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">region</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">flag</span><span class="p">)</span>
</pre></div>
</div>
<p>参数说明：</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-1-1-0" aria-selected="true" class="sphinx-tabs-tab" id="tab-1-1-0" name="1-0" role="tab" tabindex="0">RTL8721Dx</button><button aria-controls="panel-1-1-1" aria-selected="false" class="sphinx-tabs-tab" id="tab-1-1-1" name="1-1" role="tab" tabindex="-1">RTL8720E</button><button aria-controls="panel-1-1-2" aria-selected="false" class="sphinx-tabs-tab" id="tab-1-1-2" name="1-2" role="tab" tabindex="-1">RTL8726E</button><button aria-controls="panel-1-1-3" aria-selected="false" class="sphinx-tabs-tab" id="tab-1-1-3" name="1-3" role="tab" tabindex="-1">RTL8730E</button></div><div aria-labelledby="tab-1-1-0" class="sphinx-tabs-panel" id="panel-1-1-0" name="1-0" role="tabpanel" tabindex="0"><ul class="simple">
<li><p><strong>prefix</strong>: 用户自定义，用于区分不同的文件系统</p></li>
<li><p><strong>vfs_type</strong>: 底层实现的文件系统类型（FatFS 或 LittleFS）</p></li>
<li><p><strong>interface</strong>: 存储器类型（仅支持Flash）</p></li>
<li><p><strong>region</strong>: Flash分区（VFS1 或 VFS2，参考 <a class="reference internal" href="#vfs-on-flash"><span class="std std-ref">Flash中的VFS</span></a>）</p></li>
<li><p><strong>flag</strong>: 文件系统的操作权限（读写或只读）</p></li>
</ul>
</div><div aria-labelledby="tab-1-1-1" class="sphinx-tabs-panel" hidden="true" id="panel-1-1-1" name="1-1" role="tabpanel" tabindex="0"><ul class="simple">
<li><p><strong>prefix</strong>: 用户自定义，用于区分不同的文件系统</p></li>
<li><p><strong>vfs_type</strong>: 底层实现的文件系统类型（FatFS 或 LittleFS）</p></li>
<li><p><strong>interface</strong>: 存储器类型（仅支持Flash）</p></li>
<li><p><strong>region</strong>: Flash分区（VFS1 或 VFS2，参考 <a class="reference internal" href="#vfs-on-flash"><span class="std std-ref">Flash中的VFS</span></a>）</p></li>
<li><p><strong>flag</strong>: 文件系统的操作权限（读写或只读）</p></li>
</ul>
</div><div aria-labelledby="tab-1-1-2" class="sphinx-tabs-panel" hidden="true" id="panel-1-1-2" name="1-2" role="tabpanel" tabindex="0"><ul class="simple">
<li><p><strong>prefix</strong>: 用户自定义，用于区分不同的文件系统</p></li>
<li><p><strong>vfs_type</strong>: 底层实现的文件系统类型（FatFS 或 LittleFS）</p></li>
<li><p><strong>interface</strong>: 存储器类型（仅支持Flash）</p></li>
<li><p><strong>region</strong>: Flash分区（VFS1 或 VFS2，参考 <a class="reference internal" href="#vfs-on-flash"><span class="std std-ref">Flash中的VFS</span></a>）</p></li>
<li><p><strong>flag</strong>: 文件系统的操作权限（读写或只读）</p></li>
</ul>
</div><div aria-labelledby="tab-1-1-3" class="sphinx-tabs-panel" hidden="true" id="panel-1-1-3" name="1-3" role="tabpanel" tabindex="0"><ul class="simple">
<li><p><strong>prefix</strong>: 用户自定义，用于区分不同的文件系统</p></li>
<li><p><strong>vfs_type</strong>: 底层实现的文件系统类型（FatFS 或 LittleFS）</p></li>
<li><p><strong>interface</strong>: 存储器类型（LittleFS支持Flash，FatFS支持Flash和SD card）</p></li>
<li><p><strong>region</strong>: Flash分区（VFS1 或 VFS2，参考 <a class="reference internal" href="#vfs-on-flash"><span class="std std-ref">Flash中的VFS</span></a>）</p></li>
<li><p><strong>flag</strong>: 文件系统的操作权限（读写或只读）</p></li>
</ul>
</div></div>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p><strong>VFS1</strong> 的 <strong>vfs_type</strong> 默认配置为 <strong>LittleFS</strong>，以实现读写均衡与掉电保护。为确保合理使用FatFS，必须在 menuconfig 中完成相关配置。</p>
</div>
</section>
<section id="id2">
<h1>VFS 用法<a class="headerlink" href="#id2" title="Link to this heading"></a></h1>
<section id="flashvfs">
<span id="vfs-on-flash"></span><h2>Flash中的VFS<a class="headerlink" href="#flashvfs" title="Link to this heading"></a></h2>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-2-2-0" aria-selected="true" class="sphinx-tabs-tab" id="tab-2-2-0" name="2-0" role="tab" tabindex="0">RTL8730E</button><button aria-controls="panel-2-2-1" aria-selected="false" class="sphinx-tabs-tab" id="tab-2-2-1" name="2-1" role="tab" tabindex="-1">RTL8720E</button><button aria-controls="panel-2-2-2" aria-selected="false" class="sphinx-tabs-tab" id="tab-2-2-2" name="2-2" role="tab" tabindex="-1">RTL8726E</button><button aria-controls="panel-2-2-3" aria-selected="false" class="sphinx-tabs-tab" id="tab-2-2-3" name="2-3" role="tab" tabindex="-1">RTL8721Dx</button></div><div aria-labelledby="tab-2-2-0" class="sphinx-tabs-panel" id="panel-2-2-0" name="2-0" role="tabpanel" tabindex="0"><p>如果VFS接口设置为Flash，则需要适当调整Flash分区，并根据 <code class="file docutils literal notranslate"><span class="pre">main.c</span></code> 中的配置修改文件 <code class="docutils literal notranslate"><span class="pre">{SDK}component\soc\amebasmart\usrcfg\ameba_flashcfg.c</span></code> 中 Flash_Layout[] 数组中的 <strong>VFS1</strong> 或 <strong>VFS2</strong> 区域。</p>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>当调整Flash布局时，需要考虑Flash的类型。</p>
<ul class="simple">
<li><p>NOR Flash：FatFS 和 LittleFS</p></li>
<li><p>NAND Flash：仅 LittleFS</p></li>
</ul>
</div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">FlashLayoutInfo_TypeDef</span><span class="w"> </span><span class="n">Flash_Layout_Nor</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="cm">/*Region_Type,         [StartAddr,     EndAddr]                */</span>
<span class="w">   </span><span class="p">{</span><span class="n">IMG_BOOT</span><span class="p">,</span><span class="w">                     </span><span class="mh">0x08000000</span><span class="p">,</span><span class="w"> </span><span class="mh">0x0801FFFF</span><span class="p">},</span><span class="w"> </span><span class="c1">//Boot Manifest(4K) + KM4 Bootloader(124K)</span>
<span class="w">   </span><span class="c1">//Users should modify below according to their own memory</span>
<span class="w">   </span><span class="p">{</span><span class="n">IMG_APP_OTA1</span><span class="p">,</span><span class="w">                 </span><span class="mh">0x08020000</span><span class="p">,</span><span class="w"> </span><span class="mh">0x082FFFFF</span><span class="p">},</span><span class="w"> </span><span class="c1">//Certificate(4K) + Manifest(4K) + KR4 &amp; KM4   Application OTA1 + Manifest(4K) + RDP IMG OTA1</span>
<span class="w">   </span><span class="c1">// + AP IMG OTA1</span>
<span class="w">   </span><span class="p">{</span><span class="n">IMG_BOOT_OTA2</span><span class="p">,</span><span class="w">        </span><span class="mh">0x08300000</span><span class="p">,</span><span class="w"> </span><span class="mh">0x0833FFFF</span><span class="p">},</span><span class="w"> </span><span class="c1">//Boot Manifest(4K) + KM4 Bootloader(252K) OTA</span>
<span class="w">   </span><span class="p">{</span><span class="n">IMG_APP_OTA2</span><span class="p">,</span><span class="w">                 </span><span class="mh">0x08340000</span><span class="p">,</span><span class="w"> </span><span class="mh">0x0861FFFF</span><span class="p">},</span><span class="w"> </span><span class="c1">//Certificate(4K) + Manifest(4K) + KR4 &amp; KM4   Application OTA2 + Manifest(4K) + RDP IMG OTA2</span>
<span class="w">   </span><span class="c1">// + AP IMG OTA2</span>
<span class="w">   </span><span class="p">{</span><span class="n">FTL</span><span class="p">,</span><span class="w">                          </span><span class="mh">0x08620000</span><span class="p">,</span><span class="w"> </span><span class="mh">0x08622FFF</span><span class="p">},</span><span class="w"> </span><span class="c1">//FTL for BT(&gt;=12K), The start offset of flash    pages which is allocated to FTL physical map.</span>
<span class="hll"><span class="w">   </span><span class="p">{</span><span class="n">VFS1</span><span class="p">,</span><span class="w">                                 </span><span class="mh">0x08623000</span><span class="p">,</span><span class="w"> </span><span class="mh">0x08642FFF</span><span class="p">},</span><span class="w"> </span><span class="c1">//VFS region 1 (128K)</span>
</span><span class="hll"><span class="w">   </span><span class="p">{</span><span class="n">VFS2</span><span class="p">,</span><span class="w">                                 </span><span class="mh">0xFFFFFFFF</span><span class="p">,</span><span class="w"> </span><span class="mh">0xFFFFFFFF</span><span class="p">},</span><span class="w"> </span><span class="c1">//VFS region 2</span>
</span><span class="w">   </span><span class="p">{</span><span class="n">USER</span><span class="p">,</span><span class="w">                                 </span><span class="mh">0xFFFFFFFF</span><span class="p">,</span><span class="w"> </span><span class="mh">0xFFFFFFFF</span><span class="p">},</span><span class="w"> </span><span class="c1">//reserve for user</span>
<span class="w">   </span><span class="cm">/* End */</span>
<span class="w">   </span><span class="p">{</span><span class="mh">0xFF</span><span class="p">,</span><span class="w">                                 </span><span class="mh">0xFFFFFFFF</span><span class="p">,</span><span class="w"> </span><span class="mh">0xFFFFFFFF</span><span class="p">},</span>
<span class="p">};</span>
</pre></div>
</div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">FlashLayoutInfo_TypeDef</span><span class="w"> </span><span class="n">Flash_Layout_Nand</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="cm">/*Region_Type,         [StartAddr,     EndAddr]                */</span>
<span class="w">   </span><span class="p">{</span><span class="n">IMG_BOOT</span><span class="p">,</span><span class="w">                     </span><span class="mh">0x08000000</span><span class="p">,</span><span class="w"> </span><span class="mh">0x0801FFFF</span><span class="p">},</span><span class="w"> </span><span class="c1">//Boot Manifest(4K) + KM4 Bootloader(124K)</span>
<span class="w">   </span><span class="c1">//Users should modify below according to their own memory</span>
<span class="w">   </span><span class="p">{</span><span class="n">IMG_APP_OTA1</span><span class="p">,</span><span class="w">                 </span><span class="mh">0x08020000</span><span class="p">,</span><span class="w"> </span><span class="mh">0x082FFFFF</span><span class="p">},</span><span class="w"> </span><span class="c1">//Certificate(4K) + Manifest(4K) + KR4 &amp; KM4   Application OTA1 + Manifest(4K) + RDP IMG OTA1</span>
<span class="w">   </span><span class="c1">// + AP IMG OTA1</span>
<span class="w">   </span><span class="p">{</span><span class="n">IMG_BOOT_OTA2</span><span class="p">,</span><span class="w">        </span><span class="mh">0x08300000</span><span class="p">,</span><span class="w"> </span><span class="mh">0x0833FFFF</span><span class="p">},</span><span class="w"> </span><span class="c1">//Boot Manifest(4K) + KM4 Bootloader(252K) OTA</span>
<span class="w">   </span><span class="p">{</span><span class="n">IMG_APP_OTA2</span><span class="p">,</span><span class="w">                 </span><span class="mh">0x08340000</span><span class="p">,</span><span class="w"> </span><span class="mh">0x0861FFFF</span><span class="p">},</span><span class="w"> </span><span class="c1">//Certificate(4K) + Manifest(4K) + KR4 &amp; KM4   Application OTA2 + Manifest(4K) + RDP IMG OTA2</span>
<span class="w">   </span><span class="c1">// + AP IMG OTA2</span>
<span class="w">   </span><span class="p">{</span><span class="n">FTL</span><span class="p">,</span><span class="w">                          </span><span class="mh">0x0C400000</span><span class="p">,</span><span class="w"> </span><span class="mh">0x0C45FFFF</span><span class="p">},</span><span class="w"> </span><span class="c1">//FTL for BT(&gt;=384K), The start offset of flash   pages which is allocated to FTL physical map.</span>
<span class="hll"><span class="w">   </span><span class="p">{</span><span class="n">VFS1</span><span class="p">,</span><span class="w">                                 </span><span class="mh">0x0C460000</span><span class="p">,</span><span class="w"> </span><span class="mh">0x0C55FFFF</span><span class="p">},</span><span class="w"> </span><span class="c1">//VFS region 1(1024K)</span>
</span><span class="hll"><span class="w">   </span><span class="p">{</span><span class="n">VFS2</span><span class="p">,</span><span class="w">                                 </span><span class="mh">0xFFFFFFFF</span><span class="p">,</span><span class="w"> </span><span class="mh">0xFFFFFFFF</span><span class="p">},</span><span class="w"> </span><span class="c1">//VFS region 2</span>
</span><span class="w">   </span><span class="p">{</span><span class="n">USER</span><span class="p">,</span><span class="w">                                 </span><span class="mh">0xFFFFFFFF</span><span class="p">,</span><span class="w"> </span><span class="mh">0xFFFFFFFF</span><span class="p">},</span><span class="w"> </span><span class="c1">//reserve for user</span>
<span class="w">   </span><span class="cm">/* End */</span>
<span class="w">   </span><span class="p">{</span><span class="mh">0xFF</span><span class="p">,</span><span class="w">                                 </span><span class="mh">0xFFFFFFFF</span><span class="p">,</span><span class="w"> </span><span class="mh">0xFFFFFFFF</span><span class="p">},</span>
<span class="p">};</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">备注</p>
<ul class="simple">
<li><p><strong>VFS1</strong> 区域必须存在，且其大小必须大于128KB。</p></li>
<li><p>最多可配置两个VFS区域。</p></li>
</ul>
</div>
</div><div aria-labelledby="tab-2-2-1" class="sphinx-tabs-panel" hidden="true" id="panel-2-2-1" name="2-1" role="tabpanel" tabindex="0"><p>如果VFS接口设置为Flash，则需要适当调整Flash分区，并根据 <code class="file docutils literal notranslate"><span class="pre">main.c</span></code> 中的配置修改文件 <code class="docutils literal notranslate"><span class="pre">{SDK}component\soc\amebalite\usrcfg\ameba_flashcfg.c</span></code> 中 Flash_Layout[] 数组中的 <strong>VFS1</strong> 或 <strong>VFS2</strong> 区域。</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">FlashLayoutInfo_TypeDef</span><span class="w"> </span><span class="n">Flash_Layout</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="cm">/*Region_Type,    [StartAddr,     EndAddr]                */</span>
<span class="w">   </span><span class="p">{</span><span class="n">IMG_BOOT</span><span class="p">,</span><span class="w">      </span><span class="mh">0x08000000</span><span class="p">,</span><span class="w"> </span><span class="mh">0x08013FFF</span><span class="p">},</span><span class="w"> </span><span class="c1">//Boot Manifest(4K) + KM4 Bootloader(76K)</span>
<span class="w">   </span><span class="c1">//Users should modify below according to their own memory</span>
<span class="w">   </span><span class="p">{</span><span class="n">IMG_APP_OTA1</span><span class="p">,</span><span class="w">  </span><span class="mh">0x08014000</span><span class="p">,</span><span class="w"> </span><span class="mh">0x081F3FFF</span><span class="p">},</span><span class="w"> </span><span class="c1">//Certificate(4K) + Manifest(4K) + KR4 &amp; KM4  Application OTA1 + Manifest(4K) + RDP IMG OTA1</span>

<span class="w">   </span><span class="p">{</span><span class="n">IMG_BOOT_OTA2</span><span class="p">,</span><span class="w"> </span><span class="mh">0x08200000</span><span class="p">,</span><span class="w"> </span><span class="mh">0x08213FFF</span><span class="p">},</span><span class="w"> </span><span class="c1">//Boot Manifest(4K) + KM4 Bootloader(76K) OTA</span>
<span class="w">   </span><span class="p">{</span><span class="n">IMG_APP_OTA2</span><span class="p">,</span><span class="w">  </span><span class="mh">0x08214000</span><span class="p">,</span><span class="w"> </span><span class="mh">0x083DCFFF</span><span class="p">},</span><span class="w"> </span><span class="c1">//Certificate(4K) + Manifest(4K) + KR4 &amp; KM4  Application OTA2 + Manifest(4K) + RDP IMG OTA2</span>
<span class="w">   </span><span class="p">{</span><span class="n">FTL</span><span class="p">,</span><span class="w">           </span><span class="mh">0x083DD000</span><span class="p">,</span><span class="w"> </span><span class="mh">0x083DFFFF</span><span class="p">},</span><span class="w"> </span><span class="c1">//FTL for BT(&gt;=12K), The start offset of flash   pages which is allocated to FTL physical map.</span>
<span class="hll"><span class="w">   </span><span class="p">{</span><span class="n">VFS1</span><span class="p">,</span><span class="w">          </span><span class="mh">0x083E0000</span><span class="p">,</span><span class="w"> </span><span class="mh">0x083FFFFF</span><span class="p">},</span><span class="w"> </span><span class="c1">//VFS region 1 (128K)</span>
</span><span class="w">   </span><span class="p">{</span><span class="n">IMG_DSP</span><span class="p">,</span><span class="w">       </span><span class="mh">0x08400000</span><span class="p">,</span><span class="w"> </span><span class="mh">0x086FFFFF</span><span class="p">},</span><span class="w"> </span><span class="c1">//Manifest(4K) + DSP IMG, only one DSP region in    layout</span>
<span class="w">   </span><span class="p">{</span><span class="n">VFS2</span><span class="p">,</span><span class="w">          </span><span class="mh">0xFFFFFFFF</span><span class="p">,</span><span class="w"> </span><span class="mh">0xFFFFFFFF</span><span class="p">},</span><span class="w"> </span><span class="c1">//VFS region 2</span>
<span class="w">   </span><span class="p">{</span><span class="n">USER</span><span class="p">,</span><span class="w">          </span><span class="mh">0xFFFFFFFF</span><span class="p">,</span><span class="w"> </span><span class="mh">0xFFFFFFFF</span><span class="p">},</span><span class="w"> </span><span class="c1">//reserve for user</span>

<span class="w">   </span><span class="cm">/* End */</span>
<span class="w">   </span><span class="p">{</span><span class="mh">0xFF</span><span class="p">,</span><span class="w">          </span><span class="mh">0xFFFFFFFF</span><span class="p">,</span><span class="w"> </span><span class="mh">0xFFFFFFFF</span><span class="p">},</span>
<span class="p">};</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">备注</p>
<ul class="simple">
<li><p><strong>VFS1</strong> 区域必须存在，且其大小必须大于128KB。</p></li>
<li><p>最多可配置两个VFS区域。</p></li>
</ul>
</div>
</div><div aria-labelledby="tab-2-2-2" class="sphinx-tabs-panel" hidden="true" id="panel-2-2-2" name="2-2" role="tabpanel" tabindex="0"><p>如果VFS接口设置为Flash，则需要适当调整Flash分区，并根据 <code class="file docutils literal notranslate"><span class="pre">main.c</span></code> 中的配置修改文件 <code class="docutils literal notranslate"><span class="pre">{SDK}component\soc\amebalite\usrcfg\ameba_flashcfg.c</span></code> 中 Flash_Layout[] 数组中的 <strong>VFS1</strong> 或 <strong>VFS2</strong> 区域。</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">FlashLayoutInfo_TypeDef</span><span class="w"> </span><span class="n">Flash_Layout</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="cm">/*Region_Type,    [StartAddr,     EndAddr]                */</span>
<span class="w">   </span><span class="p">{</span><span class="n">IMG_BOOT</span><span class="p">,</span><span class="w">      </span><span class="mh">0x08000000</span><span class="p">,</span><span class="w"> </span><span class="mh">0x08013FFF</span><span class="p">},</span><span class="w"> </span><span class="c1">//Boot Manifest(4K) + KM4 Bootloader(76K)</span>
<span class="w">   </span><span class="c1">//Users should modify below according to their own memory</span>
<span class="w">   </span><span class="p">{</span><span class="n">IMG_APP_OTA1</span><span class="p">,</span><span class="w">  </span><span class="mh">0x08014000</span><span class="p">,</span><span class="w"> </span><span class="mh">0x081F3FFF</span><span class="p">},</span><span class="w"> </span><span class="c1">//Certificate(4K) + Manifest(4K) + KR4 &amp; KM4  Application OTA1 + Manifest(4K) + RDP IMG OTA1</span>

<span class="w">   </span><span class="p">{</span><span class="n">IMG_BOOT_OTA2</span><span class="p">,</span><span class="w"> </span><span class="mh">0x08200000</span><span class="p">,</span><span class="w"> </span><span class="mh">0x08213FFF</span><span class="p">},</span><span class="w"> </span><span class="c1">//Boot Manifest(4K) + KM4 Bootloader(76K) OTA</span>
<span class="w">   </span><span class="p">{</span><span class="n">IMG_APP_OTA2</span><span class="p">,</span><span class="w">  </span><span class="mh">0x08214000</span><span class="p">,</span><span class="w"> </span><span class="mh">0x083DCFFF</span><span class="p">},</span><span class="w"> </span><span class="c1">//Certificate(4K) + Manifest(4K) + KR4 &amp; KM4  Application OTA2 + Manifest(4K) + RDP IMG OTA2</span>
<span class="w">   </span><span class="p">{</span><span class="n">FTL</span><span class="p">,</span><span class="w">           </span><span class="mh">0x083DD000</span><span class="p">,</span><span class="w"> </span><span class="mh">0x083DFFFF</span><span class="p">},</span><span class="w"> </span><span class="c1">//FTL for BT(&gt;=12K), The start offset of flash   pages which is allocated to FTL physical map.</span>
<span class="hll"><span class="w">   </span><span class="p">{</span><span class="n">VFS1</span><span class="p">,</span><span class="w">          </span><span class="mh">0x083E0000</span><span class="p">,</span><span class="w"> </span><span class="mh">0x083FFFFF</span><span class="p">},</span><span class="w"> </span><span class="c1">//VFS region 1 (128K)</span>
</span><span class="w">   </span><span class="p">{</span><span class="n">IMG_DSP</span><span class="p">,</span><span class="w">       </span><span class="mh">0x08400000</span><span class="p">,</span><span class="w"> </span><span class="mh">0x086FFFFF</span><span class="p">},</span><span class="w"> </span><span class="c1">//Manifest(4K) + DSP IMG, only one DSP region in    layout</span>
<span class="w">   </span><span class="p">{</span><span class="n">VFS2</span><span class="p">,</span><span class="w">          </span><span class="mh">0xFFFFFFFF</span><span class="p">,</span><span class="w"> </span><span class="mh">0xFFFFFFFF</span><span class="p">},</span><span class="w"> </span><span class="c1">//VFS region 2</span>
<span class="w">   </span><span class="p">{</span><span class="n">USER</span><span class="p">,</span><span class="w">          </span><span class="mh">0xFFFFFFFF</span><span class="p">,</span><span class="w"> </span><span class="mh">0xFFFFFFFF</span><span class="p">},</span><span class="w"> </span><span class="c1">//reserve for user</span>

<span class="w">   </span><span class="cm">/* End */</span>
<span class="w">   </span><span class="p">{</span><span class="mh">0xFF</span><span class="p">,</span><span class="w">          </span><span class="mh">0xFFFFFFFF</span><span class="p">,</span><span class="w"> </span><span class="mh">0xFFFFFFFF</span><span class="p">},</span>
<span class="p">};</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">备注</p>
<ul class="simple">
<li><p><strong>VFS1</strong> 区域必须存在，且其大小必须大于128KB。</p></li>
<li><p>最多可配置两个VFS区域。</p></li>
</ul>
</div>
</div><div aria-labelledby="tab-2-2-3" class="sphinx-tabs-panel" hidden="true" id="panel-2-2-3" name="2-3" role="tabpanel" tabindex="0"><p>如果VFS接口设置为Flash，则需要适当调整Flash分区，并根据 <code class="file docutils literal notranslate"><span class="pre">main.c</span></code> 中的配置修改文件 <code class="docutils literal notranslate"><span class="pre">{SDK}component\soc\amebadplus\usrcfg\ameba_flashcfg.c</span></code> 中 Flash_Layout[] 数组中的 <strong>VFS1</strong> 或 <strong>VFS2</strong> 区域。</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">const</span><span class="w"> </span><span class="n">FlashLayoutInfo_TypeDef</span><span class="w"> </span><span class="n">Flash_Layout</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="cm">/*Region_Type,  [StartAddr, EndAddr]   */</span>
<span class="w">    </span><span class="p">{</span><span class="n">IMG_BOOT</span><span class="p">,</span><span class="w">      </span><span class="mh">0x08000000</span><span class="p">,</span><span class="w"> </span><span class="mh">0x08013FFF</span><span class="p">},</span><span class="w"> </span><span class="c1">//Boot Manifest(4K) + KM4 Bootloader(76K)</span>
<span class="w">    </span><span class="c1">//Users should modify below according to their own memory</span>
<span class="w">    </span><span class="p">{</span><span class="n">IMG_APP_OTA1</span><span class="p">,</span><span class="w">  </span><span class="mh">0x08014000</span><span class="p">,</span><span class="w"> </span><span class="mh">0x081F3FFF</span><span class="p">},</span><span class="w"> </span><span class="c1">//Certificate(4K) + Manifest(4K) + KM4    Application OTA1 + Manifest(4K) + RDP IMG OTA1</span>

<span class="w">    </span><span class="p">{</span><span class="n">IMG_BOOT_OTA2</span><span class="p">,</span><span class="w"> </span><span class="mh">0x08200000</span><span class="p">,</span><span class="w"> </span><span class="mh">0x08213FFF</span><span class="p">},</span><span class="w"> </span><span class="c1">//Boot Manifest(4K) + KM4 Bootloader(76K) OTA</span>
<span class="w">    </span><span class="p">{</span><span class="n">IMG_APP_OTA2</span><span class="p">,</span><span class="w">  </span><span class="mh">0x08214000</span><span class="p">,</span><span class="w"> </span><span class="mh">0x083DCFFF</span><span class="p">},</span><span class="w"> </span><span class="c1">//Certificate(4K) + Manifest(4K) + KM4    Application OTA2 + Manifest(4K) + RDP IMG OTA2</span>

<span class="w">    </span><span class="p">{</span><span class="n">FTL</span><span class="p">,</span><span class="w">           </span><span class="mh">0x083DD000</span><span class="p">,</span><span class="w"> </span><span class="mh">0x083DFFFF</span><span class="p">},</span><span class="w"> </span><span class="c1">//FTL for BT(&gt;=12K), The start offset of flash  pages which is allocated to FTL physical map.</span>
<span class="hll"><span class="w">    </span><span class="p">{</span><span class="n">VFS1</span><span class="p">,</span><span class="w">          </span><span class="mh">0x083E0000</span><span class="p">,</span><span class="w"> </span><span class="mh">0x083FFFFF</span><span class="p">},</span><span class="w"> </span><span class="c1">//VFS region 1 (128K)</span>
</span><span class="w">    </span><span class="p">{</span><span class="n">VFS2</span><span class="p">,</span><span class="w">          </span><span class="mh">0xFFFFFFFF</span><span class="p">,</span><span class="w"> </span><span class="mh">0xFFFFFFFF</span><span class="p">},</span><span class="w"> </span><span class="c1">//VFS region 2</span>
<span class="w">    </span><span class="p">{</span><span class="n">USER</span><span class="p">,</span><span class="w">          </span><span class="mh">0xFFFFFFFF</span><span class="p">,</span><span class="w"> </span><span class="mh">0xFFFFFFFF</span><span class="p">},</span><span class="w"> </span><span class="c1">//Reserved for users</span>

<span class="w">    </span><span class="cm">/* End */</span>
<span class="w">    </span><span class="p">{</span><span class="mh">0xFF</span><span class="p">,</span><span class="w">          </span><span class="mh">0xFFFFFFFF</span><span class="p">,</span><span class="w"> </span><span class="mh">0xFFFFFFFF</span><span class="p">},</span>
<span class="p">};</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">备注</p>
<ul class="simple">
<li><p><strong>VFS1</strong> 区域必须存在，且其大小必须大于128KB。</p></li>
<li><p>最多可配置两个VFS区域。</p></li>
</ul>
</div>
</div></div>
</section>
<section id="sdvfs">
<h2>SD卡中的VFS<a class="headerlink" href="#sdvfs" title="Link to this heading"></a></h2>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-3-3-0" aria-selected="true" class="sphinx-tabs-tab" id="tab-3-3-0" name="3-0" role="tab" tabindex="0">RTL8730E</button><button aria-controls="panel-3-3-1" aria-selected="false" class="sphinx-tabs-tab" id="tab-3-3-1" name="3-1" role="tab" tabindex="-1">RTL8721Dx</button><button aria-controls="panel-3-3-2" aria-selected="false" class="sphinx-tabs-tab" id="tab-3-3-2" name="3-2" role="tab" tabindex="-1">RTL8720E</button><button aria-controls="panel-3-3-3" aria-selected="false" class="sphinx-tabs-tab" id="tab-3-3-3" name="3-3" role="tab" tabindex="-1">RTL8726E</button></div><div aria-labelledby="tab-3-3-0" class="sphinx-tabs-panel" id="panel-3-3-0" name="3-0" role="tabpanel" tabindex="0"><p>FatFS文件系统仅支持SD卡，因此当 <strong>interface</strong> 设置为SD卡时， <strong>vfs_type</strong> 应设置为 <strong>FatFS</strong>。同时，需要在menuconfig中配置VFS FatFS SD相关选项。</p>
</div><div aria-labelledby="tab-3-3-1" class="sphinx-tabs-panel" hidden="true" id="panel-3-3-1" name="3-1" role="tabpanel" tabindex="0"><p>不支持。</p>
</div><div aria-labelledby="tab-3-3-2" class="sphinx-tabs-panel" hidden="true" id="panel-3-3-2" name="3-2" role="tabpanel" tabindex="0"><p>不支持。</p>
</div><div aria-labelledby="tab-3-3-3" class="sphinx-tabs-panel" hidden="true" id="panel-3-3-3" name="3-3" role="tabpanel" tabindex="0"><p>不支持。</p>
</div></div>
</section>
<section id="appvfs">
<h2>APP固件中的VFS<a class="headerlink" href="#appvfs" title="Link to this heading"></a></h2>
<p>如果用户只想通过VFS使用只读文件，VFS针对Flash提供了更方便的只读配置功能。详细步骤如下：</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-4-4-0" aria-selected="true" class="sphinx-tabs-tab" id="tab-4-4-0" name="4-0" role="tab" tabindex="0">RTL8730E</button><button aria-controls="panel-4-4-1" aria-selected="false" class="sphinx-tabs-tab" id="tab-4-4-1" name="4-1" role="tab" tabindex="-1">RTL8720E</button><button aria-controls="panel-4-4-2" aria-selected="false" class="sphinx-tabs-tab" id="tab-4-4-2" name="4-2" role="tab" tabindex="-1">RTL8726E</button><button aria-controls="panel-4-4-3" aria-selected="false" class="sphinx-tabs-tab" id="tab-4-4-3" name="4-3" role="tab" tabindex="-1">RTL8721Dx</button></div><div aria-labelledby="tab-4-4-0" class="sphinx-tabs-panel" id="panel-4-4-0" name="4-0" role="tabpanel" tabindex="0"><ol class="arabic">
<li><p>准备只读文件并将其转换成FAT格式的二进制文件，具体方法请参考 <a class="reference internal" href="#fatfs-bin-file-generation"><span class="std std-ref">FatFS二进制文件</span></a>。</p></li>
<li><p>将生成的二进制文件命名为 <code class="file docutils literal notranslate"><span class="pre">fatfs.bin</span></code>，并放置于 <code class="docutils literal notranslate"><span class="pre">{SDK}\amebasmart_gcc_project</span></code> 目录下。</p></li>
<li><p>在menuconfig中启用以下配置：</p>
<figure class="align-center">
<a class="reference internal image-reference" href="../../_images/vfs_within_app_image_1.png"><img alt="../../_images/vfs_within_app_image_1.png" src="../../_images/vfs_within_app_image_1.png" style="width: 299.7px; height: 114.3px;" /></a>
</figure>
<figure class="align-center">
<a class="reference internal image-reference" href="../../_images/vfs_within_app_image_2.png"><img alt="../../_images/vfs_within_app_image_2.png" src="../../_images/vfs_within_app_image_2.png" style="width: 221.4px; height: 75.60000000000001px;" /></a>
</figure>
</li>
<li><p>重新编译应用程序固件。</p></li>
</ol>
<p>应用程序固件 (<code class="file docutils literal notranslate"><span class="pre">km0_km4_ca32_app.bin</span></code>) 将包含一个FAT格式的只读VFS区域，该区域将在启动过程中自动挂载。</p>
</div><div aria-labelledby="tab-4-4-1" class="sphinx-tabs-panel" hidden="true" id="panel-4-4-1" name="4-1" role="tabpanel" tabindex="0"><ol class="arabic">
<li><p>准备只读文件并将其转换成FAT格式的二进制文件，具体方法请参考  <a class="reference internal" href="#fatfs-bin-file-generation"><span class="std std-ref">FatFS二进制文件</span></a>。</p></li>
<li><p>将生成的二进制文件命名为 <code class="file docutils literal notranslate"><span class="pre">fatfs.bin</span></code>，并放置于 <code class="docutils literal notranslate"><span class="pre">{SDK}\amebalite_gcc_project</span></code> 目录下。</p></li>
<li><p>在menuconfig中启用以下配置：</p>
<figure class="align-center">
<a class="reference internal image-reference" href="../../_images/vfs_within_app_image_1.png"><img alt="../../_images/vfs_within_app_image_1.png" src="../../_images/vfs_within_app_image_1.png" style="width: 299.7px; height: 114.3px;" /></a>
</figure>
<figure class="align-center">
<a class="reference internal image-reference" href="../../_images/vfs_within_app_image_2.png"><img alt="../../_images/vfs_within_app_image_2.png" src="../../_images/vfs_within_app_image_2.png" style="width: 221.4px; height: 75.60000000000001px;" /></a>
</figure>
</li>
<li><p>重新编译应用程序固件。</p></li>
</ol>
<p>应用程序固件 (<code class="file docutils literal notranslate"><span class="pre">kr4_km4_app.bin</span></code>) 将包含一个FAT格式的只读VFS区域，该区域将在启动过程中自动挂载。</p>
</div><div aria-labelledby="tab-4-4-2" class="sphinx-tabs-panel" hidden="true" id="panel-4-4-2" name="4-2" role="tabpanel" tabindex="0"><ol class="arabic">
<li><p>准备只读文件并将其转换成FAT格式的二进制文件，具体方法请参考  <a class="reference internal" href="#fatfs-bin-file-generation"><span class="std std-ref">FatFS二进制文件</span></a>。</p></li>
<li><p>将生成的二进制文件命名为 <code class="file docutils literal notranslate"><span class="pre">fatfs.bin</span></code>，并放置于 <code class="docutils literal notranslate"><span class="pre">{SDK}\amebalite_gcc_project</span></code> 目录下。</p></li>
<li><p>在menuconfig中启用以下配置：</p>
<figure class="align-center">
<a class="reference internal image-reference" href="../../_images/vfs_within_app_image_1.png"><img alt="../../_images/vfs_within_app_image_1.png" src="../../_images/vfs_within_app_image_1.png" style="width: 299.7px; height: 114.3px;" /></a>
</figure>
<figure class="align-center">
<a class="reference internal image-reference" href="../../_images/vfs_within_app_image_2.png"><img alt="../../_images/vfs_within_app_image_2.png" src="../../_images/vfs_within_app_image_2.png" style="width: 221.4px; height: 75.60000000000001px;" /></a>
</figure>
</li>
<li><p>重新编译应用程序固件。</p></li>
</ol>
<p>应用程序固件 (<code class="file docutils literal notranslate"><span class="pre">kr4_km4_app.bin</span></code>) 将包含一个FAT格式的只读VFS区域，该区域将在启动过程中自动挂载。</p>
</div><div aria-labelledby="tab-4-4-3" class="sphinx-tabs-panel" hidden="true" id="panel-4-4-3" name="4-3" role="tabpanel" tabindex="0"><ol class="arabic">
<li><p>准备只读文件并将其转换成FAT格式的二进制文件，具体方法请参考 <a class="reference internal" href="#fatfs-bin-file-generation"><span class="std std-ref">FatFS二进制文件</span></a>。</p></li>
<li><p>将生成的二进制文件命名为 <code class="file docutils literal notranslate"><span class="pre">fatfs.bin</span></code>，并放置于 <code class="docutils literal notranslate"><span class="pre">{SDK}\amebadplus_gcc_project</span></code> 目录下。</p></li>
<li><p>在menuconfig中启用以下配置：</p>
<figure class="align-center">
<a class="reference internal image-reference" href="../../_images/vfs_within_app_image_1.png"><img alt="../../_images/vfs_within_app_image_1.png" src="../../_images/vfs_within_app_image_1.png" style="width: 299.7px; height: 114.3px;" /></a>
</figure>
<figure class="align-center">
<a class="reference internal image-reference" href="../../_images/vfs_within_app_image_2.png"><img alt="../../_images/vfs_within_app_image_2.png" src="../../_images/vfs_within_app_image_2.png" style="width: 221.4px; height: 75.60000000000001px;" /></a>
</figure>
</li>
<li><p>重新编译应用程序固件。</p></li>
</ol>
<p>应用程序固件 (<code class="file docutils literal notranslate"><span class="pre">km0_km4_app.bin</span></code>) 将包含一个FAT格式的只读VFS区域，该区域将在启动过程中自动挂载。</p>
</div></div>
<p>启动后，出现日志 <strong>VFS-FAT Init Success</strong>，即表明只读文件系统已成功挂载。</p>
<p>关于文件使用方法，请参考 <a class="reference internal" href="#common-file-operation"><span class="std std-ref">通用文件操作</span></a> 或 <a class="reference internal" href="#key-value-operation"><span class="std std-ref">KV 操作</span></a>。</p>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>为了优化只读文件系统的有效空间利用率，目前仅支持FAT格式。</p>
</div>
</section>
<section id="common-file-operation">
<span id="id3"></span><h2>通用文件操作<a class="headerlink" href="#common-file-operation" title="Link to this heading"></a></h2>
<p>VFS 中常用的通用文件操作接口如下所示：</p>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 30.0%" />
<col style="width: 40.0%" />
<col style="width: 30.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>API</p></th>
<th class="head"><p>Parameter</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>fopen</p></td>
<td><ul class="simple">
<li><p>const char * filename</p></li>
<li><p>const char * mode</p></li>
</ul>
</td>
<td><p>Open the filename pointed to, by filename using the given mode</p></td>
</tr>
<tr class="row-odd"><td><p>fclose</p></td>
<td><p>FILE * stream</p></td>
<td><p>Close the stream</p></td>
</tr>
<tr class="row-even"><td><p>fread</p></td>
<td><ul class="simple">
<li><p>void * ptr</p></li>
<li><p>size_t size</p></li>
<li><p>size_t count</p></li>
<li><p>FILE * stream</p></li>
</ul>
</td>
<td><p>Read data from the given stream by ptr into the array pointed to</p></td>
</tr>
<tr class="row-odd"><td><p>fwrite</p></td>
<td><ul class="simple">
<li><p>const void * ptr</p></li>
<li><p>size_t size</p></li>
<li><p>size_t count</p></li>
<li><p>FILE * stream</p></li>
</ul>
</td>
<td><p>Write data from the array pointed to by ptr to the given stream</p></td>
</tr>
<tr class="row-even"><td><p>fseek</p></td>
<td><ul class="simple">
<li><p>FILE * stream</p></li>
<li><p>long int offset</p></li>
<li><p>int origin</p></li>
</ul>
</td>
<td><p>Set the file position of the stream to the given offset</p></td>
</tr>
<tr class="row-odd"><td><p>rewind</p></td>
<td><p>FILE * stream</p></td>
<td><p>Set the file position to the beginning of the file of the given stream</p></td>
</tr>
<tr class="row-even"><td><p>fgetpos</p></td>
<td><ul class="simple">
<li><p>FILE * stream</p></li>
<li><p>fpos_t * p</p></li>
</ul>
</td>
<td><p>Get the current file position of the stream and writes it to pos</p></td>
</tr>
<tr class="row-odd"><td><p>fsetpos</p></td>
<td><ul class="simple">
<li><p>FILE * stream</p></li>
<li><p>fpos_t * p</p></li>
</ul>
</td>
<td><p>Set the file position of the given stream to the given position</p></td>
</tr>
<tr class="row-even"><td><p>fflush</p></td>
<td><p>FILE * stream</p></td>
<td><p>Flush the output buffer of a stream</p></td>
</tr>
<tr class="row-odd"><td><p>remove</p></td>
<td><p>const char * filename</p></td>
<td><p>Delete the given filename so that it is no longer accessible</p></td>
</tr>
<tr class="row-even"><td><p>rename</p></td>
<td><ul class="simple">
<li><p>const char * oldname</p></li>
<li><p>const char * newname</p></li>
</ul>
</td>
<td><p>Cause the filename referred to from old_filename to new_filename</p></td>
</tr>
<tr class="row-odd"><td><p>feof</p></td>
<td><p>FILE * stream</p></td>
<td><p>Test the end-of-file indicator for the given stream</p></td>
</tr>
<tr class="row-even"><td><p>ferror</p></td>
<td><p>FILE * stream</p></td>
<td><p>Test the error indicator for the given stream</p></td>
</tr>
<tr class="row-odd"><td><p>ftell</p></td>
<td><p>FILE * stream</p></td>
<td><p>Return the current file position of the given stream</p></td>
</tr>
<tr class="row-even"><td><p>ftruncate</p></td>
<td><ul class="simple">
<li><p>FILE * stream</p></li>
<li><p>off_t length</p></li>
</ul>
</td>
<td><p>Truncate a file to a specified length</p></td>
</tr>
<tr class="row-odd"><td><p>opendir</p></td>
<td><p>const char * name</p></td>
<td><p>Open a directory</p></td>
</tr>
<tr class="row-even"><td><p>readdir</p></td>
<td><p>DIR * pdir</p></td>
<td><p>Read a directory</p></td>
</tr>
<tr class="row-odd"><td><p>closedir</p></td>
<td><p>DIR * dirp</p></td>
<td><p>Close a directory</p></td>
</tr>
<tr class="row-even"><td><p>rmdir</p></td>
<td><p>const char * path</p></td>
<td><p>Remove a directory</p></td>
</tr>
<tr class="row-odd"><td><p>mkdir</p></td>
<td><ul class="simple">
<li><p>const char * pathname</p></li>
<li><p>mode_t mode</p></li>
</ul>
</td>
<td><p>Make a directory</p></td>
</tr>
<tr class="row-even"><td><p>access</p></td>
<td><ul class="simple">
<li><p>const char * pathname</p></li>
<li><p>int mode</p></li>
</ul>
</td>
<td><p>Determine accessibility of a file</p></td>
</tr>
<tr class="row-odd"><td><p>stat</p></td>
<td><ul class="simple">
<li><p>const char * path</p></li>
<li><p>struct stat * buf</p></li>
</ul>
</td>
<td><p>Get file status</p></td>
</tr>
</tbody>
</table>
<p>用户可以通过 <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">all</span> <span class="pre">EXAMPLE=vfs</span></code> 命令重新编译项目，以测试通用文件操作是如何工作的。测试日志应包含如下关键信息：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>[example_vfs_thread] fwrite succeeded !!!
[example_vfs_thread] fread succeeded !!!
[example_vfs_thread] remove file succeeded !!!
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>如果成功，fseek将返回当前文件指针相对于文件开头的偏移量，这与标准接口不同。</p>
</div>
</section>
<section id="kv">
<span id="key-value-operation"></span><h2>KV 操作<a class="headerlink" href="#kv" title="Link to this heading"></a></h2>
<p>我们同时提供了简单的键值对（KV）接口，这些接口位于 <code class="docutils literal notranslate"><span class="pre">{SDK}\component\file_system\kv\kv.c</span></code>。用户可以通过 <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">all</span> <span class="pre">EXAMPLE=kv</span></code> 命令重新编译项目，以测试KV接口是如何工作的。测试日志应包含如下关键信息：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rt_kv_set</span> <span class="n">success</span><span class="p">,</span> <span class="n">write</span> <span class="mi">28</span> <span class="n">letters</span><span class="o">.</span>
<span class="n">rt_kv_get</span> <span class="n">success</span><span class="p">,</span> <span class="n">read</span> <span class="mi">28</span> <span class="n">letters</span><span class="o">.</span>
<span class="n">rt_kv_delett</span> <span class="n">success</span><span class="o">.</span>
</pre></div>
</div>
</section>
<section id="id4">
<h2>代码转换<a class="headerlink" href="#id4" title="Link to this heading"></a></h2>
<p>FatFS 默认不支持 Unicode 与其他编码之间的转换。</p>
<p>修改 <code class="docutils literal notranslate"><span class="pre">{SDK}\component\file_system\fatfs\r0.14b\include\ffconf.h</span></code> 文件中的宏 <code class="docutils literal notranslate"><span class="pre">FF_CODE_PAGE</span></code> 可开启代码转换功能，开发者需根据目标代码页编号配置 <code class="docutils literal notranslate"><span class="pre">FF_CODE_PAGE</span></code>。</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#define FF_CODE_PAGE  999</span>
<span class="cm">/* This option specifies the OEM code page to be used on the target system.</span>
<span class="cm">/  Incorrect code page setting can cause a file open failure.</span>
<span class="cm">/   437 - U.S.</span>
<span class="cm">/   720 - Arabic</span>
<span class="cm">/   737 - Greek</span>
<span class="cm">/   771 - KBL</span>
<span class="cm">/   775 - Baltic</span>
<span class="cm">/   850 - Latin 1</span>
<span class="cm">/   852 - Latin 2</span>
<span class="cm">/   855 - Cyrillic</span>
<span class="cm">/   857 - Turkish</span>
<span class="cm">/   860 - Portuguese</span>
<span class="cm">/   861 - Icelandic</span>
<span class="cm">/   862 - Hebrew</span>
<span class="cm">/   863 - Canadian French</span>
<span class="cm">/   864 - Arabic</span>
<span class="cm">/   865 - Nordic</span>
<span class="cm">/   866 - Russian</span>
<span class="cm">/   869 - Greek 2</span>
<span class="cm">/   932 - Japanese (DBCS)</span>
<span class="cm">/   936 - Simplified Chinese (DBCS)</span>
<span class="cm">/   949 - Korean (DBCS)</span>
<span class="cm">/   950 - Traditional Chinese (DBCS)</span>
<span class="cm">/   999 - Realtek defined for code size</span>
<span class="cm">/     0 - Include all code pages above and configured by f_setcp()</span>
<span class="cm">*/</span>
</pre></div>
</div>
</section>
<section id="id5">
<h2>VFS 加密<a class="headerlink" href="#id5" title="Link to this heading"></a></h2>
<p>对于特殊的存储安全需求，用户可通过配置VFS的加解密功能实现数据保护。相关接口的使用说明位于 <code class="docutils literal notranslate"><span class="pre">{SDK}\component\example\storage\vfs_encrypt\readme.txt</span></code></p>
<p>用户可以通过 <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">all</span> <span class="pre">EXAMPLE=vfs_encrypt</span></code> 命令重新编译项目，以测试VFS加密是如何工作的。测试日志应包含如下关键信息：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>[example_vfs_encrypt_thread] fwrite succeeded !!!
[example_vfs_encrypt_thread] fread succeeded !!!
[example_vfs_encrypt_thread] remove file succeeded !!!
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>当启用VFS加密功能时，系统会对明文数据进行填充处理，这将导致额外的储存空间开销。</p>
</div>
</section>
<section id="vfs-bin-file-generation">
<span id="id6"></span><h2>VFS二进制文件生成<a class="headerlink" href="#vfs-bin-file-generation" title="Link to this heading"></a></h2>
<p>若需预先将数据存放至Flash中，可在PC端生成VFS二进制文件。生成完成后，需根据Flash布局将二进制文件下载至VFS区域。</p>
<section id="littlefs">
<h3>LittleFS二进制文件<a class="headerlink" href="#littlefs" title="Link to this heading"></a></h3>
<ol class="arabic">
<li><p>在生成LittleFS二进制文件前，需准备一个包含所需文件的目录。例如：</p>
<figure class="align-center">
<a class="reference internal image-reference" href="../../_images/littlefs_bin_generation_step1.png"><img alt="../../_images/littlefs_bin_generation_step1.png" src="../../_images/littlefs_bin_generation_step1.png" style="width: 154.8px; height: 178.20000000000002px;" /></a>
</figure>
<p>在Flash中， <strong>AUDIO</strong> 和 <strong>KV</strong> 目录作为 LittleFS 目录， <strong>test</strong> 则相当于文件系统的根目录。</p>
</li>
<li><p>在位于 <code class="docutils literal notranslate"><span class="pre">\tools\littlefs</span></code> 目录下的 <strong>mklittlefs</strong> 工具中，使用以下命令生成LittleFS二进制文件：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$./mklittlefs -b 4096 -p 256 -s 0x20000 -c test image_littlefs.bin
</pre></div>
</div>
<p>参数说明：</p>
<ul class="simple">
<li><p><strong>-b</strong>：块大小，由Flash决定</p></li>
<li><p><strong>-p</strong>：页大小</p></li>
<li><p><strong>-s</strong>：二进制文件大小</p></li>
<li><p><strong>-c</strong>：目标目录</p></li>
<li><p><strong>image_littlefs.bin</strong>：生成的LittleFS二进制文件名</p></li>
</ul>
<figure class="align-center">
<a class="reference internal image-reference" href="../../_images/littlefs_bin_generation_step2.png"><img alt="../../_images/littlefs_bin_generation_step2.png" src="../../_images/littlefs_bin_generation_step2.png" style="width: 596.7px; height: 66.60000000000001px;" /></a>
</figure>
<div class="admonition note">
<p class="admonition-title">备注</p>
<ul class="simple">
<li><p><strong>-b 4096</strong> 和 <strong>-p 256</strong> 为默认配置，用户需根据 <code class="docutils literal notranslate"><span class="pre">{SDK}\component\file_system\littlefs\littlefs_adapter.c</span></code> 文件中的 <code class="docutils literal notranslate"><span class="pre">lfs_config</span></code> 中的 <em>block_size</em> 和 <em>cache_size</em> 进行适配。</p></li>
<li><p><strong>-s 0x20000</strong> 应根据 <a class="reference internal" href="#vfs-on-flash"><span class="std std-ref">Flash中的VFS</span></a> 中提到的VFS区域大小来设置。</p></li>
</ul>
</div>
</li>
<li><p>下载固件至Flash中。</p>
<p>Image Tool的起始地址应为 <a class="reference internal" href="#vfs-on-flash"><span class="std std-ref">Flash中的VFS</span></a> 中提到的VFS Flash区域的 <code class="docutils literal notranslate"><span class="pre">StartAddr</span></code>，结束地址应为 <code class="docutils literal notranslate"><span class="pre">EndAddr</span> <span class="pre">+</span> <span class="pre">1</span></code>。</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-5-5-0" aria-selected="true" class="sphinx-tabs-tab" id="tab-5-5-0" name="5-0" role="tab" tabindex="0">RTL8721Dx</button><button aria-controls="panel-5-5-1" aria-selected="false" class="sphinx-tabs-tab" id="tab-5-5-1" name="5-1" role="tab" tabindex="-1">RTL8720E</button><button aria-controls="panel-5-5-2" aria-selected="false" class="sphinx-tabs-tab" id="tab-5-5-2" name="5-2" role="tab" tabindex="-1">RTL8726E</button><button aria-controls="panel-5-5-3" aria-selected="false" class="sphinx-tabs-tab" id="tab-5-5-3" name="5-3" role="tab" tabindex="-1">RTL8730E</button></div><div aria-labelledby="tab-5-5-0" class="sphinx-tabs-panel" id="panel-5-5-0" name="5-0" role="tabpanel" tabindex="0"><figure class="align-center">
<a class="reference internal image-reference" href="../../_images/littlefs_bin_download_dplus.png"><img alt="../../_images/littlefs_bin_download_dplus.png" src="../../_images/littlefs_bin_download_dplus.png" style="width: 777.6px; height: 112.8px;" /></a>
</figure>
</div><div aria-labelledby="tab-5-5-1" class="sphinx-tabs-panel" hidden="true" id="panel-5-5-1" name="5-1" role="tabpanel" tabindex="0"><figure class="align-center">
<a class="reference internal image-reference" href="../../_images/littlefs_bin_download_lite.png"><img alt="../../_images/littlefs_bin_download_lite.png" src="../../_images/littlefs_bin_download_lite.png" style="width: 772.2px; height: 108.0px;" /></a>
</figure>
</div><div aria-labelledby="tab-5-5-2" class="sphinx-tabs-panel" hidden="true" id="panel-5-5-2" name="5-2" role="tabpanel" tabindex="0"><figure class="align-center">
<a class="reference internal image-reference" href="../../_images/littlefs_bin_download_lite.png"><img alt="../../_images/littlefs_bin_download_lite.png" src="../../_images/littlefs_bin_download_lite.png" style="width: 772.2px; height: 108.0px;" /></a>
</figure>
</div><div aria-labelledby="tab-5-5-3" class="sphinx-tabs-panel" hidden="true" id="panel-5-5-3" name="5-3" role="tabpanel" tabindex="0"><figure class="align-center">
<a class="reference internal image-reference" href="../../_images/littlefs_bin_download_smart.png"><img alt="../../_images/littlefs_bin_download_smart.png" src="../../_images/littlefs_bin_download_smart.png" style="width: 775.8000000000001px; height: 105.3px;" /></a>
</figure>
</div></div>
</li>
</ol>
</section>
<section id="fatfs">
<span id="fatfs-bin-file-generation"></span><h3>FatFS二进制文件<a class="headerlink" href="#fatfs" title="Link to this heading"></a></h3>
<p>生成FatFS二进制文件的步骤如下：</p>
<ol class="arabic">
<li><p>使用 <code class="docutils literal notranslate"><span class="pre">root&#64;ubuntu</span> <span class="pre">#</span> <span class="pre">dd</span> <span class="pre">if=/dev/zero</span> <span class="pre">of=test.bin</span> <span class="pre">count=64</span> <span class="pre">bs=1KB</span></code> 命令创建 <code class="docutils literal notranslate"><span class="pre">test.bin</span></code> 文件，该文件包含64个块，每个块的大小为1KB。</p></li>
<li><p>使用 <code class="docutils literal notranslate"><span class="pre">root&#64;ubuntu</span> <span class="pre">#</span> <span class="pre">mkfs.fat</span> <span class="pre">-S</span> <span class="pre">512-F</span> <span class="pre">12</span> <span class="pre">test.bin</span></code> 命令编译一个FAT文件系统。</p></li>
<li><p>使用 <code class="docutils literal notranslate"><span class="pre">root&#64;ubuntu</span> <span class="pre">#</span> <span class="pre">sudo</span> <span class="pre">mount</span> <span class="pre">test.bin</span> <span class="pre">./fs``将</span> <span class="pre">``test.bin</span></code> 挂载到文件夹 <code class="docutils literal notranslate"><span class="pre">fs</span></code> 中。</p></li>
<li><p>使用 <code class="docutils literal notranslate"><span class="pre">root&#64;ubuntu</span> <span class="pre">#</span> <span class="pre">sudo</span> <span class="pre">cp</span> <span class="pre">hello.txt</span> <span class="pre">./fs</span></code> 命令将用户需要存储的文件复制到 <code class="docutils literal notranslate"><span class="pre">test.bin</span></code> 中。</p>
<p>这一步， <code class="docutils literal notranslate"><span class="pre">hello.txt</span></code> 文件被存储到 <code class="docutils literal notranslate"><span class="pre">test.bin</span></code> 中。</p>
</li>
<li><p>使用 <code class="docutils literal notranslate"><span class="pre">root&#64;ubuntu</span> <span class="pre">#</span> <span class="pre">sudo</span> <span class="pre">umount</span> <span class="pre">./fs</span></code> 命令卸载 <code class="docutils literal notranslate"><span class="pre">test.bin</span></code> 后生成FatFS文件。</p>
<p>请查阅其他相关信息，最终将 <code class="docutils literal notranslate"><span class="pre">test.bin</span></code> 复制到Flash的用户数据区中。</p>
</li>
</ol>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="页脚">
        <a href="0_vfs_index_cn.html" class="btn btn-neutral float-left" title="虚拟文件系统" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> 上一页</a>
        <a href="../0_ftl/0_ftl_index_cn.html" class="btn btn-neutral float-right" title="Flash 转换层 (FTL)" accesskey="n" rel="next">下一页 <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; 版权所有 2025, Realsil。</p>
  </div>

  利用 <a href="https://www.sphinx-doc.org/">Sphinx</a> 构建，使用的 
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">主题</a>
    由 <a href="https://readthedocs.org">Read the Docs</a> 开发.
   

</footer>
        </div>

      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 



</body>
</html>